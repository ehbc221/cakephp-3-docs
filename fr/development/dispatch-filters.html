

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Filtres du Dispatcher" lang="fr" name="title" />
<meta content="Les filtres du Dispatcher sont une couche middleware pour CakePHP permettant de modifier la requête ou la réponse avant qu'elles ne soit envoyées" lang="fr" name="description" />
<meta content="middleware, filters, dispatcher, request, response, rack, application stack, events, beforeDispatch, afterDispatch, router" lang="fr" name="keywords" />

    <title>Filtres du Dispatcher - 3.x</title>
    <link href="../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/app.js"></script>

    <link rel="alternate" hreflang="en" href="../../en/development/dispatch-filters.html" /><link rel="alternate" hreflang="pt_BR" href="../../pt/development/dispatch-filters.html" /><link rel="alternate" hreflang="es" href="../../es/development/dispatch-filters.html" /><link rel="alternate" hreflang="ja" href="../../ja/development/dispatch-filters.html" /><link rel="alternate" hreflang="zh" href="../../zh/development/dispatch-filters.html" /><link rel="alternate" hreflang="tr" href="../../tr/development/dispatch-filters.html" /><link rel="alternate" hreflang="ru" href="../../ru/development/dispatch-filters.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within documentation CakePHP Cookbook 3.5" href="../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="documentation CakePHP Cookbook 3.5" href="../index.html" />
    <link rel="up" title="Routing" href="routing.html" />
    <link rel="next" title="Les Objets Request &amp; Response" href="../controllers/request-response.html" />
    <link rel="prev" title="Routing" href="routing.html" />

    <script type="text/javascript">
    window.lang = "fr";
    </script>
  </head>
  <body>

<div id="container">
    
    <header class="nav-down">
        <div class="container-fluid hidden-xs hidden-sm">
            <div class="row">
                <div class="col-sm-3 col-md-3">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-9 col-md-9">
                    <nav class="navbar-right">
                        <ul class="menu">
                            <li class="first">
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
                                <ul class="submenu">
                                    
<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                                </ul>
                            </li>

                            <li><a href="https://cakephp.org/business-solutions">Business Solutions</a></li>
                            <li><a href="https://cakephp.org/writers">Get Paid To Write</a></li>
                            <li><a href="https://cakephp.org/pages/team">Team</a></li>

                            <li>
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
                                <div class="megamenu full">
                                    <div class="row">
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                                            </ul>
                                        </div>
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        
        <div class="container-fluid hidden-md hidden-lg">
            <div class="row">
                <div class="col-sm-6 col-xs-6">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-6 col-xs-6">
                    <div class="navbar-right">
                        <button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
                            <i class="fa fa-bars toggle-modal"></i>
                        </button>
                    </div>
                    <div id="wrap">
                        <form class="search" action="../search.html" method="get">
                            <input name="q" type="search" placeholder="What are you looking for?">
                            <input id="search_submit" value="Recherche" type="submit">
                        </form>
                    </div>
                </div>
            </div>
        </div>

        
        <section id="nav-cook" class="hidden-xs hidden-sm">
            <div class="container-fluid ">
                <div class="row ">
                    <div class="col-md-12 back-book">
                        <div class="col-md-5 text-center t-cook-nav p0 hidden-sm hidden-xs">
                            <h2>
                                <a href="../contents.html">
                                    <span class="glyph_range icon-submenu icon-submenu-cook">B</span>
                                    CakePHP 3.5 Red Velvet <strong>Cookbook</strong>
                                </a>
                            </h2>
                        </div>

                        <div class="col-md-4 hidden-sm">
                            <form class="search" action="../search.html" method="get">
                                <input type="hidden" name="check_keywords" value="yes" />
                                <input type="hidden" name="area" value="default" />

                                <div class="col-md-10 p0">
                                    <input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
                                </div>
                                <div class="col-md-2 p0 search-cook">
                                    <button type="submit">
                                        <span class="glyph_range icon-submenu icon-submenu-cook">A</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        
                        <div class="col-md-3">
                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Language:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
                                                    role="button" aria-haspopup="true" aria-expanded="false" href="#">
                                                        fr
                                                        <i class="fa fa-menu-en fa-chevron-down"></i>
                                                    </a>
                                            <ul class="dropdown-menu">
                                            
                                                <li><a href="../../en/development/dispatch-filters.html">en</a></li>
                                            
                                                <li><a href="../../pt/development/dispatch-filters.html">pt</a></li>
                                            
                                                <li><a href="../../es/development/dispatch-filters.html">es</a></li>
                                            
                                                <li><a href="../../ja/development/dispatch-filters.html">ja</a></li>
                                            
                                                <li></li>
                                            
                                                <li><a href="../../zh/development/dispatch-filters.html">zh</a></li>
                                            
                                                <li><a href="../../tr/development/dispatch-filters.html">tr</a></li>
                                            
                                                <li><a href="../../ru/development/dispatch-filters.html">ru</a></li>
                                            
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Version:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">3.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
                                            <ul class="dropdown-menu">
                                                <li><a href="https://book.cakephp.org/3.0/fr">3.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/2.0/fr">2.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.3/fr/">1.3 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.2/fr/">1.2 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.1/en">1.1 Book</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
        </section>
    </header>

    
    <section class="nav-btn visible-sm visible-xs">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
                </div>

                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
                </div>
            </div>
        </div>
    </section>

    
    <div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title-cookbook" id="modal-header"></h4>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>

<div class="container page-container "><div id="improve-slideout">
        <i class="fa fa-pencil icon-improve"></i>
        <a href="https://github.com/cakephp/docs/edit/3.0/fr/development/dispatch-filters.rst" target="_blank">
            <div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
        </a>
    </div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

    
    <div class="row">
        <div class="col-sm-12 col-md-9 col-md-push-3"><div class="page-contents col-sm-5">
                <h3>Page Contents</h3>
                <ul>
<li><a class="reference internal" href="#">Filtres du Dispatcher</a><ul>
<li><a class="reference internal" href="#filtres-integres">Filtres Intégrés</a></li>
<li><a class="reference internal" href="#utiliser-les-filtres">Utiliser les Filtres</a><ul>
<li><a class="reference internal" href="#configurer-l-ordre-de-filter">Configurer l&#8217;Ordre de Filter</a></li>
<li><a class="reference internal" href="#appliquer-les-filtres-de-facon-conditionnelle">Appliquer les Filtres de Façon Conditionnelle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#construire-un-filtre">Construire un Filtre</a></li>
</ul>
</li>
</ul>

            </div><div class="document-body">
            
  <div class="section" id="filtres-du-dispatcher">
<h1>Filtres du Dispatcher<a class="headerlink" href="#filtres-du-dispatcher" title="Lien permanent vers ce titre">¶</a></h1>
<div class="deprecated">
<p><span class="versionmodified">Obsolète depuis la version 3.3.0: </span>Depuis la version 3.3.0 , les Filtres de Dispatcher sont dépréciés. Vous
devriez maintenant utiliser le <a class="reference internal" href="../controllers/middleware.html"><span class="doc">Middleware</span></a> à la place.</p>
</div>
<p>Il y a plusieurs raisons de vouloir exécuter un bout de code avant que tout
code de controller ne soit lancé ou juste avant que la réponse ne soit
envoyée au client, comme la mise en cache de la réponse, le tunning de header,
une authentification spéciale ou juste pour fournir l&#8217;accès à une réponse de
l&#8217;API critique plus rapidement qu&#8217;avec un cycle complet de dispatch
de requêtes.</p>
<p>CakePHP fournit une interface propre et extensible pour de tels cas pour
attacher les filtres au cycle de dispatch, de la même façon qu&#8217;une
couche middleware pour fournir des services empilables ou des routines
pour chaque requête. Nous les appelons <em>Dispatcher Filters</em>.</p>
<div class="section" id="filtres-integres">
<h2>Filtres Intégrés<a class="headerlink" href="#filtres-integres" title="Lien permanent vers ce titre">¶</a></h2>
<p>CakePHP fournit plusieurs filtres de dispatcher intégrés. Ils gèrent des
fonctionnalités habituelles dont toutes les applications vont avoir besoin.
Les filtres intégrés sont:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">AssetFilter</span></code> vérifie si la requête fait référence au fichier d&#8217;asset de
plugin ou du theme, comme un fichier CSS, un fichier JavaScript ou une image
stockée soit dans le dossier webroot d&#8217;un plugin ou celui qui correspond pour
un Theme. Il va servir le fichier correspondant s&#8217;il est trouvé, stoppant le
reste du cycle de dispatch:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Utilisez options pour définir le cacheTime de vos assets statiques</span>
<span class="c1">// S&#39;il n&#39;est pas défini, il est de 1 heure (+1 hour) par défaut.</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Asset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cacheTime&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;+24 hours&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">RoutingFilter</span></code> applique les règles de routing de l&#8217;application pour l&#8217;URL
de la requête. Remplit <code class="docutils literal"><span class="pre">$request-&gt;getParam()</span></code> avec les résultats de routing.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ControllerFactory</span></code> utilise <code class="docutils literal"><span class="pre">$request-&gt;getParam()</span></code> pour localiser le
controller qui gère la requête courante.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">LocaleSelector</span></code> active le langage automatiquement en changeant le header
<code class="docutils literal"><span class="pre">Accept-Language</span></code> envoyé par le navigateur.</p>
</li>
</ul>
</div>
<div class="section" id="utiliser-les-filtres">
<h2>Utiliser les Filtres<a class="headerlink" href="#utiliser-les-filtres" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les filtres sont habituellement activés dans le fichier <strong>bootstrap.php</strong> de
votre application, mais vous pouvez les charger à n&#8217;importe quel moment avant
que la requête ne soit dispatchée. Ajouter et retirer les filtres se fait avec
<code class="xref php php-class docutils literal"><span class="pre">Cake\Routing\DispatcherFactory</span></code>. Par défaut, le template d&#8217;une
application CakePHP est fourni avec un couple de classes filter déjà activées
pour toutes les requêtes; Regardons la façon dont elles sont ajoutées:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Routing&#39;</span><span class="p">);</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;ControllerFactory&#39;</span><span class="p">);</span>

<span class="c1">// La syntaxe de plugin est aussi possible</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;PluginName.DispatcherName&#39;</span><span class="p">);</span>

<span class="c1">// Utilisez les options pour définir la priorité</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Asset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;priority&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
<p>Les filtres Dispatcher avec une priorité <code class="docutils literal"><span class="pre">priority</span></code> supérieure (nombres les
plus faibles) - seront exécutés les premiers. La priorité est par défaut à
<code class="docutils literal"><span class="pre">10</span></code>.</p>
<p>Alors qu&#8217;utiliser le nom de la chaîne est pratique, vous pouvez aussi passer les
instances dans <code class="docutils literal"><span class="pre">add()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Cake\Routing\Filter\RoutingFilter</span><span class="p">;</span>

<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">RoutingFilter</span><span class="p">());</span>
</pre></div>
</div>
<div class="section" id="configurer-l-ordre-de-filter">
<h3>Configurer l&#8217;Ordre de Filter<a class="headerlink" href="#configurer-l-ordre-de-filter" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lors de l&#8217;ajout de filtres, vous pouvez contrôler l&#8217;ordre dans lequel ils sont
appelés en utilisant les priorités du gestionnaire d&#8217;event. Alors que les
filtres peuvent définir une priorité par défaut en utilisant la propriété
<code class="docutils literal"><span class="pre">$_priority</span></code>, vous pouvez définir une priorité spécifique quand vous attachez
le filtre:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Asset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;priority&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">AssetFilter</span><span class="p">([</span><span class="s1">&#39;priority&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]));</span>
</pre></div>
</div>
<p>Plus la priorité est haute, plus le filtre sera appelé tardivement.</p>
</div>
<div class="section" id="appliquer-les-filtres-de-facon-conditionnelle">
<h3>Appliquer les Filtres de Façon Conditionnelle<a class="headerlink" href="#appliquer-les-filtres-de-facon-conditionnelle" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous ne voulez pas exécuter un filtre sur chaque requête, vous pouvez
utiliser des conditions pour les appliquer seulement certaines fois. Vous
pouvez appliquer les conditions en utilisant les options <code class="docutils literal"><span class="pre">for</span></code> et <code class="docutils literal"><span class="pre">when</span></code>.
L&#8217;option <code class="docutils literal"><span class="pre">for</span></code> vous laisse faire la correspondance sur des sous-chaines d&#8217;URL,
alors que l&#8217;option <code class="docutils literal"><span class="pre">when</span></code> vous permet de lancer un callable:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Only runs on requests starting with `/blog`</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;BlogHeader&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;for&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/blog&#39;</span><span class="p">]);</span>

<span class="c1">// Only run on GET requests.</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Cache&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;when&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>The callable provided to <code class="docutils literal"><span class="pre">when</span></code> should return <code class="docutils literal"><span class="pre">true</span></code> when the filter should
run. The callable can expect to get the current request and response as
arguments.</p>
</div>
</div>
<div class="section" id="construire-un-filtre">
<h2>Construire un Filtre<a class="headerlink" href="#construire-un-filtre" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour créer un filtre, définissez une classe dans <strong>src/Routing/Filter</strong>. Dans
cet exemple, nous allons créer un filtre qui ajoute un cookie de tracking pour
la page d&#8217;accueil. Premièrement, créez le fichier. Son contenu doit ressembler
à ceci:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Routing\Filter</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Event\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Routing\DispatcherFilter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TrackingCookieFilter</span> <span class="k">extends</span> <span class="nx">DispatcherFilter</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">beforeDispatch</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">);</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getCookie</span><span class="p">(</span><span class="s1">&#39;landing_page&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">cookie</span><span class="p">([</span>
                <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;landing_page&#39;</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">here</span><span class="p">(),</span>
                <span class="s1">&#39;expire&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;+ 1 year&#39;</span><span class="p">,</span>
            <span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Enregistrez ce fichier sous <strong>src/Routing/Filter/TrackingCookieFilter.php</strong>.
Comme vous pouvez le voir, à l&#8217;image des autres classes dans CakePHP, les
filtres de dispatcher suivent quelques conventions:</p>
<ul class="simple">
<li>Les noms de classes finissent par <code class="docutils literal"><span class="pre">Filter</span></code>.</li>
<li>Les classes sont dans le namespace <code class="docutils literal"><span class="pre">Routing\\Filter</span></code>. Par exemple,
<code class="docutils literal"><span class="pre">App\\Routing\\Filter</span></code>.</li>
<li>Généralement, les filtres étendent <code class="docutils literal"><span class="pre">Cake\\Routing\\DispatcherFilter</span></code>.</li>
</ul>
<p><code class="docutils literal"><span class="pre">DispatcherFilter</span></code> expose deux méthodes qui peuvent être surchargées dans les
sous-classes qui sont <code class="docutils literal"><span class="pre">beforeDispatch()</span></code> et <code class="docutils literal"><span class="pre">afterDispatch()</span></code>. Ces méthodes
sont exécutées respectivement avant et après l&#8217;exécution de tout controller.
les deux méthodes reçoivent un objet <code class="xref php php-class docutils literal"><span class="pre">Cake\Event\Event</span></code> contenant
les objets <code class="docutils literal"><span class="pre">ServerRequest</span></code> et <code class="docutils literal"><span class="pre">Response</span></code>
(instances de <a class="reference internal" href="../controllers/request-response.html#Cake\Http\ServerRequest" title="Cake\Http\ServerRequest"><code class="xref php php-class docutils literal"><span class="pre">Cake\Http\ServerRequest</span></code></a> et
<a class="reference internal" href="../controllers/request-response.html#Cake\Http\Response" title="Cake\Http\Response"><code class="xref php php-class docutils literal"><span class="pre">Cake\Http\Response</span></code></a>) dans la propriété <code class="docutils literal"><span class="pre">data</span></code>.</p>
<p>Alors que notre filtre était relativement simple, il y a quelques autres choses
intéressantes que nous pouvons réaliser dans les méthodes de filtre. En
renvoyant un objet <code class="docutils literal"><span class="pre">Response</span></code>, vous pouvez court-circuiter le process de
dispatch et empêcher le controller d&#8217;être appelé. Lorsque vous renvoyez une
response, n&#8217;oubliez pas d&#8217;appeler <code class="docutils literal"><span class="pre">$event-&gt;stopPropagation()</span></code> pour que les
autres filtres ne soient pas appelés.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Lorsque la méthode beforeDispatch renvoie une response, le controller, et
l&#8217;event afterDispatch ne seront pas appelés.</p>
</div>
<p>Créons maintenant un autre filtre pour modifier l&#8217;en-tête de response de
n&#8217;importe quelle page publique, dans notre cas ce serait tout ce qui est
servi depuis le <code class="docutils literal"><span class="pre">PagesController</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Routing\Filter</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Event\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Routing\DispatcherFilter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HttpCacheFilter</span> <span class="k">extends</span> <span class="nx">DispatcherFilter</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">afterDispatch</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">);</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">statusCode</span><span class="p">()</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">sharable</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">expires</span><span class="p">(</span><span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;+1 day&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1">// Dans notre bootstrap.php</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;HttpCache&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;for&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/pages&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Ce filtre enverra un en-tête d&#8217;expiration pour 1 jour dans le futur pour toutes
responses produites pour le controller pages. Vous pourriez bien entendu faire
la même chose dans un controller, ce n&#8217;est qu&#8217;un exemple de ce qui peut être
réalisé avec les filtres. Par exemple, au lieu d&#8217;altérer la response, vous
pourriez la mettre en cache en utilisant <a class="reference internal" href="../core-libraries/caching.html#Cake\Cache\Cache" title="Cake\Cache\Cache"><code class="xref php php-class docutils literal"><span class="pre">Cake\Cache\Cache</span></code></a> en
servant la response depuis le callback <code class="docutils literal"><span class="pre">beforeDispatch()</span></code>.</p>
<p>Bien que très puissants, les filtres du dispatcher peuvent également compliquer
la maintenance de votre application. Les filtres sont des outils extrêmement
puissants lorsqu&#8217;ils sont utilisés sagement et ajouter des gestionnaires de
responses pour chaque URL dans votre application n&#8217;est pas une bonne
utilisation. Gardez à l&#8217;esprit que tout n&#8217;a pas besoin d&#8217;être un filtre; Les
<cite>Controllers</cite> et les <cite>Components</cite> sont souvent un choix plus précis pour ajouter
tout code de gestionnaire de requête à votre application.</p>
</div>
</div>


            </div>
        </div>

        
        <div class="col-md-3 col-md-pull-9 hidden-xs hidden-sm" lang="fr">
            <aside class="sidebar">
                <div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<p class="caption"><span class="caption-text">Préface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">CakePHP en un Coup d&#8217;Oeil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Guide de Démarrage Rapide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/3-x-migration-guide.html">3.x Guide de Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutoriels et exemples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribuer</a></li>
</ul>
<p class="caption"><span class="caption-text">Pour Commencer</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="routing.html">Routing</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Filtres du Dispatcher</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/request-response.html">Les Objets Request &amp; Response</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers (Contrôleurs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views (Vues)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orm.html">Accès Base de Données &amp; ORM</a></li>
</ul>
<p class="caption"><span class="caption-text">Généralités</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/authentication.html">Authentification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bake.html">Console Bake</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/caching.html">La mise en cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Outils de Console, Shells, &amp; Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Déploiement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Gestion des Erreurs &amp; Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/events.html">Événements système</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/internationalization-and-localization.html">Internationalisation &amp; Localisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/logging.html">Journalisation (logging)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/form.html">Formulaires Sans Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/pagination.html">Pagination</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Sécurité</a></li>
<li class="toctree-l1"><a class="reference internal" href="sessions.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/validation.html">Validation</a></li>
</ul>
<p class="caption"><span class="caption-text">Utilitaires</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/app.html">Classe App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/collections.html">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/file-folder.html">Folder &amp; File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/hash.html">Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/httpclient.html">Client Http</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/inflector.html">Inflector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/registry-objects.html">Objets Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/text.html">Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/time.html">Date &amp; Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/xml.html">Xml</a></li>
</ul>
<p class="caption"><span class="caption-text">Divers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/global-constants-and-functions.html">Globales &amp; Fonctions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chronos.html">Chronos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug-kit.html">Debug Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrations.html">Migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch.html">ElasticSearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade-tool.html">Outil d&#8217;Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Annexes</a></li>
</ul>

</div>

                </div>
            </aside>
            <aside class="sidebar">
                <div class="mb30 row">
                </div>
            </aside>
        </div>
    </div>
</div>

<section id="socials" class="back-3">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-5  social text-center">
                <div class="col-sm-3 col-xs-3">
                    <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                          var js, fjs = d.getElementsByTagName(s)[0];
                          if (d.getElementById(id)) return;
                          js = d.createElement(s); js.id = id;
                          js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
                          fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));
                        </script>
                        <div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-7 social-footer text-center ">
                <a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
                <a href="https://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
                <a href="https://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
                <a href="https://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
                <a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
                <a href="https://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
                <a href="https://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
                <a href="https://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
            </div>
        </div>
    </div>
</section>

<footer id="footer" class="footer-wrapper">
    <div class="container">

        <div class="row col-p30">
            <div class="col-sm-12 col-md-3">
                <div class="footer-widget t-footer">
                    <div class="col-md-12">
                        <a href="https://www.openhub.net/p/cakephp">
                            <img src="../_static/open-hub.png">
                        </a>
                        <div class="mt10">
                            <a href="https://www.rackspace.com/">
                                <img src="../_static/rackspace.png">
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-md-9">
                <div class="col-md-3 col-sm-6 business-solution">
                    <ul class="footer-menu">
                        <li class="menu-title">
    <a href="https://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
    <a href="https://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 text-center mt30">
                <p class="copyright">
                            &copy; Copyright 2017, Cake Software Foundation, Inc.
                        Mis à jour le août 30, 2017.
                        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
                </p>
            </div>
        </div>
    </div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-743287-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
  </body>
</html>
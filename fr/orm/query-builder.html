

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Query Builder - 3.x</title>
    <link href="../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/app.js"></script>

    <link rel="alternate" hreflang="en" href="../../en/orm/query-builder.html" /><link rel="alternate" hreflang="pt_BR" href="../../pt/orm/query-builder.html" /><link rel="alternate" hreflang="es" href="../../es/orm/query-builder.html" /><link rel="alternate" hreflang="ja" href="../../ja/orm/query-builder.html" /><link rel="alternate" hreflang="zh" href="../../zh/orm/query-builder.html" /><link rel="alternate" hreflang="tr" href="../../tr/orm/query-builder.html" /><link rel="alternate" hreflang="ru" href="../../ru/orm/query-builder.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within documentation CakePHP Cookbook 3.5" href="../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="documentation CakePHP Cookbook 3.5" href="../index.html" />
    <link rel="up" title="Accès Base de Données &amp; ORM" href="../orm.html" />
    <link rel="next" title="Les Objets Table" href="table-objects.html" />
    <link rel="prev" title="Notions de Base de Base de Données" href="database-basics.html" />

    <script type="text/javascript">
    window.lang = "fr";
    </script>
  </head>
  <body>

<div id="container">
    
    <header class="nav-down">
        <div class="container-fluid hidden-xs hidden-sm">
            <div class="row">
                <div class="col-sm-3 col-md-3">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-9 col-md-9">
                    <nav class="navbar-right">
                        <ul class="menu">
                            <li class="first">
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
                                <ul class="submenu">
                                    
<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                                </ul>
                            </li>

                            <li><a href="https://cakephp.org/business-solutions">Business Solutions</a></li>
                            <li><a href="https://cakephp.org/writers">Get Paid To Write</a></li>
                            <li><a href="https://cakephp.org/pages/team">Team</a></li>

                            <li>
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
                                <div class="megamenu full">
                                    <div class="row">
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                                            </ul>
                                        </div>
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        
        <div class="container-fluid hidden-md hidden-lg">
            <div class="row">
                <div class="col-sm-6 col-xs-6">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-6 col-xs-6">
                    <div class="navbar-right">
                        <button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
                            <i class="fa fa-bars toggle-modal"></i>
                        </button>
                    </div>
                    <div id="wrap">
                        <form class="search" action="../search.html" method="get">
                            <input name="q" type="search" placeholder="What are you looking for?">
                            <input id="search_submit" value="Recherche" type="submit">
                        </form>
                    </div>
                </div>
            </div>
        </div>

        
        <section id="nav-cook" class="hidden-xs hidden-sm">
            <div class="container-fluid ">
                <div class="row ">
                    <div class="col-md-12 back-book">
                        <div class="col-md-5 text-center t-cook-nav p0 hidden-sm hidden-xs">
                            <h2>
                                <a href="../contents.html">
                                    <span class="glyph_range icon-submenu icon-submenu-cook">B</span>
                                    CakePHP 3.5 Red Velvet <strong>Cookbook</strong>
                                </a>
                            </h2>
                        </div>

                        <div class="col-md-4 hidden-sm">
                            <form class="search" action="../search.html" method="get">
                                <input type="hidden" name="check_keywords" value="yes" />
                                <input type="hidden" name="area" value="default" />

                                <div class="col-md-10 p0">
                                    <input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
                                </div>
                                <div class="col-md-2 p0 search-cook">
                                    <button type="submit">
                                        <span class="glyph_range icon-submenu icon-submenu-cook">A</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        
                        <div class="col-md-3">
                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Language:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
                                                    role="button" aria-haspopup="true" aria-expanded="false" href="#">
                                                        fr
                                                        <i class="fa fa-menu-en fa-chevron-down"></i>
                                                    </a>
                                            <ul class="dropdown-menu">
                                            
                                                <li><a href="../../en/orm/query-builder.html">en</a></li>
                                            
                                                <li><a href="../../pt/orm/query-builder.html">pt</a></li>
                                            
                                                <li><a href="../../es/orm/query-builder.html">es</a></li>
                                            
                                                <li><a href="../../ja/orm/query-builder.html">ja</a></li>
                                            
                                                <li></li>
                                            
                                                <li><a href="../../zh/orm/query-builder.html">zh</a></li>
                                            
                                                <li><a href="../../tr/orm/query-builder.html">tr</a></li>
                                            
                                                <li><a href="../../ru/orm/query-builder.html">ru</a></li>
                                            
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Version:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">3.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
                                            <ul class="dropdown-menu">
                                                <li><a href="https://book.cakephp.org/3.0/fr">3.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/2.0/fr">2.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.3/fr/">1.3 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.2/fr/">1.2 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.1/en">1.1 Book</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
        </section>
    </header>

    
    <section class="nav-btn visible-sm visible-xs">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
                </div>

                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
                </div>
            </div>
        </div>
    </section>

    
    <div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title-cookbook" id="modal-header"></h4>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>

<div class="container page-container "><div id="improve-slideout">
        <i class="fa fa-pencil icon-improve"></i>
        <a href="https://github.com/cakephp/docs/edit/3.0/fr/orm/query-builder.rst" target="_blank">
            <div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
        </a>
    </div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

    
    <div class="row">
        <div class="col-sm-12 col-md-9 col-md-push-3"><div class="page-contents col-sm-5">
                <h3>Page Contents</h3>
                <ul>
<li><a class="reference internal" href="#">Query Builder</a><ul>
<li><a class="reference internal" href="#l-objet-query">L&#8217;Objet Query</a><ul>
<li><a class="reference internal" href="#recuperer-les-lignes-d-une-table">Récupérer les Lignes d&#8217;une Table</a></li>
<li><a class="reference internal" href="#recuperez-une-ligne-unique-d-une-table">Récupérez une Ligne Unique d&#8217;une Table</a></li>
<li><a class="reference internal" href="#recuperer-une-liste-de-valeurs-a-partir-d-une-colonne">Récupérer une Liste de Valeurs à Partir d&#8217;une Colonne</a></li>
<li><a class="reference internal" href="#les-requetes-sont-des-objets-collection">Les Requêtes sont des Objets Collection</a></li>
<li><a class="reference internal" href="#comment-les-requetes-sont-evaluees-lazily">Comment les Requêtes sont Évaluées Lazily</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recuperer-vos-donnees">Récupérer vos Données</a><ul>
<li><a class="reference internal" href="#selectionner-tous-les-champs-d-une-table">Sélectionner Tous les Champs d&#8217;une Table</a></li>
<li><a class="reference internal" href="#utiliser-les-fonctions-sql">Utiliser les Fonctions SQL</a></li>
<li><a class="reference internal" href="#regroupements-group-et-having">Regroupements - Group et Having</a></li>
<li><a class="reference internal" href="#instructions-case">Instructions Case</a></li>
<li><a class="reference internal" href="#recuperer-des-tableaux-plutot-que-des-entities">Récupérer des Tableaux plutôt que des Entities</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ajouter-des-champs-calcules">Ajouter des Champs Calculés</a></li>
<li><a class="reference internal" href="#conditions-avancees">Conditions Avancées</a><ul>
<li><a class="reference internal" href="#creer-automatiquement-des-clauses-in">Créer automatiquement des Clauses IN</a></li>
<li><a class="reference internal" href="#creation-automatique-de-is-null">Création Automatique de IS NULL</a></li>
<li><a class="reference internal" href="#creation-automatique-de-is-not-null">Création Automatique de IS NOT NULL</a></li>
<li><a class="reference internal" href="#raw-expressions">Raw Expressions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recuperer-les-resultats">Récupérer les Résultats</a><ul>
<li><a class="reference internal" href="#retourner-le-nombre-total-des-enregistrements">Retourner le Nombre Total des Enregistrements</a></li>
<li><a class="reference internal" href="#mettre-en-cache-les-resultats-charges">Mettre en Cache les Résultats Chargés</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chargement-des-associations">Chargement des Associations</a><ul>
<li><a class="reference internal" href="#passer-des-conditions-a-contain">Passer des Conditions à Contain</a></li>
<li><a class="reference internal" href="#ordonner-les-associations-contain">Ordonner les Associations Contain</a></li>
<li><a class="reference internal" href="#filtering-by-associated-data">Filtering by Associated Data</a></li>
<li><a class="reference internal" href="#utiliser-innerjoinwith">Utiliser innerJoinWith</a></li>
<li><a class="reference internal" href="#utiliser-notmatching">Utiliser notMatching</a></li>
<li><a class="reference internal" href="#utiliser-leftjoinwith">Utiliser leftJoinWith</a></li>
<li><a class="reference internal" href="#ajouter-des-jointures">Ajouter des Jointures</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inserer-des-donnees">Insérer des Données</a></li>
<li><a class="reference internal" href="#mettre-a-jour-les-donnees">Mettre à Jour les Données</a></li>
<li><a class="reference internal" href="#suppression-des-donnees">Suppression des Données</a></li>
<li><a class="reference internal" href="#prevention-contre-les-injections-sql">Prévention contre les Injections SQL</a><ul>
<li><a class="reference internal" href="#lier-les-valeurs-binding">Lier les Valeurs (Binding)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plus-de-requetes-complexes">Plus de Requêtes Complexes</a><ul>
<li><a class="reference internal" href="#unions">Unions</a></li>
<li><a class="reference internal" href="#sous-requetes">Sous-Requêtes</a></li>
<li><a class="reference internal" href="#adding-locking-statements">Adding Locking Statements</a></li>
<li><a class="reference internal" href="#executer-des-requetes-complexes">Exécuter des Requêtes Complexes</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div><div class="document-body">
            
  <div class="section" id="namespace-Cake\ORM">
<span id="query-builder"></span><h1>Query Builder<a class="headerlink" href="#namespace-Cake\ORM" title="Lien permanent vers ce titre">¶</a></h1>
<dl class="class">
<dt id="Cake\ORM\Query">
<em class="property">class </em><code class="descclassname">Cake\ORM\</code><code class="descname">Query</code><a class="headerlink" href="#Cake\ORM\Query" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Le constructeur de requête de l&#8217;ORM fournit une interface facile à utiliser pour
créer et lancer les requêtes. En arrangeant les requêtes ensemble, vous pouvez
créer des requêtes avancées en utilisant les unions et les sous-requêtes avec
facilité.</p>
<p>Sous le capot, le constructeur de requête utilise les requêtes préparées de PDO
qui protègent contre les attaques d&#8217;injection SQL.</p>
<div class="section" id="l-objet-query">
<h2>L&#8217;Objet Query<a class="headerlink" href="#l-objet-query" title="Lien permanent vers ce titre">¶</a></h2>
<p>La façon la plus simple de créer un objet <code class="docutils literal"><span class="pre">Query</span></code> est d&#8217;utiliser <code class="docutils literal"><span class="pre">find()</span></code> à
partir d&#8217;un objet <code class="docutils literal"><span class="pre">Table</span></code>. Cette méthode va retourner une requête incomplète
prête à être modifiée. Vous pouvez aussi utiliser un objet table connection pour
accéder au niveau inférieur du constructeur de Requête qui n&#8217;inclut pas les
fonctionnalités de l&#8217;ORM, si nécessaire. Consultez la section
<a class="reference internal" href="database-basics.html#database-queries"><span class="std std-ref">L&#8217;exécution des Requêtes</span></a> pour plus d&#8217;informations:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="nv">$articles</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>

<span class="c1">// Commence une nouvelle requête.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
</pre></div>
</div>
<p>Depuis un controller, vous pouvez utiliser la variable de table créée
automatiquement par le système de conventions:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Inside ArticlesController.php</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
</pre></div>
</div>
<div class="section" id="recuperer-les-lignes-d-une-table">
<h3>Récupérer les Lignes d&#8217;une Table<a class="headerlink" href="#recuperer-les-lignes-d-une-table" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$query</span> <span class="k">as</span> <span class="nv">$article</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">debug</span><span class="p">(</span><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pour les exemples restants, imaginez que <code class="docutils literal"><span class="pre">$articles</span></code> est une
<a class="reference internal" href="retrieving-data-and-resultsets.html#Cake\ORM\Table" title="Cake\ORM\Table"><code class="xref php php-class docutils literal"><span class="pre">ORM\Table</span></code></a>. Quand vous êtes dans des controllers, vous
pouvez utiliser <code class="docutils literal"><span class="pre">$this-&gt;Articles</span></code> plutôt que <code class="docutils literal"><span class="pre">$articles</span></code>.</p>
<p>Presque chaque méthode dans un objet <code class="docutils literal"><span class="pre">Query</span></code> va retourner la même requête,
cela signifie que les objets <code class="docutils literal"><span class="pre">Query</span></code> sont lazy, et ne seront pas exécutés à
moins que vous lui disiez de le faire:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span> <span class="c1">// Retourne le même objet query</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">order</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;DESC&#39;</span><span class="p">]);</span> <span class="c1">// Toujours le même objet, aucun SQL exécuté</span>
</pre></div>
</div>
<p>Vous pouvez bien sûr chainer les méthodes que vous appelez sur les objets
Query:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id !=&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">order</span><span class="p">([</span><span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;DESC&#39;</span><span class="p">]);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$query</span> <span class="k">as</span> <span class="nv">$article</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">debug</span><span class="p">(</span><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">created</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si vous essayez d&#8217;appeler <code class="docutils literal"><span class="pre">debug()</span></code> sur un objet Query, vous verrez son état
interne et le SQL qui sera exécuté dans la base de données:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">debug</span><span class="p">(</span><span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]));</span>

<span class="c1">// Affiche</span>
<span class="c1">// ...</span>
<span class="c1">// &#39;sql&#39; =&gt; &#39;SELECT * FROM articles where id = ?&#39;</span>
<span class="c1">// ...</span>
</pre></div>
</div>
<p>Vous pouvez exécuter une requête directement sans avoir à utiliser <code class="docutils literal"><span class="pre">foreach</span></code>.
La façon la plus simple est d&#8217;appeler les méthodes <code class="docutils literal"><span class="pre">all()</span></code> ou <code class="docutils literal"><span class="pre">toArray()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$resultsIteratorObject</span> <span class="o">=</span> <span class="nv">$articles</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id &gt;&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$resultsIteratorObject</span> <span class="k">as</span> <span class="nv">$article</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">debug</span><span class="p">(</span><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$resultsArray</span> <span class="o">=</span> <span class="nv">$articles</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id &gt;&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$resultsArray</span> <span class="k">as</span> <span class="nv">$article</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">debug</span><span class="p">(</span><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">debug</span><span class="p">(</span><span class="nv">$resultsArray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">);</span>
</pre></div>
</div>
<p>Dans l&#8217;exemple ci-dessus, <code class="docutils literal"><span class="pre">$resultsIteratorObject</span></code> sera une instance de
<code class="docutils literal"><span class="pre">Cake\ORM\ResultSet</span></code>, un objet que vous pouvez itérer et sur lequel vous
pouvez appliquer plusieurs méthodes d&#8217;extractions ou de traversement.</p>
<p>Souvent, il n&#8217;y a pas besoin d&#8217;appeler <code class="docutils literal"><span class="pre">all()</span></code>, vous pouvez juste itérer
l&#8217;objet Query pour récupérer ses résultats. les objets Query peuvent également
être utilisés directement en tant qu&#8217;objet résultat; Essayer d&#8217;itérer la requête
en utilisant <code class="docutils literal"><span class="pre">toArray()</span></code> ou n&#8217;importe qu&#8217;elle méthode héritée de
<a class="reference internal" href="../core-libraries/collections.html"><span class="doc">Collection</span></a>, aura pour résultat l&#8217;exécution
de la requête et la récupération des résultats.</p>
</div>
<div class="section" id="recuperez-une-ligne-unique-d-une-table">
<h3>Récupérez une Ligne Unique d&#8217;une Table<a class="headerlink" href="#recuperez-une-ligne-unique-d-une-table" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez utilisez la méthode <code class="docutils literal"><span class="pre">first()</span></code> pour récupérer le premier résultat
dans la requête:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$article</span> <span class="o">=</span> <span class="nv">$articles</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>

<span class="nx">debug</span><span class="p">(</span><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="recuperer-une-liste-de-valeurs-a-partir-d-une-colonne">
<h3>Récupérer une Liste de Valeurs à Partir d&#8217;une Colonne<a class="headerlink" href="#recuperer-une-liste-de-valeurs-a-partir-d-une-colonne" title="Lien permanent vers ce titre">¶</a></h3>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Utilise la méthode extract() à partir de la libraire collections</span>
<span class="c1">// Ceci exécute aussi la requête</span>
<span class="nv">$allTitles</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$allTitles</span> <span class="k">as</span> <span class="nv">$title</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$title</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vous pouvez aussi récupérer une liste de clé-valeur à partir d&#8217;un résultat d&#8217;une
requête:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$list</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$list</span> <span class="k">as</span> <span class="nv">$id</span> <span class="o">=&gt;</span> <span class="nv">$title</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$id</span><span class="s2"> : </span><span class="si">$title</span><span class="s2">&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pour plus d&#8217;informations sur la façon de personnaliser les champs utilisés pour
remplir la liste, consultez la section <a class="reference internal" href="retrieving-data-and-resultsets.html#table-find-list"><span class="std std-ref">Trouver les Paires de Clé/Valeur</span></a>.</p>
</div>
<div class="section" id="les-requetes-sont-des-objets-collection">
<h3>Les Requêtes sont des Objets Collection<a class="headerlink" href="#les-requetes-sont-des-objets-collection" title="Lien permanent vers ce titre">¶</a></h3>
<p>Une fois que vous êtes familier avec les méthodes de l&#8217;objet Query, il est
fortement recommandé que vous consultiez la section
<a class="reference internal" href="../core-libraries/collections.html"><span class="doc">Collection</span></a> pour améliorer vos compétences
dans le traversement efficace de données. En résumé, il est important de se
rappeler que tout ce que vous pouvez appeler sur un objet Collection, vous
pouvez aussi le faire avec un objet Query:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Utilise la méthode combine() à partir de la libraire collection</span>
<span class="c1">// Ceci est équivalent au find(&#39;list&#39;)</span>
<span class="nv">$keyValueList</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">combine</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">);</span>

<span class="c1">// Un exemple avancé</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id &gt;&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">order</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;DESC&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// map() est une méthode de collection, elle exécute la requête</span>
        <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">trimmedTitle</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$row</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$row</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">combine</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;trimmedTitle&#39;</span><span class="p">)</span> <span class="c1">// combine() est une autre méthode de collection</span>
    <span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span> <span class="c1">// Aussi une méthode de la librairie collection</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$results</span> <span class="k">as</span> <span class="nv">$id</span> <span class="o">=&gt;</span> <span class="nv">$trimmedTitle</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;</span><span class="si">$id</span><span class="s2"> : </span><span class="si">$trimmedTitle</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="comment-les-requetes-sont-evaluees-lazily">
<h3>Comment les Requêtes sont Évaluées Lazily<a class="headerlink" href="#comment-les-requetes-sont-evaluees-lazily" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les objets Query sont évalués &#8220;lazily&#8221; (paresseusement). Cela signifie qu&#8217;une
requête n&#8217;est pas exécutée jusqu&#8217;à ce qu&#8217;une des prochaines actions se fasse:</p>
<ul class="simple">
<li>La requête est itérée avec <code class="docutils literal"><span class="pre">foreach()</span></code>.</li>
<li>La méthode <code class="docutils literal"><span class="pre">execute()</span></code> de query est appelée. Elle retourne l&#8217;objet
d&#8217;instruction sous-jacente, et va être utilisée avec les requêtes
insert/update/delete.</li>
<li>La méthode <code class="docutils literal"><span class="pre">first()</span></code> de query est appelée. Elle retourne le premier résultat
correspondant à l&#8217;instruction <code class="docutils literal"><span class="pre">SELECT</span></code> (ajoute LIMIT 1 à la requête).</li>
<li>La méthode <code class="docutils literal"><span class="pre">all()</span></code> de query est appelée. Elle retourne l&#8217;ensemble de
résultats et peut seulement être utilisée avec les instructions <code class="docutils literal"><span class="pre">SELECT</span></code>.</li>
<li>La méthode <code class="docutils literal"><span class="pre">toArray()</span></code> de query est appelée.</li>
</ul>
<p>Jusqu&#8217;à ce qu&#8217;une de ces conditions soit rencontrée, la requête peut être
modifiée avec du SQL supplémentaire envoyé à la base de données. Cela signifie
que si une Query n&#8217;a pas été évaluée, aucun SQL ne sera jamais envoyé à la
base de données. Une fois exécutée, la modification et la ré-évaluation
d&#8217;une requête va entraîner l&#8217;exécution de SQL supplémentaire.</p>
<p>Si vous souhaitez jeter un œil sur le SQL que CakePHP génère, vous pouvez
activer les <a class="reference internal" href="database-basics.html#database-query-logging"><span class="std std-ref">logs de requête</span></a> de la base de
données.</p>
<p>Les sections suivantes vont vous montrer tout ce qu&#8217;il faut savoir sur
l&#8217;utilisation et la combinaison des méthodes de l&#8217;objet Query pour construire
des requêtes SQL et extraire les données.</p>
</div>
</div>
<div class="section" id="recuperer-vos-donnees">
<h2>Récupérer vos Données<a class="headerlink" href="#recuperer-vos-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>La plupart des applications web utilisent beaucoup les requêtes de type
<code class="docutils literal"><span class="pre">SELECT</span></code>. CakePHP permet de construire ces requêtes en un clin d&#8217;œil. La
méthode <code class="docutils literal"><span class="pre">select()</span></code> vous permet de ne récupérer que les champs qui vous sont
nécessaires:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">]);</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$query</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">debug</span><span class="p">(</span><span class="nv">$row</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vous pouvez également définir des alias pour vos champs en fournissant les
champs en tant que tableau associatif:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Résultats dans SELECT id AS pk, title AS aliased_title, body ...</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;pk&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;aliased_title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>Pour sélectionner des champs distincts, vous pouvez utiliser la méthode
<code class="docutils literal"><span class="pre">distinct()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Résultats dans SELECT DISTINCT country FROM ...</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;country&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">distinct</span><span class="p">([</span><span class="s1">&#39;country&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>Pour définir certaines conditions basiques, vous pouvez utiliser la
méthode <code class="docutils literal"><span class="pre">where()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Conditions sont combinées avec AND</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Post&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>

<span class="c1">// Vous pouvez aussi appeler where() plusieurs fois</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Post&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
</pre></div>
</div>
<p>Consultez la section <a class="reference internal" href="#advanced-query-conditions"><span class="std std-ref">Conditions Avancées</span></a> pour trouver comment
construire des conditions <code class="docutils literal"><span class="pre">WHERE</span></code> plus complexes. Pour appliquer un tri,
vous pouvez utiliser la méthode <code class="docutils literal"><span class="pre">order</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">order</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ASC&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ASC&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>Lorsque vous appelez <code class="docutils literal"><span class="pre">order()</span></code> plusieurs fois sur une même requête, les clauses
seront ajoutées les unes après les autres. Cependant, en utilisant les finders,
vous pouvez parfois avoir besoin d&#8217;écraser le <code class="docutils literal"><span class="pre">ORDER</span> <span class="pre">BY</span></code>. Pour se faire, vous
pouvez utiliser le second paramètre de <code class="docutils literal"><span class="pre">order()</span></code> (mais aussi de <code class="docutils literal"><span class="pre">orderAsc()</span></code>
ou <code class="docutils literal"><span class="pre">orderDesc()</span></code>) et le définir à <code class="docutils literal"><span class="pre">Query::OVERWRITE</span></code> ou <code class="docutils literal"><span class="pre">true</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">order</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;ASC&#39;</span><span class="p">]);</span>

<span class="c1">// Plus loin dans le code, vous écrasez la clause ORDER BY plutôt</span>
<span class="c1">// qu&#39;ajouter une autre clause à l&#39;existante.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">order</span><span class="p">([</span><span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;DESC&#39;</span><span class="p">],</span> <span class="nx">Query</span><span class="o">::</span><span class="na">OVERWRITE</span><span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.0.12: </span>En plus de <code class="docutils literal"><span class="pre">order</span></code>, les méthodes <code class="docutils literal"><span class="pre">orderAsc</span></code> et <code class="docutils literal"><span class="pre">orderDesc</span></code> peuvent
être utilisées quand vous devez trier selon des expressions complexes:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$concat</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">concat</span><span class="p">([</span>
    <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;identifier&#39;</span><span class="p">,</span>
    <span class="s1">&#39;synopsis&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;identifier&#39;</span>
<span class="p">]);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">orderAsc</span><span class="p">(</span><span class="nv">$concat</span><span class="p">);</span>
</pre></div>
</div>
</div>
<p>Pour limiter le nombre de lignes ou définir la ligne offset, vous pouvez
utiliser les méthodes <code class="docutils literal"><span class="pre">limit()</span></code> et <code class="docutils literal"><span class="pre">page()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Récupérer les lignes 50 à 100</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">page</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
</pre></div>
</div>
<p>Comme vous pouvez le voir sur les exemples précédents, toutes les méthodes
qui modifient la requête fournissent une interface fluide, vous permettant
de construire une requête avec des appels de méthode chaînés.</p>
<div class="section" id="selectionner-tous-les-champs-d-une-table">
<h3>Sélectionner Tous les Champs d&#8217;une Table<a class="headerlink" href="#selectionner-tous-les-champs-d-une-table" title="Lien permanent vers ce titre">¶</a></h3>
<p>Par défaut, une requête va sélectionner tous les champs d&#8217;une table sauf si vous
appelez la fonction <code class="docutils literal"><span class="pre">select()</span></code> vous-même et passez certains champs:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Sélectionne seulement id et title de la table articles</span>
<span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>Si vous souhaitez toujours sélectionner tous les champs d&#8217;une table après avoir
appelé <code class="docutils literal"><span class="pre">select($fields)</span></code>, vous pouvez dans cette optique passer l&#8217;instance de
table à <code class="docutils literal"><span class="pre">select()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Sélectionne seulement id et title de la table articles</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articlesTable</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;slug&#39;</span> <span class="o">=&gt;</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">concat</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;identifier&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;identifier&#39;</span><span class="p">])])</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="nv">$articlesTable</span><span class="p">);</span> <span class="c1">// Sélectionne tous les champs de articles</span>
</pre></div>
</div>
</div>
<div class="section" id="utiliser-les-fonctions-sql">
<span id="using-sql-functions"></span><h3>Utiliser les Fonctions SQL<a class="headerlink" href="#utiliser-les-fonctions-sql" title="Lien permanent vers ce titre">¶</a></h3>
<p>L&#8217;ORM de CakePHP offre une abstraction pour les fonctions les plus communément
utilisées par SQL. Utiliser l&#8217;abstraction permet à l&#8217;ORM de sélectionner
l&#8217;intégration spécifique de la fonction pour la plateforme que vous souhaitez.
Par exemple, <code class="docutils literal"><span class="pre">concat</span></code> est intégré différemment dans MySQL, PostgreSQL et
SQL Server. Utiliser l&#8217;abstraction permet à votre code d&#8217;être portable:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Résultats dans SELECT COUNT(*) count FROM ...</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;count&#39;</span> <span class="o">=&gt;</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)]);</span>
</pre></div>
</div>
<p>Un certain nombre de fonctions communément utilisées peut être créé avec la
méthode <code class="docutils literal"><span class="pre">func()</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">sum()</span></code> Calcule une somme. Les arguments sont traités comme des valeurs
littérales.</li>
<li><code class="docutils literal"><span class="pre">avg()</span></code> Calcule une moyenne. Les arguments sont traités comme des valeurs
littérales.</li>
<li><code class="docutils literal"><span class="pre">min()</span></code> Calcule le min d&#8217;une colonne. Les arguments sont traités comme des
valeurs littérales.</li>
<li><code class="docutils literal"><span class="pre">max()</span></code> Calcule le max d&#8217;une colonne. Les arguments sont traités comme
des valeurs littérales.</li>
<li><code class="docutils literal"><span class="pre">count()</span></code> Calcule le count. Les arguments sont traités comme des valeurs
littérales.</li>
<li><code class="docutils literal"><span class="pre">concat()</span></code> Concatène deux valeurs ensemble. Les arguments sont traités
comme des paramètres liés, à moins qu&#8217;ils ne soient marqués comme littéral.</li>
<li><code class="docutils literal"><span class="pre">coalesce()</span></code> Regroupe les valeurs. Les arguments sont traités comme des
paramètres liés, à moins qu&#8217;ils ne soient marqués comme littéral.</li>
<li><code class="docutils literal"><span class="pre">dateDiff()</span></code> Récupère la différence entre deux dates/times. Les arguments
sont traités comme des paramètres liés, à moins qu&#8217;ils ne soient marqués comme
littéral.</li>
<li><code class="docutils literal"><span class="pre">now()</span></code> Prend soit &#8216;time&#8217;, soit &#8216;date&#8217; comme argument vous permettant de
récupérer soit le time courant, soit la date courante.</li>
<li><code class="docutils literal"><span class="pre">extract()</span></code> Retourne la partie de la date spécifiée de l&#8217;expression SQL.</li>
<li><code class="docutils literal"><span class="pre">dateAdd()</span></code> Ajoute l&#8217;unité de temps à l&#8217;expression de la date.</li>
<li><code class="docutils literal"><span class="pre">dayOfWeek()</span></code> Retourne une FunctionExpression représentant un appel à la
fonction SQL WEEKDAY.</li>
</ul>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.1: </span>Les méthodes <code class="docutils literal"><span class="pre">extract()</span></code>, <code class="docutils literal"><span class="pre">dateAdd()</span></code> et <code class="docutils literal"><span class="pre">dayOfWeek()</span></code> ont été
ajoutées.</p>
</div>
<p>Quand vous fournissez des arguments pour les fonctions SQL, il y a deux types de
paramètres que vous pouvez utiliser; Les arguments littéraux et les paramètres
liés. Les paramètres d&#8217;identifaction/littéraux vous permettent de référencer les
colonnes ou les autres valeurs littérales de SQL. Les paramètres liés peuvent
être utilisés pour ajouter en toute sécurité les données d&#8217;utilisateur aux
fonctions SQL. Par exemple:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">innerJoinWith</span><span class="p">(</span><span class="s1">&#39;Categories&#39;</span><span class="p">);</span>
<span class="nv">$concat</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">concat</span><span class="p">([</span>
    <span class="s1">&#39;Articles.title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;identifier&#39;</span><span class="p">,</span>
    <span class="s1">&#39; - CAT: &#39;</span><span class="p">,</span>
    <span class="s1">&#39;Categories.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;identifier&#39;</span><span class="p">,</span>
    <span class="s1">&#39; - Age: &#39;</span><span class="p">,</span>
    <span class="s1">&#39;(DATEDIFF(NOW(), Articles.created))&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;literal&#39;</span><span class="p">,</span>
<span class="p">]);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;link_title&#39;</span> <span class="o">=&gt;</span> <span class="nv">$concat</span><span class="p">]);</span>
</pre></div>
</div>
<p>En modifiant les arguments avec une valeur de <code class="docutils literal"><span class="pre">literal</span></code>, l&#8217;ORM va savoir que
la clé doit être traitée comme une valeur SQL littérale. En modifiant les
arguments avec une valeur d&#8217;<code class="docutils literal"><span class="pre">identifier</span></code>, l&#8217;ORM va savoir que la clé doit être
traitée comme un identifieur de champ. Le code ci-dessus va générer le SQL
suivant sur MySQL:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="nx">CONCAT</span><span class="p">(</span><span class="nx">Articles</span><span class="o">.</span><span class="nx">title</span><span class="p">,</span> <span class="o">:</span><span class="nx">c0</span><span class="p">,</span> <span class="nx">Categories</span><span class="o">.</span><span class="nx">name</span><span class="p">,</span> <span class="o">:</span><span class="nx">c1</span><span class="p">,</span> <span class="p">(</span><span class="nx">DATEDIFF</span><span class="p">(</span><span class="nx">NOW</span><span class="p">(),</span> <span class="nx">Articles</span><span class="o">.</span><span class="nx">created</span><span class="p">)))</span> <span class="nx">FROM</span> <span class="nx">articles</span><span class="p">;</span>
</pre></div>
</div>
<p>La valeur <code class="docutils literal"><span class="pre">:c0</span></code> aura le texte <code class="docutils literal"><span class="pre">'</span> <span class="pre">-</span> <span class="pre">CAT:'</span></code> lié quand la requête est exécutée.</p>
<p>En plus des fonctions ci-dessus, la méthode <code class="docutils literal"><span class="pre">func()</span></code> peut être utilisée pour
créer toute fonction générique SQL comme <code class="docutils literal"><span class="pre">year</span></code>, <code class="docutils literal"><span class="pre">date_format</span></code>,
<code class="docutils literal"><span class="pre">convert</span></code>, etc... Par exemple:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$year</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">year</span><span class="p">([</span>
    <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;identifier&#39;</span>
<span class="p">]);</span>
<span class="nv">$time</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">date_format</span><span class="p">([</span>
    <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;identifier&#39;</span><span class="p">,</span>
    <span class="s2">&quot;&#39;%H:%i&#39;&quot;</span> <span class="o">=&gt;</span> <span class="s1">&#39;literal&#39;</span>
<span class="p">]);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span>
    <span class="s1">&#39;yearCreated&#39;</span> <span class="o">=&gt;</span> <span class="nv">$year</span><span class="p">,</span>
    <span class="s1">&#39;timeCreated&#39;</span> <span class="o">=&gt;</span> <span class="nv">$time</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Entraînera:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="nx">YEAR</span><span class="p">(</span><span class="nx">created</span><span class="p">)</span> <span class="k">as</span> <span class="nx">yearCreated</span><span class="p">,</span> <span class="nx">DATE_FORMAT</span><span class="p">(</span><span class="nx">created</span><span class="p">,</span> <span class="s1">&#39;%H:%i&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="nx">timeCreated</span> <span class="nx">FROM</span> <span class="nx">articles</span><span class="p">;</span>
</pre></div>
</div>
<p>Vous devriez penser à utiliser le constructeur de fonctions à chaque fois que
vous devez mettre des données non fiables dans des fonctions SQL ou des
procédures stockées:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Utilise une procédure stockée</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$lev</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">levenshtein</span><span class="p">([</span><span class="nv">$search</span><span class="p">,</span> <span class="s1">&#39;LOWER(title)&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;literal&#39;</span><span class="p">]);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$lev</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">between</span><span class="p">(</span><span class="nv">$lev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nv">$tolerance</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Le SQL généré serait</span>
<span class="nx">WHERE</span> <span class="nb">levenshtein</span><span class="p">(</span><span class="o">:</span><span class="nx">c0</span><span class="p">,</span> <span class="nx">lower</span><span class="p">(</span><span class="nx">street</span><span class="p">))</span> <span class="nx">BETWEEN</span> <span class="o">:</span><span class="nx">c1</span> <span class="k">AND</span> <span class="o">:</span><span class="nx">c2</span>
</pre></div>
</div>
</div>
<div class="section" id="regroupements-group-et-having">
<h3>Regroupements - Group et Having<a class="headerlink" href="#regroupements-group-et-having" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand vous utilisez les fonctions d&#8217;agrégation comme <code class="docutils literal"><span class="pre">count</span></code> et <code class="docutils literal"><span class="pre">sum</span></code>, vous
pouvez utiliser les clauses <code class="docutils literal"><span class="pre">group</span> <span class="pre">by</span></code> et <code class="docutils literal"><span class="pre">having</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span>
    <span class="s1">&#39;count&#39;</span> <span class="o">=&gt;</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="s1">&#39;view_count&#39;</span><span class="p">),</span>
    <span class="s1">&#39;published_date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;DATE(created)&#39;</span>
<span class="p">])</span>
<span class="o">-&gt;</span><span class="na">group</span><span class="p">(</span><span class="s1">&#39;published_date&#39;</span><span class="p">)</span>
<span class="o">-&gt;</span><span class="na">having</span><span class="p">([</span><span class="s1">&#39;count &gt;&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="instructions-case">
<h3>Instructions Case<a class="headerlink" href="#instructions-case" title="Lien permanent vers ce titre">¶</a></h3>
<p>L&#8217;ORM offre également l&#8217;expression SQL <code class="docutils literal"><span class="pre">case</span></code>. L&#8217;expression <code class="docutils literal"><span class="pre">case</span></code> permet
l&#8217;implémentation d&#8217;une logique <code class="docutils literal"><span class="pre">if</span> <span class="pre">...</span> <span class="pre">then</span> <span class="pre">...</span> <span class="pre">else</span></code> dans votre SQL. Cela
peut être utile pour créer des rapports sur des données que vous avez besoin
d&#8217;additionner ou de compter conditionnellement, ou si vous avez besoin de
données spécifiques basées sur une condition.</p>
<p>Si vous vouliez savoir combien d&#8217;articles sont publiés dans notre base de
données, nous pourrions utiliser le SQL suivant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span>
<span class="nx">COUNT</span><span class="p">(</span><span class="k">CASE</span> <span class="nx">WHEN</span> <span class="nx">published</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span> <span class="nx">THEN</span> <span class="mi">1</span> <span class="nx">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nx">number_published</span><span class="p">,</span>
<span class="nx">COUNT</span><span class="p">(</span><span class="k">CASE</span> <span class="nx">WHEN</span> <span class="nx">published</span> <span class="o">=</span> <span class="s1">&#39;N&#39;</span> <span class="nx">THEN</span> <span class="mi">1</span> <span class="nx">END</span><span class="p">)</span> <span class="k">AS</span> <span class="nx">number_unpublished</span>
<span class="nx">FROM</span> <span class="nx">articles</span>
</pre></div>
</div>
<p>Pour faire ceci avec le générateur de requêtes, vous utiliseriez le code
suivant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$publishedCase</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">addCase</span><span class="p">(</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">([</span><span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Y&#39;</span><span class="p">]),</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;integer&#39;</span>
    <span class="p">);</span>
<span class="nv">$unpublishedCase</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">addCase</span><span class="p">(</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">([</span><span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;N&#39;</span><span class="p">]),</span>
        <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;integer&#39;</span>
    <span class="p">);</span>

<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span>
    <span class="s1">&#39;number_published&#39;</span> <span class="o">=&gt;</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="nv">$publishedCase</span><span class="p">),</span>
    <span class="s1">&#39;number_unpublished&#39;</span> <span class="o">=&gt;</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="nv">$unpublishedCase</span><span class="p">)</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>La fonction <code class="docutils literal"><span class="pre">addCase</span></code> peut aussi chaîner ensemble plusieurs instructions pour
créer une logique <code class="docutils literal"><span class="pre">if</span> <span class="pre">..</span> <span class="pre">then</span> <span class="pre">..</span> <span class="pre">[elseif</span> <span class="pre">..</span> <span class="pre">then</span> <span class="pre">..</span> <span class="pre">]</span> <span class="pre">[</span> <span class="pre">..</span> <span class="pre">else</span> <span class="pre">]</span></code> dans
votre SQL.</p>
<p>Si nous souhaitions classer des villes selon des tailles de population SMALL,
MEDIUM, ou LARGE, nous pourrions faire ce qui suit:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">addCase</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">lt</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="mi">100000</span><span class="p">),</span>
                <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">between</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="mi">100000</span><span class="p">,</span> <span class="mi">999000</span><span class="p">),</span>
                <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">gte</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="mi">999001</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;SMALL&#39;</span><span class="p">,</span>  <span class="s1">&#39;MEDIUM&#39;</span><span class="p">,</span> <span class="s1">&#39;LARGE&#39;</span><span class="p">],</span> <span class="c1"># les valeurs correspondantes aux conditions</span>
            <span class="p">[</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="c1"># type de chaque valeur</span>
        <span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE CASE</span>
<span class="c1">#   WHEN population &lt; 100000 THEN &#39;SMALL&#39;</span>
<span class="c1">#   WHEN population BETWEEN 100000 AND 999000 THEN &#39;MEDIUM&#39;</span>
<span class="c1">#   WHEN population &gt;= 999001 THEN &#39;LARGE&#39;</span>
<span class="c1">#   END</span>
</pre></div>
</div>
<p>A chaque fois qu&#8217;il y a moins de conditions qu&#8217;il n&#8217;y a de valeurs, <code class="docutils literal"><span class="pre">addCase</span></code>
va automatiquement produire une instruction <code class="docutils literal"><span class="pre">if</span> <span class="pre">..</span> <span class="pre">then</span> <span class="pre">..</span> <span class="pre">else</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">addCase</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;DESERTED&#39;</span><span class="p">,</span> <span class="s1">&#39;INHABITED&#39;</span><span class="p">],</span> <span class="c1"># valeurs correspondantes aux conditions</span>
            <span class="p">[</span><span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">]</span> <span class="c1"># type de chaque valeur</span>
        <span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE CASE</span>
<span class="c1">#   WHEN population = 0 THEN &#39;DESERTED&#39; ELSE &#39;INHABITED&#39; END</span>
</pre></div>
</div>
</div>
<div class="section" id="recuperer-des-tableaux-plutot-que-des-entities">
<h3>Récupérer des Tableaux plutôt que des Entities<a class="headerlink" href="#recuperer-des-tableaux-plutot-que-des-entities" title="Lien permanent vers ce titre">¶</a></h3>
<p>Bien que les ensembles de résultats en objet de l&#8217;ORM soient puissants, créer
des entities n&#8217;est parfois pas nécessaire. Par exemple, quand vous accédez aux
données agrégées, la construction d&#8217;une Entity peut ne pas être utile. Le
processus de conversion des résultats de la base de données en entities est
appelé hydratation. Si vous souhaitez désactiver ce processus, vous pouvez
faire ceci:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">hydrate</span><span class="p">(</span><span class="k">false</span><span class="p">);</span> <span class="c1">// Résultats en tableaux plutôt qu&#39;en entities</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span> <span class="c1">// Exécute la requête et retourne le tableau</span>
</pre></div>
</div>
<p>Après avoir exécuté ces lignes, votre résultat devrait ressembler à quelque
chose comme ceci:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Article 1 body&#39;</span> <span class="o">...</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Article 2 body&#39;</span> <span class="o">...</span><span class="p">],</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ajouter-des-champs-calcules">
<span id="format-results"></span><h2>Ajouter des Champs Calculés<a class="headerlink" href="#ajouter-des-champs-calcules" title="Lien permanent vers ce titre">¶</a></h2>
<p>Après vos requêtes, vous aurez peut-être besoin de faire des traitements
postérieurs. Si vous voulez ajouter quelques champs calculés ou des données
dérivées, vous pouvez utiliser la méthode <code class="docutils literal"><span class="pre">formatResults()</span></code>. C&#8217;est une
façon légère de mapper les ensembles de résultats. Si vous avez besoin de plus de
contrôle sur le processus, ou que vous souhaitez réduire les résultats, vous
devriez utiliser la fonctionnalité de <a class="reference internal" href="retrieving-data-and-resultsets.html#map-reduce"><span class="std std-ref">Map/Reduce</span></a> à la
place. Si vous faîtes une requête d&#8217;une liste de personnes, vous pourriez
calculer leur âge avec le formateur de résultats:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// En supposant que nous avons construit les champs, les conditions et les contain.</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">formatResults</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Cake\Collection\CollectionInterface</span>  <span class="nv">$results</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$results</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">diff</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">y</span><span class="p">;</span>
        <span class="k">return</span> <span class="nv">$row</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Comme vous pouvez le voir dans l&#8217;exemple ci-dessus, les callbacks de formatage
récupéreront un <code class="docutils literal"><span class="pre">ResultSetDecorator</span></code> en premier argument. Le second argument
sera l&#8217;instance Query sur laquelle le formateur a été attaché. L&#8217;argument
<code class="docutils literal"><span class="pre">$results</span></code> peut être traversé et modifié autant que nécessaire.</p>
<p>Les formateurs de résultat sont nécessaires pour retourner un objet itérateur,
qui sera utilisé comme valeur retournée pour la requête. Les fonctions de
formateurs sont appliquées après que toutes les routines
Map/Reduce soient exécutées. Les formateurs de résultat peuvent aussi être
appliqués dans les associations <code class="docutils literal"><span class="pre">contain</span></code>. CakePHP va s&#8217;assurer que vos
formateurs sont bien scopés. Par exemple, faire ce qui suit fonctionnera
comme vous pouvez vous y attendre:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Dans une méthode dans la table Articles</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Authors&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">formatResults</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">\Cake\Collection\CollectionInterface</span> <span class="nv">$authors</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$authors</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$author</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$author</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$author</span><span class="p">[</span><span class="s1">&#39;birth_date&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">diff</span><span class="p">(</span><span class="k">new</span> <span class="nx">\DateTime</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">y</span><span class="p">;</span>
            <span class="k">return</span> <span class="nv">$author</span><span class="p">;</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">}]);</span>

<span class="c1">// Récupère les résultats</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Affiche 29</span>
<span class="k">echo</span> <span class="nv">$results</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">author</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">;</span>
</pre></div>
</div>
<p>Comme vu précédemment, les formateurs attachés aux constructeurs de requête
associées sont limités pour agir seulement sur les données dans l&#8217;association.
CakePHP va s&#8217;assurer que les valeurs calculées soient insérées dans la bonne
entity.</p>
</div>
<div class="section" id="conditions-avancees">
<span id="advanced-query-conditions"></span><h2>Conditions Avancées<a class="headerlink" href="#conditions-avancees" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le constructeur de requête facilite la construction de clauses <code class="docutils literal"><span class="pre">where</span></code>
complexes. Les conditions groupées peuvent être exprimées en fournissant
une combinaison de <code class="docutils literal"><span class="pre">where()</span></code>, <code class="docutils literal"><span class="pre">andWhere()</span></code> et <code class="docutils literal"><span class="pre">orWhere()</span></code>. La méthode
<code class="docutils literal"><span class="pre">where()</span></code> fonctionne de manière similaire aux tableaux de conditions des
versions précédentes de CakePHP:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span>
        <span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s1">&#39;OR&#39;</span> <span class="o">=&gt;</span> <span class="p">[[</span><span class="s1">&#39;view_count&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;view_count&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">]],</span>
    <span class="p">]);</span>
</pre></div>
</div>
<p>Ce qui précède générerait le code SQL:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="o">*</span> <span class="nx">FROM</span> <span class="nx">articles</span> <span class="nx">WHERE</span> <span class="nx">author_id</span> <span class="o">=</span> <span class="mi">3</span> <span class="k">AND</span> <span class="p">(</span><span class="nx">view_count</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">OR</span> <span class="nx">view_count</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>Si vous préférez éviter des tableaux imbriqués profondément, vous pouvez
utiliser les méthodes <code class="docutils literal"><span class="pre">orWhere()</span></code> et <code class="docutils literal"><span class="pre">andWhere()</span></code> pour construire vos
requêtes. Chaque méthode définit l&#8217;opérateur de combinaison utilisé entre
les conditions courante et précédente. Par exemple:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">orWhere</span><span class="p">([</span><span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">]);</span>
</pre></div>
</div>
<p>Ce qui précède générerait le code SQL:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="o">*</span> <span class="nx">FROM</span> <span class="nx">articles</span> <span class="nx">WHERE</span> <span class="p">(</span><span class="nx">author_id</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">OR</span> <span class="nx">author_id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>En combinant <code class="docutils literal"><span class="pre">orWhere()</span></code> et <code class="docutils literal"><span class="pre">andWhere()</span></code>, vous pouvez exprimer des
conditions complexes qui utilisent un mix d&#8217;opérateurs:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">orWhere</span><span class="p">([</span><span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">andWhere</span><span class="p">([</span>
        <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="s1">&#39;view_count &gt;&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span>
    <span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">orWhere</span><span class="p">([</span><span class="s1">&#39;promoted&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
</pre></div>
</div>
<p>Ce qui précède générerait le code SQL:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="o">*</span>
<span class="nx">FROM</span> <span class="nx">articles</span>
<span class="nx">WHERE</span> <span class="p">(</span>
    <span class="p">(</span>
        <span class="p">(</span><span class="nx">author_id</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">OR</span> <span class="nx">author_id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">AND</span>
        <span class="p">(</span><span class="nx">published</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">AND</span> <span class="nx">view_count</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">OR</span> <span class="nx">promoted</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
<p>En utilisant les fonctions en paramètres pour <code class="docutils literal"><span class="pre">orWhere()</span></code> et <code class="docutils literal"><span class="pre">andWhere()</span></code>,
vous pouvez organiser ensemble les conditions avec les objets expression:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;title LIKE&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;%First%&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">andWhere</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">or_</span><span class="p">([</span>
            <span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
            <span class="s1">&#39;is_highlighted&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">]);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Ce qui précède générerait le code SQL:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="o">*</span>
<span class="nx">FROM</span> <span class="nx">articles</span>
<span class="nx">WHERE</span> <span class="p">(</span>
    <span class="nx">title</span> <span class="nx">LIKE</span> <span class="s1">&#39;%First%&#39;</span>
    <span class="k">AND</span>
    <span class="p">(</span><span class="nx">author_id</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">OR</span> <span class="nx">is_highlighted</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Les objets expression qui sont passés dans les fonctions <code class="docutils literal"><span class="pre">where()</span></code> ont deux
types de méthodes. Les premiers types de méthode sont des <strong>combinateurs</strong>.
Les méthodes <code class="docutils literal"><span class="pre">and_()</span></code> et <code class="docutils literal"><span class="pre">or_()</span></code> créent de nouveaux objets expression qui
changent <strong>la façon dont</strong> les conditions sont combinées. Les seconds types de
méthode sont les <strong>conditions</strong>. Les conditions sont ajoutées dans une
expression où elles sont combinées avec le combinateur courant.</p>
<p>Par exemple, appeler <code class="docutils literal"><span class="pre">$exp-&gt;and_(...)</span></code> va créer un nouvel objet <code class="docutils literal"><span class="pre">Expression</span></code>
qui combine toutes les conditions qu&#8217;il contient avec <code class="docutils literal"><span class="pre">AND</span></code>. Alors que
<code class="docutils literal"><span class="pre">$exp-&gt;or_()</span></code> va créer un nouvel objet <code class="docutils literal"><span class="pre">Expression</span></code> qui combine toutes les
conditions qui lui sont ajoutées avec <code class="docutils literal"><span class="pre">OR</span></code>. Un exemple d&#8217;ajout de conditions
avec une objet <code class="docutils literal"><span class="pre">Expression</span></code> serait:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span>
            <span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;author_id&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">notEq</span><span class="p">(</span><span class="s1">&#39;spam&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">gt</span><span class="p">(</span><span class="s1">&#39;view_count&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Puisque nous avons commencé à utiliser <code class="docutils literal"><span class="pre">where()</span></code>, nous n&#8217;avons pas besoin
d&#8217;appeler <code class="docutils literal"><span class="pre">and_()</span></code>, puisqu&#8217;elle est appelée implicitement. Un peu de la même
façon que nous n&#8217;appellerions pas <code class="docutils literal"><span class="pre">or_()</span></code> si nous avons commencé notre requête
avec <code class="docutils literal"><span class="pre">orWhere()</span></code>. Le code ci-dessus montre quelques nouvelles méthodes de
conditions combinées avec <code class="docutils literal"><span class="pre">AND</span></code>. Le code SQL résultant serait:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="o">*</span>
<span class="nx">FROM</span> <span class="nx">articles</span>
<span class="nx">WHERE</span> <span class="p">(</span>
<span class="nx">author_id</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">AND</span> <span class="nx">published</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">AND</span> <span class="nx">spam</span> <span class="o">!=</span> <span class="mi">1</span>
<span class="k">AND</span> <span class="nx">view_count</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Cependant, si nous souhaitons utiliser les deux conditions <code class="docutils literal"><span class="pre">AND</span></code> &amp; <code class="docutils literal"><span class="pre">OR</span></code>,
nous pourrions faire ce qui suit:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$orConditions</span> <span class="o">=</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">or_</span><span class="p">([</span><span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;author_id&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$exp</span>
            <span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$orConditions</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">gte</span><span class="p">(</span><span class="s1">&#39;view_count&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Ce qui générerait le code SQL suivant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="o">*</span>
<span class="nx">FROM</span> <span class="nx">articles</span>
<span class="nx">WHERE</span> <span class="p">(</span>
<span class="p">(</span><span class="nx">author_id</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">OR</span> <span class="nx">author_id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">AND</span> <span class="nx">published</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">AND</span> <span class="nx">view_count</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Les méthodes <code class="docutils literal"><span class="pre">or_()</span></code> et <code class="docutils literal"><span class="pre">and_()</span></code> vous permettent aussi d&#8217;utiliser les
fonctions en paramètres. C&#8217;est souvent plus facile à lire que les méthodes
chaînées:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$orConditions</span> <span class="o">=</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">or_</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$or</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$or</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;author_id&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;author_id&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="p">});</span>
        <span class="k">return</span> <span class="nv">$exp</span>
            <span class="o">-&gt;</span><span class="na">not</span><span class="p">(</span><span class="nv">$orConditions</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">lte</span><span class="p">(</span><span class="s1">&#39;view_count&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Vous pouvez faire une négation des sous-expressions en utilisant <code class="docutils literal"><span class="pre">not()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$orConditions</span> <span class="o">=</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">or_</span><span class="p">([</span><span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;author_id&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$exp</span>
            <span class="o">-&gt;</span><span class="na">not</span><span class="p">(</span><span class="nv">$orConditions</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">lte</span><span class="p">(</span><span class="s1">&#39;view_count&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Ce qui générerait le code SQL suivant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="o">*</span>
<span class="nx">FROM</span> <span class="nx">articles</span>
<span class="nx">WHERE</span> <span class="p">(</span>
<span class="k">NOT</span> <span class="p">(</span><span class="nx">author_id</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">OR</span> <span class="nx">author_id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
<span class="k">AND</span> <span class="nx">view_count</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>Il est aussi possible de construire les expressions en utilisant les fonctions
SQL:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$year</span> <span class="o">=</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">year</span><span class="p">([</span>
            <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;identifier&#39;</span>
        <span class="p">]);</span>
        <span class="k">return</span> <span class="nv">$exp</span>
            <span class="o">-&gt;</span><span class="na">gte</span><span class="p">(</span><span class="nv">$year</span><span class="p">,</span> <span class="mi">2014</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Ce qui générerait le code SQL suivant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">SELECT</span> <span class="o">*</span>
<span class="nx">FROM</span> <span class="nx">articles</span>
<span class="nx">WHERE</span> <span class="p">(</span>
<span class="nx">YEAR</span><span class="p">(</span><span class="nx">created</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2014</span>
<span class="k">AND</span> <span class="nx">published</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Quand vous utilisez les objets expression, vous pouvez utiliser les méthodes
suivantes pour créer des conditions:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">eq()</span></code> Crée une condition d&#8217;égalité:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">eq</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;10000&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE population = 10000</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">notEq()</span></code> Crée une condition d&#8217;inégalité:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">notEq</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;10000&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE population != 10000</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">like()</span></code> Crée une condition en utilisant l&#8217;opérateur <code class="docutils literal"><span class="pre">LIKE</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">like</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;%A%&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE name LIKE &quot;%A%&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">notLike()</span></code> Crée une condition négative de type <code class="docutils literal"><span class="pre">LIKE</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">notLike</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;%A%&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE name NOT LIKE &quot;%A%&quot;</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">in()</span></code> Crée une condition en utilisant <code class="docutils literal"><span class="pre">IN</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">in</span><span class="p">(</span><span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;AFG&#39;</span><span class="p">,</span> <span class="s1">&#39;USA&#39;</span><span class="p">,</span> <span class="s1">&#39;EST&#39;</span><span class="p">]);</span>
    <span class="p">});</span>
<span class="c1"># WHERE country_id IN (&#39;AFG&#39;, &#39;USA&#39;, &#39;EST&#39;)</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">notIn()</span></code> Crée une condition négative en utilisant <code class="docutils literal"><span class="pre">IN</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">notIn</span><span class="p">(</span><span class="s1">&#39;country_id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;AFG&#39;</span><span class="p">,</span> <span class="s1">&#39;USA&#39;</span><span class="p">,</span> <span class="s1">&#39;EST&#39;</span><span class="p">]);</span>
    <span class="p">});</span>
<span class="c1"># WHERE country_id NOT IN (&#39;AFG&#39;, &#39;USA&#39;, &#39;EST&#39;)</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">gt()</span></code> Crée une condition <code class="docutils literal"><span class="pre">&gt;</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">gt</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;10000&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE population &gt; 10000</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">gte()</span></code> Crée une condition <code class="docutils literal"><span class="pre">&gt;=</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">gte</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;10000&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE population &gt;= 10000</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">lt()</span></code> Crée une condition <code class="docutils literal"><span class="pre">&lt;</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">lt</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;10000&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE population &lt; 10000</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">lte()</span></code> Crée une condition <code class="docutils literal"><span class="pre">&lt;=</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">lte</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="s1">&#39;10000&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE population &lt;= 10000</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">isNull()</span></code> Crée une condition <code class="docutils literal"><span class="pre">IS</span> <span class="pre">NULL</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">isNull</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE (population) IS NULL</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">isNotNull()</span></code> Crée une condition négative <code class="docutils literal"><span class="pre">IS</span> <span class="pre">NULL</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">isNotNull</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE (population) IS NOT NULL</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">between()</span></code> Crée une condition <code class="docutils literal"><span class="pre">BETWEEN</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">between</span><span class="p">(</span><span class="s1">&#39;population&#39;</span><span class="p">,</span> <span class="mi">999</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE population BETWEEN 999 AND 5000000,</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">exists()</span></code> Crée une condition en utilisant <code class="docutils literal"><span class="pre">EXISTS</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$subquery</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">equalFields</span><span class="p">(</span><span class="s1">&#39;countries.id&#39;</span><span class="p">,</span> <span class="s1">&#39;cities.country_id&#39;</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">andWhere</span><span class="p">([</span><span class="s1">&#39;population &gt;&#39;</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">]);</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$countries</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$subquery</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">exists</span><span class="p">(</span><span class="nv">$subquery</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE EXISTS (SELECT id FROM cities WHERE countries.id = cities.country_id AND population &gt; 5000000)</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">notExists()</span></code> Crée une condition négative en utilisant <code class="docutils literal"><span class="pre">EXISTS</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$subquery</span> <span class="o">=</span> <span class="nv">$cities</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">equalFields</span><span class="p">(</span><span class="s1">&#39;countries.id&#39;</span><span class="p">,</span> <span class="s1">&#39;cities.country_id&#39;</span><span class="p">);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">andWhere</span><span class="p">([</span><span class="s1">&#39;population &gt;&#39;</span><span class="p">,</span> <span class="mi">5000000</span><span class="p">]);</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$countries</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">,</span> <span class="nv">$q</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$subquery</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">notExists</span><span class="p">(</span><span class="nv">$subquery</span><span class="p">);</span>
    <span class="p">});</span>
<span class="c1"># WHERE NOT EXISTS (SELECT id FROM cities WHERE countries.id = cities.country_id AND population &gt; 5000000)</span>
</pre></div>
</div>
</li>
</ul>
<p>Dans les cas où vous ne pouvez ou ne voulez pas utiliser les méthodes du
constructeur pour créer les conditions que vous voulez, vous pouvez utiliser du
code SQL dans des clauses where:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Compare deux champs l&#39;un avec l&#39;autre</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Categories.parent_id != Parents.id&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Les noms de champs utilisés dans les expressions et le code SQL ne doivent
<strong>jamais</strong> contenir de contenu non fiable.
Référez-vous à la section <a class="reference internal" href="#using-sql-functions"><span class="std std-ref">Utiliser les Fonctions SQL</span></a> pour savoir comment
inclure des données non fiables de manière sécurisée dans vos appels de
fonctions.</p>
</div>
<div class="section" id="creer-automatiquement-des-clauses-in">
<h3>Créer automatiquement des Clauses IN<a class="headerlink" href="#creer-automatiquement-des-clauses-in" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand vous construisez des requêtes en utilisant l&#8217;ORM, vous n&#8217;avez
généralement pas besoin d&#8217;indiquer les types de données des colonnes avec
lesquelles vous interagissez, puisque CakePHP peut déduire les types en se
basant sur les données du schéma. Si dans vos requêtes, vous souhaitez que
CakePHP convertisse automatiquement l&#8217;égalité en comparaisons <code class="docutils literal"><span class="pre">IN</span></code>, vous
devez indiquer les types de données des colonnes:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$ids</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer[]&#39;</span><span class="p">]);</span>

<span class="c1">// Or include IN to automatically cast to an array.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id IN&#39;</span> <span class="o">=&gt;</span> <span class="nv">$ids</span><span class="p">]);</span>
</pre></div>
</div>
<p>Ce qui est au-dessus va automatiquement créer <code class="docutils literal"><span class="pre">id</span> <span class="pre">IN</span> <span class="pre">(...)</span></code> plutôt que
<code class="docutils literal"><span class="pre">id</span> <span class="pre">=</span> <span class="pre">?</span></code>. Ceci peut être utile quand vous ne savez pas si vous allez
récupérer un scalaire ou un tableau de paramètres. Le suffixe <code class="docutils literal"><span class="pre">[]</span></code> sur un
nom de type de données indique au constructeur de requête que vous souhaitez
que les données soient gérées en tableau. Si les données ne sont pas un tableau,
elles vont d&#8217;abord être converties en tableau. Après cela, chaque valeur dans
le tableau va être convertie en utilisant le
<a class="reference internal" href="database-basics.html#database-data-types"><span class="std std-ref">système type</span></a>. Ceci fonctionne aussi avec les types
complexes. Par exemple, vous pourriez prendre une liste d&#8217;objets DateTime
en utilisant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;post_date&#39;</span> <span class="o">=&gt;</span> <span class="nv">$dates</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;post_date&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;date[]&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="creation-automatique-de-is-null">
<h3>Création Automatique de IS NULL<a class="headerlink" href="#creation-automatique-de-is-null" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand une valeur d&#8217;une condition s&#8217;attend à être <code class="docutils literal"><span class="pre">null</span></code> ou tout autre valeur,
vous pouvez utiliser l&#8217;opérateur <code class="docutils literal"><span class="pre">IS</span></code> pour créer automatiquement la bonne
expression:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$categories</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;parent_id IS&#39;</span> <span class="o">=&gt;</span> <span class="nv">$parentId</span><span class="p">]);</span>
</pre></div>
</div>
<p>Ce qui précède va créer <code class="docutils literal"><span class="pre">parent_id`</span> <span class="pre">=</span> <span class="pre">:c1</span></code> ou <code class="docutils literal"><span class="pre">parent_id</span> <span class="pre">IS</span> <span class="pre">NULL</span></code> selon le
type de <code class="docutils literal"><span class="pre">$parentId</span></code>.</p>
</div>
<div class="section" id="creation-automatique-de-is-not-null">
<h3>Création Automatique de IS NOT NULL<a class="headerlink" href="#creation-automatique-de-is-not-null" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand une valeur d&#8217;une condition s&#8217;attend à être <code class="docutils literal"><span class="pre">null</span></code> ou tout autre valeur,
vous pouvez utiliser l&#8217;opérateur <code class="docutils literal"><span class="pre">IS</span> <span class="pre">NOT</span></code> pour créer automatiquement la bonne
expression:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$categories</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;parent_id IS NOT&#39;</span> <span class="o">=&gt;</span> <span class="nv">$parentId</span><span class="p">]);</span>
</pre></div>
</div>
<p>Ce qui précède va créer <code class="docutils literal"><span class="pre">parent_id`</span> <span class="pre">!=</span> <span class="pre">:c1</span></code> ou <code class="docutils literal"><span class="pre">parent_id</span> <span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code>
selon le type de <code class="docutils literal"><span class="pre">$parentId</span></code>.</p>
</div>
<div class="section" id="raw-expressions">
<h3>Raw Expressions<a class="headerlink" href="#raw-expressions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand vous ne pouvez pas construire le code SQL, vous devez utiliser le
constructeur de requête, vous pouvez utiliser les objets <code class="docutils literal"><span class="pre">Expression</span></code> pour
ajouter des extraits de code SQL à vos requêtes:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$expr</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;1 + 1&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;two&#39;</span> <span class="o">=&gt;</span> <span class="nv">$expr</span><span class="p">]);</span>
</pre></div>
</div>
<p>Les objets <code class="docutils literal"><span class="pre">Expression</span></code> peuvent être utilisés avec les méthodes du
constructeur de requête comme <code class="docutils literal"><span class="pre">where()</span></code>, <code class="docutils literal"><span class="pre">limit()</span></code>, <code class="docutils literal"><span class="pre">group()</span></code>,
<code class="docutils literal"><span class="pre">select()</span></code> et d&#8217;autres méthodes.</p>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Utiliser les objets <code class="docutils literal"><span class="pre">Expression</span></code> vous laisse vulnérable aux injections SQL.
Vous devrez évitez d&#8217;interpoler les données d&#8217;utilisateur dans les
expressions.</p>
</div>
</div>
</div>
<div class="section" id="recuperer-les-resultats">
<h2>Récupérer les Résultats<a class="headerlink" href="#recuperer-les-resultats" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une fois que vous avez fait votre requête, vous voudrez récupérer des lignes
résultantes. Il y a plusieurs façons de faire ceci:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Itérer la requête</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$query</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Do stuff.</span>
<span class="p">}</span>

<span class="c1">// Récupérer les résultats</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
</pre></div>
</div>
<p>Vous pouvez utiliser toutes les méthodes
<a class="reference internal" href="../core-libraries/collections.html"><span class="doc">des Collections</span></a> sur vos objets
query pour traiter préalablement ou transformer les résultats:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Utilise une des méthodes collection.</span>
<span class="nv">$ids</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$maxAge</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">max</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$max</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$max</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Vous pouvez utiliser <code class="docutils literal"><span class="pre">first()</span></code> ou <code class="docutils literal"><span class="pre">firstOrFail()</span></code> pour récupérer un
enregistrement unique. Ces méthodes vont modifier la requête en ajoutant
une clause <code class="docutils literal"><span class="pre">LIMIT</span> <span class="pre">1</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Récupère uniquement la première ligne</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>

<span class="c1">// Récupère la première ligne ou une exception.</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">firstOrFail</span><span class="p">();</span>
</pre></div>
</div>
<div class="section" id="retourner-le-nombre-total-des-enregistrements">
<span id="query-count"></span><h3>Retourner le Nombre Total des Enregistrements<a class="headerlink" href="#retourner-le-nombre-total-des-enregistrements" title="Lien permanent vers ce titre">¶</a></h3>
<p>En utilisant un objet query unique, il est possible d&#8217;obtenir le nombre total
de lignes trouvées pour un ensemble de conditions:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$total</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;is_active&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">();</span>
</pre></div>
</div>
<p>La méthode <code class="docutils literal"><span class="pre">count()</span></code> va ignorer les clauses <code class="docutils literal"><span class="pre">limit</span></code>, <code class="docutils literal"><span class="pre">offset</span></code> et <code class="docutils literal"><span class="pre">page</span></code>,
donc ce qui suit va retourner les mêmes résultats:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$total</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;is_active&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">();</span>
</pre></div>
</div>
<p>C&#8217;est utile quand vous avez besoin de savoir la taille totale de l&#8217;ensemble des
résultats en avance, sans avoir à construire un autre objet <code class="docutils literal"><span class="pre">Query</span></code>. De cette
façon, tous les résultats formatés et les routines map-reduce sont ignorées
quand vous utilisez la méthode <code class="docutils literal"><span class="pre">count()</span></code>.</p>
<p>De plus, il est possible de retourner le nombre total pour une requête contenant
des clauses group by sans avoir à réécrire la requête en aucune façon. Par
exemple, considérons la requête qui permet de récupérer les ids d&#8217;article et
leur nombre de commentaires:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;Articles.id&#39;</span><span class="p">,</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="s1">&#39;Comments.id&#39;</span><span class="p">)])</span>
    <span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;Articles.id&#39;</span><span class="p">]);</span>
<span class="nv">$total</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">();</span>
</pre></div>
</div>
<p>Après avoir compté, la requête peut toujours être utilisée pour récupérer les
enregistrements associés:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$list</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
</pre></div>
</div>
<p>Parfois, vous voulez fournir une méthode alternative pour compter le nombre
total d&#8217;enregistrements d&#8217;une requête. Un cas d&#8217;utilisation courante pour ceci
est pour fournir une valeur mise en cache ou un nombre estimé total de lignes,
ou pour modifier la requête pour retirer les parties coûteuses non nécessaires
comme les left joins. Ceci devient particulièrement pratique quand vous utilisez
le système de pagination intégré à CakePHP qui appelle la méthode <code class="docutils literal"><span class="pre">count()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;is_active&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">counter</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">100000</span><span class="p">;</span>
<span class="p">});</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">();</span> <span class="c1">// Retourne 100000</span>
</pre></div>
</div>
<p>Dans l&#8217;exemple ci-dessus, quand le component pagination appelle la méthode
count, elle va recevoir le nombre de lignes estimées écrit en dur.</p>
</div>
<div class="section" id="mettre-en-cache-les-resultats-charges">
<span id="caching-query-results"></span><h3>Mettre en Cache les Résultats Chargés<a class="headerlink" href="#mettre-en-cache-les-resultats-charges" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand vous récupérez les entities qui ne changent pas souvent, vous voudrez
peut-être mettre en cache les résultats. La classe <code class="docutils literal"><span class="pre">Query</span></code> facilite cela:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">(</span><span class="s1">&#39;recent_articles&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Va activer la mise en cache l&#8217;ensemble des résultats de la requête. Si un seul
argument est fourni à <code class="docutils literal"><span class="pre">cache()</span></code> alors la configuration du cache &#8216;default&#8217;
va être utilisée. Vous pouvez contrôler la configuration du cache à utiliser
avec le deuxième paramètre:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Nom de la config.</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">(</span><span class="s1">&#39;recent_articles&#39;</span><span class="p">,</span> <span class="s1">&#39;dbResults&#39;</span><span class="p">);</span>

<span class="c1">// Instance de CacheEngine</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">(</span><span class="s1">&#39;recent_articles&#39;</span><span class="p">,</span> <span class="nv">$memcache</span><span class="p">);</span>
</pre></div>
</div>
<p>En plus de supporter les clés statiques, la méthode <code class="docutils literal"><span class="pre">cache()</span></code> accepte une
fonction pour générer la clé. La fonction que vous lui donnez, va recevoir la
requête en argument. Vous pouvez ensuite lire les aspects de la requête pour
générer dynamiquement la clé mise en cache:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Génère une clé basée sur un checksum simple</span>
<span class="c1">// de la clause where de la requête</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">cache</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s1">&#39;articles-&#39;</span> <span class="o">.</span> <span class="nb">md5</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$q</span><span class="o">-&gt;</span><span class="na">clause</span><span class="p">(</span><span class="s1">&#39;where&#39;</span><span class="p">)));</span>
<span class="p">});</span>
</pre></div>
</div>
<p>La méthode cache facilite l&#8217;ajout des résultats mis en cache à vos finders
personnalisés ou à travers des écouteurs d&#8217;évènement.</p>
<p>Quand les résultats pour une requête mise en cache sont récupérés, ce qui suit
va arriver:</p>
<ol class="arabic simple">
<li>L&#8217;évènement <code class="docutils literal"><span class="pre">Model.beforeFind</span></code> est déclenché.</li>
<li>Si la requête a des ensembles de résultats, ceux-ci vont être retournés.</li>
<li>La clé du cache va être déterminée et les données du cache vont être lues.
Si les données du cache sont vides, ces résultats vont être retournés.</li>
<li>Si le cache n&#8217;est pas présent, la requête sera exécutée et un nouveau
<code class="docutils literal"><span class="pre">ResultSet</span></code> sera créé. Ce <code class="docutils literal"><span class="pre">ResultSet</span></code> sera écrit dans le cache et sera
retourné.</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Vous ne pouvez pas mettre en cache un résultat de requête streaming.</p>
</div>
</div>
</div>
<div class="section" id="chargement-des-associations">
<h2>Chargement des Associations<a class="headerlink" href="#chargement-des-associations" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le constructeur peut vous aider à retrouver les données de plusieurs tables en
même temps avec le minimum de requêtes. Pour pouvoir
récupérer les données associées, vous devez configurer les associations entre
les tables comme décrit dans la section <a class="reference internal" href="associations.html"><span class="doc">Associations - Lier les Tables Ensemble</span></a>. Cette
technique de requêtes combinées pour récupérer les données associées à partir
d&#8217;autres tables est appelé <strong>eager loading</strong>.</p>
<p>Chaque Eager loading évite plusieurs problèmes potentiels de chargement
lors du lazy loading dans un ORM. Les requêtes générées par le eager loading
peuvent augmenter l&#8217;impact des jointures, permettant de faire des
requêtes plus efficaces. Dans CakePHP vous définissez des associations chargées
en eager en utilisant la méthode &#8216;contain&#8217;:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Dans un controller ou une méthode de table.</span>

<span class="c1">// En option du find()</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;contain&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Authors&#39;</span><span class="p">,</span> <span class="s1">&#39;Comments&#39;</span><span class="p">]]);</span>

<span class="c1">// En méthode sur un objet query</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Authors&#39;</span><span class="p">,</span> <span class="s1">&#39;Comments&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>Ce qui est au-dessus va charger les auteurs et commentaires liés pour chaque
article de l&#8217;ensemble de résultats. Vous pouvez charger les associations
imbriquées en utilisant les tableaux imbriqués pour définir les
associations à charger:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Authors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Addresses&#39;</span><span class="p">],</span> <span class="s1">&#39;Comments&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Authors&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>D&#8217;une autre façon, vous pouvez exprimer des associations imbriquées en utilisant
la notation par point:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Authors.Addresses&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Comments.Authors&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Vous pouvez charger les associations en eager aussi profondément que vous le
souhaitez:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$products</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Shops.Cities.Countries&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Shops.Managers&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Vous pouvez sélectionner des champs de toutes les associations en utilisant
plusieurs appels à <code class="docutils literal"><span class="pre">contain()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span>
    <span class="s1">&#39;Realestates.id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Realestates.title&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Realestates.description&#39;</span>
<span class="p">])</span>
<span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;RealestateAttributes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;Attributes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="c1">// Les champs alias dans contain() doivent</span>
                <span class="c1">// inclure le préfixe du modèle à mapper correctement.</span>
                <span class="s1">&#39;Attributes__name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;attr_name&#39;</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">])</span>
<span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;RealestateAttributes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;RealestateAttributes.realestate_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RealestateAttributes.value&#39;</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">])</span>
<span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="nv">$condition</span><span class="p">);</span>
</pre></div>
</div>
<p>Si vous avez besoin de remettre les contain sur une requête, vous pouvez
définir le second argument à <code class="docutils literal"><span class="pre">true</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Authors&#39;</span><span class="p">,</span> <span class="s1">&#39;Comments&#39;</span><span class="p">],</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="passer-des-conditions-a-contain">
<h3>Passer des Conditions à Contain<a class="headerlink" href="#passer-des-conditions-a-contain" title="Lien permanent vers ce titre">¶</a></h3>
<p>Avec l&#8217;utilisation de <code class="docutils literal"><span class="pre">contain()</span></code>, vous pouvez restreindre les données
retournées par les associations et les filtrer par conditions:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Dans un controller ou une méthode de table.</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nv">$q</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;author_id&#39;</span><span class="p">])</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Comments.approved&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Cela fonctionne aussi pour la pagination au niveau du Controller:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;contain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Comments&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nx">\Cake\ORM\Query</span> <span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;author_id&#39;</span><span class="p">])</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Comments.approved&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Quand vous limitez les champs qui sont récupérés d&#8217;une association, vous
<strong>devez</strong> vous assurer que les colonnes de clé étrangère soient
sélectionnées. Ne pas sélectionner les champs de clé étrangère va entraîner
la non présence des données associées dans le résultat final.</p>
</div>
<p>Il est aussi possible de restreindre les associations imbriquées profondément
en utilisant la notation par point:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Comments&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Authors.Profiles&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Profiles.is_published&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Dans l&#8217;exemple ci-dessus, vous obtiendrez les auteurs même s&#8217;ils n&#8217;ont pas
de profil publié. Pour ne récupérer que les auteurs avec un profil publié,
utilisez <a class="reference internal" href="retrieving-data-and-resultsets.html#filtering-by-associated-data"><span class="std std-ref">matching()</span></a>.</p>
<p>Si vous avez des méthodes de finder personnalisées dans votre table associée,
vous pouvez les utiliser à l&#8217;intérieur de <code class="docutils literal"><span class="pre">contain()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Récupère tous les articles, mais récupère seulement les commentaires qui</span>
<span class="c1">// sont approuvés et populaires.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;approved&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;popular&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour les associations <code class="docutils literal"><span class="pre">BelongsTo</span></code> et <code class="docutils literal"><span class="pre">HasOne</span></code>, seules les clauses
<code class="docutils literal"><span class="pre">where</span></code> et <code class="docutils literal"><span class="pre">select</span></code> sont utilisées lors du chargement des
enregistrements associés. Pour le reste des types d&#8217;association, vous pouvez
utiliser chaque clause que l&#8217;objet query fournit.</p>
</div>
<p>Si vous devez prendre le contrôle total d&#8217;une requête qui est générée, vous
pouvez appeler <code class="docutils literal"><span class="pre">contain()</span></code> pour ne pas ajouter les contraintes <code class="docutils literal"><span class="pre">foreignKey</span></code>
à la requête générée. Dans ce cas, vous devez utiliser un tableau en passant
<code class="docutils literal"><span class="pre">foreignKey</span></code> et <code class="docutils literal"><span class="pre">queryBuilder</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Authors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;foreignKey&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="s1">&#39;queryBuilder&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="o">...</span><span class="p">);</span> <span class="c1">// Full conditions for filtering</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Si vous avez limité les champs que vous chargez avec <code class="docutils literal"><span class="pre">select()</span></code> mais que
vous souhaitez aussi charger les champs enlevés des associations avec contain,
vous pouvez passer l&#8217;objet association à <code class="docutils literal"><span class="pre">select()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Sélectionne id &amp; title de articles, mais tous les champs enlevés pour Users.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">Users</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Users&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>D&#8217;une autre façon, si vous pouvez faire des associations multiples, vous
pouvez utiliser <code class="docutils literal"><span class="pre">enableAutoFields()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Sélectionne id &amp; title de articles, mais tous les champs enlevés de</span>
<span class="c1">// Users, Comments et Tags.</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Comments&#39;</span><span class="p">,</span> <span class="s1">&#39;Tags&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">enableAutoFields</span><span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="c1">// Avant 3.4.0 utilisez autoFields(true)</span>
    <span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Users&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span><span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">autoFields</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}]);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.1: </span>La sélection des colonnes via un objet association a été ajouté dans 3.1</p>
</div>
</div>
<div class="section" id="ordonner-les-associations-contain">
<h3>Ordonner les Associations Contain<a class="headerlink" href="#ordonner-les-associations-contain" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand vous chargez des associations HasMany et BelongsToMany, vous pouvez
utiliser l&#8217;option <code class="docutils literal"><span class="pre">sort</span></code> pour ordonner les données dans ces associations:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Comments&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;sort&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Comments.created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;DESC&#39;</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-by-associated-data">
<h3>Filtering by Associated Data<a class="headerlink" href="#filtering-by-associated-data" title="Lien permanent vers ce titre">¶</a></h3>
<p>Un cas de requête couramment fait avec les associations est de trouver les
enregistrements qui &#8216;matchent&#8217; les données associées spécifiques. Par exemple
si vous avez &#8216;Articles belongsToMany Tags&#8217;, vous aurez probablement envie de
trouver les Articles qui ont le tag CakePHP. C&#8217;est extrêmement simple
à faire avec l&#8217;ORM de CakePHP:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Dans un controller ou table de méthode.</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span><span class="s1">&#39;Tags&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Tags.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CakePHP&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Vous pouvez aussi appliquer cette stratégie aux associations HasMany. Par
exemple si &#8216;Authors HasMany Articles&#8217;, vous pouvez trouver tous les auteurs
avec les articles récemment publiés en utilisant ce qui suit:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$authors</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Articles.created &gt;=&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;-10 days&#39;</span><span class="p">)]);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Filtrer des associations imbriquées est étonnamment facile, et la syntaxe doit
déjà vous être familière:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Dans un controller ou une table de méthode.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$products</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span>
    <span class="s1">&#39;Shops.Cities.Countries&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Countries.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Japan&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Récupère les articles uniques qui étaient commentés par &#39;markstory&#39;</span>
<span class="c1">// en utilisant la variable passée</span>
<span class="c1">// Les chemins avec points doivent être utilisés plutôt que les appels</span>
<span class="c1">// imbriqués de matching()</span>
<span class="nv">$username</span> <span class="o">=</span> <span class="s1">&#39;markstory&#39;</span><span class="p">;</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span><span class="s1">&#39;Comments.Users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Comme cette fonction va créer un <code class="docutils literal"><span class="pre">INNER</span> <span class="pre">JOIN</span></code>, vous pouvez appeler
<code class="docutils literal"><span class="pre">distinct</span></code> sur le find de la requête puisque vous aurez des lignes
dupliquées si les conditions ne les excluent pas déjà. Ceci peut être le
cas, par exemple, quand les mêmes utilisateurs commentent plus d&#8217;une fois
un article unique.</p>
</div>
<p>Les données des associations qui sont &#8216;matchés&#8217; (appairés) seront disponibles
dans l&#8217;attribut <code class="docutils literal"><span class="pre">_matchingData</span></code> des entities. Si vous utilisez à la fois
match et contain sur la même association, vous pouvez vous attendre à recevoir
à la fois la propriété <code class="docutils literal"><span class="pre">_matchingData</span></code> et la propriété standard d&#8217;association
dans vos résultats.</p>
</div>
<div class="section" id="utiliser-innerjoinwith">
<h3>Utiliser innerJoinWith<a class="headerlink" href="#utiliser-innerjoinwith" title="Lien permanent vers ce titre">¶</a></h3>
<p>Utiliser la fonction <code class="docutils literal"><span class="pre">matching()</span></code>, comme nous l&#8217;avons vu précédemment, va
créer un <code class="docutils literal"><span class="pre">INNER</span> <span class="pre">JOIN</span></code> avec l&#8217;association spécifiée et va aussi charger les
champs dans un ensemble de résultats.</p>
<p>Il peut arriver que vous vouliez utiliser <code class="docutils literal"><span class="pre">matching()</span></code> mais que vous n&#8217;êtes
pas intéressé par le chargement des champs dans un ensemble de résultats. Dans
ce cas, vous pouvez utiliser <code class="docutils literal"><span class="pre">innerJoinWith()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">innerJoinWith</span><span class="p">(</span><span class="s1">&#39;Tags&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Tags.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CakePHP&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>La méthode <code class="docutils literal"><span class="pre">innerJoinWith()</span></code> fonctionne de la même manière que <code class="docutils literal"><span class="pre">matching()</span></code>,
ce qui signifie que vous pouvez utiliser la notation par points pour faire des
jointures pour les associations imbriquées profondément:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$products</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">innerJoinWith</span><span class="p">(</span>
    <span class="s1">&#39;Shops.Cities.Countries&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Countries.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Japan&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>De même, la seule différence est qu&#8217;aucune colonne supplémentaire ne sera
ajoutée à l&#8217;ensemble de résultats et aucune propriété <code class="docutils literal"><span class="pre">_matchingData</span></code> ne sera
définie.</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.1: </span>Query::innerJoinWith() a été ajoutée dans 3.1</p>
</div>
</div>
<div class="section" id="utiliser-notmatching">
<h3>Utiliser notMatching<a class="headerlink" href="#utiliser-notmatching" title="Lien permanent vers ce titre">¶</a></h3>
<p>L&#8217;opposé de <code class="docutils literal"><span class="pre">matching()</span></code> est <code class="docutils literal"><span class="pre">notMatching()</span></code>. Cette fonction va changer
la requête pour qu&#8217;elle filtre les résultats qui n&#8217;ont pas de relation avec
l&#8217;association spécifiée:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Dans un controller ou une méthode de table.</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articlesTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">notMatching</span><span class="p">(</span><span class="s1">&#39;Tags&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Tags.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boring&#39;</span><span class="p">]);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>L&#8217;exemple ci-dessus va trouver tous les articles qui n&#8217;étaient pas taggés avec
le mot <code class="docutils literal"><span class="pre">boring</span></code>. Vous pouvez aussi utiliser cette méthode avec les
associations HasMany. Vous pouvez, par exemple, trouver tous les auteurs qui
n&#8217;ont aucun article dans les 10 derniers jours:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$authorsTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">notMatching</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Articles.created &gt;=&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(</span><span class="s1">&#39;-10 days&#39;</span><span class="p">)]);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Il est aussi possible d&#8217;utiliser cette méthode pour filtrer les enregistrements
qui ne matchent pas les associations profondes. Par exemple, vous pouvez
trouver les articles qui n&#8217;ont pas été commentés par un utilisateur précis:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articlesTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">notMatching</span><span class="p">(</span><span class="s1">&#39;Comments.Users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jose&#39;</span><span class="p">]);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Puisque les articles avec aucun commentaire satisfont aussi la condition
du dessus, vous pouvez combiner <code class="docutils literal"><span class="pre">matching()</span></code> et <code class="docutils literal"><span class="pre">notMatching()</span></code> dans la
même requête. L&#8217;exemple suivant va trouver les articles ayant au moins un
commentaire, mais non commentés par un utilisateur précis:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articlesTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">notMatching</span><span class="p">(</span><span class="s1">&#39;Comments.Users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jose&#39;</span><span class="p">]);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Comme <code class="docutils literal"><span class="pre">notMatching()</span></code> va créer un <code class="docutils literal"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code>, vous pouvez envisager
d&#8217;appeler <code class="docutils literal"><span class="pre">distinct</span></code> sur la requête find puisque sinon vous allez avoir
des lignes dupliquées.</p>
</div>
<p>Gardez à l&#8217;esprit que le contraire de la fonction <code class="docutils literal"><span class="pre">matching()</span></code>,
<code class="docutils literal"><span class="pre">notMatching()</span></code> ne va pas ajouter toutes les données à la propriété
<code class="docutils literal"><span class="pre">_matchingData</span></code> dans les résultats.</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.1: </span>Query::notMatching() a été ajoutée dans 3.1</p>
</div>
</div>
<div class="section" id="utiliser-leftjoinwith">
<h3>Utiliser leftJoinWith<a class="headerlink" href="#utiliser-leftjoinwith" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans certaines situations, vous aurez à calculer un résultat selon une
association, sans avoir à charger tous les enregistrements. Par
exemple, si vous voulez charger le nombre total de commentaires qu&#8217;un article
a, ainsi que toutes les données de l&#8217;article, vous pouvez utiliser la fonction
<code class="docutils literal"><span class="pre">leftJoinWith()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articlesTable</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;total_comments&#39;</span> <span class="o">=&gt;</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="s1">&#39;Comments.id&#39;</span><span class="p">)])</span>
    <span class="o">-&gt;</span><span class="na">leftJoinWith</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;Articles.id&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">enableAutoFields</span><span class="p">(</span><span class="k">true</span><span class="p">);</span> <span class="c1">// Avant 3.4.0 utilisez autoFields(true)</span>
</pre></div>
</div>
<p>Le résultat de la requête ci-dessus va contenir les données de l&#8217;article et
la propriété <code class="docutils literal"><span class="pre">total_comments</span></code> pour chacun d&#8217;eux.</p>
<p><code class="docutils literal"><span class="pre">leftJoinWith()</span></code> peut aussi être utilisée avec des associations profondes.
C&#8217;est utile par exemple pour rapporter le nombre d&#8217;articles taggés par l&#8217;auteur
avec un certain mot:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$authorsTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;total_articles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="s1">&#39;Articles.id&#39;</span><span class="p">)])</span>
    <span class="o">-&gt;</span><span class="na">leftJoinWith</span><span class="p">(</span><span class="s1">&#39;Articles.Tags&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Tags.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;awesome&#39;</span><span class="p">]);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;Authors.id&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">enableAutoFields</span><span class="p">(</span><span class="k">true</span><span class="p">);</span> <span class="c1">// Avant 3.4.0 utilisez autoFields(true)</span>
</pre></div>
</div>
<p>Cette fonction ne va charger aucune colonne des associations spécifiées dans
l&#8217;ensemble de résultats.</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.1: </span>Query::leftJoinWith() a été ajoutée dans 3.1</p>
</div>
</div>
<div class="section" id="ajouter-des-jointures">
<span id="adding-joins"></span><h3>Ajouter des Jointures<a class="headerlink" href="#ajouter-des-jointures" title="Lien permanent vers ce titre">¶</a></h3>
<p>En plus de charger les données liées avec <code class="docutils literal"><span class="pre">contain()</span></code>, vous pouvez aussi
ajouter des jointures supplémentaires avec le constructeur de requête:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">hydrate</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">join</span><span class="p">([</span>
        <span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span>
        <span class="s1">&#39;alias&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span>
        <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">,</span>
        <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;c.article_id = articles.id&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
</pre></div>
</div>
<p>Vous pouvez ajouter plusieurs jointures en même temps en passant un tableau
associatif avec plusieurs <code class="docutils literal"><span class="pre">join</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">hydrate</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">join</span><span class="p">([</span>
        <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;c.article_id = articles.id&#39;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s1">&#39;u&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;INNER&#39;</span><span class="p">,</span>
            <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;u.id = articles.user_id&#39;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]);</span>
</pre></div>
</div>
<p>Comme vu précédemment, lors de l&#8217;ajout de <code class="docutils literal"><span class="pre">join</span></code>, l&#8217;alias peut être la clé du
tableau externe. Les conditions <code class="docutils literal"><span class="pre">join</span></code> peuvent être aussi exprimées en tableau
de conditions:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">hydrate</span><span class="p">(</span><span class="k">false</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">join</span><span class="p">([</span>
        <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;c.created &gt;&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;-5 days&#39;</span><span class="p">),</span>
                <span class="s1">&#39;c.moderated&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="s1">&#39;c.article_id = articles.id&#39;</span>
            <span class="p">]</span>
        <span class="p">],</span>
    <span class="p">],</span> <span class="p">[</span><span class="s1">&#39;c.created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;c.moderated&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boolean&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>Lors de la création de <code class="docutils literal"><span class="pre">join</span></code> à la main, et l&#8217;utilisation d&#8217;un tableau basé
sur les conditions, vous devez fournir les types de données pour chaque colonne
dans les conditions du <code class="docutils literal"><span class="pre">join</span></code>. En fournissant les types de données pour les
conditions de <code class="docutils literal"><span class="pre">join</span></code>, l&#8217;ORM peut convertir correctement les types de données
en code SQL. En plus de <code class="docutils literal"><span class="pre">join()</span></code> vous pouvez utiliser <code class="docutils literal"><span class="pre">rightJoin()</span></code>,
<code class="docutils literal"><span class="pre">leftJoin()</span></code> et <code class="docutils literal"><span class="pre">innerJoin()</span></code> pour créer les jointures:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Jointure avec un alias et des conditions</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">leftJoin</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;Authors&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;authors&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;Authors.id = Articles.author_id&#39;</span><span class="p">]</span>
<span class="p">);</span>

<span class="c1">// Jointure avec un alias, tableau de conditions, et de types</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">innerJoin</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;Authors&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;authors&#39;</span><span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;Authors.promoted&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
        <span class="s1">&#39;Authors.created&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;-5 days&#39;</span><span class="p">),</span>
        <span class="s1">&#39;Authors.id = Articles.author_id&#39;</span>
    <span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;Authors.promoted&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boolean&#39;</span><span class="p">,</span> <span class="s1">&#39;Authors.created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">]</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Notez que si vous définissez l&#8217;option <code class="docutils literal"><span class="pre">quoteIdentifiers</span></code> à <code class="docutils literal"><span class="pre">true</span></code> quand vous
configurez votre <code class="docutils literal"><span class="pre">Connection</span></code>, les conditions mettant en relation deux champs
de tables différentes doivent être définies de cette manière:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">join</span><span class="p">([</span>
        <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;comments&#39;</span><span class="p">,</span>
            <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LEFT&#39;</span><span class="p">,</span>
            <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;c.article_id&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\Cake\Database\Expression\IdentifierExpression</span><span class="p">(</span><span class="s1">&#39;articles.id&#39;</span><span class="p">)</span>
            <span class="p">]</span>
        <span class="p">],</span>
    <span class="p">]);</span>
</pre></div>
</div>
<p>Cela permet de s&#8217;assurer que tous les <code class="docutils literal"><span class="pre">identifiers</span></code> sont bien quotés dans la
requête générée, permettant d&#8217;éviter des erreurs avec certains drivers
(PostgreSQL notamment).</p>
</div>
</div>
<div class="section" id="inserer-des-donnees">
<h2>Insérer des Données<a class="headerlink" href="#inserer-des-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>Au contraire des exemples précédents, vous ne devez pas utiliser <code class="docutils literal"><span class="pre">find()</span></code> pour
créer des requêtes d&#8217;insertion. A la place, créez un nouvel objet <code class="docutils literal"><span class="pre">Query</span></code>
en utilisant <code class="docutils literal"><span class="pre">query()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">values</span><span class="p">([</span>
        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First post&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Some body text&#39;</span>
    <span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Pour insérer plusieurs lignes en une seule requête, vous pouvez chaîner la
méthode <code class="docutils literal"><span class="pre">values()</span></code> autant de fois que nécessaire:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">values</span><span class="p">([</span>
        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First post&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Some body text&#39;</span>
    <span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">values</span><span class="p">([</span>
        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second post&#39;</span><span class="p">,</span>
        <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Another body text&#39;</span>
    <span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Généralement, il est plus facile d&#8217;insérer des données en utilisant les
entities et <a class="reference internal" href="saving-data.html#Cake\ORM\Table::save" title="Cake\ORM\Table::save"><code class="xref php php-meth docutils literal"><span class="pre">ORM\Table::save()</span></code></a>. En composant des requêtes
<code class="docutils literal"><span class="pre">SELECT</span></code> et <code class="docutils literal"><span class="pre">INSERT</span></code> ensemble, vous pouvez créer des requêtes de style
<code class="docutils literal"><span class="pre">INSERT</span> <span class="pre">INTO</span> <span class="pre">...</span> <span class="pre">SELECT</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$select</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">insert</span><span class="p">([</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;published&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">values</span><span class="p">(</span><span class="nv">$select</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ajouter des enregistrements avec le constructeur de requêtes ne va pas
déclencher les events comme <code class="docutils literal"><span class="pre">Model.afterSave</span></code>. À la place, vous pouvez
utiliser <a class="reference internal" href="saving-data.html"><span class="doc">l&#8217;ORM pour sauvegardes les données</span></a>.</p>
</div>
</div>
<div class="section" id="mettre-a-jour-les-donnees">
<span id="query-builder-updating-data"></span><h2>Mettre à Jour les Données<a class="headerlink" href="#mettre-a-jour-les-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>Comme pour les requêtes d&#8217;insertion, vous ne devez pas utiliser <code class="docutils literal"><span class="pre">find()</span></code> pour
créer des requêtes de mise à jour. A la place, créez un nouvel objet <code class="docutils literal"><span class="pre">Query</span></code>
en utilisant <code class="docutils literal"><span class="pre">query()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span><span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Généralement, il est plus facile de mettre à jour des données en utilisant des
entities et <code class="xref php php-meth docutils literal"><span class="pre">ORM\Table::patchEntity()</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Mettre à jour des enregistrements avec le constructeur de requêtes ne va pas
déclencher les events comme <code class="docutils literal"><span class="pre">Model.afterSave</span></code>. À la place, vous pouvez
utiliser <a class="reference internal" href="saving-data.html"><span class="doc">l&#8217;ORM pour sauvegarder des données</span></a>.</p>
</div>
</div>
<div class="section" id="suppression-des-donnees">
<h2>Suppression des Données<a class="headerlink" href="#suppression-des-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>Comme pour les requêtes d&#8217;insertion, vous ne devez pas utiliser <code class="docutils literal"><span class="pre">find()</span></code>
pour créer des requêtes de suppression. A la place, créez un nouvel objet de
requête en utilisant <code class="docutils literal"><span class="pre">query()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$id</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
</pre></div>
</div>
<p>Généralement, il est plus facile de supprimer les données en utilisant les
entities et <a class="reference internal" href="deleting-data.html#Cake\ORM\Table::delete" title="Cake\ORM\Table::delete"><code class="xref php php-meth docutils literal"><span class="pre">ORM\Table::delete()</span></code></a>.</p>
</div>
<div class="section" id="prevention-contre-les-injections-sql">
<h2>Prévention contre les Injections SQL<a class="headerlink" href="#prevention-contre-les-injections-sql" title="Lien permanent vers ce titre">¶</a></h2>
<p>Alors que l&#8217;ORM et les couches d&#8217;abstraction de base de données empêchent la
plupart des problèmes relatifs aux injections SQL, il est toujours possible que
vous soyez vulnérables face à une utilisation incorrecte.</p>
<p>Lorsque vous utilisez des tableaux de conditions, la clé (la partie à gauche)
ou bien une valeur seule ne doivent pas contenir de données utilisateur:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span>
    <span class="c1">// Utiliser cette clé est dangereux car elle sera insérée dans la</span>
    <span class="c1">// requête générée telle quelle</span>
    <span class="nv">$userData</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">,</span>

    <span class="c1">// Le même commentaire s&#39;applique pour les valeurs seule : il est</span>
    <span class="c1">// dangereux de les utiliser avec des données utilisateur</span>
    <span class="nv">$userData</span><span class="p">,</span>
    <span class="s2">&quot;MATCH (comment) AGAINST (</span><span class="si">$userData</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="s1">&#39;created &lt; NOW() - &#39;</span> <span class="o">.</span> <span class="nv">$userData</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Lorsque vous utilisez le constructeur de fonctions, les noms de colonnes ne
doivent pas contenir de données provenant d&#8217;utilisateurs:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$exp</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$userData</span><span class="p">,</span> <span class="nv">$values</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Les noms de colonnes dans toutes les expressions ne sont pas sûrs.</span>
    <span class="k">return</span> <span class="nv">$exp</span><span class="o">-&gt;</span><span class="na">in</span><span class="p">(</span><span class="nv">$userData</span><span class="p">,</span> <span class="nv">$values</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Lorsque vous construisez des expressions, les noms de fonctions ne doivent
jamais contenir de données provenant d&#8217;utilisateurs:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Non sécurisé.</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$userData</span><span class="p">}(</span><span class="nv">$arg1</span><span class="p">);</span>

<span class="c1">// L&#39;utilisation d&#39;un tableau de données utilisateurs</span>
<span class="c1">// dans une fonction n&#39;est également pas sécurisée</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">coalesce</span><span class="p">(</span><span class="nv">$userData</span><span class="p">);</span>
</pre></div>
</div>
<p>Les expressions brutes ne sont jamais sécurisées:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$expr</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">newExpr</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">(</span><span class="nv">$userData</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;two&#39;</span> <span class="o">=&gt;</span> <span class="nv">$expr</span><span class="p">]);</span>
</pre></div>
</div>
<div class="section" id="lier-les-valeurs-binding">
<h3>Lier les Valeurs (Binding)<a class="headerlink" href="#lier-les-valeurs-binding" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il est possible de protéger vos requêtes en utilisant le &#8220;binding&#8221;.
De la même manière que vous pouvez <a class="reference internal" href="database-basics.html#database-basics-binding-values"><span class="std std-ref">&#8220;binder&#8221; des valeurs pour les requêtes préparées</span></a>,
des valeurs peuvent être &#8220;bindées&#8221; aux requêtes en utilisant la méthode <code class="xref php php-meth docutils literal"><span class="pre">Cake\Database\Query::bind()</span></code>.</p>
<p>L&#8217;exemple ci-dessous est une alternative sûre par rapport à la version donnée
plus haut, qui serait vulnérable à une injection SQL:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span>
        <span class="s1">&#39;MATCH (comment) AGAINST (:userData)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;created &lt; NOW() - :moreUserData&#39;</span>
    <span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;:userData&#39;</span><span class="p">,</span> <span class="nv">$userData</span><span class="p">,</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">bind</span><span class="p">(</span><span class="s1">&#39;:moreUserData&#39;</span><span class="p">,</span> <span class="nv">$moreUserData</span><span class="p">,</span> <span class="s1">&#39;datetime&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Contrairement à <code class="xref php php-meth docutils literal"><span class="pre">Cake\Database\StatementInterface::bindValue()</span></code>,
<code class="docutils literal"><span class="pre">Query::bind()</span></code> a besoin que vous passiez les &#8220;placeholders&#8221; en incluant
les deux-points (<code class="docutils literal"><span class="pre">:</span></code>) !</p>
</div>
</div>
</div>
<div class="section" id="plus-de-requetes-complexes">
<h2>Plus de Requêtes Complexes<a class="headerlink" href="#plus-de-requetes-complexes" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le constructeur de requête est capable de construire des requêtes complexes
comme les requêtes <code class="docutils literal"><span class="pre">UNION</span></code> et sous-requêtes.</p>
<div class="section" id="unions">
<h3>Unions<a class="headerlink" href="#unions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les unions sont créées en composant une ou plusieurs requêtes select ensemble:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$inReview</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;need_review&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>

<span class="nv">$unpublished</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]);</span>

<span class="nv">$unpublished</span><span class="o">-&gt;</span><span class="na">union</span><span class="p">(</span><span class="nv">$inReview</span><span class="p">);</span>
</pre></div>
</div>
<p>Vous pouvez créer les requêtes <code class="docutils literal"><span class="pre">UNION</span> <span class="pre">ALL</span></code> en utilisant la méthode
<code class="docutils literal"><span class="pre">unionAll()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$inReview</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;need_review&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>

<span class="nv">$unpublished</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]);</span>

<span class="nv">$unpublished</span><span class="o">-&gt;</span><span class="na">unionAll</span><span class="p">(</span><span class="nv">$inReview</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="sous-requetes">
<h3>Sous-Requêtes<a class="headerlink" href="#sous-requetes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les sous-requêtes sont une fonctionnalité puissante dans les bases de données
relationnelles et les construire dans CakePHP est assez intuitif. En composant
les requêtes ensemble, vous pouvez faire des sous-requêtes:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$matchingComment</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">association</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;article_id&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">distinct</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;comment LIKE&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;%CakePHP%&#39;</span><span class="p">]);</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$matchingComment</span><span class="p">]);</span>
</pre></div>
</div>
<p>Les sous-requêtes sont acceptées partout où une expression query peut être
utilisée. Par exemple, dans les méthodes <code class="docutils literal"><span class="pre">select()</span></code> et <code class="docutils literal"><span class="pre">join()</span></code>.</p>
</div>
<div class="section" id="adding-locking-statements">
<h3>Adding Locking Statements<a class="headerlink" href="#adding-locking-statements" title="Lien permanent vers ce titre">¶</a></h3>
<p>Most relational database vendors support taking out locks when doing select
operations. You can use the <code class="docutils literal"><span class="pre">epilog()</span></code> method for this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In MySQL</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">epilog</span><span class="p">(</span><span class="s1">&#39;FOR UPDATE&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">epilog()</span></code> method allows you to append raw SQL to the end of queries. You
should never put raw user data into <code class="docutils literal"><span class="pre">epilog()</span></code>.</p>
</div>
<div class="section" id="executer-des-requetes-complexes">
<h3>Exécuter des Requêtes Complexes<a class="headerlink" href="#executer-des-requetes-complexes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Bien que le constructeur de requêtes facilite la construction de la plupart des
requêtes, les requêtes très complexes peuvent être fastidieuses et compliquées
à construire. Vous voudrez surement vous référer à <a class="reference internal" href="database-basics.html#running-select-statements"><span class="std std-ref">l&#8217;exécution
directe du SQL souhaité</span></a>.</p>
<p>Exécuter directement le SQL vous permet d&#8217;affiner la requête qui sera utilisée.
Cependant, cela vous empêchera d&#8217;utiliser <code class="docutils literal"><span class="pre">contain</span></code> ou toute autre
fonctionnalité de plus haut niveau de l&#8217;ORM.</p>
</div>
</div>
</div>


            </div>
        </div>

        
        <div class="col-md-3 col-md-pull-9 hidden-xs hidden-sm" lang="fr">
            <aside class="sidebar">
                <div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<p class="caption"><span class="caption-text">Préface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">CakePHP en un Coup d&#8217;Oeil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Guide de Démarrage Rapide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/3-x-migration-guide.html">3.x Guide de Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutoriels et exemples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribuer</a></li>
</ul>
<p class="caption"><span class="caption-text">Pour Commencer</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/request-response.html">Les Objets Request &amp; Response</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers (Contrôleurs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views (Vues)</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../orm.html">Accès Base de Données &amp; ORM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="database-basics.html">Notions de Base de Base de Données</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Query Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="table-objects.html">Les Objets Table</a></li>
<li class="toctree-l2"><a class="reference internal" href="entities.html">Entities</a></li>
<li class="toctree-l2"><a class="reference internal" href="retrieving-data-and-resultsets.html">Récupérer les Données et les Ensembles de Résultats</a></li>
<li class="toctree-l2"><a class="reference internal" href="validation.html">Valider des Données</a></li>
<li class="toctree-l2"><a class="reference internal" href="saving-data.html">Sauvegarder les Données</a></li>
<li class="toctree-l2"><a class="reference internal" href="deleting-data.html">Supprimer des Données</a></li>
<li class="toctree-l2"><a class="reference internal" href="associations.html">Associations - Lier les Tables Ensemble</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors.html">Behaviors (Comportements)</a></li>
<li class="toctree-l2"><a class="reference internal" href="schema-system.html">Système de Schéma</a></li>
<li class="toctree-l2"><a class="reference internal" href="../console-and-shells/orm-cache.html">Shell du Cache de l&#8217;ORM</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Généralités</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/authentication.html">Authentification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bake.html">Console Bake</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/caching.html">La mise en cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Outils de Console, Shells, &amp; Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/debugging.html">Debugger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Déploiement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/errors.html">Gestion des Erreurs &amp; Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/events.html">Événements système</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/internationalization-and-localization.html">Internationalisation &amp; Localisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/logging.html">Journalisation (logging)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/form.html">Formulaires Sans Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/pagination.html">Pagination</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/rest.html">REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Sécurité</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/sessions.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/validation.html">Validation</a></li>
</ul>
<p class="caption"><span class="caption-text">Utilitaires</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/app.html">Classe App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/collections.html">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/file-folder.html">Folder &amp; File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/hash.html">Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/httpclient.html">Client Http</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/inflector.html">Inflector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/registry-objects.html">Objets Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/text.html">Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/time.html">Date &amp; Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/xml.html">Xml</a></li>
</ul>
<p class="caption"><span class="caption-text">Divers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/global-constants-and-functions.html">Globales &amp; Fonctions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chronos.html">Chronos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug-kit.html">Debug Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrations.html">Migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch.html">ElasticSearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade-tool.html">Outil d&#8217;Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Annexes</a></li>
</ul>

</div>

                </div>
            </aside>
            <aside class="sidebar">
                <div class="mb30 row">
                </div>
            </aside>
        </div>
    </div>
</div>

<section id="socials" class="back-3">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-5  social text-center">
                <div class="col-sm-3 col-xs-3">
                    <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                          var js, fjs = d.getElementsByTagName(s)[0];
                          if (d.getElementById(id)) return;
                          js = d.createElement(s); js.id = id;
                          js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
                          fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));
                        </script>
                        <div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-7 social-footer text-center ">
                <a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
                <a href="https://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
                <a href="https://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
                <a href="https://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
                <a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
                <a href="https://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
                <a href="https://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
                <a href="https://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
            </div>
        </div>
    </div>
</section>

<footer id="footer" class="footer-wrapper">
    <div class="container">

        <div class="row col-p30">
            <div class="col-sm-12 col-md-3">
                <div class="footer-widget t-footer">
                    <div class="col-md-12">
                        <a href="https://www.openhub.net/p/cakephp">
                            <img src="../_static/open-hub.png">
                        </a>
                        <div class="mt10">
                            <a href="https://www.rackspace.com/">
                                <img src="../_static/rackspace.png">
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-md-9">
                <div class="col-md-3 col-sm-6 business-solution">
                    <ul class="footer-menu">
                        <li class="menu-title">
    <a href="https://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
    <a href="https://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 text-center mt30">
                <p class="copyright">
                            &copy; Copyright 2017, Cake Software Foundation, Inc.
                        Mis à jour le août 30, 2017.
                        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
                </p>
            </div>
        </div>
    </div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-743287-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
  </body>
</html>


<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Retrieving Data &amp; Results Sets - 3.x</title>
    <link href="../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/app.js"></script>

    <link rel="alternate" hreflang="pt_BR" href="../../pt/orm/retrieving-data-and-resultsets.html" /><link rel="alternate" hreflang="es" href="../../es/orm/retrieving-data-and-resultsets.html" /><link rel="alternate" hreflang="ja" href="../../ja/orm/retrieving-data-and-resultsets.html" /><link rel="alternate" hreflang="fr" href="../../fr/orm/retrieving-data-and-resultsets.html" /><link rel="alternate" hreflang="zh" href="../../zh/orm/retrieving-data-and-resultsets.html" /><link rel="alternate" hreflang="tr" href="../../tr/orm/retrieving-data-and-resultsets.html" /><link rel="alternate" hreflang="ru" href="../../ru/orm/retrieving-data-and-resultsets.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within CakePHP Cookbook 3.5 documentation" href="../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="CakePHP Cookbook 3.5 documentation" href="../index.html" />
    <link rel="up" title="Database Access &amp; ORM" href="../orm.html" />
    <link rel="next" title="Validating Data" href="validation.html" />
    <link rel="prev" title="Entities" href="entities.html" />

    <script type="text/javascript">
    window.lang = "en";
    </script>
  </head>
  <body>

<div id="container">
    
    <header class="nav-down">
        <div class="container-fluid hidden-xs hidden-sm">
            <div class="row">
                <div class="col-sm-3 col-md-3">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-9 col-md-9">
                    <nav class="navbar-right">
                        <ul class="menu">
                            <li class="first">
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
                                <ul class="submenu">
                                    
<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                                </ul>
                            </li>

                            <li><a href="https://cakephp.org/business-solutions">Business Solutions</a></li>
                            <li><a href="https://cakephp.org/writers">Get Paid To Write</a></li>
                            <li><a href="https://cakephp.org/pages/team">Team</a></li>

                            <li>
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
                                <div class="megamenu full">
                                    <div class="row">
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                                            </ul>
                                        </div>
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        
        <div class="container-fluid hidden-md hidden-lg">
            <div class="row">
                <div class="col-sm-6 col-xs-6">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-6 col-xs-6">
                    <div class="navbar-right">
                        <button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
                            <i class="fa fa-bars toggle-modal"></i>
                        </button>
                    </div>
                    <div id="wrap">
                        <form class="search" action="../search.html" method="get">
                            <input name="q" type="search" placeholder="What are you looking for?">
                            <input id="search_submit" value="Search" type="submit">
                        </form>
                    </div>
                </div>
            </div>
        </div>

        
        <section id="nav-cook" class="hidden-xs hidden-sm">
            <div class="container-fluid ">
                <div class="row ">
                    <div class="col-md-12 back-book">
                        <div class="col-md-5 text-center t-cook-nav p0 hidden-sm hidden-xs">
                            <h2>
                                <a href="../contents.html">
                                    <span class="glyph_range icon-submenu icon-submenu-cook">B</span>
                                    CakePHP 3.5 Red Velvet <strong>Cookbook</strong>
                                </a>
                            </h2>
                        </div>

                        <div class="col-md-4 hidden-sm">
                            <form class="search" action="../search.html" method="get">
                                <input type="hidden" name="check_keywords" value="yes" />
                                <input type="hidden" name="area" value="default" />

                                <div class="col-md-10 p0">
                                    <input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
                                </div>
                                <div class="col-md-2 p0 search-cook">
                                    <button type="submit">
                                        <span class="glyph_range icon-submenu icon-submenu-cook">A</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        
                        <div class="col-md-3">
                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Language:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
                                                    role="button" aria-haspopup="true" aria-expanded="false" href="#">
                                                        en
                                                        <i class="fa fa-menu-en fa-chevron-down"></i>
                                                    </a>
                                            <ul class="dropdown-menu">
                                            
                                                <li></li>
                                            
                                                <li><a href="../../pt/orm/retrieving-data-and-resultsets.html">pt</a></li>
                                            
                                                <li><a href="../../es/orm/retrieving-data-and-resultsets.html">es</a></li>
                                            
                                                <li><a href="../../ja/orm/retrieving-data-and-resultsets.html">ja</a></li>
                                            
                                                <li><a href="../../fr/orm/retrieving-data-and-resultsets.html">fr</a></li>
                                            
                                                <li><a href="../../zh/orm/retrieving-data-and-resultsets.html">zh</a></li>
                                            
                                                <li><a href="../../tr/orm/retrieving-data-and-resultsets.html">tr</a></li>
                                            
                                                <li><a href="../../ru/orm/retrieving-data-and-resultsets.html">ru</a></li>
                                            
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Version:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">3.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
                                            <ul class="dropdown-menu">
                                                <li><a href="https://book.cakephp.org/3.0/en">3.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/2.0/en">2.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.3/en/">1.3 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.2/en/">1.2 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.1/en">1.1 Book</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
        </section>
    </header>

    
    <section class="nav-btn visible-sm visible-xs">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
                </div>

                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
                </div>
            </div>
        </div>
    </section>

    
    <div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title-cookbook" id="modal-header"></h4>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>

<div class="container page-container "><div id="improve-slideout">
        <i class="fa fa-pencil icon-improve"></i>
        <a href="https://github.com/cakephp/docs/edit/3.0/en/orm/retrieving-data-and-resultsets.rst" target="_blank">
            <div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
        </a>
    </div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

    
    <div class="row">
        <div class="col-sm-12 col-md-9 col-md-push-3"><div class="page-contents col-sm-5">
                <h3>Page Contents</h3>
                <ul>
<li><a class="reference internal" href="#">Retrieving Data &amp; Results Sets</a><ul>
<li><a class="reference internal" href="#debugging-queries-and-resultsets">Debugging Queries and ResultSets</a></li>
<li><a class="reference internal" href="#getting-a-single-entity-by-primary-key">Getting a Single Entity by Primary Key</a></li>
<li><a class="reference internal" href="#using-finders-to-load-data">Using Finders to Load Data</a></li>
<li><a class="reference internal" href="#getting-the-first-result">Getting the First Result</a></li>
<li><a class="reference internal" href="#getting-a-count-of-results">Getting a Count of Results</a></li>
<li><a class="reference internal" href="#finding-key-value-pairs">Finding Key/Value Pairs</a><ul>
<li><a class="reference internal" href="#customize-key-value-output">Customize Key-Value Output</a></li>
</ul>
</li>
<li><a class="reference internal" href="#finding-threaded-data">Finding Threaded Data</a></li>
<li><a class="reference internal" href="#custom-finder-methods">Custom Finder Methods</a></li>
<li><a class="reference internal" href="#dynamic-finders">Dynamic Finders</a></li>
<li><a class="reference internal" href="#retrieving-associated-data">Retrieving Associated Data</a></li>
<li><a class="reference internal" href="#eager-loading-associations-via-contain">Eager Loading Associations Via Contain</a><ul>
<li><a class="reference internal" href="#passing-conditions-to-contain">Passing Conditions to Contain</a></li>
<li><a class="reference internal" href="#sorting-contained-associations">Sorting Contained Associations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#filtering-by-associated-data-via-matching-and-joins">Filtering by Associated Data Via Matching And Joins</a><ul>
<li><a class="reference internal" href="#using-innerjoinwith">Using innerJoinWith</a></li>
<li><a class="reference internal" href="#using-notmatching">Using notMatching</a></li>
<li><a class="reference internal" href="#using-leftjoinwith">Using leftJoinWith</a></li>
</ul>
</li>
<li><a class="reference internal" href="#changing-fetching-strategies">Changing Fetching Strategies</a><ul>
<li><a class="reference internal" href="#fetching-with-the-subquery-strategy">Fetching With The Subquery Strategy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lazy-loading-associations">Lazy Loading Associations</a></li>
<li><a class="reference internal" href="#working-with-result-sets">Working with Result Sets</a><ul>
<li><a class="reference internal" href="#getting-the-first-last-record-from-a-resultset">Getting the First &amp; Last Record From a ResultSet</a></li>
<li><a class="reference internal" href="#getting-an-arbitrary-index-from-a-resultset">Getting an Arbitrary Index From a ResultSet</a></li>
<li><a class="reference internal" href="#checking-if-a-query-or-resultset-is-empty">Checking if a Query or ResultSet is Empty</a></li>
<li><a class="reference internal" href="#loading-additional-associations">Loading Additional Associations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#modifying-results-with-map-reduce">Modifying Results with Map/Reduce</a><ul>
<li><a class="reference internal" href="#stacking-multiple-operations">Stacking Multiple Operations</a></li>
<li><a class="reference internal" href="#removing-all-stacked-map-reduce-operations">Removing All Stacked Map-reduce Operations</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div><div class="document-body">
            
  <div class="section" id="namespace-Cake\ORM">
<span id="retrieving-data-results-sets"></span><h1>Retrieving Data &amp; Results Sets<a class="headerlink" href="#namespace-Cake\ORM" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Cake\ORM\Table">
<em class="property">class </em><code class="descclassname">Cake\ORM\</code><code class="descname">Table</code><a class="headerlink" href="#Cake\ORM\Table" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>While table objects provide an abstraction around a &#8216;repository&#8217; or collection
of objects, when you query for individual records you get &#8216;entity&#8217; objects.
While this section discusses the different ways you can find and load entities,
you should read the <a class="reference internal" href="entities.html"><span class="doc">Entities</span></a> section for more information on
entities.</p>
<div class="section" id="debugging-queries-and-resultsets">
<h2>Debugging Queries and ResultSets<a class="headerlink" href="#debugging-queries-and-resultsets" title="Permalink to this headline">¶</a></h2>
<p>Since the ORM now returns Collections and Entities, debugging these objects can
be more complicated than in previous CakePHP versions. There are now various
ways to inspect the data returned by the ORM.</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">debug($query)</span></code> Shows the SQL and bound params, does not show results.</li>
<li><code class="docutils literal"><span class="pre">debug($query-&gt;all())</span></code> Shows the ResultSet properties (not the results).</li>
<li><code class="docutils literal"><span class="pre">debug($query-&gt;toArray())</span></code> An easy way to show each of the results.</li>
<li><code class="docutils literal"><span class="pre">debug(json_encode($query,</span> <span class="pre">JSON_PRETTY_PRINT))</span></code> More human readable results.</li>
<li><code class="docutils literal"><span class="pre">debug($query-&gt;first())</span></code> Show the properties of a single entity.</li>
<li><code class="docutils literal"><span class="pre">debug((string)$query-&gt;first())</span></code> Show the properties of a single entity as JSON.</li>
</ul>
</div>
<div class="section" id="getting-a-single-entity-by-primary-key">
<h2>Getting a Single Entity by Primary Key<a class="headerlink" href="#getting-a-single-entity-by-primary-key" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="Cake\ORM\Table::get">
<code class="descclassname">Cake\ORM\Table::</code><code class="descname">get</code><span class="sig-paren">(</span><em>$id</em>, <em>$options = []</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\ORM\Table::get" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>It is often convenient to load a single entity from the database when editing or
view entities and their related data. You can do this by using <code class="docutils literal"><span class="pre">get()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>

<span class="c1">// Get a single article</span>
<span class="nv">$article</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

<span class="c1">// Get a single article, and related comments</span>
<span class="nv">$article</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;contain&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Comments&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>If the get operation does not find any results a
<code class="docutils literal"><span class="pre">Cake\Datasource\Exception\RecordNotFoundException</span></code> will be raised. You can
either catch this exception yourself, or allow CakePHP to convert it into a 404
error.</p>
<p>Like <code class="docutils literal"><span class="pre">find()</span></code>, <code class="docutils literal"><span class="pre">get()</span></code> also has caching integrated. You can use the
<code class="docutils literal"><span class="pre">cache</span></code> option when calling <code class="docutils literal"><span class="pre">get()</span></code> to perform read-through caching:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>

<span class="c1">// Use any cache config or CacheEngine instance &amp; a generated key</span>
<span class="nv">$article</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;cache&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;custom&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="c1">// Use any cache config or CacheEngine instance &amp; specific key</span>
<span class="nv">$article</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;cache&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;custom&#39;</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mykey&#39;</span>
<span class="p">]);</span>

<span class="c1">// Explicitly disable caching</span>
<span class="nv">$article</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;cache&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Optionally you can <code class="docutils literal"><span class="pre">get()</span></code> an entity using <a class="reference internal" href="#custom-find-methods"><span class="std std-ref">Custom Finder Methods</span></a>. For
example you may want to get all translations for an entity. You can achieve that
by using the <code class="docutils literal"><span class="pre">finder</span></code> option:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$article</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;finder&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;translations&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="section" id="using-finders-to-load-data">
<h2>Using Finders to Load Data<a class="headerlink" href="#using-finders-to-load-data" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="Cake\ORM\Table::find">
<code class="descclassname">Cake\ORM\Table::</code><code class="descname">find</code><span class="sig-paren">(</span><em>$type</em>, <em>$options = []</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\ORM\Table::find" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Before you can work with entities, you&#8217;ll need to load them. The easiest way to
do this is using the <code class="docutils literal"><span class="pre">find()</span></code> method. The find method provides an easy and
extensible way to find the data you are interested in:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>

<span class="c1">// Find all the articles</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The return value of any <code class="docutils literal"><span class="pre">find()</span></code> method is always
a <a class="reference internal" href="query-builder.html#Cake\ORM\Query" title="Cake\ORM\Query"><code class="xref php php-class docutils literal"><span class="pre">Cake\ORM\Query</span></code></a> object. The Query class allows you to further
refine a query after creating it. Query objects are evaluated lazily, and do not
execute until you start fetching rows, convert it to an array, or when the
<code class="docutils literal"><span class="pre">all()</span></code> method is called:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>

<span class="c1">// Find all the articles.</span>
<span class="c1">// At this point the query has not run.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>

<span class="c1">// Iteration will execute the query.</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$query</span> <span class="k">as</span> <span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>

<span class="c1">// Calling all() will execute the query</span>
<span class="c1">// and return the result set.</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Once we have a result set we can get all the rows</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$results</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>

<span class="c1">// Converting the query to an array will execute it.</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Once you&#8217;ve started a query you can use the <a class="reference internal" href="query-builder.html"><span class="doc">Query Builder</span></a>
interface to build more complex queries, adding additional conditions,
limits, or include associations using the fluent interface.</p>
</div>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Articles.created &gt;&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;-10 days&#39;</span><span class="p">)])</span>
    <span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Comments&#39;</span><span class="p">,</span> <span class="s1">&#39;Authors&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
<p>You can also provide many commonly used options to <code class="docutils literal"><span class="pre">find()</span></code>. This can help
with testing as there are fewer methods to mock:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Articles.created &gt;&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;-10 days&#39;</span><span class="p">)],</span>
    <span class="s1">&#39;contain&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Authors&#39;</span><span class="p">,</span> <span class="s1">&#39;Comments&#39;</span><span class="p">],</span>
    <span class="s1">&#39;limit&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>The list of options supported by find() are:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">conditions</span></code> provide conditions for the WHERE clause of your query.</li>
<li><code class="docutils literal"><span class="pre">limit</span></code> Set the number of rows you want.</li>
<li><code class="docutils literal"><span class="pre">offset</span></code> Set the page offset you want. You can also use <code class="docutils literal"><span class="pre">page</span></code> to make
the calculation simpler.</li>
<li><code class="docutils literal"><span class="pre">contain</span></code> define the associations to eager load.</li>
<li><code class="docutils literal"><span class="pre">fields</span></code> limit the fields loaded into the entity. Only loading some fields
can cause entities to behave incorrectly.</li>
<li><code class="docutils literal"><span class="pre">group</span></code> add a GROUP BY clause to your query. This is useful when using
aggregating functions.</li>
<li><code class="docutils literal"><span class="pre">having</span></code> add a HAVING clause to your query.</li>
<li><code class="docutils literal"><span class="pre">join</span></code> define additional custom joins.</li>
<li><code class="docutils literal"><span class="pre">order</span></code> order the result set.</li>
</ul>
<p>Any options that are not in this list will be passed to beforeFind listeners
where they can be used to modify the query object. You can use the
<code class="docutils literal"><span class="pre">getOptions()</span></code> method on a query object to retrieve the options used. While
you can pass query objects to your controllers, we recommend that you package
your queries up as <a class="reference internal" href="#custom-find-methods"><span class="std std-ref">Custom Finder Methods</span></a> instead. Using custom finder
methods will let you re-use your queries and make testing easier.</p>
<p>By default queries and result sets will return <a class="reference internal" href="entities.html"><span class="doc">Entities</span></a> objects. You
can retrieve basic arrays by disabling hydration:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">enableHydration</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="c1">// Prior to 3.4.0</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">hydrate</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>

<span class="c1">// $data is ResultSet that contains array data.</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-the-first-result">
<span id="table-find-first"></span><h2>Getting the First Result<a class="headerlink" href="#getting-the-first-result" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">first()</span></code> method allows you to fetch only the first row from a query. If
the query has not been executed, a <code class="docutils literal"><span class="pre">LIMIT</span> <span class="pre">1</span></code> clause will be applied:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Articles.created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;DESC&#39;</span><span class="p">]</span>
<span class="p">]);</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</pre></div>
</div>
<p>This approach replaces <code class="docutils literal"><span class="pre">find('first')</span></code> in previous versions of CakePHP. You
may also want to use the <code class="docutils literal"><span class="pre">get()</span></code> method if you are loading entities by primary
key.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <code class="docutils literal"><span class="pre">first()</span></code> method will return <code class="docutils literal"><span class="pre">null</span></code> if no results are found.</p>
</div>
</div>
<div class="section" id="getting-a-count-of-results">
<h2>Getting a Count of Results<a class="headerlink" href="#getting-a-count-of-results" title="Permalink to this headline">¶</a></h2>
<p>Once you have created a query object, you can use the <code class="docutils literal"><span class="pre">count()</span></code> method to get
a result count of that query:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Articles.title LIKE&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;%Ovens%&#39;</span><span class="p">]</span>
<span class="p">]);</span>
<span class="nv">$number</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">();</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="query-builder.html#query-count"><span class="std std-ref">Returning the Total Count of Records</span></a> for additional usage of the <code class="docutils literal"><span class="pre">count()</span></code> method.</p>
</div>
<div class="section" id="finding-key-value-pairs">
<span id="table-find-list"></span><h2>Finding Key/Value Pairs<a class="headerlink" href="#finding-key-value-pairs" title="Permalink to this headline">¶</a></h2>
<p>It is often useful to generate an associative array of data from your
application&#8217;s data. For example, this is very useful when creating <code class="docutils literal"><span class="pre">&lt;select&gt;</span></code>
elements. CakePHP provides a simple to use method for generating &#8216;lists&#8217; of
data:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">);</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>

<span class="c1">// Data now looks like</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;First post&#39;</span><span class="p">,</span>
    <span class="mi">2</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second article I wrote&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>
</div>
<p>With no additional options the keys of <code class="docutils literal"><span class="pre">$data</span></code> will be the primary key of your
table, while the values will be the &#8216;displayField&#8217; of the table. You can use the
<code class="docutils literal"><span class="pre">setDisplayField()</span></code> method on a table object to configure the display field of
a table:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesTable</span> <span class="k">extends</span> <span class="nx">Table</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">initialize</span><span class="p">(</span><span class="k">array</span> <span class="nv">$config</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setDisplayField</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>
        <span class="c1">// Prior to 3.4.0</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">displayField</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When calling <code class="docutils literal"><span class="pre">list</span></code> you can configure the fields used for the key and value
with the <code class="docutils literal"><span class="pre">keyField</span></code> and <code class="docutils literal"><span class="pre">valueField</span></code> options respectively:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;keyField&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
    <span class="s1">&#39;valueField&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;title&#39;</span>
<span class="p">]);</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>

<span class="c1">// Data now looks like</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;first-post&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First post&#39;</span><span class="p">,</span>
    <span class="s1">&#39;second-article-i-wrote&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second article I wrote&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>
</div>
<p>Results can be grouped into nested sets. This is useful when you want
bucketed sets, or want to build <code class="docutils literal"><span class="pre">&lt;optgroup&gt;</span></code> elements with FormHelper:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;keyField&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;slug&#39;</span><span class="p">,</span>
    <span class="s1">&#39;valueField&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;title&#39;</span><span class="p">,</span>
    <span class="s1">&#39;groupField&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;author_id&#39;</span>
<span class="p">]);</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>

<span class="c1">// Data now looks like</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;first-post&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First post&#39;</span><span class="p">,</span>
        <span class="s1">&#39;second-article-i-wrote&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second article I wrote&#39;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="mi">2</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="c1">// More data.</span>
    <span class="p">]</span>
<span class="p">];</span>
</pre></div>
</div>
<p>You can also create list data from associations that can be reached with joins:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;keyField&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;valueField&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;author.name&#39;</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Authors&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<div class="section" id="customize-key-value-output">
<h3>Customize Key-Value Output<a class="headerlink" href="#customize-key-value-output" title="Permalink to this headline">¶</a></h3>
<p>Lastly it is possible to use closures to access entity accessor methods in your
list finds.</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In your Authors Entity create a virtual field to be used as the displayField:</span>
<span class="k">protected</span> <span class="k">function</span> <span class="nf">_getLabel</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_properties</span><span class="p">[</span><span class="s1">&#39;first_name&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39; &#39;</span> <span class="o">.</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_properties</span><span class="p">[</span><span class="s1">&#39;last_name&#39;</span><span class="p">]</span>
      <span class="o">.</span> <span class="s1">&#39; / &#39;</span> <span class="o">.</span> <span class="nx">__</span><span class="p">(</span><span class="s1">&#39;User ID %s&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_properties</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This example shows using the <code class="docutils literal"><span class="pre">_getLabel()</span></code> accessor method from
the Author entity.</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In your finders/controller:</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;keyField&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;valueField&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$article</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$article</span><span class="o">-&gt;</span><span class="na">author</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>You can also fetch the label in the list directly using.</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In AuthorsTable::initialize():</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setDisplayField</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">);</span> <span class="c1">// Will utilize Author::_getLabel()</span>
<span class="c1">// In your finders/controller:</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$authors</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;list&#39;</span><span class="p">);</span> <span class="c1">// Will utilize AuthorsTable::getDisplayField()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="finding-threaded-data">
<h2>Finding Threaded Data<a class="headerlink" href="#finding-threaded-data" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">find('threaded')</span></code> finder returns nested entities that are threaded
together through a key field. By default this field is <code class="docutils literal"><span class="pre">parent_id</span></code>. This
finder allows you to access data stored in an &#8216;adjacency list&#8217; style table. All
entities matching a given <code class="docutils literal"><span class="pre">parent_id</span></code> are placed under the <code class="docutils literal"><span class="pre">children</span></code>
attribute:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$comments</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;threaded&#39;</span><span class="p">);</span>

<span class="c1">// Expanded default values</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$comments</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;threaded&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;keyField&#39;</span> <span class="o">=&gt;</span> <span class="nv">$comments</span><span class="o">-&gt;</span><span class="na">primaryKey</span><span class="p">(),</span>
    <span class="s1">&#39;parentField&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;parent_id&#39;</span>
<span class="p">]);</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>

<span class="k">echo</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">);</span>
<span class="k">echo</span> <span class="nv">$results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">comment</span><span class="p">;</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">parentField</span></code> and <code class="docutils literal"><span class="pre">keyField</span></code> keys can be used to define the fields that
threading will occur on.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">If you need to manage more advanced trees of data, consider using
<a class="reference internal" href="behaviors/tree.html"><span class="doc">Tree</span></a> instead.</p>
</div>
</div>
<div class="section" id="custom-finder-methods">
<span id="custom-find-methods"></span><h2>Custom Finder Methods<a class="headerlink" href="#custom-finder-methods" title="Permalink to this headline">¶</a></h2>
<p>The examples above show how to use the built-in <code class="docutils literal"><span class="pre">all</span></code> and <code class="docutils literal"><span class="pre">list</span></code> finders.
However, it is possible and recommended that you implement your own finder
methods. Finder methods are the ideal way to package up commonly used queries,
allowing you to abstract query details into a simple to use method. Finder
methods are defined by creating methods following the convention of <code class="docutils literal"><span class="pre">findFoo</span></code>
where <code class="docutils literal"><span class="pre">Foo</span></code> is the name of the finder you want to create. For example if we
wanted to add a finder to our articles table for finding published articles we
would do the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Cake\ORM\Query</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\Table</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesTable</span> <span class="k">extends</span> <span class="nx">Table</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">findOwnedBy</span><span class="p">(</span><span class="nx">Query</span> <span class="nv">$query</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">];</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>
    <span class="p">}</span>

<span class="p">}</span>

<span class="c1">// In a controller or table method.</span>
<span class="nv">$articles</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;ownedBy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;user&#39;</span> <span class="o">=&gt;</span> <span class="nv">$userEntity</span><span class="p">]);</span>
</pre></div>
</div>
<p>Finder methods can modify the query as required, or use the <code class="docutils literal"><span class="pre">$options</span></code> to
customize the finder operation with relevant application logic. You can also
&#8216;stack&#8217; finders, allowing you to express complex queries effortlessly. Assuming
you have both the &#8216;published&#8217; and &#8216;recent&#8217; finders, you could do the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$articles</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;recent&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>While all the examples so far have show finder methods on table classes, finder
methods can also be defined on <a class="reference internal" href="behaviors.html"><span class="doc">Behaviors</span></a>.</p>
<p>If you need to modify the results after they have been fetched you should use
a <a class="reference internal" href="#map-reduce"><span class="std std-ref">Modifying Results with Map/Reduce</span></a> function to modify the results. The map reduce features
replace the &#8216;afterFind&#8217; callback found in previous versions of CakePHP.</p>
</div>
<div class="section" id="dynamic-finders">
<span id="id1"></span><h2>Dynamic Finders<a class="headerlink" href="#dynamic-finders" title="Permalink to this headline">¶</a></h2>
<p>CakePHP&#8217;s ORM provides dynamically constructed finder methods which allow you to
express simple queries with no additional code. For example if you wanted to
find a user by username you could do:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller</span>
<span class="c1">// The following two calls are equal.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Users</span><span class="o">-&gt;</span><span class="na">findByUsername</span><span class="p">(</span><span class="s1">&#39;joebob&#39;</span><span class="p">);</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Users</span><span class="o">-&gt;</span><span class="na">findAllByUsername</span><span class="p">(</span><span class="s1">&#39;joebob&#39;</span><span class="p">);</span>

<span class="c1">// In a table method</span>
<span class="nv">$users</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Users&#39;</span><span class="p">);</span>
<span class="c1">// The following two calls are equal.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">findByUsername</span><span class="p">(</span><span class="s1">&#39;joebob&#39;</span><span class="p">);</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">findAllByUsername</span><span class="p">(</span><span class="s1">&#39;joebob&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>When using dynamic finders you can constrain on multiple fields:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">findAllByUsernameAndApproved</span><span class="p">(</span><span class="s1">&#39;joebob&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p>You can also create <code class="docutils literal"><span class="pre">OR</span></code> conditions:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">findAllByUsernameOrEmail</span><span class="p">(</span><span class="s1">&#39;joebob&#39;</span><span class="p">,</span> <span class="s1">&#39;joe@example.com&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>While you can use either OR or AND conditions, you cannot combine the two in a
single dynamic finder. Other query options like <code class="docutils literal"><span class="pre">contain</span></code> are also not
supported with dynamic finders. You should use <a class="reference internal" href="#custom-find-methods"><span class="std std-ref">Custom Finder Methods</span></a> to
encapsulate more complex queries.  Lastly, you can also combine dynamic finders
with custom finders:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">findTrollsByUsername</span><span class="p">(</span><span class="s1">&#39;bro&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The above would translate into the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$users</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;trolls&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;conditions&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bro&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Once you have a query object from a dynamic finder, you&#8217;ll need to call
<code class="docutils literal"><span class="pre">first()</span></code> if you want the first result.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">While dynamic finders make it simple to express queries, they come with some
additional performance overhead.</p>
</div>
</div>
<div class="section" id="retrieving-associated-data">
<h2>Retrieving Associated Data<a class="headerlink" href="#retrieving-associated-data" title="Permalink to this headline">¶</a></h2>
<p>When you want to grab associated data, or filter based on associated data, there
are two ways:</p>
<ul class="simple">
<li>use CakePHP ORM query functions like <code class="docutils literal"><span class="pre">contain()</span></code> and <code class="docutils literal"><span class="pre">matching()</span></code></li>
<li>use join functions like <code class="docutils literal"><span class="pre">innerJoin()</span></code>, <code class="docutils literal"><span class="pre">leftJoin()</span></code>, and <code class="docutils literal"><span class="pre">rightJoin()</span></code></li>
</ul>
<p>You should use <code class="docutils literal"><span class="pre">contain()</span></code> when you want to load the primary model, and its
associated data. While <code class="docutils literal"><span class="pre">contain()</span></code> will let you apply additional conditions to
the loaded associations, you cannot constrain the primary model based on the
associations. For more details on the <code class="docutils literal"><span class="pre">contain()</span></code>, look at
<a class="reference internal" href="#eager-loading-associations"><span class="std std-ref">Eager Loading Associations Via Contain</span></a>.</p>
<p>You should use <code class="docutils literal"><span class="pre">matching()</span></code> when you want to restrict the primary model based
on associations. For example, you want to load all the articles that have
a specific tag on them. For more details on the <code class="docutils literal"><span class="pre">matching()</span></code>, look at
<a class="reference internal" href="#filtering-by-associated-data"><span class="std std-ref">Filtering by Associated Data Via Matching And Joins</span></a>.</p>
<p>If you prefer to use join functions, you can look at
<a class="reference internal" href="query-builder.html#adding-joins"><span class="std std-ref">Adding Joins</span></a> for more information.</p>
</div>
<div class="section" id="eager-loading-associations-via-contain">
<span id="eager-loading-associations"></span><h2>Eager Loading Associations Via Contain<a class="headerlink" href="#eager-loading-associations-via-contain" title="Permalink to this headline">¶</a></h2>
<p>By default CakePHP does not load <strong>any</strong> associated data when using <code class="docutils literal"><span class="pre">find()</span></code>.
You need to &#8216;contain&#8217; or eager-load each association you want loaded in your
results.</p>
<p>Eager loading helps avoid many of the potential performance problems
surrounding lazy-loading in an ORM. The queries generated by eager loading can
better leverage joins, allowing more efficient queries to be made. In CakePHP
you define eager loaded associations using the &#8216;contain&#8217; method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>

<span class="c1">// As an option to find()</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;contain&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Authors&#39;</span><span class="p">,</span> <span class="s1">&#39;Comments&#39;</span><span class="p">]]);</span>

<span class="c1">// As a method on the query object</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">);</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Authors&#39;</span><span class="p">,</span> <span class="s1">&#39;Comments&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>The above will load the related author and comments for each article in the
result set. You can load nested associations using nested arrays to define the
associations to be loaded:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Authors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Addresses&#39;</span><span class="p">],</span> <span class="s1">&#39;Comments&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Authors&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Alternatively, you can express nested associations using the dot notation:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Authors.Addresses&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Comments.Authors&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>You can eager load associations as deep as you like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$products</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Shops.Cities.Countries&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Shops.Managers&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>You can select fields from all associations with multiple easy <code class="docutils literal"><span class="pre">contain()</span></code>
statements:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span>
    <span class="s1">&#39;Realestates.id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Realestates.title&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Realestates.description&#39;</span>
<span class="p">])</span>
<span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;RealestateAttributes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;Attributes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="c1">// Aliased fields in contain() must include</span>
                <span class="c1">// the model prefix to be mapped correctly.</span>
                <span class="s1">&#39;Attributes__name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;attr_name&#39;</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">])</span>
<span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;RealestateAttributes&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;RealestateAttributes.realestate_id&#39;</span><span class="p">,</span>
            <span class="s1">&#39;RealestateAttributes.value&#39;</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">])</span>
<span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="nv">$condition</span><span class="p">);</span>
</pre></div>
</div>
<p>If you need to reset the containments on a query you can set the second argument
to <code class="docutils literal"><span class="pre">true</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Authors&#39;</span><span class="p">,</span> <span class="s1">&#39;Comments&#39;</span><span class="p">],</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="passing-conditions-to-contain">
<h3>Passing Conditions to Contain<a class="headerlink" href="#passing-conditions-to-contain" title="Permalink to this headline">¶</a></h3>
<p>When using <code class="docutils literal"><span class="pre">contain()</span></code> you are able to restrict the data returned by the
associations and filter them by conditions:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nv">$q</span>
        <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;author_id&#39;</span><span class="p">])</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Comments.approved&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This also works for pagination at the Controller level:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;contain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Comments&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nx">\Cake\ORM\Query</span> <span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;body&#39;</span><span class="p">,</span> <span class="s1">&#39;author_id&#39;</span><span class="p">])</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Comments.approved&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">];</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When you limit the fields that are fetched from an association, you <strong>must</strong>
ensure that the foreign key columns are selected. Failing to select foreign
key fields will cause associated data to not be present in the final result.</p>
</div>
<p>It is also possible to restrict deeply-nested associations using the dot
notation:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Comments&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Authors.Profiles&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Profiles.is_published&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>In the above example, you&#8217;ll still get authors even if they don&#8217;t have
a published profile. To only get authors with a published profile use
<a class="reference internal" href="#filtering-by-associated-data"><span class="std std-ref">matching()</span></a>. If you have defined custom
finders in your associations, you can use them inside <code class="docutils literal"><span class="pre">contain()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Bring all articles, but only bring the comments that are approved and</span>
<span class="c1">// popular.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;approved&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;popular&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For <code class="docutils literal"><span class="pre">BelongsTo</span></code> and <code class="docutils literal"><span class="pre">HasOne</span></code> associations only the <code class="docutils literal"><span class="pre">where</span></code> and
<code class="docutils literal"><span class="pre">select</span></code> clauses are used when loading the associated records. For the
rest of the association types you can use every clause that the query object
provides.</p>
</div>
<p>If you need full control over the query that is generated, you can tell <code class="docutils literal"><span class="pre">contain()</span></code>
to not append the <code class="docutils literal"><span class="pre">foreignKey</span></code> constraints to the generated query. In that
case you should use an array passing <code class="docutils literal"><span class="pre">foreignKey</span></code> and <code class="docutils literal"><span class="pre">queryBuilder</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Authors&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;foreignKey&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="s1">&#39;queryBuilder&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="o">...</span><span class="p">);</span> <span class="c1">// Full conditions for filtering</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>If you have limited the fields you are loading with <code class="docutils literal"><span class="pre">select()</span></code> but also want to
load fields off of contained associations, you can pass the association object
to <code class="docutils literal"><span class="pre">select()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Select id &amp; title from articles, but all fields off of Users.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">(</span><span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">Users</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Users&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>Alternatively, if you have multiple associations, you can use <code class="docutils literal"><span class="pre">enableAutoFields()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Select id &amp; title from articles, but all fields off of Users, Comments</span>
<span class="c1">// and Tags.</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Comments&#39;</span><span class="p">,</span> <span class="s1">&#39;Tags&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">enableAutoFields</span><span class="p">(</span><span class="k">true</span><span class="p">)</span> <span class="c1">// Prior to 3.4.0 use autoFields(true)</span>
    <span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Users&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span><span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">autoFields</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}]);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.1: </span>Selecting columns via an association object was added in 3.1</p>
</div>
</div>
<div class="section" id="sorting-contained-associations">
<h3>Sorting Contained Associations<a class="headerlink" href="#sorting-contained-associations" title="Permalink to this headline">¶</a></h3>
<p>When loading HasMany and BelongsToMany associations, you can use the <code class="docutils literal"><span class="pre">sort</span></code>
option to sort the data in those associations:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Comments&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;sort&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Comments.created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;DESC&#39;</span><span class="p">]</span>
    <span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="filtering-by-associated-data-via-matching-and-joins">
<span id="filtering-by-associated-data"></span><h2>Filtering by Associated Data Via Matching And Joins<a class="headerlink" href="#filtering-by-associated-data-via-matching-and-joins" title="Permalink to this headline">¶</a></h2>
<p>A fairly common query case with associations is finding records &#8216;matching&#8217;
specific associated data. For example if you have &#8216;Articles belongsToMany Tags&#8217;
you will probably want to find Articles that have the CakePHP tag. This is
extremely simple to do with the ORM in CakePHP:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span><span class="s1">&#39;Tags&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Tags.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CakePHP&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can apply this strategy to HasMany associations as well. For example if
&#8216;Authors HasMany Articles&#8217;, you could find all the authors with recently
published articles using the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$authors</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Articles.created &gt;=&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;-10 days&#39;</span><span class="p">)]);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Filtering by deep associations is surprisingly easy, and the syntax should be
already familiar to you:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$products</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span>
    <span class="s1">&#39;Shops.Cities.Countries&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Countries.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Japan&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Bring unique articles that were commented by &#39;markstory&#39; using passed variable</span>
<span class="c1">// Dotted matching paths should be used over nested matching() calls</span>
<span class="nv">$username</span> <span class="o">=</span> <span class="s1">&#39;markstory&#39;</span><span class="p">;</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span><span class="s1">&#39;Comments.Users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="k">use</span> <span class="p">(</span><span class="nv">$username</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="nv">$username</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As this function will create an <code class="docutils literal"><span class="pre">INNER</span> <span class="pre">JOIN</span></code>, you might want to consider
calling <code class="docutils literal"><span class="pre">distinct</span></code> on the find query as you might get duplicate rows if
your conditions don&#8217;t exclude them already. This might be the case, for
example, when the same users comments more than once on a single article.</p>
</div>
<p>The data from the association that is &#8216;matched&#8217; will be available on the
<code class="docutils literal"><span class="pre">_matchingData</span></code> property of entities. If you both match and contain the same
association, you can expect to get both the <code class="docutils literal"><span class="pre">_matchingData</span></code> and standard
association properties in your results.</p>
<div class="section" id="using-innerjoinwith">
<h3>Using innerJoinWith<a class="headerlink" href="#using-innerjoinwith" title="Permalink to this headline">¶</a></h3>
<p>Using the <code class="docutils literal"><span class="pre">matching()</span></code> function, as we saw already, will create an <code class="docutils literal"><span class="pre">INNER</span>
<span class="pre">JOIN</span></code> with the specified association and will also load the fields into the
result set.</p>
<p>There may be cases where you want to use <code class="docutils literal"><span class="pre">matching()</span></code> but are not interested
in loading the fields into the result set. For this purpose, you can use
<code class="docutils literal"><span class="pre">innerJoinWith()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">innerJoinWith</span><span class="p">(</span><span class="s1">&#39;Tags&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Tags.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;CakePHP&#39;</span><span class="p">]);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">innerJoinWith()</span></code> method works the same as <code class="docutils literal"><span class="pre">matching()</span></code>, that
means that you can use dot notation to join deeply nested
associations:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$products</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">innerJoinWith</span><span class="p">(</span>
    <span class="s1">&#39;Shops.Cities.Countries&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Countries.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Japan&#39;</span><span class="p">]);</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
<p>Again, the only difference is that no additional columns will be added to the
result set, and no <code class="docutils literal"><span class="pre">_matchingData</span></code> property will be set.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.1: </span>Query::innerJoinWith() was added in 3.1</p>
</div>
</div>
<div class="section" id="using-notmatching">
<h3>Using notMatching<a class="headerlink" href="#using-notmatching" title="Permalink to this headline">¶</a></h3>
<p>The opposite of <code class="docutils literal"><span class="pre">matching()</span></code> is <code class="docutils literal"><span class="pre">notMatching()</span></code>. This function will change
the query so that it filters results that have no relation to the specified
association:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articlesTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">notMatching</span><span class="p">(</span><span class="s1">&#39;Tags&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Tags.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;boring&#39;</span><span class="p">]);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>The above example will find all articles that were not tagged with the word
<code class="docutils literal"><span class="pre">boring</span></code>.  You can apply this method to HasMany associations as well. You could,
for example, find all the authors with no published articles in the last 10
days:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$authorsTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">notMatching</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Articles.created &gt;=&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">\DateTime</span><span class="p">(</span><span class="s1">&#39;-10 days&#39;</span><span class="p">)]);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>It is also possible to use this method for filtering out records not matching
deep associations. For example, you could find articles that have not been
commented on by a certain user:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articlesTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">notMatching</span><span class="p">(</span><span class="s1">&#39;Comments.Users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jose&#39;</span><span class="p">]);</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Since articles with no comments at all also satisfy the condition above, you may
want to combine <code class="docutils literal"><span class="pre">matching()</span></code> and <code class="docutils literal"><span class="pre">notMatching()</span></code> in the same query. The
following example will find articles having at least one comment, but not
commented by a certain user:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articlesTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">notMatching</span><span class="p">(</span><span class="s1">&#39;Comments.Users&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jose&#39;</span><span class="p">]);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">matching</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As <code class="docutils literal"><span class="pre">notMatching()</span></code> will create a <code class="docutils literal"><span class="pre">LEFT</span> <span class="pre">JOIN</span></code>, you might want to consider
calling <code class="docutils literal"><span class="pre">distinct</span></code> on the find query as you can get duplicate rows
otherwise.</p>
</div>
<p>Keep in mind that contrary to the <code class="docutils literal"><span class="pre">matching()</span></code> function, <code class="docutils literal"><span class="pre">notMatching()</span></code>
will not add any data to the <code class="docutils literal"><span class="pre">_matchingData</span></code> property in the results.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.1: </span>Query::notMatching() was added in 3.1</p>
</div>
</div>
<div class="section" id="using-leftjoinwith">
<h3>Using leftJoinWith<a class="headerlink" href="#using-leftjoinwith" title="Permalink to this headline">¶</a></h3>
<p>On certain occasions you may want to calculate a result based on an association,
without having to load all the records for it. For example, if you wanted to
load the total number of comments an article has along with all the article
data, you can use the <code class="docutils literal"><span class="pre">leftJoinWith()</span></code> function:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articlesTable</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;total_comments&#39;</span> <span class="o">=&gt;</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="s1">&#39;Comments.id&#39;</span><span class="p">)])</span>
    <span class="o">-&gt;</span><span class="na">leftJoinWith</span><span class="p">(</span><span class="s1">&#39;Comments&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;Articles.id&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">enableAutoFields</span><span class="p">(</span><span class="k">true</span><span class="p">);</span> <span class="c1">// Prior to 3.4.0 use autoFields(true);</span>
</pre></div>
</div>
<p>The results for the above query will contain the article data and the
<code class="docutils literal"><span class="pre">total_comments</span></code> property for each of them.</p>
<p><code class="docutils literal"><span class="pre">leftJoinWith()</span></code> can also be used with deeply nested associations. This is
useful, for example, for bringing the count of articles tagged with a certain
word, per author:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$authorsTable</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">select</span><span class="p">([</span><span class="s1">&#39;total_articles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">func</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="s1">&#39;Articles.id&#39;</span><span class="p">)])</span>
    <span class="o">-&gt;</span><span class="na">leftJoinWith</span><span class="p">(</span><span class="s1">&#39;Articles.Tags&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Tags.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;awesome&#39;</span><span class="p">]);</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">group</span><span class="p">([</span><span class="s1">&#39;Authors.id&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">enableAutoFields</span><span class="p">(</span><span class="k">true</span><span class="p">);</span> <span class="c1">// Prior to 3.4.0 use autoFields(true);</span>
</pre></div>
</div>
<p>This function will not load any columns from the specified associations into the
result set.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.1: </span>Query::leftJoinWith() was added in 3.1</p>
</div>
</div>
</div>
<div class="section" id="changing-fetching-strategies">
<h2>Changing Fetching Strategies<a class="headerlink" href="#changing-fetching-strategies" title="Permalink to this headline">¶</a></h2>
<p>As you may know already, <code class="docutils literal"><span class="pre">belongsTo</span></code> and <code class="docutils literal"><span class="pre">hasOne</span></code> associations are loaded
using a <code class="docutils literal"><span class="pre">JOIN</span></code> in the main finder query. While this improves query and
fetching speed and allows for creating more expressive conditions when
retrieving data, this may be a problem when you want to apply certain clauses to
the finder query for the association, such as <code class="docutils literal"><span class="pre">order()</span></code> or <code class="docutils literal"><span class="pre">limit()</span></code>.</p>
<p>For example, if you wanted to get the first comment of an article as an
association:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">hasOne</span><span class="p">(</span><span class="s1">&#39;FirstComment&#39;</span><span class="p">,</span> <span class="p">[</span>
     <span class="s1">&#39;className&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Comments&#39;</span><span class="p">,</span>
     <span class="s1">&#39;foreignKey&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;article_id&#39;</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>In order to correctly fetch the data from this association, we will need to tell
the query to use the <code class="docutils literal"><span class="pre">select</span></code> strategy, since we want order by a particular
column:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;FirstComment&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;strategy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;select&#39;</span><span class="p">,</span>
            <span class="s1">&#39;queryBuilder&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">order</span><span class="p">([</span><span class="s1">&#39;FirstComment.created&#39;</span> <span class="o">=&gt;</span><span class="s1">&#39;ASC&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="p">}</span>
    <span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Dynamically changing the strategy in this way will only apply to a specific
query. If you want to make the strategy change permanent you can do:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">FirstComment</span><span class="o">-&gt;</span><span class="na">setStrategy</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
<span class="c1">// Prior to 3.4.0</span>
<span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">FirstComment</span><span class="o">-&gt;</span><span class="na">strategy</span><span class="p">(</span><span class="s1">&#39;select&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Using the <code class="docutils literal"><span class="pre">select</span></code> strategy is also a great way of making associations with
tables in another database, since it would not be possible to fetch records
using <code class="docutils literal"><span class="pre">joins</span></code>.</p>
<div class="section" id="fetching-with-the-subquery-strategy">
<h3>Fetching With The Subquery Strategy<a class="headerlink" href="#fetching-with-the-subquery-strategy" title="Permalink to this headline">¶</a></h3>
<p>As your tables grow in size, fetching associations from them can become
slower, especially if you are querying big batches at once. A good way of
optimizing association loading for <code class="docutils literal"><span class="pre">hasMany</span></code> and <code class="docutils literal"><span class="pre">belongsToMany</span></code>
associations is by using the <code class="docutils literal"><span class="pre">subquery</span></code> strategy:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span>
    <span class="s1">&#39;Comments&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;strategy&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;subquery&#39;</span><span class="p">,</span>
            <span class="s1">&#39;queryBuilder&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$q</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;Comments.approved&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
            <span class="p">}</span>
    <span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>The result will remain the same as with using the default strategy, but this
can greatly improve the query and fetching time in some databases, in
particular it will allow to fetch big chunks of data at the same time in
databases that limit the amount of bound parameters per query, such as
<strong>Microsoft SQL Server</strong>.</p>
<p>You can also make the strategy permanent for the association by doing:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">Comments</span><span class="o">-&gt;</span><span class="na">setStrategy</span><span class="p">(</span><span class="s1">&#39;subquery&#39;</span><span class="p">);</span>
<span class="c1">// Prior to 3.4.0</span>
<span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">Comments</span><span class="o">-&gt;</span><span class="na">strategy</span><span class="p">(</span><span class="s1">&#39;subquery&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lazy-loading-associations">
<h2>Lazy Loading Associations<a class="headerlink" href="#lazy-loading-associations" title="Permalink to this headline">¶</a></h2>
<p>While CakePHP makes it easy to eager load your associations, there may be cases
where you need to lazy-load associations. You should refer to the
<a class="reference internal" href="entities.html#lazy-load-associations"><span class="std std-ref">Lazy Loading Associations</span></a> and <a class="reference internal" href="#loading-additional-associations"><span class="std std-ref">Loading Additional Associations</span></a>
sections for more information.</p>
</div>
<div class="section" id="working-with-result-sets">
<h2>Working with Result Sets<a class="headerlink" href="#working-with-result-sets" title="Permalink to this headline">¶</a></h2>
<p>Once a query is executed with <code class="docutils literal"><span class="pre">all()</span></code>, you will get an instance of
<code class="xref php php-class docutils literal"><span class="pre">Cake\ORM\ResultSet</span></code>. This object offers powerful ways to manipulate
the resulting data from your queries. Like Query objects, ResultSets are
a <a class="reference internal" href="../core-libraries/collections.html"><span class="doc">Collection</span></a> and you can use any collection
method on ResultSet objects.</p>
<p>Result set objects will lazily load rows from the underlying prepared statement.
By default results will be buffered in memory allowing you to iterate a result
set multiple times, or cache and iterate the results. If you need work with
a data set that does not fit into memory you can disable buffering on the query
to stream results:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">enableBufferResults</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="c1">// Prior to 3.4.0</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">bufferResults</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
</pre></div>
</div>
<p>Turning buffering off has a few caveats:</p>
<ol class="arabic simple">
<li>You will not be able to iterate a result set more than once.</li>
<li>You will also not be able to iterate &amp; cache the results.</li>
<li>Buffering cannot be disabled for queries that eager load hasMany or
belongsToMany associations, as these association types require eagerly
loading all results so that dependent queries can be generated.</li>
</ol>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Streaming results will still allocate memory for the entire results when
using PostgreSQL and SQL Server. This is due to limitations in PDO.</p>
</div>
<p>Result sets allow you to cache/serialize or JSON encode results for API
results:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Serialized</span>
<span class="nv">$serialized</span> <span class="o">=</span> <span class="nb">serialize</span><span class="p">(</span><span class="nv">$results</span><span class="p">);</span>

<span class="c1">// Json</span>
<span class="nv">$json</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$results</span><span class="p">);</span>
</pre></div>
</div>
<p>Both serializing and JSON encoding result sets work as you would expect. The
serialized data can be unserialized into a working result set. Converting to
JSON respects hidden &amp; virtual field settings on all entity objects
within a result set.</p>
<p>In addition to making serialization easy, result sets are a &#8216;Collection&#8217; object and
support the same methods that <a class="reference internal" href="../core-libraries/collections.html"><span class="doc">collection objects</span></a>
do. For example, you can extract a list of unique tags on a collection of
articles by running:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In a controller or table method.</span>
<span class="nv">$articles</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
<span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Tags&#39;</span><span class="p">]);</span>

<span class="nv">$reducer</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$output</span><span class="p">,</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$output</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$output</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$output</span><span class="p">;</span>
<span class="p">};</span>

<span class="nv">$uniqueTags</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="s1">&#39;tags.name&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">reduce</span><span class="p">(</span><span class="nv">$reducer</span><span class="p">,</span> <span class="p">[]);</span>
</pre></div>
</div>
<p>Some other examples of the collection methods being used with result sets are:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Filter the rows by a calculated property</span>
<span class="nv">$filtered</span> <span class="o">=</span> <span class="nv">$results</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$row</span><span class="o">-&gt;</span><span class="na">is_recent</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Create an associative array from result properties</span>
<span class="nv">$articles</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">contain</span><span class="p">([</span><span class="s1">&#39;Authors&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="nv">$authorList</span> <span class="o">=</span> <span class="nv">$results</span><span class="o">-&gt;</span><span class="na">combine</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;author.name&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../core-libraries/collections.html"><span class="doc">Collections</span></a> chapter has more detail on what can be
done with result sets using the collections features. The <a class="reference internal" href="query-builder.html#format-results"><span class="std std-ref">Adding Calculated Fields</span></a>
section show how you can add calculated fields, or replace the result set.</p>
<div class="section" id="getting-the-first-last-record-from-a-resultset">
<h3>Getting the First &amp; Last Record From a ResultSet<a class="headerlink" href="#getting-the-first-last-record-from-a-resultset" title="Permalink to this headline">¶</a></h3>
<p>You can use the <code class="docutils literal"><span class="pre">first()</span></code> and <code class="docutils literal"><span class="pre">last()</span></code> methods to get the respective records
from a result set:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Get the first and/or last result.</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">last</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="getting-an-arbitrary-index-from-a-resultset">
<h3>Getting an Arbitrary Index From a ResultSet<a class="headerlink" href="#getting-an-arbitrary-index-from-a-resultset" title="Permalink to this headline">¶</a></h3>
<p>You can use <code class="docutils literal"><span class="pre">skip()</span></code> and <code class="docutils literal"><span class="pre">first()</span></code> to get an arbitrary record from
a ResultSet:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$result</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>

<span class="c1">// Get the 5th record</span>
<span class="nv">$row</span> <span class="o">=</span> <span class="nv">$result</span><span class="o">-&gt;</span><span class="na">skip</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="checking-if-a-query-or-resultset-is-empty">
<h3>Checking if a Query or ResultSet is Empty<a class="headerlink" href="#checking-if-a-query-or-resultset-is-empty" title="Permalink to this headline">¶</a></h3>
<p>You can use the <code class="docutils literal"><span class="pre">isEmpty()</span></code> method on a Query or ResultSet object to see if it
has any rows in it. Calling <code class="docutils literal"><span class="pre">isEmpty()</span></code> on a Query object will evaluate the
query:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Check a query.</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">isEmpty</span><span class="p">();</span>

<span class="c1">// Check results</span>
<span class="nv">$results</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
<span class="nv">$results</span><span class="o">-&gt;</span><span class="na">isEmpty</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="loading-additional-associations">
<span id="id2"></span><h3>Loading Additional Associations<a class="headerlink" href="#loading-additional-associations" title="Permalink to this headline">¶</a></h3>
<p>Once you&#8217;ve created a result set, you may need to load
additional associations. This is the perfect time to lazily eager load data. You
can load additional associations using <code class="docutils literal"><span class="pre">loadInto()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$articles</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">all</span><span class="p">();</span>
<span class="nv">$withMore</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">loadInto</span><span class="p">(</span><span class="nv">$articles</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Comments&#39;</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<p>You can eager load additional data into a single entity, or a collection of
entities.</p>
</div>
</div>
<div class="section" id="modifying-results-with-map-reduce">
<span id="map-reduce"></span><h2>Modifying Results with Map/Reduce<a class="headerlink" href="#modifying-results-with-map-reduce" title="Permalink to this headline">¶</a></h2>
<p>More often than not, find operations require post-processing the data that is
found in the database. While entities&#8217; getter methods can take care of most of
the virtual property generation or special data formatting, sometimes you
need to change the data structure in a more fundamental way.</p>
<p>For those cases, the <code class="docutils literal"><span class="pre">Query</span></code> object offers the <code class="docutils literal"><span class="pre">mapReduce()</span></code> method, which
is a way of processing results once they are fetched from the database.</p>
<p>A common example of changing the data structure is grouping results together
based on certain conditions. For this task we can use the <code class="docutils literal"><span class="pre">mapReduce()</span></code>
function. We need two callable functions the <code class="docutils literal"><span class="pre">$mapper</span></code> and the <code class="docutils literal"><span class="pre">$reducer</span></code>.
The <code class="docutils literal"><span class="pre">$mapper</span></code> callable receives the current result from the database as first
argument, the iteration key as second argument and finally it receives an
instance of the <code class="docutils literal"><span class="pre">MapReduce</span></code> routine it is running:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$mapper</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$article</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$mapReduce</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$status</span> <span class="o">=</span> <span class="s1">&#39;published&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">isDraft</span><span class="p">()</span> <span class="o">||</span> <span class="nv">$article</span><span class="o">-&gt;</span><span class="na">isInReview</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$status</span> <span class="o">=</span> <span class="s1">&#39;unpublished&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$mapReduce</span><span class="o">-&gt;</span><span class="na">emitIntermediate</span><span class="p">(</span><span class="nv">$article</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>In the above example <code class="docutils literal"><span class="pre">$mapper</span></code> is calculating the status of an article, either
published or unpublished, then it calls <code class="docutils literal"><span class="pre">emitIntermediate()</span></code> on the
<code class="docutils literal"><span class="pre">MapReduce</span></code> instance. This method stores the article in the list of articles
labelled as either published or unpublished.</p>
<p>The next step in the map-reduce process is to consolidate the final results. For
each status created in the mapper, the <code class="docutils literal"><span class="pre">$reducer</span></code> function will be called so
you can do any extra processing. This function will receive the list of articles
in a particular &#8220;bucket&#8221; as the first parameter, the name of the &#8220;bucket&#8221; it
needs to process as the second parameter, and again, as in the <code class="docutils literal"><span class="pre">mapper()</span></code>
function, the instance of the <code class="docutils literal"><span class="pre">MapReduce</span></code> routine as the third parameter. In
our example, we did not have to do any extra processing, so we just <code class="docutils literal"><span class="pre">emit()</span></code>
the final results:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$reducer</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$articles</span><span class="p">,</span> <span class="nv">$status</span><span class="p">,</span> <span class="nv">$mapReduce</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$mapReduce</span><span class="o">-&gt;</span><span class="na">emit</span><span class="p">(</span><span class="nv">$articles</span><span class="p">,</span> <span class="nv">$status</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>Finally, we can put these two functions together to do the grouping:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$articlesByStatus</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;author_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">mapReduce</span><span class="p">(</span><span class="nv">$mapper</span><span class="p">,</span> <span class="nv">$reducer</span><span class="p">);</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$articlesByStatus</span> <span class="k">as</span> <span class="nv">$status</span> <span class="o">=&gt;</span> <span class="nv">$articles</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s2">&quot;There are %d %s articles&quot;</span><span class="p">,</span> <span class="nb">count</span><span class="p">(</span><span class="nv">$articles</span><span class="p">),</span> <span class="nv">$status</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above will ouput the following lines:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">There</span> <span class="nx">are</span> <span class="mi">4</span> <span class="nx">published</span> <span class="nx">articles</span>
<span class="nx">There</span> <span class="nx">are</span> <span class="mi">5</span> <span class="nx">unpublished</span> <span class="nx">articles</span>
</pre></div>
</div>
<p>Of course, this is a simplistic example that could actually be solved in another
way without the help of a map-reduce process. Now, let&#8217;s take a look at another
example in which the reducer function will be needed to do something more than
just emitting the results.</p>
<p>Calculating the most commonly mentioned words, where the articles contain
information about CakePHP, as usual we need a mapper function:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$mapper</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$article</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$mapReduce</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">stripos</span><span class="p">(</span><span class="nv">$article</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">],</span> <span class="s1">&#39;cakephp&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nv">$words</span> <span class="o">=</span> <span class="nb">array_map</span><span class="p">(</span><span class="s1">&#39;strtolower&#39;</span><span class="p">,</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="nv">$article</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]));</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$words</span> <span class="k">as</span> <span class="nv">$word</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$mapReduce</span><span class="o">-&gt;</span><span class="na">emitIntermediate</span><span class="p">(</span><span class="nv">$article</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="nv">$word</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>It first checks for whether the &#8220;cakephp&#8221; word is in the article&#8217;s body, and
then breaks the body into individual words. Each word will create its own
<code class="docutils literal"><span class="pre">bucket</span></code> where each article id will be stored. Now let&#8217;s reduce our results to
only extract the count:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$reducer</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$occurrences</span><span class="p">,</span> <span class="nv">$word</span><span class="p">,</span> <span class="nv">$mapReduce</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$mapReduce</span><span class="o">-&gt;</span><span class="na">emit</span><span class="p">(</span><span class="nb">count</span><span class="p">(</span><span class="nv">$occurrences</span><span class="p">),</span> <span class="nv">$word</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, we put everything together:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$wordCount</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">andWhere</span><span class="p">([</span><span class="s1">&#39;published_date &gt;=&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;2014-01-01&#39;</span><span class="p">)])</span>
    <span class="o">-&gt;</span><span class="na">enableHydrate</span><span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="c1">// Prior to 3.4.0 use hydrate(false)</span>
    <span class="o">-&gt;</span><span class="na">mapReduce</span><span class="p">(</span><span class="nv">$mapper</span><span class="p">,</span> <span class="nv">$reducer</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</pre></div>
</div>
<p>This could return a very large array if we don&#8217;t clean stop words, but it could
look something like this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="s1">&#39;cakephp&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span>
    <span class="s1">&#39;awesome&#39;</span> <span class="o">=&gt;</span> <span class="mi">39</span><span class="p">,</span>
    <span class="s1">&#39;impressive&#39;</span> <span class="o">=&gt;</span> <span class="mi">57</span><span class="p">,</span>
    <span class="s1">&#39;outstanding&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
    <span class="s1">&#39;mind-blowing&#39;</span> <span class="o">=&gt;</span> <span class="mi">83</span>
<span class="p">]</span>
</pre></div>
</div>
<p>One last example and you will be a map-reduce expert. Imagine you have
a <code class="docutils literal"><span class="pre">friends</span></code> table and you want to find &#8220;fake friends&#8221; in our database, or
better said, people who do not follow each other. Let&#8217;s start with our
<code class="docutils literal"><span class="pre">mapper()</span></code> function:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$mapper</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$rel</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$mr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$mr</span><span class="o">-&gt;</span><span class="na">emitIntermediate</span><span class="p">(</span><span class="nv">$rel</span><span class="p">[</span><span class="s1">&#39;target_user_id&#39;</span><span class="p">],</span> <span class="nv">$rel</span><span class="p">[</span><span class="s1">&#39;source_user_id&#39;</span><span class="p">]);</span>
    <span class="nv">$mr</span><span class="o">-&gt;</span><span class="na">emitIntermediate</span><span class="p">(</span><span class="o">-</span><span class="nv">$rel</span><span class="p">[</span><span class="s1">&#39;source_user_id&#39;</span><span class="p">],</span> <span class="nv">$rel</span><span class="p">[</span><span class="s1">&#39;target_user_id&#39;</span><span class="p">]);</span>
<span class="p">};</span>
</pre></div>
</div>
<p>The intermediate array will be like the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">],</span>
    <span class="mi">2</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="mi">3</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>
    <span class="mi">4</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
    <span class="mi">5</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="mi">6</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Positive numbers mean that a user, indicated with the first-level key, is
following them, and negative numbers mean that the user is followed by them.</p>
<p>Now it&#8217;s time to reduce it. For each call to the reducer, it will receive a list
of followers per user:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$reducer</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$friends</span><span class="p">,</span> <span class="nv">$user</span><span class="p">,</span> <span class="nv">$mr</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$fakeFriends</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$friends</span> <span class="k">as</span> <span class="nv">$friend</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$friend</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nb">in_array</span><span class="p">(</span><span class="o">-</span><span class="nv">$friend</span><span class="p">,</span> <span class="nv">$friends</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$fakeFriends</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$friend</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nv">$fakeFriends</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$mr</span><span class="o">-&gt;</span><span class="na">emit</span><span class="p">(</span><span class="nv">$fakeFriends</span><span class="p">,</span> <span class="nv">$user</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>And we supply our functions to a query:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$fakeFriends</span> <span class="o">=</span> <span class="nv">$friends</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">enableHydrate</span><span class="p">(</span><span class="k">false</span><span class="p">)</span> <span class="c1">// Prior to 3.4.0 use hydrate(false)</span>
    <span class="o">-&gt;</span><span class="na">mapReduce</span><span class="p">(</span><span class="nv">$mapper</span><span class="p">,</span> <span class="nv">$reducer</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</pre></div>
</div>
<p>This would return an array similar to this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
    <span class="mi">3</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The resulting array means, for example, that user with id <code class="docutils literal"><span class="pre">1</span></code> follows users
<code class="docutils literal"><span class="pre">2</span></code> and <code class="docutils literal"><span class="pre">4</span></code>, but those do not follow <code class="docutils literal"><span class="pre">1</span></code> back.</p>
<div class="section" id="stacking-multiple-operations">
<h3>Stacking Multiple Operations<a class="headerlink" href="#stacking-multiple-operations" title="Permalink to this headline">¶</a></h3>
<p>Using <cite>mapReduce</cite> in a query will not execute it immediately. The operation will
be registered to be run as soon as the first result is attempted to be fetched.
This allows you to keep chaining additional methods and filters to the query
even after adding a map-reduce routine:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span>
    <span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">mapReduce</span><span class="p">(</span><span class="nv">$mapper</span><span class="p">,</span> <span class="nv">$reducer</span><span class="p">);</span>

<span class="c1">// At a later point in your app:</span>
<span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;created &gt;=&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;1 day ago&#39;</span><span class="p">)]);</span>
</pre></div>
</div>
<p>This is particularly useful for building custom finder methods as described in the
<a class="reference internal" href="#custom-find-methods"><span class="std std-ref">Custom Finder Methods</span></a> section:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">findPublished</span><span class="p">(</span><span class="nx">Query</span> <span class="nv">$query</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">findRecent</span><span class="p">(</span><span class="nx">Query</span> <span class="nv">$query</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;created &gt;=&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">DateTime</span><span class="p">(</span><span class="s1">&#39;1 day ago&#39;</span><span class="p">)]);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">findCommonWords</span><span class="p">(</span><span class="nx">Query</span> <span class="nv">$query</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Same as in the common words example in the previous section</span>
    <span class="nv">$mapper</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>
    <span class="nv">$reducer</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>
    <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">mapReduce</span><span class="p">(</span><span class="nv">$mapper</span><span class="p">,</span> <span class="nv">$reducer</span><span class="p">);</span>
<span class="p">}</span>

<span class="nv">$commonWords</span> <span class="o">=</span> <span class="nv">$articles</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;commonWords&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;recent&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Moreover, it is also possible to stack more than one <code class="docutils literal"><span class="pre">mapReduce</span></code> operation for
a single query. For example, if we wanted to have the most commonly used words
for articles, but then filter it to only return words that were mentioned more
than 20 times across all articles:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$mapper</span> <span class="o">=</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$count</span><span class="p">,</span> <span class="nv">$word</span><span class="p">,</span> <span class="nv">$mr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$count</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$mr</span><span class="o">-&gt;</span><span class="na">emit</span><span class="p">(</span><span class="nv">$count</span><span class="p">,</span> <span class="nv">$word</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;commonWords&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">mapReduce</span><span class="p">(</span><span class="nv">$mapper</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="removing-all-stacked-map-reduce-operations">
<h3>Removing All Stacked Map-reduce Operations<a class="headerlink" href="#removing-all-stacked-map-reduce-operations" title="Permalink to this headline">¶</a></h3>
<p>Under some circumstances you may want to modify a <code class="docutils literal"><span class="pre">Query</span></code> object so that no
<code class="docutils literal"><span class="pre">mapReduce</span></code> operations are executed at all. This can be done by
calling the method with both parameters as null and the third parameter
(overwrite) as <code class="docutils literal"><span class="pre">true</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">mapReduce</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
</div>


            </div>
        </div>

        
        <div class="col-md-3 col-md-pull-9 hidden-xs hidden-sm" lang="en">
            <aside class="sidebar">
                <div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<p class="caption"><span class="caption-text">Preface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">CakePHP at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/3-x-migration-guide.html">3.x Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/request-response.html">Request &amp; Response Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../orm.html">Database Access &amp; ORM</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="database-basics.html">Database Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="query-builder.html">Query Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="table-objects.html">Table Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="entities.html">Entities</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Retrieving Data &amp; Results Sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="validation.html">Validating Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="saving-data.html">Saving Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="deleting-data.html">Deleting Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="associations.html">Associations - Linking Tables Together</a></li>
<li class="toctree-l2"><a class="reference internal" href="behaviors.html">Behaviors</a></li>
<li class="toctree-l2"><a class="reference internal" href="schema-system.html">Schema System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../console-and-shells/orm-cache.html">ORM Cache Shell</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Using CakePHP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bake.html">Bake Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/caching.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Console Tools, Shells &amp; Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/errors.html">Error &amp; Exception Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/events.html">Events System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/internationalization-and-localization.html">Internationalization &amp; Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/form.html">Modelless Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/pagination.html">Pagination</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/rest.html">REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/sessions.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/validation.html">Validation</a></li>
</ul>
<p class="caption"><span class="caption-text">Utility Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/app.html">App Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/collections.html">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/file-folder.html">Folder &amp; File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/hash.html">Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/httpclient.html">Http Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/inflector.html">Inflector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/registry-objects.html">Registry Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/text.html">Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/time.html">Date &amp; Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/xml.html">Xml</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../chronos.html">Chronos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug-kit.html">Debug Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrations.html">Migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch.html">ElasticSearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade-tool.html">Upgrade Tool</a></li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/global-constants-and-functions.html">Constants &amp; Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

                </div>
            </aside>
            <aside class="sidebar">
                <div class="mb30 row">
                </div>
            </aside>
        </div>
    </div>
</div>

<section id="socials" class="back-3">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-5  social text-center">
                <div class="col-sm-3 col-xs-3">
                    <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                          var js, fjs = d.getElementsByTagName(s)[0];
                          if (d.getElementById(id)) return;
                          js = d.createElement(s); js.id = id;
                          js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
                          fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));
                        </script>
                        <div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-7 social-footer text-center ">
                <a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
                <a href="https://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
                <a href="https://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
                <a href="https://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
                <a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
                <a href="https://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
                <a href="https://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
                <a href="https://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
            </div>
        </div>
    </div>
</section>

<footer id="footer" class="footer-wrapper">
    <div class="container">

        <div class="row col-p30">
            <div class="col-sm-12 col-md-3">
                <div class="footer-widget t-footer">
                    <div class="col-md-12">
                        <a href="https://www.openhub.net/p/cakephp">
                            <img src="../_static/open-hub.png">
                        </a>
                        <div class="mt10">
                            <a href="https://www.rackspace.com/">
                                <img src="../_static/rackspace.png">
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-md-9">
                <div class="col-md-3 col-sm-6 business-solution">
                    <ul class="footer-menu">
                        <li class="menu-title">
    <a href="https://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
    <a href="https://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 text-center mt30">
                <p class="copyright">
                            &copy; Copyright 2017, Cake Software Foundation, Inc.
                        Last updated on Aug 30, 2017.
                        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
                </p>
            </div>
        </div>
    </div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-743287-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
  </body>
</html>
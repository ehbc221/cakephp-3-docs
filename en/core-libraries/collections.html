

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Collections" lang="en" name="title" />
<meta content="collections, cakephp, append, sort, compile, contains, countBy, each, every, extract, filter, first, firstMatch, groupBy, indexBy, jsonSerialize, map, match, max, min, reduce, reject, sample, shuffle, some, random, sortBy, take, toArray, insert, sumOf, stopWhen, unfold, through" lang="en" name="keywords" />

    <title>Collections - 3.x</title>
    <link href="../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/app.js"></script>

    <link rel="alternate" hreflang="pt_BR" href="../../pt/core-libraries/collections.html" /><link rel="alternate" hreflang="es" href="../../es/core-libraries/collections.html" /><link rel="alternate" hreflang="ja" href="../../ja/core-libraries/collections.html" /><link rel="alternate" hreflang="fr" href="../../fr/core-libraries/collections.html" /><link rel="alternate" hreflang="zh" href="../../zh/core-libraries/collections.html" /><link rel="alternate" hreflang="tr" href="../../tr/core-libraries/collections.html" /><link rel="alternate" hreflang="ru" href="../../ru/core-libraries/collections.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within CakePHP Cookbook 3.5 documentation" href="../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="CakePHP Cookbook 3.5 documentation" href="../index.html" />
    <link rel="next" title="Folder &amp; File" href="file-folder.html" />
    <link rel="prev" title="App Class" href="app.html" />

    <script type="text/javascript">
    window.lang = "en";
    </script>
  </head>
  <body>

<div id="container">
    
    <header class="nav-down">
        <div class="container-fluid hidden-xs hidden-sm">
            <div class="row">
                <div class="col-sm-3 col-md-3">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-9 col-md-9">
                    <nav class="navbar-right">
                        <ul class="menu">
                            <li class="first">
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
                                <ul class="submenu">
                                    
<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                                </ul>
                            </li>

                            <li><a href="https://cakephp.org/business-solutions">Business Solutions</a></li>
                            <li><a href="https://cakephp.org/writers">Get Paid To Write</a></li>
                            <li><a href="https://cakephp.org/pages/team">Team</a></li>

                            <li>
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
                                <div class="megamenu full">
                                    <div class="row">
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                                            </ul>
                                        </div>
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        
        <div class="container-fluid hidden-md hidden-lg">
            <div class="row">
                <div class="col-sm-6 col-xs-6">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-6 col-xs-6">
                    <div class="navbar-right">
                        <button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
                            <i class="fa fa-bars toggle-modal"></i>
                        </button>
                    </div>
                    <div id="wrap">
                        <form class="search" action="../search.html" method="get">
                            <input name="q" type="search" placeholder="What are you looking for?">
                            <input id="search_submit" value="Search" type="submit">
                        </form>
                    </div>
                </div>
            </div>
        </div>

        
        <section id="nav-cook" class="hidden-xs hidden-sm">
            <div class="container-fluid ">
                <div class="row ">
                    <div class="col-md-12 back-book">
                        <div class="col-md-5 text-center t-cook-nav p0 hidden-sm hidden-xs">
                            <h2>
                                <a href="../contents.html">
                                    <span class="glyph_range icon-submenu icon-submenu-cook">B</span>
                                    CakePHP 3.5 Red Velvet <strong>Cookbook</strong>
                                </a>
                            </h2>
                        </div>

                        <div class="col-md-4 hidden-sm">
                            <form class="search" action="../search.html" method="get">
                                <input type="hidden" name="check_keywords" value="yes" />
                                <input type="hidden" name="area" value="default" />

                                <div class="col-md-10 p0">
                                    <input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
                                </div>
                                <div class="col-md-2 p0 search-cook">
                                    <button type="submit">
                                        <span class="glyph_range icon-submenu icon-submenu-cook">A</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        
                        <div class="col-md-3">
                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Language:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
                                                    role="button" aria-haspopup="true" aria-expanded="false" href="#">
                                                        en
                                                        <i class="fa fa-menu-en fa-chevron-down"></i>
                                                    </a>
                                            <ul class="dropdown-menu">
                                            
                                                <li></li>
                                            
                                                <li><a href="../../pt/core-libraries/collections.html">pt</a></li>
                                            
                                                <li><a href="../../es/core-libraries/collections.html">es</a></li>
                                            
                                                <li><a href="../../ja/core-libraries/collections.html">ja</a></li>
                                            
                                                <li><a href="../../fr/core-libraries/collections.html">fr</a></li>
                                            
                                                <li><a href="../../zh/core-libraries/collections.html">zh</a></li>
                                            
                                                <li><a href="../../tr/core-libraries/collections.html">tr</a></li>
                                            
                                                <li><a href="../../ru/core-libraries/collections.html">ru</a></li>
                                            
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Version:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">3.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
                                            <ul class="dropdown-menu">
                                                <li><a href="https://book.cakephp.org/3.0/en">3.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/2.0/en">2.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.3/en/">1.3 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.2/en/">1.2 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.1/en">1.1 Book</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
        </section>
    </header>

    
    <section class="nav-btn visible-sm visible-xs">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
                </div>

                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
                </div>
            </div>
        </div>
    </section>

    
    <div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title-cookbook" id="modal-header"></h4>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>

<div class="container page-container "><div id="improve-slideout">
        <i class="fa fa-pencil icon-improve"></i>
        <a href="https://github.com/cakephp/docs/edit/3.0/en/core-libraries/collections.rst" target="_blank">
            <div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
        </a>
    </div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

    
    <div class="row">
        <div class="col-sm-12 col-md-9 col-md-push-3"><div class="page-contents col-sm-5">
                <h3>Page Contents</h3>
                <ul>
<li><a class="reference internal" href="#">Collections</a><ul>
<li><a class="reference internal" href="#quick-example">Quick Example</a></li>
<li><a class="reference internal" href="#list-of-methods">List of Methods</a></li>
<li><a class="reference internal" href="#iterating">Iterating</a></li>
<li><a class="reference internal" href="#filtering">Filtering</a></li>
<li><a class="reference internal" href="#aggregation">Aggregation</a><ul>
<li><a class="reference internal" href="#grouping-and-counting">Grouping and Counting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sorting">Sorting</a></li>
<li><a class="reference internal" href="#working-with-tree-data">Working with Tree Data</a></li>
<li><a class="reference internal" href="#other-methods">Other Methods</a><ul>
<li><a class="reference internal" href="#withdrawing-elements">Withdrawing Elements</a></li>
<li><a class="reference internal" href="#expanding-collections">Expanding Collections</a></li>
<li><a class="reference internal" href="#modifiying-elements">Modifiying Elements</a></li>
<li><a class="reference internal" href="#making-collection-methods-reusable">Making Collection Methods Reusable</a></li>
<li><a class="reference internal" href="#optimizing-collections">Optimizing Collections</a></li>
<li><a class="reference internal" href="#making-collections-rewindable">Making Collections Rewindable</a></li>
<li><a class="reference internal" href="#cloning-collections">Cloning Collections</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div><div class="document-body">
            
  <div class="section" id="namespace-Cake\Collection">
<span id="collections"></span><h1>Collections<a class="headerlink" href="#namespace-Cake\Collection" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="Cake\Collection\Collection">
<em class="property">class </em><code class="descclassname">Cake\Collection\</code><code class="descname">Collection</code><a class="headerlink" href="#Cake\Collection\Collection" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The collection classes provide a set of tools to manipulate arrays or
<code class="docutils literal"><span class="pre">Traversable</span></code> objects. If you have ever used underscore.js,
you have an idea of what you can expect from the collection classes.</p>
<p>Collection instances are immutable; modifying a collection will instead generate
a new collection. This makes working with collection objects more predictable as
operations are side-effect free.</p>
<div class="section" id="quick-example">
<h2>Quick Example<a class="headerlink" href="#quick-example" title="Permalink to this headline">¶</a></h2>
<p>Collections can be created using an array or <code class="docutils literal"><span class="pre">Traversable</span></code> object. You&#8217;ll also
interact with collections every time you interact with the ORM in CakePHP.
A simple use of a Collection would be:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Cake\Collection\Collection</span><span class="p">;</span>

<span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>

<span class="c1">// Create a new collection containing elements</span>
<span class="c1">// with a value greater than one.</span>
<span class="nv">$overOne</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$iterator</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$value</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can also use the <code class="docutils literal"><span class="pre">collection()</span></code> helper function instead of <code class="docutils literal"><span class="pre">new</span>
<span class="pre">Collection()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">];</span>

<span class="c1">// These both make a Collection instance.</span>
<span class="nv">$collectionA</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>
<span class="nv">$collectionB</span> <span class="o">=</span> <span class="nx">collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>
</pre></div>
</div>
<p>The benefit of the helper method is that it is easier to chain off of than
<code class="docutils literal"><span class="pre">(new</span> <span class="pre">Collection($items))</span></code>.</p>
<p>The <code class="xref php php-trait docutils literal"><span class="pre">Collection\CollectionTrait</span></code> allows you to integrate
collection-like features into any <code class="docutils literal"><span class="pre">Traversable</span></code> object you have in your
application as well.</p>
</div>
<div class="section" id="list-of-methods">
<h2>List of Methods<a class="headerlink" href="#list-of-methods" title="Permalink to this headline">¶</a></h2>
<table border="1" class="docutils internal-toc">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><a class="reference internal" href="#Cake\Collection\Collection::append" title="Cake\Collection\Collection::append"><code class="xref php php-meth docutils literal"><span class="pre">append</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::avg" title="Cake\Collection\Collection::avg"><code class="xref php php-meth docutils literal"><span class="pre">avg</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::buffered" title="Cake\Collection\Collection::buffered"><code class="xref php php-meth docutils literal"><span class="pre">buffered</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::chunk" title="Cake\Collection\Collection::chunk"><code class="xref php php-meth docutils literal"><span class="pre">chunk</span></code></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#Cake\Collection\Collection::chunkWithKeys" title="Cake\Collection\Collection::chunkWithKeys"><code class="xref php php-meth docutils literal"><span class="pre">chunkWithKeys</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::combine" title="Cake\Collection\Collection::combine"><code class="xref php php-meth docutils literal"><span class="pre">combine</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::compile" title="Cake\Collection\Collection::compile"><code class="xref php php-meth docutils literal"><span class="pre">compile</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::contains" title="Cake\Collection\Collection::contains"><code class="xref php php-meth docutils literal"><span class="pre">contains</span></code></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#Cake\Collection\Collection::countBy" title="Cake\Collection\Collection::countBy"><code class="xref php php-meth docutils literal"><span class="pre">countBy</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::each" title="Cake\Collection\Collection::each"><code class="xref php php-meth docutils literal"><span class="pre">each</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::every" title="Cake\Collection\Collection::every"><code class="xref php php-meth docutils literal"><span class="pre">every</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::extract" title="Cake\Collection\Collection::extract"><code class="xref php php-meth docutils literal"><span class="pre">extract</span></code></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#Cake\Collection\Collection::filter" title="Cake\Collection\Collection::filter"><code class="xref php php-meth docutils literal"><span class="pre">filter</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::first" title="Cake\Collection\Collection::first"><code class="xref php php-meth docutils literal"><span class="pre">first</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::groupBy" title="Cake\Collection\Collection::groupBy"><code class="xref php php-meth docutils literal"><span class="pre">groupBy</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::indexBy" title="Cake\Collection\Collection::indexBy"><code class="xref php php-meth docutils literal"><span class="pre">indexBy</span></code></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#Cake\Collection\Collection::insert" title="Cake\Collection\Collection::insert"><code class="xref php php-meth docutils literal"><span class="pre">insert</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::isEmpty" title="Cake\Collection\Collection::isEmpty"><code class="xref php php-meth docutils literal"><span class="pre">isEmpty</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::last" title="Cake\Collection\Collection::last"><code class="xref php php-meth docutils literal"><span class="pre">last</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::listNested" title="Cake\Collection\Collection::listNested"><code class="xref php php-meth docutils literal"><span class="pre">listNested</span></code></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#Cake\Collection\Collection::map" title="Cake\Collection\Collection::map"><code class="xref php php-meth docutils literal"><span class="pre">map</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::match" title="Cake\Collection\Collection::match"><code class="xref php php-meth docutils literal"><span class="pre">match</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::max" title="Cake\Collection\Collection::max"><code class="xref php php-meth docutils literal"><span class="pre">max</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::median" title="Cake\Collection\Collection::median"><code class="xref php php-meth docutils literal"><span class="pre">median</span></code></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#Cake\Collection\Collection::min" title="Cake\Collection\Collection::min"><code class="xref php php-meth docutils literal"><span class="pre">min</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::nest" title="Cake\Collection\Collection::nest"><code class="xref php php-meth docutils literal"><span class="pre">nest</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::reduce" title="Cake\Collection\Collection::reduce"><code class="xref php php-meth docutils literal"><span class="pre">reduce</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::reject" title="Cake\Collection\Collection::reject"><code class="xref php php-meth docutils literal"><span class="pre">reject</span></code></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#Cake\Collection\Collection::sample" title="Cake\Collection\Collection::sample"><code class="xref php php-meth docutils literal"><span class="pre">sample</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::shuffle" title="Cake\Collection\Collection::shuffle"><code class="xref php php-meth docutils literal"><span class="pre">shuffle</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::skip" title="Cake\Collection\Collection::skip"><code class="xref php php-meth docutils literal"><span class="pre">skip</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::some" title="Cake\Collection\Collection::some"><code class="xref php php-meth docutils literal"><span class="pre">some</span></code></a></td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#Cake\Collection\Collection::sortBy" title="Cake\Collection\Collection::sortBy"><code class="xref php php-meth docutils literal"><span class="pre">sortBy</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::stopWhen" title="Cake\Collection\Collection::stopWhen"><code class="xref php php-meth docutils literal"><span class="pre">stopWhen</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::sumOf" title="Cake\Collection\Collection::sumOf"><code class="xref php php-meth docutils literal"><span class="pre">sumOf</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::take" title="Cake\Collection\Collection::take"><code class="xref php php-meth docutils literal"><span class="pre">take</span></code></a></td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#Cake\Collection\Collection::through" title="Cake\Collection\Collection::through"><code class="xref php php-meth docutils literal"><span class="pre">through</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::transpose" title="Cake\Collection\Collection::transpose"><code class="xref php php-meth docutils literal"><span class="pre">transpose</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::unfold" title="Cake\Collection\Collection::unfold"><code class="xref php php-meth docutils literal"><span class="pre">unfold</span></code></a></td>
<td><a class="reference internal" href="#Cake\Collection\Collection::zip" title="Cake\Collection\Collection::zip"><code class="xref php php-meth docutils literal"><span class="pre">zip</span></code></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="iterating">
<h2>Iterating<a class="headerlink" href="#iterating" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="Cake\Collection\Collection::each">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">each</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::each" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Collections can be iterated and/or transformed into new collections with the
<code class="docutils literal"><span class="pre">each()</span></code> and <code class="docutils literal"><span class="pre">map()</span></code> methods. The <code class="docutils literal"><span class="pre">each()</span></code> method will not create a new
collection, but will allow you to modify any objects within the collection:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="s2">&quot;Element </span><span class="si">$key</span><span class="s2">: </span><span class="si">$value</span><span class="s2">&quot;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The return of <code class="docutils literal"><span class="pre">each()</span></code> will be the collection object. Each will iterate the
collection immediately applying the callback to each value in the collection.</p>
<dl class="method">
<dt id="Cake\Collection\Collection::map">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">map</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::map" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <code class="docutils literal"><span class="pre">map()</span></code> method will create a new collection based on the output of the
callback being applied to each object in the original collection:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>

<span class="nv">$new</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$value</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// $result contains [&#39;a&#39; =&gt; 2, &#39;b&#39; =&gt; 4, &#39;c&#39; =&gt; 6];</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$new</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">map()</span></code> method will create a new iterator which lazily creates
the resulting items when iterated.</p>
<dl class="method">
<dt id="Cake\Collection\Collection::extract">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">extract</code><span class="sig-paren">(</span><em>$matcher</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::extract" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>One of the most common uses for a <code class="docutils literal"><span class="pre">map()</span></code> function is to extract a single
column from a collection. If you are looking to build a list of elements
containing the values for a particular property, you can use the <code class="docutils literal"><span class="pre">extract()</span></code>
method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$names</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// $result contains [&#39;mark&#39;, &#39;jose&#39;, &#39;barbara&#39;];</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$names</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</pre></div>
</div>
<p>As with many other functions in the collection class, you are allowed to specify
a dot-separated path for extracting columns. This example will return
a collection containing the author names from a list of articles:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$articles</span><span class="p">);</span>
<span class="nv">$names</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="s1">&#39;author.name&#39;</span><span class="p">);</span>

<span class="c1">// $result contains [&#39;Maria&#39;, &#39;Stacy&#39;, &#39;Larry&#39;];</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$names</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</pre></div>
</div>
<p>Finally, if the property you are looking after cannot be expressed as a path,
you can use a callback function to return it:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$articles</span><span class="p">);</span>
<span class="nv">$names</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$article</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$article</span><span class="o">-&gt;</span><span class="na">author</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span> <span class="s1">&#39;, &#39;</span> <span class="o">.</span> <span class="nv">$article</span><span class="o">-&gt;</span><span class="na">author</span><span class="o">-&gt;</span><span class="na">last_name</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Often, the properties you need to extract a common key present in multiple
arrays or objects that are deeply nested inside other structures. For those
cases you can use the <code class="docutils literal"><span class="pre">{*}</span></code> matcher in the path key. This matcher is often
helpful when matching HasMany and BelongsToMany association data:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;James&#39;</span><span class="p">,</span>
        <span class="s1">&#39;phone_numbers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;number&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;number-1&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;number&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;number-2&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;number&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;number-3&#39;</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;James&#39;</span><span class="p">,</span>
        <span class="s1">&#39;phone_numbers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;number&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;number-4&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;number&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;number-5&#39;</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$numbers</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$data</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="s1">&#39;phone_numbers.{*}.number&#39;</span><span class="p">);</span>
<span class="nv">$numbers</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span>
<span class="c1">// Returns [&#39;number-1&#39;, &#39;number-2&#39;, &#39;number-3&#39;, &#39;number-4&#39;, &#39;number-5&#39;]</span>
</pre></div>
</div>
<p>This last example uses <code class="docutils literal"><span class="pre">toList()</span></code> unlike other examples, which is important
when we&#8217;re getting results with possibly duplicate keys. By using <code class="docutils literal"><span class="pre">toList()</span></code>
we&#8217;ll be guaranteed to get all values even if there are duplicate keys.</p>
<p>Unlike <a class="reference internal" href="hash.html#Cake\Utility\Hash::extract" title="Cake\Utility\Hash::extract"><code class="xref php php-meth docutils literal"><span class="pre">Cake\Utility\Hash::extract()</span></code></a> this method only supports the
<code class="docutils literal"><span class="pre">{*}</span></code> wildcard. All other wildcard and attributes matchers are not supported.</p>
<dl class="method">
<dt id="Cake\Collection\Collection::combine">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">combine</code><span class="sig-paren">(</span><em>$keyPath</em>, <em>$valuePath</em>, <em>$groupPath = null</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::combine" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Collections allow you to create a new collection made from keys and values in
an existing collection. Both the key and value paths can be specified with
dot notation paths:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;a&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;b&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;a&#39;</span><span class="p">],</span>
<span class="p">];</span>
<span class="nv">$combined</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">combine</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">);</span>

<span class="c1">// Result will look like this when converted to array</span>
<span class="p">[</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span>
    <span class="mi">2</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="mi">3</span> <span class="o">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">,</span>
<span class="p">];</span>
</pre></div>
</div>
<p>You can also optionally use a <code class="docutils literal"><span class="pre">groupPath</span></code> to group results based on a path:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$combined</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">combine</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;parent&#39;</span><span class="p">);</span>

<span class="c1">// Result will look like this when converted to array</span>
<span class="p">[</span>
    <span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="mi">3</span> <span class="o">=&gt;</span> <span class="s1">&#39;baz&#39;</span><span class="p">],</span>
    <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">2</span> <span class="o">=&gt;</span> <span class="s1">&#39;bar&#39;</span><span class="p">]</span>
<span class="p">];</span>
</pre></div>
</div>
<p>Finally you can use <em>closures</em> to build keys/values/groups paths dynamically,
for example when working with entities and dates (converted to <code class="docutils literal"><span class="pre">Cake/Time</span></code>
instances by the ORM) you may want to group results by date:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$combined</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$entities</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">combine</span><span class="p">(</span>
    <span class="s1">&#39;id&#39;</span><span class="p">,</span>
    <span class="k">function</span> <span class="p">(</span><span class="nv">$entity</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$entity</span><span class="p">;</span> <span class="p">},</span>
    <span class="k">function</span> <span class="p">(</span><span class="nv">$entity</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nv">$entity</span><span class="o">-&gt;</span><span class="na">date</span><span class="o">-&gt;</span><span class="na">toDateString</span><span class="p">();</span> <span class="p">}</span>
<span class="p">);</span>

<span class="c1">// Result will look like this when converted to array</span>
<span class="p">[</span>
    <span class="s1">&#39;date string like 2015-05-01&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;entity1-&gt;id&#39;</span> <span class="o">=&gt;</span> <span class="nx">entity1</span><span class="p">,</span> <span class="s1">&#39;entity2-&gt;id&#39;</span> <span class="o">=&gt;</span> <span class="nx">entity2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;entityN-&gt;id&#39;</span> <span class="o">=&gt;</span> <span class="nx">entityN</span><span class="p">]</span>
    <span class="s1">&#39;date string like 2015-06-01&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;entity1-&gt;id&#39;</span> <span class="o">=&gt;</span> <span class="nx">entity1</span><span class="p">,</span> <span class="s1">&#39;entity2-&gt;id&#39;</span> <span class="o">=&gt;</span> <span class="nx">entity2</span><span class="p">,</span> <span class="o">...</span><span class="p">,</span> <span class="s1">&#39;entityN-&gt;id&#39;</span> <span class="o">=&gt;</span> <span class="nx">entityN</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::stopWhen">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">stopWhen</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::stopWhen" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>You can stop the iteration at any point using the <code class="docutils literal"><span class="pre">stopWhen()</span></code> method. Calling
it in a collection will create a new one that will stop yielding results if the
passed callable returns false for one of the elements:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>

<span class="nv">$new</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">stopWhen</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$value</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Stop on the first value bigger than 30</span>
    <span class="k">return</span> <span class="nv">$value</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// $result contains [10, 20];</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$new</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::unfold">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">unfold</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::unfold" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes the internal items of a collection will contain arrays or iterators
with more items. If you wish to flatten the internal structure to iterate once
over all elements you can use the <code class="docutils literal"><span class="pre">unfold()</span></code> method. It will create a new
collection that will yield every single element nested in the collection:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>
<span class="nv">$new</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">unfold</span><span class="p">();</span>

<span class="c1">// $result contains [1, 2, 3, 4, 5];</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$new</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span>
</pre></div>
</div>
<p>When passing a callable to <code class="docutils literal"><span class="pre">unfold()</span></code> you can control what elements will be
unfolded from each item in the original collection. This is useful for returning
data from paginated services:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$pages</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$pages</span><span class="p">);</span>
<span class="nv">$items</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">unfold</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$page</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// An imaginary web service that returns a page of results</span>
    <span class="k">return</span> <span class="nx">MyService</span><span class="o">::</span><span class="na">fetchPage</span><span class="p">(</span><span class="nv">$page</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
<span class="p">});</span>

<span class="nv">$allPagesItems</span> <span class="o">=</span> <span class="nv">$items</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span>
</pre></div>
</div>
<p>If you are using PHP 5.5+, you can use the <code class="docutils literal"><span class="pre">yield</span></code> keyword inside <code class="docutils literal"><span class="pre">unfold()</span></code>
to return as many elements for each item in the collection as you may need:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$oddNumbers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$oddNumbers</span><span class="p">);</span>
<span class="nv">$new</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">unfold</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$oddNumber</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">yield</span> <span class="nv">$oddNumber</span><span class="p">;</span>
    <span class="k">yield</span> <span class="nv">$oddNumber</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// $result contains [1, 2, 3, 4, 5, 6, 7, 8];</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$new</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::chunk">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">chunk</code><span class="sig-paren">(</span><em>$chunkSize</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::chunk" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>When dealing with large amounts of items in a collection, it may make sense to
process the elements in batches instead of one by one. For splitting
a collection into multiple arrays of a certain size, you can use the <code class="docutils literal"><span class="pre">chunk()</span></code>
function:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>
<span class="nv">$chunked</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">chunk</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="nv">$chunked</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span> <span class="c1">// [[1, 2], [3, 4], [5, 6], [7, 8], [9, 10], [11]]</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">chunk</span></code> function is particularly useful when doing batch processing, for
example with a database result:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$articles</span><span class="p">);</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$article</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Change a property in the article</span>
        <span class="nv">$article</span><span class="o">-&gt;</span><span class="na">property</span> <span class="o">=</span> <span class="s1">&#39;changed&#39;</span><span class="p">;</span>
    <span class="p">})</span>
    <span class="o">-&gt;</span><span class="na">chunk</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">each</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$batch</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">myBulkSave</span><span class="p">(</span><span class="nv">$batch</span><span class="p">);</span> <span class="c1">// This function will be called for each batch</span>
    <span class="p">});</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::chunkWithKeys">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">chunkWithKeys</code><span class="sig-paren">(</span><em>$chunkSize</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::chunkWithKeys" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Much like <a class="reference internal" href="#Cake\Collection\Collection::chunk" title="Cake\Collection\Collection::chunk"><code class="xref php php-meth docutils literal"><span class="pre">chunk()</span></code></a>, <code class="docutils literal"><span class="pre">chunkWithKeys()</span></code> allows you to slice up
a collection into smaller batches but with keys preserved. This is useful when
chunking associative arrays:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span>
    <span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span>
    <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
    <span class="s1">&#39;d&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="p">]);</span>
<span class="nv">$chunked</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">chunkWithKeys</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span>
<span class="c1">// Creates</span>
<span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.4.0: </span><code class="docutils literal"><span class="pre">chunkWithKeys()</span></code> was added in 3.4.0</p>
</div>
</div>
<div class="section" id="filtering">
<h2>Filtering<a class="headerlink" href="#filtering" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="Cake\Collection\Collection::filter">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">filter</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::filter" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Collections make it easy to filter and create new collections based on
the result of callback functions. You can use <code class="docutils literal"><span class="pre">filter()</span></code> to create a new
collection of elements matching a criteria callback:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$ladies</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$person</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">gender</span> <span class="o">===</span> <span class="s1">&#39;female&#39;</span><span class="p">;</span>
<span class="p">});</span>
<span class="nv">$guys</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$person</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">gender</span> <span class="o">===</span> <span class="s1">&#39;male&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::reject">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">reject</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::reject" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The inverse of <code class="docutils literal"><span class="pre">filter()</span></code> is <code class="docutils literal"><span class="pre">reject()</span></code>. This method does a negative filter,
removing elements that match the filter function:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$ladies</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">reject</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$person</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">gender</span> <span class="o">===</span> <span class="s1">&#39;male&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::every">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">every</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::every" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>You can do truth tests with filter functions. To see if every element in
a collection matches a test you can use <code class="docutils literal"><span class="pre">every()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$allYoungPeople</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">every</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$person</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">age</span> <span class="o">&lt;</span> <span class="mi">21</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::some">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">some</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::some" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>You can see if the collection contains at least one element matching a filter
function using the <code class="docutils literal"><span class="pre">some()</span></code> method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$hasYoungPeople</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">some</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$person</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">age</span> <span class="o">&lt;</span> <span class="mi">21</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::match">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">match</code><span class="sig-paren">(</span><em>array $conditions</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::match" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>If you need to extract a new collection containing only the elements that
contain a given set of properties, you should use the <code class="docutils literal"><span class="pre">match()</span></code> method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$comments</span><span class="p">);</span>
<span class="nv">$commentsFromMark</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">match</span><span class="p">([</span><span class="s1">&#39;user.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mark&#39;</span><span class="p">]);</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::firstMatch">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">firstMatch</code><span class="sig-paren">(</span><em>array $conditions</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::firstMatch" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The property name can be a dot-separated path. You can traverse into nested
entities and match the values they contain. When you only need the first
matching element from a collection, you can use <code class="docutils literal"><span class="pre">firstMatch()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$comments</span><span class="p">);</span>
<span class="nv">$comment</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">firstMatch</span><span class="p">([</span>
    <span class="s1">&#39;user.name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span>
    <span class="s1">&#39;active&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>As you can see from the above, both <code class="docutils literal"><span class="pre">match()</span></code> and <code class="docutils literal"><span class="pre">firstMatch()</span></code> allow you
to provide multiple conditions to match on. In addition, the conditions can be
for different paths, allowing you to express complex conditions to match
against.</p>
</div>
<div class="section" id="aggregation">
<h2>Aggregation<a class="headerlink" href="#aggregation" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="Cake\Collection\Collection::reduce">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">reduce</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::reduce" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The counterpart of a <code class="docutils literal"><span class="pre">map()</span></code> operation is usually a <code class="docutils literal"><span class="pre">reduce</span></code>. This
function will help you build a single result out of all the elements in a
collection:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$totalPrice</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">reduce</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$accumulated</span><span class="p">,</span> <span class="nv">$orderLine</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$accumulated</span> <span class="o">+</span> <span class="nv">$orderLine</span><span class="o">-&gt;</span><span class="na">price</span><span class="p">;</span>
<span class="p">},</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
<p>In the above example, <code class="docutils literal"><span class="pre">$totalPrice</span></code> will be the sum of all single prices
contained in the collection. Note the second argument for the <code class="docutils literal"><span class="pre">reduce()</span></code>
function takes the initial value for the reduce operation you are
performing:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$allTags</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">reduce</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$accumulated</span><span class="p">,</span> <span class="nv">$article</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">array_merge</span><span class="p">(</span><span class="nv">$accumulated</span><span class="p">,</span> <span class="nv">$article</span><span class="o">-&gt;</span><span class="na">tags</span><span class="p">);</span>
<span class="p">},</span> <span class="p">[]);</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::min">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">min</code><span class="sig-paren">(</span><em>string|callable $callback</em>, <em>$type = SORT_NUMERIC</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::min" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>To extract the minimum value for a collection based on a property, just use the
<code class="docutils literal"><span class="pre">min()</span></code> function. This will return the full element from the collection and
not just the smallest value found:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$youngest</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">min</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>

<span class="k">echo</span> <span class="nv">$youngest</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
</pre></div>
</div>
<p>You are also able to express the property to compare by providing a path or a
callback function:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$personYoungestChild</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">min</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$person</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">child</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$personWithYoungestDad</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">min</span><span class="p">(</span><span class="s1">&#39;dad.age&#39;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::max">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">max</code><span class="sig-paren">(</span><em>string|callable $callback</em>, <em>$type = SORT_NUMERIC</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::max" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The same can be applied to the <code class="docutils literal"><span class="pre">max()</span></code> function, which will return a single
element from the collection having the highest property value:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$oldest</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">max</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>

<span class="nv">$personOldestChild</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">max</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$person</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">child</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$personWithOldestDad</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">min</span><span class="p">(</span><span class="s1">&#39;dad.age&#39;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::sumOf">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">sumOf</code><span class="sig-paren">(</span><em>string|callable $callback</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::sumOf" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Finally, the <code class="docutils literal"><span class="pre">sumOf()</span></code> method will return the sum of a property of all
elements:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$sumOfAges</span> <span class="o">=</span>  <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sumOf</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>

<span class="nv">$sumOfChildrenAges</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sumOf</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$person</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$person</span><span class="o">-&gt;</span><span class="na">child</span><span class="o">-&gt;</span><span class="na">age</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$sumOfDadAges</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sumOf</span><span class="p">(</span><span class="s1">&#39;dad.age&#39;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::avg">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">avg</code><span class="sig-paren">(</span><em>$matcher = null</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::avg" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Calculate the average value of the elements in the collection. Optionally
provide a matcher path, or function to extract values to generate the average
for:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span>
   <span class="p">[</span><span class="s1">&#39;invoice&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;total&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">]],</span>
   <span class="p">[</span><span class="s1">&#39;invoice&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;total&#39;</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">]],</span>
<span class="p">];</span>

<span class="c1">// Average: 150</span>
<span class="nv">$average</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">avg</span><span class="p">(</span><span class="s1">&#39;invoice.total&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.5.0.</span></p>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::median">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">median</code><span class="sig-paren">(</span><em>$matcher = null</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::median" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Calculate the median value of a set of elements. Optionally provide a matcher
path, or function to extract values to generate the median for:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">[</span><span class="s1">&#39;invoice&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;total&#39;</span> <span class="o">=&gt;</span> <span class="mi">400</span><span class="p">]],</span>
  <span class="p">[</span><span class="s1">&#39;invoice&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;total&#39;</span> <span class="o">=&gt;</span> <span class="mi">500</span><span class="p">]],</span>
  <span class="p">[</span><span class="s1">&#39;invoice&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;total&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">]],</span>
  <span class="p">[</span><span class="s1">&#39;invoice&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;total&#39;</span> <span class="o">=&gt;</span> <span class="mi">333</span><span class="p">]],</span>
  <span class="p">[</span><span class="s1">&#39;invoice&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;total&#39;</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">]],</span>
<span class="p">];</span>

<span class="c1">// Median: 333</span>
<span class="nv">$median</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">median</span><span class="p">(</span><span class="s1">&#39;invoice.total&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.5.0.</span></p>
</div>
<div class="section" id="grouping-and-counting">
<h3>Grouping and Counting<a class="headerlink" href="#grouping-and-counting" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="Cake\Collection\Collection::groupBy">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">groupBy</code><span class="sig-paren">(</span><em>$callback</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::groupBy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Collection values can be grouped by different keys in a new collection when they
share the same value for a property:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$students</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Andrew&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Stacy&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Barbara&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">]</span>
<span class="p">];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$students</span><span class="p">);</span>
<span class="nv">$studentsByGrade</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">groupBy</span><span class="p">(</span><span class="s1">&#39;grade&#39;</span><span class="p">);</span>

<span class="c1">// Result will look like this when converted to array:</span>
<span class="p">[</span>
  <span class="mi">10</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Andrew&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Stacy&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">]</span>
  <span class="p">],</span>
  <span class="mi">9</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Mark&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Barbara&#39;</span><span class="p">,</span> <span class="s1">&#39;grade&#39;</span> <span class="o">=&gt;</span> <span class="mi">9</span><span class="p">]</span>
  <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>As usual, it is possible to provide either a dot-separated path for nested
properties or your own callback function to generate the groups dynamically:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$commentsByUserId</span> <span class="o">=</span> <span class="nv">$comments</span><span class="o">-&gt;</span><span class="na">groupBy</span><span class="p">(</span><span class="s1">&#39;user.id&#39;</span><span class="p">);</span>

<span class="nv">$classResults</span> <span class="o">=</span> <span class="nv">$students</span><span class="o">-&gt;</span><span class="na">groupBy</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$student</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$student</span><span class="o">-&gt;</span><span class="na">grade</span> <span class="o">&gt;</span> <span class="mi">6</span> <span class="o">?</span> <span class="s1">&#39;approved&#39;</span> <span class="o">:</span> <span class="s1">&#39;denied&#39;</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::countBy">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">countBy</code><span class="sig-paren">(</span><em>$callback</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::countBy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>If you only wish to know the number of occurrences per group, you can do so by
using the <code class="docutils literal"><span class="pre">countBy()</span></code> method. It takes the same arguments as <code class="docutils literal"><span class="pre">groupBy</span></code> so it
should be already familiar to you:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$classResults</span> <span class="o">=</span> <span class="nv">$students</span><span class="o">-&gt;</span><span class="na">countBy</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$student</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$student</span><span class="o">-&gt;</span><span class="na">grade</span> <span class="o">&gt;</span> <span class="mi">6</span> <span class="o">?</span> <span class="s1">&#39;approved&#39;</span> <span class="o">:</span> <span class="s1">&#39;denied&#39;</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Result could look like this when converted to array:</span>
<span class="p">[</span><span class="s1">&#39;approved&#39;</span> <span class="o">=&gt;</span> <span class="mi">70</span><span class="p">,</span> <span class="s1">&#39;denied&#39;</span> <span class="o">=&gt;</span> <span class="mi">20</span><span class="p">]</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::indexBy">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">indexBy</code><span class="sig-paren">(</span><em>$callback</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::indexBy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>There will be certain cases where you know an element is unique for the property
you want to group by. If you wish a single result per group, you can use the
function <code class="docutils literal"><span class="pre">indexBy()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$usersById</span> <span class="o">=</span> <span class="nv">$users</span><span class="o">-&gt;</span><span class="na">indexBy</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>

<span class="c1">// When converted to array result could look like</span>
<span class="p">[</span>
    <span class="mi">1</span> <span class="o">=&gt;</span> <span class="s1">&#39;markstory&#39;</span><span class="p">,</span>
    <span class="mi">3</span> <span class="o">=&gt;</span> <span class="s1">&#39;jose_zap&#39;</span><span class="p">,</span>
    <span class="mi">4</span> <span class="o">=&gt;</span> <span class="s1">&#39;jrbasso&#39;</span>
<span class="p">]</span>
</pre></div>
</div>
<p>As with the <code class="docutils literal"><span class="pre">groupBy()</span></code> function you can also use a property path or
a callback:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$articlesByAuthorId</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">indexBy</span><span class="p">(</span><span class="s1">&#39;author.id&#39;</span><span class="p">);</span>

<span class="nv">$filesByHash</span> <span class="o">=</span> <span class="nv">$files</span><span class="o">-&gt;</span><span class="na">indexBy</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$file</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$file</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::zip">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">zip</code><span class="sig-paren">(</span><em>$elements</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::zip" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The elements of different collections can be grouped together using the
<code class="docutils literal"><span class="pre">zip()</span></code> method. It will return a new collection containing an array grouping
the elements from each collection that are placed at the same position:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$odds</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">]);</span>
<span class="nv">$pairs</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">]);</span>
<span class="nv">$combined</span> <span class="o">=</span> <span class="nv">$odds</span><span class="o">-&gt;</span><span class="na">zip</span><span class="p">(</span><span class="nv">$pairs</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span> <span class="c1">// [[1, 2], [3, 4], [5, 6]]</span>
</pre></div>
</div>
<p>You can also zip multiple collections at once:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$years</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">2014</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2016</span><span class="p">]);</span>
<span class="nv">$salaries</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">2300</span><span class="p">];</span>
<span class="nv">$increments</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">300</span><span class="p">];</span>

<span class="nv">$rows</span> <span class="o">=</span> <span class="nv">$years</span><span class="o">-&gt;</span><span class="na">zip</span><span class="p">(</span><span class="nv">$salaries</span><span class="p">,</span> <span class="nv">$increments</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span>
<span class="c1">// Returns:</span>
<span class="p">[</span>
    <span class="p">[</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">1500</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">500</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2016</span><span class="p">,</span> <span class="mi">2300</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>As you can already see, the <code class="docutils literal"><span class="pre">zip()</span></code> method is very useful for transposing
multidimensional arrays:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="mi">2014</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;jan&#39;</span> <span class="o">=&gt;</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;feb&#39;</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">],</span>
    <span class="mi">2015</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;jan&#39;</span> <span class="o">=&gt;</span> <span class="mi">300</span><span class="p">,</span> <span class="s1">&#39;feb&#39;</span> <span class="o">=&gt;</span> <span class="mi">500</span><span class="p">],</span>
    <span class="mi">2016</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;jan&#39;</span> <span class="o">=&gt;</span> <span class="mi">400</span><span class="p">,</span> <span class="s1">&#39;feb&#39;</span> <span class="o">=&gt;</span> <span class="mi">600</span><span class="p">],</span>
<span class="p">]</span>

<span class="c1">// Getting jan and feb data together</span>

<span class="nv">$firstYear</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nb">array_shift</span><span class="p">(</span><span class="nv">$data</span><span class="p">));</span>
<span class="nv">$firstYear</span><span class="o">-&gt;</span><span class="na">zip</span><span class="p">(</span><span class="nv">$data</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nv">$data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span>

<span class="c1">// Or $firstYear-&gt;zip(...$data) in PHP &gt;= 5.6</span>

<span class="c1">// Returns</span>
<span class="p">[</span>
    <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">400</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">600</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sorting">
<h2>Sorting<a class="headerlink" href="#sorting" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="Cake\Collection\Collection::sortBy">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">sortBy</code><span class="sig-paren">(</span><em>$callback</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::sortBy" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Collection values can be sorted in ascending or descending order based on
a column or custom function. To create a new sorted collection out of the values
of another one, you can use <code class="docutils literal"><span class="pre">sortBy</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$sorted</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sortBy</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>As seen above, you can sort by passing the name of a column or property that
is present in the collection values. You are also able to specify a property
path instead using the dot notation. The next example will sort articles by
their author&#8217;s name:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$articles</span><span class="p">);</span>
<span class="nv">$sorted</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sortBy</span><span class="p">(</span><span class="s1">&#39;author.name&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">sortBy()</span></code> method is flexible enough to let you specify an extractor
function that will let you dynamically select the value to use for comparing two
different values in the collection:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$articles</span><span class="p">);</span>
<span class="nv">$sorted</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sortBy</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$article</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$article</span><span class="o">-&gt;</span><span class="na">author</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">.</span> <span class="s1">&#39;-&#39;</span> <span class="o">.</span> <span class="nv">$article</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>In order to specify in which direction the collection should be sorted, you need
to provide either <code class="docutils literal"><span class="pre">SORT_ASC</span></code> or <code class="docutils literal"><span class="pre">SORT_DESC</span></code> as the second parameter for
sorting in ascending or descending direction respectively. By default,
collections are sorted in descending direction:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>
<span class="nv">$sorted</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sortBy</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="nx">SORT_ASC</span><span class="p">);</span>
</pre></div>
</div>
<p>Sometimes you will need to specify which type of data you are trying to compare
so that you get consistent results. For this purpose, you should supply a third
argument in the <code class="docutils literal"><span class="pre">sortBy()</span></code> function with one of the following constants:</p>
<ul class="simple">
<li><strong>SORT_NUMERIC</strong>: For comparing numbers</li>
<li><strong>SORT_STRING</strong>: For comparing string values</li>
<li><strong>SORT_NATURAL</strong>: For sorting string containing numbers and you&#8217;d like those
numbers to be order in a natural way. For example: showing &#8220;10&#8221; after &#8220;2&#8221;.</li>
<li><strong>SORT_LOCALE_STRING</strong>: For comparing strings based on the current locale.</li>
</ul>
<p>By default, <code class="docutils literal"><span class="pre">SORT_NUMERIC</span></code> is used:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$articles</span><span class="p">);</span>
<span class="nv">$sorted</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sortBy</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="nx">SORT_ASC</span><span class="p">,</span> <span class="nx">SORT_NATURAL</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is often expensive to iterate sorted collections more than once. If you
plan to do so, consider converting the collection to an array or simply use
the <code class="docutils literal"><span class="pre">compile()</span></code> method on it.</p>
</div>
</div>
<div class="section" id="working-with-tree-data">
<h2>Working with Tree Data<a class="headerlink" href="#working-with-tree-data" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="Cake\Collection\Collection::nest">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">nest</code><span class="sig-paren">(</span><em>$idPath</em>, <em>$parentPath</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::nest" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Not all data is meant to be represented in a linear way. Collections make it
easier to construct and flatten hierarchical or nested structures. Creating
a nested structure where children are grouped by a parent identifier property is
easy with the <code class="docutils literal"><span class="pre">nest()</span></code> method.</p>
<p>Two parameters are required for this function. The first one is the property
representing the item identifier. The second parameter is the name of the
property representing the identifier for the parent item:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Birds&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Land Birds&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Eagle&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Seagull&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Clown Fish&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fish&#39;</span><span class="p">],</span>
<span class="p">]);</span>

<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">nest</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
<span class="c1">// Returns</span>
<span class="p">[</span>
    <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Birds&#39;</span><span class="p">,</span>
        <span class="s1">&#39;children&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Land Birds&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span> <span class="o">=&gt;</span> <span class="p">[]],</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Eagle&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span> <span class="o">=&gt;</span> <span class="p">[]],</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Seagull&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span> <span class="o">=&gt;</span> <span class="p">[]],</span>
        <span class="p">]</span>
    <span class="p">],</span>
    <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span>
        <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
        <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fish&#39;</span><span class="p">,</span>
        <span class="s1">&#39;children&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Clown Fish&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span> <span class="o">=&gt;</span> <span class="p">[]],</span>
        <span class="p">]</span>
    <span class="p">]</span>
<span class="p">];</span>
</pre></div>
</div>
<p>Children elements are nested inside the <code class="docutils literal"><span class="pre">children</span></code> property inside each of the
items in the collection. This type of data representation is helpful for
rendering menus or traversing elements up to certain level in the tree.</p>
<dl class="method">
<dt id="Cake\Collection\Collection::listNested">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">listNested</code><span class="sig-paren">(</span><em>$dir = 'desc'</em>, <em>$nestingKey = 'children'</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::listNested" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The inverse of <code class="docutils literal"><span class="pre">nest()</span></code> is <code class="docutils literal"><span class="pre">listNested()</span></code>. This method allows you to flatten
a tree structure back into a linear structure. It takes two parameters; the
first one is the traversing mode (asc, desc or leaves), and the second one is
the name of the property containing the children for each element in the
collection.</p>
<p>Taking the input the nested collection built in the previous example, we can
flatten it:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$nested</span><span class="o">-&gt;</span><span class="na">listNested</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span>

<span class="c1">// Returns</span>
<span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Birds&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">...</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Land Birds&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Eagle&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Seagull&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Fish&#39;</span><span class="p">,</span> <span class="s1">&#39;children&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="o">...</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Clown Fish&#39;</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>By default, the tree is traversed from the root to the leaves. You can also
instruct it to only return the leaf elements in the tree:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$nested</span><span class="o">-&gt;</span><span class="na">listNested</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>

<span class="c1">// Returns</span>
<span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Eagle&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Seagull&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;parent_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">6</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Clown Fish&#39;</span><span class="p">]</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Once you have converted a tree into a nested list, you can use the <code class="docutils literal"><span class="pre">printer()</span></code>
method to configure how the list output should be formatted:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$nested</span><span class="o">-&gt;</span><span class="na">listNested</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">printer</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>

<span class="c1">// Returns</span>
<span class="p">[</span>
    <span class="mi">3</span> <span class="o">=&gt;</span> <span class="s1">&#39;Eagle&#39;</span><span class="p">,</span>
    <span class="mi">4</span> <span class="o">=&gt;</span> <span class="s1">&#39;Seagull&#39;</span><span class="p">,</span>
    <span class="mi">5</span> <span class="o">-&gt;</span> <span class="s1">&#39;--Clown Fish&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">printer()</span></code> method also lets you use a callback to generate the keys and
or values:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$nested</span><span class="o">-&gt;</span><span class="na">listNested</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">printer</span><span class="p">(</span>
    <span class="k">function</span> <span class="p">(</span><span class="nv">$el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$el</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
    <span class="p">},</span>
    <span class="k">function</span> <span class="p">(</span><span class="nv">$el</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$el</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="other-methods">
<h2>Other Methods<a class="headerlink" href="#other-methods" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="Cake\Collection\Collection::isEmpty">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">isEmpty</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::isEmpty" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Allows you to see if a collection contains any elements:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([]);</span>
<span class="c1">// Returns true</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">isEmpty</span><span class="p">();</span>

<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span><span class="mi">1</span><span class="p">]);</span>
<span class="c1">// Returns false</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">isEmpty</span><span class="p">();</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::contains">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">contains</code><span class="sig-paren">(</span><em>$value</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::contains" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Collections allow you to quickly check if they contain one particular
value: by using the <code class="docutils literal"><span class="pre">contains()</span></code> method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">];</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">);</span>
<span class="nv">$hasThree</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">contains</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
<p>Comparisons are performed using the <code class="docutils literal"><span class="pre">===</span></code> operator. If you wish to do looser
comparison types you can use the <code class="docutils literal"><span class="pre">some()</span></code> method.</p>
<dl class="method">
<dt id="Cake\Collection\Collection::shuffle">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">shuffle</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::shuffle" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes you may wish to show a collection of values in a random order. In
order to create a new collection that will return each value in a randomized
position, use the <code class="docutils literal"><span class="pre">shuffle</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span><span class="s1">&#39;a&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">]);</span>

<span class="c1">// This could return [2, 3, 1]</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">shuffle</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::transpose">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">transpose</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::transpose" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>When you transpose a collection, you get a new collection containing a row made
of the each of the original columns:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$items</span> <span class="o">=</span> <span class="p">[</span>
   <span class="p">[</span><span class="s1">&#39;Products&#39;</span><span class="p">,</span> <span class="s1">&#39;2012&#39;</span><span class="p">,</span> <span class="s1">&#39;2013&#39;</span><span class="p">,</span> <span class="s1">&#39;2014&#39;</span><span class="p">],</span>
   <span class="p">[</span><span class="s1">&#39;Product A&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">],</span>
   <span class="p">[</span><span class="s1">&#39;Product B&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">],</span>
   <span class="p">[</span><span class="s1">&#39;Product C&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">],</span>
<span class="p">]</span>
<span class="nv">$transpose</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$items</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">transpose</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span>

<span class="c1">// Returns</span>
<span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;Products&#39;</span><span class="p">,</span> <span class="s1">&#39;Product A&#39;</span><span class="p">,</span> <span class="s1">&#39;Product B&#39;</span><span class="p">,</span> <span class="s1">&#39;Product C&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;2012&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">,</span> <span class="s1">&#39;400&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;2013&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">,</span> <span class="s1">&#39;300&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;2014&#39;</span><span class="p">,</span> <span class="s1">&#39;50&#39;</span><span class="p">,</span> <span class="s1">&#39;100&#39;</span><span class="p">,</span> <span class="s1">&#39;200&#39;</span><span class="p">],</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.3.0: </span><code class="docutils literal"><span class="pre">Collection::transpose()</span></code> was added in 3.3.0.</p>
</div>
<div class="section" id="withdrawing-elements">
<h3>Withdrawing Elements<a class="headerlink" href="#withdrawing-elements" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="Cake\Collection\Collection::sample">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">sample</code><span class="sig-paren">(</span><em>int $size</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::sample" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Shuffling a collection is often useful when doing quick statistical analysis.
Another common operation when doing this sort of task is withdrawing a few
random values out of a collection so that more tests can be performed on those.
For example, if you wanted to select 5 random users to which you&#8217;d like to apply
some A/B tests to, you can use the <code class="docutils literal"><span class="pre">sample()</span></code> function:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$people</span><span class="p">);</span>

<span class="c1">// Withdraw maximum 20 random users from this collection</span>
<span class="nv">$testSubjects</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sample</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">sample()</span></code> will take at most the number of values you specify in the first
argument. If there are not enough elements in the collection to satisfy the
sample, the full collection in a random order is returned.</p>
<dl class="method">
<dt id="Cake\Collection\Collection::take">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">take</code><span class="sig-paren">(</span><em>int $size</em>, <em>int $from</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::take" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Whenever you want to take a slice of a collection use the <code class="docutils literal"><span class="pre">take()</span></code> function,
it will create a new collection with at most the number of values you specify in
the first argument, starting from the position passed in the second argument:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$topFive</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sortBy</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">take</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="c1">// Take 5 people from the collection starting from position 4</span>
<span class="nv">$nextTopFive</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">sortBy</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">take</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
</pre></div>
</div>
<p>Positions are zero-based, therefore the first position number is <code class="docutils literal"><span class="pre">0</span></code>.</p>
<dl class="method">
<dt id="Cake\Collection\Collection::skip">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">skip</code><span class="sig-paren">(</span><em>int $positions</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::skip" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>While the second argument of <code class="docutils literal"><span class="pre">take()</span></code> can help you skip some elements before
getting them from the collection, you can also use <code class="docutils literal"><span class="pre">skip()</span></code> for the same
purpose as a way to take the rest of the elements after a certain position:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]);</span>
<span class="nv">$allExceptFirstTwo</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">skip</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toList</span><span class="p">();</span> <span class="c1">// [3, 4]</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::first">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">first</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::first" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>One of the most common uses of <code class="docutils literal"><span class="pre">take()</span></code> is getting the first element in the
collection. A shortcut method for achieving the same goal is using the
<code class="docutils literal"><span class="pre">first()</span></code> method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span> <span class="c1">// Returns 5</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::last">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">last</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::last" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Similarly, you can get the last element of a collection using the <code class="docutils literal"><span class="pre">last()</span></code>
method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">last</span><span class="p">();</span> <span class="c1">// Returns 2</span>
</pre></div>
</div>
</div>
<div class="section" id="expanding-collections">
<h3>Expanding Collections<a class="headerlink" href="#expanding-collections" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="Cake\Collection\Collection::append">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">append</code><span class="sig-paren">(</span><em>array|Traversable $items</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::append" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>You can compose multiple collections into a single one. This enables you to
gather data from various sources, concatenate it, and apply other collection
functions to it very smoothly. The <code class="docutils literal"><span class="pre">append()</span></code> method will return a new
collection containing the values from both sources:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$cakephpTweets</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$tweets</span><span class="p">);</span>
<span class="nv">$myTimeline</span> <span class="o">=</span> <span class="nv">$cakephpTweets</span><span class="o">-&gt;</span><span class="na">append</span><span class="p">(</span><span class="nv">$phpTweets</span><span class="p">);</span>

<span class="c1">// Tweets containing cakefest from both sources</span>
<span class="nv">$myTimeline</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$tweet</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nb">strpos</span><span class="p">(</span><span class="nv">$tweet</span><span class="p">,</span> <span class="s1">&#39;cakefest&#39;</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When appending from different sources, you can expect some keys from both
collections to be the same. For example, when appending two simple arrays.
This can present a problem when converting a collection to an array using
<code class="docutils literal"><span class="pre">toArray()</span></code>. If you do not want values from one collection to override
others in the previous one based on their key, make sure that you call
<code class="docutils literal"><span class="pre">toList()</span></code> in order to drop the keys and preserve all values.</p>
</div>
</div>
<div class="section" id="modifiying-elements">
<h3>Modifiying Elements<a class="headerlink" href="#modifiying-elements" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="Cake\Collection\Collection::insert">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">insert</code><span class="sig-paren">(</span><em>string $path</em>, <em>array|Traversable $items</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::insert" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>At times, you may have two separate sets of data that you would like to insert
the elements of one set into each of the elements of the other set. This is
a very common case when you fetch data from a data source that does not support
data-merging or joins natively.</p>
<p>Collections offer an <code class="docutils literal"><span class="pre">insert()</span></code> method that will allow you to insert each of
the elements in one collection into a property inside each of the elements of
another collection:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$users</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mark&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;juan&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jose&#39;</span><span class="p">]</span>
<span class="p">];</span>

<span class="nv">$languages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;Bash&#39;</span><span class="p">,</span> <span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Javascript&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;Javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;Prolog&#39;</span><span class="p">]</span>
<span class="p">];</span>

<span class="nv">$merged</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$users</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">&#39;skills&#39;</span><span class="p">,</span> <span class="nv">$languages</span><span class="p">);</span>
</pre></div>
</div>
<p>When converted to an array, the <code class="docutils literal"><span class="pre">$merged</span></code> collection will look like this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mark&#39;</span><span class="p">,</span> <span class="s1">&#39;skills&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;juan&#39;</span><span class="p">,</span> <span class="s1">&#39;skills&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Bash&#39;</span><span class="p">,</span> <span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Javascript&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jose&#39;</span><span class="p">,</span> <span class="s1">&#39;skills&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Javascript&#39;</span><span class="p">,</span> <span class="s1">&#39;Prolog&#39;</span><span class="p">]]</span>
<span class="p">];</span>
</pre></div>
</div>
<p>The first parameter for the <code class="docutils literal"><span class="pre">insert()</span></code> method is a dot-separated path of
properties to follow so that the elements can be inserted at that position. The
second argument is anything that can be converted to a collection object.</p>
<p>Please observe that elements are inserted by the position they are found, thus,
the first element of the second collection is merged into the first
element of the first collection.</p>
<p>If there are not enough elements in the second collection to insert into the
first one, then the target property will be filled with <code class="docutils literal"><span class="pre">null</span></code> values:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$languages</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;Bash&#39;</span><span class="p">,</span> <span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Javascript&#39;</span><span class="p">]</span>
<span class="p">];</span>

<span class="nv">$merged</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$users</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">insert</span><span class="p">(</span><span class="s1">&#39;skills&#39;</span><span class="p">,</span> <span class="nv">$languages</span><span class="p">);</span>

<span class="c1">// Will yield</span>
<span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;mark&#39;</span><span class="p">,</span> <span class="s1">&#39;skills&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="s1">&#39;Ruby&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;juan&#39;</span><span class="p">,</span> <span class="s1">&#39;skills&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Bash&#39;</span><span class="p">,</span> <span class="s1">&#39;PHP&#39;</span><span class="p">,</span> <span class="s1">&#39;Javascript&#39;</span><span class="p">]],</span>
    <span class="p">[</span><span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jose&#39;</span><span class="p">,</span> <span class="s1">&#39;skills&#39;</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">]</span>
<span class="p">];</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">insert()</span></code> method can operate array elements or objects implementing the
<code class="docutils literal"><span class="pre">ArrayAccess</span></code> interface.</p>
</div>
<div class="section" id="making-collection-methods-reusable">
<h3>Making Collection Methods Reusable<a class="headerlink" href="#making-collection-methods-reusable" title="Permalink to this headline">¶</a></h3>
<p>Using closures for collection methods is great when the work to be done is small
and focused, but it can get messy very quickly. This becomes more obvious when
a lot of different methods need to be called or when the length of the closure
methods is more than just a few lines.</p>
<p>There are also cases when the logic used for the collection methods can be
reused in multiple parts of your application. It is recommended that you
consider extracting complex collection logic to separate classes. For example,
imagine a lengthy closure like this one:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span>
        <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$row</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">collection</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">sumOf</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;tax_amount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// More code here...</span>

            <span class="k">return</span> <span class="nv">$modifiedRow</span><span class="p">;</span>
        <span class="p">});</span>
</pre></div>
</div>
<p>This can be refactored by creating another class:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TotalOrderCalculator</span>
<span class="p">{</span>

        <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(</span><span class="nv">$row</span><span class="p">,</span> <span class="nv">$key</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">collection</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;items&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">sumOf</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]))</span> <span class="p">{</span>
                <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;tax_amount&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$row</span><span class="p">[</span><span class="s1">&#39;total&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="c1">// More code here...</span>

            <span class="k">return</span> <span class="nv">$modifiedRow</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Use the logic in your map() call</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">new</span> <span class="nx">TotalOrderCalculator</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="Cake\Collection\Collection::through">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">through</code><span class="sig-paren">(</span><em>callable $c</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::through" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes a chain of collection method calls can become reusable in other parts
of your application, but only if they are called in that specific order. In
those cases you can use <code class="docutils literal"><span class="pre">through()</span></code> in combination with a class implementing
<code class="docutils literal"><span class="pre">__invoke</span></code> to distribute your handy data processing calls:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span>
        <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">new</span> <span class="nx">ShippingCostCalculator</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">new</span> <span class="nx">TotalOrderCalculator</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">new</span> <span class="nx">GiftCardPriceReducer</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">buffered</span><span class="p">()</span>
       <span class="o">...</span>
</pre></div>
</div>
<p>The above method calls can be extracted into a new class so they don&#8217;t need to
be repeated every time:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">FinalCheckOutRowProcessor</span>
<span class="p">{</span>

        <span class="k">public</span> <span class="k">function</span> <span class="fm">__invoke</span><span class="p">(</span><span class="nv">$collection</span><span class="p">)</span>
        <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$collection</span>
                        <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">new</span> <span class="nx">ShippingCostCalculator</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">new</span> <span class="nx">TotalOrderCalculator</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">new</span> <span class="nx">GiftCardPriceReducer</span><span class="p">)</span>
                        <span class="o">-&gt;</span><span class="na">buffered</span><span class="p">()</span>
                       <span class="o">...</span>
        <span class="p">}</span>
<span class="p">}</span>


<span class="c1">// Now you can use the through() method to call all methods at once</span>
<span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">through</span><span class="p">(</span><span class="k">new</span> <span class="nx">FinalCheckOutRowProcessor</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="optimizing-collections">
<h3>Optimizing Collections<a class="headerlink" href="#optimizing-collections" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="Cake\Collection\Collection::buffered">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">buffered</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::buffered" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Collections often perform most operations that you create using its functions in
a lazy way. This means that even though you can call a function, it does not
mean it is executed right away. This is true for a great deal of functions in
this class. Lazy evaluation allows you to save resources in situations
where you don&#8217;t use all the values in a collection. You might not use all the
values when iteration stops early, or when an exception/failure case is reached
early.</p>
<p>Additionally, lazy evaluation helps speed up some operations. Consider the
following example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$collection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$oneMillionItems</span><span class="p">);</span>
<span class="nv">$collection</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">map</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$item</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">});</span>
<span class="nv">$itemsToShow</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">take</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
</pre></div>
</div>
<p>Had the collections not been lazy, we would have executed one million operations,
even though we only wanted to show 30 elements out of it. Instead, our map
operation was only applied to the 30 elements we used. We can also
derive benefits from this lazy evaluation for smaller collections when we
do more than one operation on them. For example: calling <code class="docutils literal"><span class="pre">map()</span></code> twice and
then <code class="docutils literal"><span class="pre">filter()</span></code>.</p>
<p>Lazy evaluation comes with its downside too. You could be doing the same
operations more than once if you optimize a collection prematurely. Consider
this example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$ages</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">);</span>

<span class="nv">$youngerThan30</span> <span class="o">=</span> <span class="nv">$ages</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$item</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">;</span>
<span class="p">});</span>

<span class="nv">$olderThan30</span> <span class="o">=</span> <span class="nv">$ages</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$item</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>If we iterate both <code class="docutils literal"><span class="pre">youngerThan30</span></code> and <code class="docutils literal"><span class="pre">olderThan30</span></code>, the collection would
unfortunately execute the <code class="docutils literal"><span class="pre">extract()</span></code> operation twice. This is because
collections are immutable and the lazy-extracting operation would be done for
both filters.</p>
<p>Luckily we can overcome this issue with a single function. If you plan to reuse
the values from certain operations more than once, you can compile the results
into another collection using the <code class="docutils literal"><span class="pre">buffered()</span></code> function:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$ages</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">buffered</span><span class="p">();</span>
<span class="nv">$youngerThan30</span> <span class="o">=</span> <span class="o">...</span>
<span class="nv">$olderThan30</span> <span class="o">=</span> <span class="o">...</span>
</pre></div>
</div>
<p>Now, when both collections are iterated, they will only call the
extracting operation once.</p>
</div>
<div class="section" id="making-collections-rewindable">
<h3>Making Collections Rewindable<a class="headerlink" href="#making-collections-rewindable" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">buffered()</span></code> method is also useful for converting non-rewindable iterators
into collections that can be iterated more than once:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// In PHP 5.5+</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">results</span><span class="p">()</span>
<span class="p">{</span>
    <span class="o">...</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$transientElements</span> <span class="k">as</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">yield</span> <span class="nv">$e</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nv">$rewindable</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nx">results</span><span class="p">()))</span><span class="o">-&gt;</span><span class="na">buffered</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="cloning-collections">
<h3>Cloning Collections<a class="headerlink" href="#cloning-collections" title="Permalink to this headline">¶</a></h3>
<dl class="method">
<dt id="Cake\Collection\Collection::compile">
<code class="descclassname">Cake\Collection\Collection::</code><code class="descname">compile</code><span class="sig-paren">(</span><em>bool $preserveKeys = true</em><span class="sig-paren">)</span><a class="headerlink" href="#Cake\Collection\Collection::compile" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>Sometimes you need to get a clone of the elements from another
collection. This is useful when you need to iterate the same set from different
places at the same time. In order to clone a collection out of another use the
<code class="docutils literal"><span class="pre">compile()</span></code> method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$ages</span> <span class="o">=</span> <span class="nv">$collection</span><span class="o">-&gt;</span><span class="na">extract</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">compile</span><span class="p">();</span>

<span class="k">foreach</span> <span class="p">(</span><span class="nv">$ages</span> <span class="k">as</span> <span class="nv">$age</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$collection</span> <span class="k">as</span> <span class="nv">$element</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nx">h</span><span class="p">(</span><span class="nv">$element</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">)</span> <span class="o">.</span> <span class="s1">&#39; - &#39;</span> <span class="o">.</span> <span class="nv">$age</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


            </div>
        </div>

        
        <div class="col-md-3 col-md-pull-9 hidden-xs hidden-sm" lang="en">
            <aside class="sidebar">
                <div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<p class="caption"><span class="caption-text">Preface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">CakePHP at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/3-x-migration-guide.html">3.x Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/request-response.html">Request &amp; Response Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orm.html">Database Access &amp; ORM</a></li>
</ul>
<p class="caption"><span class="caption-text">Using CakePHP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bake.html">Bake Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="caching.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Console Tools, Shells &amp; Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/errors.html">Error &amp; Exception Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="events.html">Events System</a></li>
<li class="toctree-l1"><a class="reference internal" href="internationalization-and-localization.html">Internationalization &amp; Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="form.html">Modelless Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/pagination.html">Pagination</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/rest.html">REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/sessions.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="validation.html">Validation</a></li>
</ul>
<p class="caption"><span class="caption-text">Utility Classes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="app.html">App Class</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="file-folder.html">Folder &amp; File</a></li>
<li class="toctree-l1"><a class="reference internal" href="hash.html">Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="httpclient.html">Http Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="inflector.html">Inflector</a></li>
<li class="toctree-l1"><a class="reference internal" href="number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="registry-objects.html">Registry Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="text.html">Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="time.html">Date &amp; Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="xml.html">Xml</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../chronos.html">Chronos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug-kit.html">Debug Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrations.html">Migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch.html">ElasticSearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade-tool.html">Upgrade Tool</a></li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="global-constants-and-functions.html">Constants &amp; Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

                </div>
            </aside>
            <aside class="sidebar">
                <div class="mb30 row">
                </div>
            </aside>
        </div>
    </div>
</div>

<section id="socials" class="back-3">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-5  social text-center">
                <div class="col-sm-3 col-xs-3">
                    <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                          var js, fjs = d.getElementsByTagName(s)[0];
                          if (d.getElementById(id)) return;
                          js = d.createElement(s); js.id = id;
                          js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
                          fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));
                        </script>
                        <div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-7 social-footer text-center ">
                <a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
                <a href="https://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
                <a href="https://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
                <a href="https://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
                <a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
                <a href="https://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
                <a href="https://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
                <a href="https://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
            </div>
        </div>
    </div>
</section>

<footer id="footer" class="footer-wrapper">
    <div class="container">

        <div class="row col-p30">
            <div class="col-sm-12 col-md-3">
                <div class="footer-widget t-footer">
                    <div class="col-md-12">
                        <a href="https://www.openhub.net/p/cakephp">
                            <img src="../_static/open-hub.png">
                        </a>
                        <div class="mt10">
                            <a href="https://www.rackspace.com/">
                                <img src="../_static/rackspace.png">
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-md-9">
                <div class="col-md-3 col-sm-6 business-solution">
                    <ul class="footer-menu">
                        <li class="menu-title">
    <a href="https://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
    <a href="https://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 text-center mt30">
                <p class="copyright">
                            &copy; Copyright 2017, Cake Software Foundation, Inc.
                        Last updated on Aug 30, 2017.
                        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
                </p>
            </div>
        </div>
    </div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-743287-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
  </body>
</html>
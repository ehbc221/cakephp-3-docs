

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Testing" lang="en" name="title" />
<meta content="phpunit,test database,database configuration,database setup,database test,public test,test framework,running one,test setup,de facto standard,pear,runners,array,databases,cakephp,php,integration" lang="en" name="keywords" />

    <title>Testing - 3.x</title>
    <link href="../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/app.js"></script>

    <link rel="alternate" hreflang="pt_BR" href="../../pt/development/testing.html" /><link rel="alternate" hreflang="es" href="../../es/development/testing.html" /><link rel="alternate" hreflang="ja" href="../../ja/development/testing.html" /><link rel="alternate" hreflang="fr" href="../../fr/development/testing.html" /><link rel="alternate" hreflang="zh" href="../../zh/development/testing.html" /><link rel="alternate" hreflang="tr" href="../../tr/development/testing.html" /><link rel="alternate" hreflang="ru" href="../../ru/development/testing.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within CakePHP Cookbook 3.5 documentation" href="../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="CakePHP Cookbook 3.5 documentation" href="../index.html" />
    <link rel="next" title="Validation" href="../core-libraries/validation.html" />
    <link rel="prev" title="Sessions" href="sessions.html" />

    <script type="text/javascript">
    window.lang = "en";
    </script>
  </head>
  <body>

<div id="container">
    
    <header class="nav-down">
        <div class="container-fluid hidden-xs hidden-sm">
            <div class="row">
                <div class="col-sm-3 col-md-3">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-9 col-md-9">
                    <nav class="navbar-right">
                        <ul class="menu">
                            <li class="first">
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
                                <ul class="submenu">
                                    
<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                                </ul>
                            </li>

                            <li><a href="https://cakephp.org/business-solutions">Business Solutions</a></li>
                            <li><a href="https://cakephp.org/writers">Get Paid To Write</a></li>
                            <li><a href="https://cakephp.org/pages/team">Team</a></li>

                            <li>
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
                                <div class="megamenu full">
                                    <div class="row">
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                                            </ul>
                                        </div>
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        
        <div class="container-fluid hidden-md hidden-lg">
            <div class="row">
                <div class="col-sm-6 col-xs-6">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-6 col-xs-6">
                    <div class="navbar-right">
                        <button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
                            <i class="fa fa-bars toggle-modal"></i>
                        </button>
                    </div>
                    <div id="wrap">
                        <form class="search" action="../search.html" method="get">
                            <input name="q" type="search" placeholder="What are you looking for?">
                            <input id="search_submit" value="Search" type="submit">
                        </form>
                    </div>
                </div>
            </div>
        </div>

        
        <section id="nav-cook" class="hidden-xs hidden-sm">
            <div class="container-fluid ">
                <div class="row ">
                    <div class="col-md-12 back-book">
                        <div class="col-md-5 text-center t-cook-nav p0 hidden-sm hidden-xs">
                            <h2>
                                <a href="../contents.html">
                                    <span class="glyph_range icon-submenu icon-submenu-cook">B</span>
                                    CakePHP 3.5 Red Velvet <strong>Cookbook</strong>
                                </a>
                            </h2>
                        </div>

                        <div class="col-md-4 hidden-sm">
                            <form class="search" action="../search.html" method="get">
                                <input type="hidden" name="check_keywords" value="yes" />
                                <input type="hidden" name="area" value="default" />

                                <div class="col-md-10 p0">
                                    <input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
                                </div>
                                <div class="col-md-2 p0 search-cook">
                                    <button type="submit">
                                        <span class="glyph_range icon-submenu icon-submenu-cook">A</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        
                        <div class="col-md-3">
                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Language:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
                                                    role="button" aria-haspopup="true" aria-expanded="false" href="#">
                                                        en
                                                        <i class="fa fa-menu-en fa-chevron-down"></i>
                                                    </a>
                                            <ul class="dropdown-menu">
                                            
                                                <li></li>
                                            
                                                <li><a href="../../pt/development/testing.html">pt</a></li>
                                            
                                                <li><a href="../../es/development/testing.html">es</a></li>
                                            
                                                <li><a href="../../ja/development/testing.html">ja</a></li>
                                            
                                                <li><a href="../../fr/development/testing.html">fr</a></li>
                                            
                                                <li><a href="../../zh/development/testing.html">zh</a></li>
                                            
                                                <li><a href="../../tr/development/testing.html">tr</a></li>
                                            
                                                <li><a href="../../ru/development/testing.html">ru</a></li>
                                            
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Version:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">3.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
                                            <ul class="dropdown-menu">
                                                <li><a href="https://book.cakephp.org/3.0/en">3.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/2.0/en">2.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.3/en/">1.3 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.2/en/">1.2 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.1/en">1.1 Book</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
        </section>
    </header>

    
    <section class="nav-btn visible-sm visible-xs">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
                </div>

                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
                </div>
            </div>
        </div>
    </section>

    
    <div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title-cookbook" id="modal-header"></h4>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>

<div class="container page-container "><div id="improve-slideout">
        <i class="fa fa-pencil icon-improve"></i>
        <a href="https://github.com/cakephp/docs/edit/3.0/en/development/testing.rst" target="_blank">
            <div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
        </a>
    </div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

    
    <div class="row">
        <div class="col-sm-12 col-md-9 col-md-push-3"><div class="page-contents col-sm-5">
                <h3>Page Contents</h3>
                <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#installing-phpunit">Installing PHPUnit</a><ul>
<li><a class="reference internal" href="#install-phpunit-with-composer">Install PHPUnit with Composer</a></li>
<li><a class="reference internal" href="#using-the-phar-file">Using the PHAR File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-database-setup">Test Database Setup</a></li>
<li><a class="reference internal" href="#checking-the-test-setup">Checking the Test Setup</a></li>
<li><a class="reference internal" href="#test-case-conventions">Test Case Conventions</a></li>
<li><a class="reference internal" href="#creating-your-first-test-case">Creating Your First Test Case</a></li>
<li><a class="reference internal" href="#running-tests">Running Tests</a><ul>
<li><a class="reference internal" href="#filtering-test-cases">Filtering Test Cases</a></li>
<li><a class="reference internal" href="#generating-code-coverage">Generating Code Coverage</a></li>
<li><a class="reference internal" href="#combining-test-suites-for-plugins">Combining Test Suites for Plugins</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-case-lifecycle-callbacks">Test Case Lifecycle Callbacks</a></li>
<li><a class="reference internal" href="#fixtures">Fixtures</a><ul>
<li><a class="reference internal" href="#test-connections">Test Connections</a></li>
<li><a class="reference internal" href="#creating-fixtures">Creating Fixtures</a></li>
<li><a class="reference internal" href="#dynamic-data-and-fixtures">Dynamic Data and Fixtures</a></li>
<li><a class="reference internal" href="#importing-table-information">Importing Table Information</a></li>
<li><a class="reference internal" href="#loading-fixtures-in-your-test-cases">Loading Fixtures in your Test Cases</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-table-classes">Testing Table Classes</a><ul>
<li><a class="reference internal" href="#creating-a-test-method">Creating a Test Method</a></li>
<li><a class="reference internal" href="#mocking-model-methods">Mocking Model Methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#controller-integration-testing">Controller Integration Testing</a><ul>
<li><a class="reference internal" href="#setting-up-the-request">Setting up the Request</a></li>
<li><a class="reference internal" href="#testing-actions-that-require-authentication">Testing Actions That Require Authentication</a></li>
<li><a class="reference internal" href="#testing-stateless-authentication-and-apis">Testing Stateless Authentication and APIs</a></li>
<li><a class="reference internal" href="#testing-actions-protected-by-csrfcomponent-or-securitycomponent">Testing Actions Protected by CsrfComponent or SecurityComponent</a></li>
<li><a class="reference internal" href="#integration-testing-psr-7-middleware">Integration Testing PSR-7 Middleware</a></li>
<li><a class="reference internal" href="#testing-with-encrypted-cookies">Testing with Encrypted Cookies</a></li>
<li><a class="reference internal" href="#testing-flash-messages">Testing Flash Messages</a></li>
<li><a class="reference internal" href="#testing-a-json-responding-controller">Testing a JSON Responding Controller</a></li>
<li><a class="reference internal" href="#disabling-error-handling-middleware-in-tests">Disabling Error Handling Middleware in Tests</a></li>
<li><a class="reference internal" href="#assertion-methods">Assertion methods</a></li>
<li><a class="reference internal" href="#comparing-test-results-to-a-file">Comparing test results to a file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#console-integration-testing">Console Integration Testing</a><ul>
<li><a class="reference internal" href="#testing-interactive-shells">Testing Interactive Shells</a></li>
<li><a class="reference internal" href="#testing-the-commandrunner">Testing the CommandRunner</a></li>
<li><a class="reference internal" href="#id3">Assertion methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing-views">Testing Views</a></li>
<li><a class="reference internal" href="#testing-components">Testing Components</a></li>
<li><a class="reference internal" href="#testing-helpers">Testing Helpers</a></li>
<li><a class="reference internal" href="#testing-events">Testing Events</a></li>
<li><a class="reference internal" href="#creating-test-suites">Creating Test Suites</a></li>
<li><a class="reference internal" href="#creating-tests-for-plugins">Creating Tests for Plugins</a></li>
<li><a class="reference internal" href="#generating-tests-with-bake">Generating Tests with Bake</a></li>
<li><a class="reference internal" href="#integration-with-jenkins">Integration with Jenkins</a><ul>
<li><a class="reference internal" href="#create-a-job">Create a Job</a></li>
<li><a class="reference internal" href="#add-test-database-config">Add Test Database Config</a></li>
<li><a class="reference internal" href="#add-your-tests">Add your Tests</a></li>
<li><a class="reference internal" href="#run-a-build">Run a Build</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div><div class="document-body">
            
  <div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h1>
<p>CakePHP comes with comprehensive testing support built-in. CakePHP comes with
integration for <a class="reference external" href="http://phpunit.de">PHPUnit</a>. In addition to the features
offered by PHPUnit, CakePHP offers some additional features to make testing
easier. This section will cover installing PHPUnit, and getting started with
Unit Testing, and how you can use the extensions that CakePHP offers.</p>
<div class="section" id="installing-phpunit">
<h2>Installing PHPUnit<a class="headerlink" href="#installing-phpunit" title="Permalink to this headline">¶</a></h2>
<p>CakePHP uses PHPUnit as its underlying test framework. PHPUnit is the de-facto
standard for unit testing in PHP. It offers a deep and powerful set of features
for making sure your code does what you think it does. PHPUnit can be installed
through using either a <a class="reference external" href="http://phpunit.de/#download">PHAR package</a> or
<a class="reference external" href="http://getcomposer.org">Composer</a>.</p>
<div class="section" id="install-phpunit-with-composer">
<h3>Install PHPUnit with Composer<a class="headerlink" href="#install-phpunit-with-composer" title="Permalink to this headline">¶</a></h3>
<p>To install PHPUnit with Composer:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ php composer.phar require --dev phpunit/phpunit:<span class="s2">&quot;^5.7|^6.0&quot;</span>

// Before CakePHP <span class="m">3</span>.4.1
$ php composer.phar require --dev phpunit/phpunit:<span class="s2">&quot;&lt;6.0&quot;</span>
</pre></div>
</div>
<p>This will add the dependency to the <code class="docutils literal"><span class="pre">require-dev</span></code> section of your
<code class="docutils literal"><span class="pre">composer.json</span></code>, and then install PHPUnit along with any dependencies.</p>
<p>You can now run PHPUnit using:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ vendor/bin/phpunit
</pre></div>
</div>
</div>
<div class="section" id="using-the-phar-file">
<h3>Using the PHAR File<a class="headerlink" href="#using-the-phar-file" title="Permalink to this headline">¶</a></h3>
<p>After you have downloaded the <strong>phpunit.phar</strong> file, you can use it to run your
tests:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>php phpunit.phar
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p>As a convenience you can make phpunit.phar available globally
on Unix or Linux with the following:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>chmod +x phpunit.phar
sudo mv phpunit.phar /usr/local/bin/phpunit
phpunit --version
</pre></div>
</div>
<p class="last">Please refer to the PHPUnit documentation for instructions regarding
<a class="reference external" href="http://phpunit.de/manual/current/en/installation.html#installation.phar.windows">Globally installing the PHPUnit PHAR on Windows</a>.</p>
</div>
</div>
</div>
<div class="section" id="test-database-setup">
<h2>Test Database Setup<a class="headerlink" href="#test-database-setup" title="Permalink to this headline">¶</a></h2>
<p>Remember to have debug enabled in your <strong>config/app.php</strong> file before running
any tests.  Before running any tests you should be sure to add a <code class="docutils literal"><span class="pre">test</span></code>
datasource configuration to <strong>config/app.php</strong>. This configuration is used by
CakePHP for fixture tables and data:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="s1">&#39;Datasources&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;test&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;datasource&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cake\Database\Driver\Mysql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;persistent&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;dbhost&#39;</span><span class="p">,</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;dblogin&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;dbpassword&#39;</span><span class="p">,</span>
        <span class="s1">&#39;database&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test_database&#39;</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It&#8217;s a good idea to make the test database and your actual database
different databases. This will prevent embarrassing mistakes later.</p>
</div>
</div>
<div class="section" id="checking-the-test-setup">
<h2>Checking the Test Setup<a class="headerlink" href="#checking-the-test-setup" title="Permalink to this headline">¶</a></h2>
<p>After installing PHPUnit and setting up your <code class="docutils literal"><span class="pre">test</span></code> datasource configuration
you can make sure you&#8217;re ready to write and run your own tests by running your
application&#8217;s tests:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># For phpunit.phar</span>
$ php phpunit.phar

<span class="c1"># For Composer installed phpunit</span>
$ vendor/bin/phpunit
</pre></div>
</div>
<p>The above should run any tests you have, or let you know that no tests were run.
To run a specific test you can supply the path to the test as a parameter to
PHPUnit. For example, if you had a test case for ArticlesTable class you could
run it with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ vendor/bin/phpunit tests/TestCase/Model/Table/ArticlesTableTest
</pre></div>
</div>
<p>You should see a green bar with some additional information about the tests run,
and number passed.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you are on a Windows system you probably won&#8217;t see any colours.</p>
</div>
</div>
<div class="section" id="test-case-conventions">
<h2>Test Case Conventions<a class="headerlink" href="#test-case-conventions" title="Permalink to this headline">¶</a></h2>
<p>Like most things in CakePHP, test cases have some conventions. Concerning
tests:</p>
<ol class="arabic simple">
<li>PHP files containing tests should be in your
<code class="docutils literal"><span class="pre">tests/TestCase/[Type]</span></code> directories.</li>
<li>The filenames of these files should end in <strong>Test.php</strong> instead
of just .php.</li>
<li>The classes containing tests should extend <code class="docutils literal"><span class="pre">Cake\TestSuite\TestCase</span></code>,
<code class="docutils literal"><span class="pre">Cake\TestSuite\IntegrationTestCase</span></code> or <code class="docutils literal"><span class="pre">\PHPUnit\Framework\TestCase</span></code>.</li>
<li>Like other classnames, the test case classnames should match the filename.
<strong>RouterTest.php</strong> should contain <code class="docutils literal"><span class="pre">class</span> <span class="pre">RouterTest</span> <span class="pre">extends</span> <span class="pre">TestCase</span></code>.</li>
<li>The name of any method containing a test (i.e. containing an
assertion) should begin with <code class="docutils literal"><span class="pre">test</span></code>, as in <code class="docutils literal"><span class="pre">testPublished()</span></code>.
You can also use the <code class="docutils literal"><span class="pre">&#64;test</span></code> annotation to mark methods as test methods.</li>
</ol>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.4.1: </span>Support for PHPUnit 6 was addded. If you&#8217;re using a PHPUnit version lower
than 5.7.0, your tests classes should either extends CakePHP&#8217;s classes or
<code class="docutils literal"><span class="pre">PHPUnit_Framework_TestCase</span></code>.</p>
</div>
</div>
<div class="section" id="creating-your-first-test-case">
<h2>Creating Your First Test Case<a class="headerlink" href="#creating-your-first-test-case" title="Permalink to this headline">¶</a></h2>
<p>In the following example, we&#8217;ll create a test case for a very simple helper
method. The helper we&#8217;re going to test will be formatting progress bar HTML.
Our helper looks like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\View\Helper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\View\Helper</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProgressHelper</span> <span class="k">extends</span> <span class="nx">Helper</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$width</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nv">$value</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span>
            <span class="s1">&#39;&lt;div class=&quot;progress-container&quot;&gt;</span>
<span class="s1">                &lt;div class=&quot;progress-bar&quot; style=&quot;width: %s%%&quot;&gt;&lt;/div&gt;</span>
<span class="s1">            &lt;/div&gt;&#39;</span><span class="p">,</span> <span class="nv">$width</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is a very simple example, but it will be useful to show how you can create
a simple test case. After creating and saving our helper, we&#8217;ll create the test
case file in <strong>tests/TestCase/View/Helper/ProgressHelperTest.php</strong>. In that file
we&#8217;ll start with the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\View\Helper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\View\Helper\ProgressHelper</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\View\View</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProgressHelperTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBar</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We&#8217;ll flesh out this skeleton in a minute. We&#8217;ve added two methods to start
with. First is <code class="docutils literal"><span class="pre">setUp()</span></code>. This method is called before every <em>test</em> method
in a test case class. Setup methods should initialize the objects needed for the
test, and do any configuration needed. In our setup method we&#8217;ll add the
following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
    <span class="nv">$View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Progress</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProgressHelper</span><span class="p">(</span><span class="nv">$View</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Calling the parent method is important in test cases, as <code class="docutils literal"><span class="pre">TestCase::setUp()</span></code>
does a number things like backing up the values in
<a class="reference internal" href="configuration.html#Cake\Core\Configure" title="Cake\Core\Configure"><code class="xref php php-class docutils literal"><span class="pre">Core\Configure</span></code></a> and, storing the paths in
<a class="reference internal" href="../core-libraries/app.html#Cake\Core\App" title="Cake\Core\App"><code class="xref php php-class docutils literal"><span class="pre">Core\App</span></code></a>.</p>
<p>Next, we&#8217;ll fill out the test method. We&#8217;ll use some assertions to ensure that
our code creates the output we expect:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testBar</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Progress</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">(</span><span class="mi">90</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;width: 90%&#39;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;progress-bar&#39;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>

    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Progress</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">(</span><span class="mf">33.3333333</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;width: 33%&#39;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above test is a simple one but shows the potential benefit of using test
cases. We use <code class="docutils literal"><span class="pre">assertContains()</span></code> to ensure that our helper is returning a
string that contains the content we expect. If the result did not contain the
expected content the test would fail, and we would know that our code is
incorrect.</p>
<p>By using test cases you can describe the relationship between a set of
known inputs and their expected output. This helps you be more confident of the
code you&#8217;re writing as you can ensure that the code you wrote fulfills the
expectations and assertions your tests make. Additionally because tests are
code, they are easy to re-run whenever you make a change. This helps prevent
the creation of new bugs.</p>
</div>
<div class="section" id="running-tests">
<span id="id1"></span><h2>Running Tests<a class="headerlink" href="#running-tests" title="Permalink to this headline">¶</a></h2>
<p>Once you have PHPUnit installed and some test cases written, you&#8217;ll want to run
the test cases very frequently. It&#8217;s a good idea to run tests before committing
any changes to help ensure you haven&#8217;t broken anything.</p>
<p>By using <code class="docutils literal"><span class="pre">phpunit</span></code> you can run your application tests. To run your
application&#8217;s tests you can simply run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># composer installs</span>
$ vendor/bin/phpunit

<span class="c1"># phar file</span>
php phpunit.phar
</pre></div>
</div>
<p>If you have cloned the <a class="reference external" href="https://github.com/cakephp/cakephp">CakePHP source from GitHub</a>
and wish to run CakePHP&#8217;s unit-tests don&#8217;t forget to execute the following <code class="docutils literal"><span class="pre">Composer</span></code>
command prior to running <code class="docutils literal"><span class="pre">phpunit</span></code> so that any dependencies are installed:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ composer install --dev
</pre></div>
</div>
<p>From your application&#8217;s root directory. To run tests for a plugin that is part
of your application source, first <code class="docutils literal"><span class="pre">cd</span></code> into the plugin directory, then use
<code class="docutils literal"><span class="pre">phpunit</span></code> command that matches how you installed phpunit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> plugins

<span class="c1"># Using composer installed phpunit</span>
../vendor/bin/phpunit

<span class="c1"># Using phar file</span>
php ../phpunit.phar
</pre></div>
</div>
<p>To run tests on a standalone plugin, you should first install the project in
a separate directory and install its dependencies:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone git://github.com/cakephp/debug_kit.git
<span class="nb">cd</span> debug_kit
php ~/composer.phar install
php ~/phpunit.phar
</pre></div>
</div>
<div class="section" id="filtering-test-cases">
<h3>Filtering Test Cases<a class="headerlink" href="#filtering-test-cases" title="Permalink to this headline">¶</a></h3>
<p>When you have larger test cases, you will often want to run a subset of the test
methods when you are trying to work on a single failing case. With the
CLI runner you can use an option to filter test methods:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ phpunit --filter testSave tests/TestCase/Model/Table/ArticlesTableTest
</pre></div>
</div>
<p>The filter parameter is used as a case-sensitive regular expression for
filtering which test methods to run.</p>
</div>
<div class="section" id="generating-code-coverage">
<h3>Generating Code Coverage<a class="headerlink" href="#generating-code-coverage" title="Permalink to this headline">¶</a></h3>
<p>You can generate code coverage reports from the command line using PHPUnit&#8217;s
built-in code coverage tools. PHPUnit will generate a set of static HTML files
containing the coverage results. You can generate coverage for a test case by
doing the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ phpunit --coverage-html webroot/coverage tests/TestCase/Model/Table/ArticlesTableTest
</pre></div>
</div>
<p>This will put the coverage results in your application&#8217;s webroot directory. You
should be able to view the results by going to
<code class="docutils literal"><span class="pre">http://localhost/your_app/coverage</span></code>.</p>
<p>If you are using PHP 5.6.0 or greater, you can use <a class="reference external" href="http://phpdbg.com/">phpdbg</a>
to generate coverage instead of xdebug. <code class="docutils literal"><span class="pre">phpdbg</span></code> is generally faster at
generating coverage:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ phpdbg -qrr phpunit --coverage-html webroot/coverage tests/TestCase/Model/Table/ArticlesTableTest
</pre></div>
</div>
</div>
<div class="section" id="combining-test-suites-for-plugins">
<h3>Combining Test Suites for Plugins<a class="headerlink" href="#combining-test-suites-for-plugins" title="Permalink to this headline">¶</a></h3>
<p>Often times your application will be composed of several plugins. In these
situations it can be pretty tedious to run tests for each plugin. You can make
running tests for each of the plugins that compose your application by adding
additional <code class="docutils literal"><span class="pre">&lt;testsuite&gt;</span></code> sections to your application&#8217;s <strong>phpunit.xml.dist</strong>
file:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;testsuites&gt;</span>
    <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;App Test Suite&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;directory&gt;</span>./tests/TestCase<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;/testsuite&gt;</span>

    <span class="c">&lt;!-- Add your plugin suites --&gt;</span>
    <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Forum plugin&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;directory&gt;</span>./plugins/Forum/tests/TestCase<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre></div>
</div>
<p>Any additional test suites added to the <code class="docutils literal"><span class="pre">&lt;testsuites&gt;</span></code> element will
automatically be run when you use <code class="docutils literal"><span class="pre">phpunit</span></code>.</p>
<p>If you are using <code class="docutils literal"><span class="pre">&lt;testsuites&gt;</span></code> to use fixtures from plugins that you have
installed with composer, the plugin&#8217;s <code class="docutils literal"><span class="pre">composer.json</span></code> file should add the
fixture namespace to the autoload section. Example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="s2">&quot;autoload&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;psr-4&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;PluginName</span><span class="se">\\</span><span class="s2">Test</span><span class="se">\\</span><span class="s2">Fixture</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">:</span> <span class="s2">&quot;tests</span><span class="se">\\</span><span class="s2">Fixture&quot;</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="test-case-lifecycle-callbacks">
<h2>Test Case Lifecycle Callbacks<a class="headerlink" href="#test-case-lifecycle-callbacks" title="Permalink to this headline">¶</a></h2>
<p>Test cases have a number of lifecycle callbacks you can use when doing testing:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">setUp</span></code> is called before every test method. Should be used to create the
objects that are going to be tested, and initialize any data for the test.
Always remember to call <code class="docutils literal"><span class="pre">parent::setUp()</span></code></li>
<li><code class="docutils literal"><span class="pre">tearDown</span></code> is called after every test method. Should be used to cleanup after
the test is complete. Always remember to call <code class="docutils literal"><span class="pre">parent::tearDown()</span></code>.</li>
<li><code class="docutils literal"><span class="pre">setupBeforeClass</span></code> is called once before test methods in a case are started.
This method must be <em>static</em>.</li>
<li><code class="docutils literal"><span class="pre">tearDownAfterClass</span></code> is called once after test methods in a case are started.
This method must be <em>static</em>.</li>
</ul>
</div>
<div class="section" id="fixtures">
<span id="test-fixtures"></span><h2>Fixtures<a class="headerlink" href="#fixtures" title="Permalink to this headline">¶</a></h2>
<p>When testing code that depends on models and the database, one can use
<strong>fixtures</strong> as a way to generate temporary data tables loaded with sample data
that can be used by the test. The benefit of using fixtures is that your test
has no chance of disrupting live application data. In addition, you can begin
testing your code prior to actually developing live content for an application.</p>
<p>CakePHP uses the connection named <code class="docutils literal"><span class="pre">test</span></code> in your <strong>config/app.php</strong>
configuration file. If this connection is not usable, an exception will be
raised and you will not be able to use database fixtures.</p>
<p>CakePHP performs the following during the course of a fixture based
test case:</p>
<ol class="arabic simple">
<li>Creates tables for each of the fixtures needed.</li>
<li>Populates tables with data, if data is provided in fixture.</li>
<li>Runs test methods.</li>
<li>Empties the fixture tables.</li>
<li>Removes fixture tables from database.</li>
</ol>
<div class="section" id="test-connections">
<h3>Test Connections<a class="headerlink" href="#test-connections" title="Permalink to this headline">¶</a></h3>
<p>By default CakePHP will alias each connection in your application. Each
connection defined in your application&#8217;s bootstrap that does not start with
<code class="docutils literal"><span class="pre">test_</span></code> will have a <code class="docutils literal"><span class="pre">test_</span></code> prefixed alias created. Aliasing connections
ensures, you don&#8217;t accidentally use the wrong connection in test cases.
Connection aliasing is transparent to the rest of your application. For example
if you use the &#8216;default&#8217; connection, instead you will get the <code class="docutils literal"><span class="pre">test</span></code>
connection in test cases. If you use the &#8216;replica&#8217; connection, the test suite
will attempt to use &#8216;test_replica&#8217;.</p>
</div>
<div class="section" id="creating-fixtures">
<h3>Creating Fixtures<a class="headerlink" href="#creating-fixtures" title="Permalink to this headline">¶</a></h3>
<p>When creating a fixture you will mainly define two things: how the table is
created (which fields are part of the table), and which records will be
initially populated to the table. Let&#8217;s create our first fixture, that will be
used to test our own Article model. Create a file named <strong>ArticlesFixture.php</strong>
in your <strong>tests/Fixture</strong> directory, with the following content:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\Fixture</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\TestSuite\Fixture\TestFixture</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>

      <span class="c1">// Optional. Set this property to load fixtures to a different test datasource</span>
      <span class="k">public</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">;</span>

      <span class="k">public</span> <span class="nv">$fields</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">],</span>
          <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">],</span>
          <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
          <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">],</span>
          <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
          <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
          <span class="s1">&#39;_constraints&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
          <span class="p">]</span>
      <span class="p">];</span>
      <span class="k">public</span> <span class="nv">$records</span> <span class="o">=</span> <span class="p">[</span>
          <span class="p">[</span>
              <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article&#39;</span><span class="p">,</span>
              <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article Body&#39;</span><span class="p">,</span>
              <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:39:23&#39;</span><span class="p">,</span>
              <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:41:31&#39;</span>
          <span class="p">],</span>
          <span class="p">[</span>
              <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article&#39;</span><span class="p">,</span>
              <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article Body&#39;</span><span class="p">,</span>
              <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:41:23&#39;</span><span class="p">,</span>
              <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:43:31&#39;</span>
          <span class="p">],</span>
          <span class="p">[</span>
              <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article&#39;</span><span class="p">,</span>
              <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article Body&#39;</span><span class="p">,</span>
              <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:43:23&#39;</span><span class="p">,</span>
              <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:45:31&#39;</span>
          <span class="p">]</span>
      <span class="p">];</span>
 <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is recommended to not manually add values to auto incremental columns,
as it interferes with the sequence generation in PostgreSQL and SQLServer.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">$connection</span></code> property defines the datasource of which the fixture will
use.  If your application uses multiple datasources, you should make the
fixtures match the model&#8217;s datasources but prefixed with <code class="docutils literal"><span class="pre">test_</span></code>.
For example if your model uses the <code class="docutils literal"><span class="pre">mydb</span></code> datasource, your fixture should use
the <code class="docutils literal"><span class="pre">test_mydb</span></code> datasource. If the <code class="docutils literal"><span class="pre">test_mydb</span></code> connection doesn&#8217;t exist,
your models will use the default <code class="docutils literal"><span class="pre">test</span></code> datasource. Fixture datasources must
be prefixed with <code class="docutils literal"><span class="pre">test</span></code> to reduce the possibility of accidentally truncating
all your application&#8217;s data when running tests.</p>
<p>We use <code class="docutils literal"><span class="pre">$fields</span></code> to specify which fields will be part of this table, and how
they are defined. The format used to define these fields is the same used with
<code class="xref php php-class docutils literal"><span class="pre">Cake\Database\Schema\Table</span></code>. The keys available for table
definition are:</p>
<dl class="docutils">
<dt>type</dt>
<dd><p class="first">CakePHP internal data type. Currently supported:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">string</span></code>: maps to <code class="docutils literal"><span class="pre">VARCHAR</span></code> or <code class="docutils literal"><span class="pre">CHAR</span></code></li>
<li><code class="docutils literal"><span class="pre">uuid</span></code>: maps to <code class="docutils literal"><span class="pre">UUID</span></code></li>
<li><code class="docutils literal"><span class="pre">text</span></code>: maps to <code class="docutils literal"><span class="pre">TEXT</span></code></li>
<li><code class="docutils literal"><span class="pre">integer</span></code>: maps to <code class="docutils literal"><span class="pre">INT</span></code></li>
<li><code class="docutils literal"><span class="pre">biginteger</span></code>: maps to <code class="docutils literal"><span class="pre">BIGINTEGER</span></code></li>
<li><code class="docutils literal"><span class="pre">decimal</span></code>: maps to <code class="docutils literal"><span class="pre">DECIMAL</span></code></li>
<li><code class="docutils literal"><span class="pre">float</span></code>: maps to <code class="docutils literal"><span class="pre">FLOAT</span></code></li>
<li><code class="docutils literal"><span class="pre">datetime</span></code>: maps to <code class="docutils literal"><span class="pre">DATETIME</span></code></li>
<li><code class="docutils literal"><span class="pre">timestamp</span></code>: maps to <code class="docutils literal"><span class="pre">TIMESTAMP</span></code></li>
<li><code class="docutils literal"><span class="pre">time</span></code>: maps to <code class="docutils literal"><span class="pre">TIME</span></code></li>
<li><code class="docutils literal"><span class="pre">date</span></code>: maps to <code class="docutils literal"><span class="pre">DATE</span></code></li>
<li><code class="docutils literal"><span class="pre">binary</span></code>: maps to <code class="docutils literal"><span class="pre">BLOB</span></code></li>
</ul>
</dd>
<dt>fixed</dt>
<dd>Used with string types to create CHAR columns in platforms that support
them.</dd>
<dt>length</dt>
<dd>Set to the specific length the field should take.</dd>
<dt>precision</dt>
<dd>Set the number of decimal places used on float &amp; decimal fields.</dd>
<dt>null</dt>
<dd>Set to either <code class="docutils literal"><span class="pre">true</span></code> (to allow NULLs) or <code class="docutils literal"><span class="pre">false</span></code> (to disallow NULLs).</dd>
<dt>default</dt>
<dd>Default value the field takes.</dd>
</dl>
<p>We can define a set of records that will be populated after the fixture table is
created. The format is fairly straight forward, <code class="docutils literal"><span class="pre">$records</span></code> is an array of
records. Each item in <code class="docutils literal"><span class="pre">$records</span></code> should be a single row. Inside each row,
should be an associative array of the columns and values for the row. Just keep
in mind that each record in the $records array must have a key for <strong>every</strong>
field specified in the <code class="docutils literal"><span class="pre">$fields</span></code> array. If a field for a particular record
needs to have a <code class="docutils literal"><span class="pre">null</span></code> value, just specify the value of that key as <code class="docutils literal"><span class="pre">null</span></code>.</p>
</div>
<div class="section" id="dynamic-data-and-fixtures">
<h3>Dynamic Data and Fixtures<a class="headerlink" href="#dynamic-data-and-fixtures" title="Permalink to this headline">¶</a></h3>
<p>Since records for a fixture are declared as a class property, you cannot use
functions or other dynamic data to define fixtures. To solve this problem, you
can define <code class="docutils literal"><span class="pre">$records</span></code> in the <code class="docutils literal"><span class="pre">init()</span></code> function of your fixture. For example
if you wanted all the created and modified timestamps to reflect today&#8217;s date
you could do the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\Fixture</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\TestSuite\Fixture\TestFixture</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">],</span>
        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">],</span>
        <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
        <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">],</span>
        <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_constraints&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]],</span>
        <span class="p">]</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">init</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">records</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article&#39;</span><span class="p">,</span>
                <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article Body&#39;</span><span class="p">,</span>
                <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">),</span>
                <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">];</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">init</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When overriding <code class="docutils literal"><span class="pre">init()</span></code> remember to always call <code class="docutils literal"><span class="pre">parent::init()</span></code>.</p>
</div>
<div class="section" id="importing-table-information">
<h3>Importing Table Information<a class="headerlink" href="#importing-table-information" title="Permalink to this headline">¶</a></h3>
<p>Defining the schema in fixture files can be really handy when creating plugins
or libraries or if you are creating an application that needs to be portable
between database vendors. Redefining the schema in fixtures can become difficult
to maintain in larger applications. Because of this CakePHP provides the ability
to import the schema from an existing connection and use the reflected table
definition to create the table definition used in the test suite.</p>
<p>Let&#8217;s start with an example. Assuming you have a table named articles available
in your application, change the example fixture given in the previous section
(<strong>tests/Fixture/ArticlesFixture.php</strong>) to:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$import</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;articles&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to use a different connection use:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$import</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;articles&#39;</span><span class="p">,</span> <span class="s1">&#39;connection&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;other&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.1.7.</span></p>
</div>
<p>Usually, you have a Table class along with your fixture, as well. You can also
use that to retrieve the table name:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$import</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Articles&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Since this uses <code class="docutils literal"><span class="pre">TableRegistry::get()</span></code>, it also supports plugin syntax.</p>
<p>You can naturally import your table definition from an existing model/table, but
have your records defined directly on the fixture as it was shown on previous
section. For example:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$import</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;articles&#39;</span><span class="p">];</span>
    <span class="k">public</span> <span class="nv">$records</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article&#39;</span><span class="p">,</span>
          <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article Body&#39;</span><span class="p">,</span>
          <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
          <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:39:23&#39;</span><span class="p">,</span>
          <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:41:31&#39;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article&#39;</span><span class="p">,</span>
          <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article Body&#39;</span><span class="p">,</span>
          <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
          <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:41:23&#39;</span><span class="p">,</span>
          <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:43:31&#39;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article&#39;</span><span class="p">,</span>
          <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article Body&#39;</span><span class="p">,</span>
          <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
          <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:43:23&#39;</span><span class="p">,</span>
          <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:45:31&#39;</span>
        <span class="p">]</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Finally, it&#8217;s possible to not load/create any schema in a fixture. This is useful if you
already have a test database setup with all the empty tables created. By
defining neither <code class="docutils literal"><span class="pre">$fields</span></code> nor <code class="docutils literal"><span class="pre">$import</span></code>, a fixture will only insert its
records and truncate the records on each test method.</p>
</div>
<div class="section" id="loading-fixtures-in-your-test-cases">
<h3>Loading Fixtures in your Test Cases<a class="headerlink" href="#loading-fixtures-in-your-test-cases" title="Permalink to this headline">¶</a></h3>
<p>After you&#8217;ve created your fixtures, you&#8217;ll want to use them in your test cases.
In each test case you should load the fixtures you will need. You should load a
fixture for every model that will have a query run against it. To load fixtures
you define the <code class="docutils literal"><span class="pre">$fixtures</span></code> property in your model:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">,</span> <span class="s1">&#39;app.comments&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above will load the Article and Comment fixtures from the application&#8217;s
Fixture directory. You can also load fixtures from CakePHP core, or plugins:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plugin.DebugKit.articles&#39;</span><span class="p">,</span> <span class="s1">&#39;plugin.MyVendorName/MyPlugin.messages&#39;</span><span class="p">,</span> <span class="s1">&#39;core.comments&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Using the <code class="docutils literal"><span class="pre">core</span></code> prefix will load fixtures from CakePHP, and using a plugin
name as the prefix, will load the fixture from the named plugin.</p>
<p>You can control when your fixtures are loaded by setting
<code class="xref php php-attr docutils literal"><span class="pre">Cake\TestSuite\TestCase::$autoFixtures</span></code> to <code class="docutils literal"><span class="pre">false</span></code> and later load
them using <code class="xref php php-meth docutils literal"><span class="pre">Cake\TestSuite\TestCase::loadFixtures()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">,</span> <span class="s1">&#39;app.comments&#39;</span><span class="p">];</span>
    <span class="k">public</span> <span class="nv">$autoFixtures</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testMyFunction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadFixtures</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">,</span> <span class="s1">&#39;Comments&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can load fixtures in subdirectories. Using multiple directories can make it
easier to organize your fixtures if you have a larger application. To load
fixtures in subdirectories, simply include the subdirectory name in the fixture
name:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesTest</span> <span class="k">extends</span> <span class="nx">CakeTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.blog/articles&#39;</span><span class="p">,</span> <span class="s1">&#39;app.blog/comments&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the above example, both fixtures would be loaded from
<code class="docutils literal"><span class="pre">tests/Fixture/blog/</span></code>.</p>
</div>
</div>
<div class="section" id="testing-table-classes">
<h2>Testing Table Classes<a class="headerlink" href="#testing-table-classes" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s say we already have our Articles Table class defined in
<strong>src/Model/Table/ArticlesTable.php</strong>, and it looks like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\ORM\Table</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\Query</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesTable</span> <span class="k">extends</span> <span class="nx">Table</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">findPublished</span><span class="p">(</span><span class="nx">Query</span> <span class="nv">$query</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">alias</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.published&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
        <span class="p">]);</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We now want to set up a test that will test this table class. Let&#8217;s now create
a file named <strong>ArticlesTableTest.php</strong> in your <strong>tests/TestCase/Model/Table</strong> directory,
with the following contents:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Model\Table\ArticlesTable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesTableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In our test cases&#8217; variable <code class="docutils literal"><span class="pre">$fixtures</span></code> we define the set of fixtures that
we&#8217;ll use. You should remember to include all the fixtures that will have
queries run against them.</p>
<div class="section" id="creating-a-test-method">
<h3>Creating a Test Method<a class="headerlink" href="#creating-a-test-method" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s now add a method to test the function <code class="docutils literal"><span class="pre">published()</span></code> in the Articles
table. Edit the file <strong>tests/TestCase/Model/Table/ArticlesTableTest.php</strong> so it
now looks like this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Model\Table\ArticlesTable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesTableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFindPublished</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="s1">&#39;Cake\ORM\Query&#39;</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">hydrate</span><span class="p">(</span><span class="k">false</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article&#39;</span><span class="p">]</span>
        <span class="p">];</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can see we have added a method called <code class="docutils literal"><span class="pre">testFindPublished()</span></code>. We start by
creating an instance of our <code class="docutils literal"><span class="pre">ArticlesTable</span></code> class, and then run our
<code class="docutils literal"><span class="pre">find('published')</span></code> method. In <code class="docutils literal"><span class="pre">$expected</span></code> we set what we expect should be
the proper result (that we know since we have defined which records are
initially populated to the article table.) We test that the result equals our
expectation by using the <code class="docutils literal"><span class="pre">assertEquals()</span></code> method. See the <a class="reference internal" href="#running-tests"><span class="std std-ref">Running Tests</span></a>
section for more information on how to run your test case.</p>
</div>
<div class="section" id="mocking-model-methods">
<h3>Mocking Model Methods<a class="headerlink" href="#mocking-model-methods" title="Permalink to this headline">¶</a></h3>
<p>There will be times you&#8217;ll want to mock methods on models when testing them. You
should use <code class="docutils literal"><span class="pre">getMockForModel</span></code> to create testing mocks of table classes. It
avoids issues with reflected properties that normal mocks have:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testSendingEmails</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$model</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockForModel</span><span class="p">(</span><span class="s1">&#39;EmailVerification&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;send&#39;</span><span class="p">]);</span>
    <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
        <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="k">true</span><span class="p">));</span>

    <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">verifyEmail</span><span class="p">(</span><span class="s1">&#39;test@example.com&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In your <code class="docutils literal"><span class="pre">tearDown()</span></code> method be sure to remove the mock with:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">TableRegistry</span><span class="o">::</span><span class="na">clear</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="controller-integration-testing">
<span id="integration-testing"></span><h2>Controller Integration Testing<a class="headerlink" href="#controller-integration-testing" title="Permalink to this headline">¶</a></h2>
<p>While you can test controller classes in a similar fashion to Helpers, Models,
and Components, CakePHP offers a specialized <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> class.
Using this class as the base class for your controller test cases allows you to
test controllers from a high level.</p>
<p>If you are unfamiliar with integration testing, it is a testing approach that
makes it easy to test multiple units in concert. The integration testing
features in CakePHP simulate an HTTP request being handled by your application.
For example, testing your controller will also exercise any components, models
and helpers that would be involved in handling a given request. This gives you a
more high level test of your application and all its working parts.</p>
<p>Say you have a typical ArticlesController, and its corresponding model. The
controller code looks like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Controller\AppController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesController</span> <span class="k">extends</span> <span class="nx">AppController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$helpers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Form&#39;</span><span class="p">,</span> <span class="s1">&#39;Html&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nv">$short</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$article</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">newEntity</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$article</span><span class="p">))</span> <span class="p">{</span>
                <span class="c1">// Redirect as per PRG pattern</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">([</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$short</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]</span>
            <span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span>
            <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Articles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;articles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$result</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Create a file named <strong>ArticlesControllerTest.php</strong> in your
<strong>tests/TestCase/Controller</strong> directory and put the following inside:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\IntegrationTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesControllerTest</span> <span class="k">extends</span> <span class="nx">IntegrationTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
        <span class="c1">// More asserts.</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndexQueryData</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles?page=1&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
        <span class="c1">// More asserts.</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndexShort</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles/index/short&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseContains</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
        <span class="c1">// More asserts.</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndexPostData</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;slug&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;new-article&#39;</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;New Article&#39;</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;New Body&#39;</span>
        <span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/articles&#39;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseSuccess</span><span class="p">();</span>
        <span class="nv">$articles</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This example shows a few of the request sending methods and a few of the
assertions that <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> provides. Before you can do any
assertions you&#8217;ll need to dispatch a request. You can use one of the following
methods to send a request:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">get()</span></code> Sends a GET request.</li>
<li><code class="docutils literal"><span class="pre">post()</span></code> Sends a POST request.</li>
<li><code class="docutils literal"><span class="pre">put()</span></code> Sends a PUT request.</li>
<li><code class="docutils literal"><span class="pre">delete()</span></code> Sends a DELETE request.</li>
<li><code class="docutils literal"><span class="pre">patch()</span></code> Sends a PATCH request.</li>
<li><code class="docutils literal"><span class="pre">options()</span></code> Sends an OPTIONS request.</li>
<li><code class="docutils literal"><span class="pre">head()</span></code> Sends a HEAD request.</li>
</ul>
<p>All of the methods except <code class="docutils literal"><span class="pre">get()</span></code> and <code class="docutils literal"><span class="pre">delete()</span></code> accept a second parameter
that allows you to send a request body. After dispatching a request you can use
the various assertions provided by <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> or PHPUnit to
ensure your request had the correct side-effects.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.5.0: </span><code class="docutils literal"><span class="pre">options()</span></code> and <code class="docutils literal"><span class="pre">head()</span></code> were added in 3.5.0.</p>
</div>
<div class="section" id="setting-up-the-request">
<h3>Setting up the Request<a class="headerlink" href="#setting-up-the-request" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> class comes with a number of helpers to make it easy
to configure the requests you will send to your application under test:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Set cookies</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Uncle Bob&#39;</span><span class="p">);</span>

<span class="c1">// Set session data</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">([</span><span class="s1">&#39;Auth.User.id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>

<span class="c1">// Configure headers</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
    <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Accept&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>The state set by these helper methods is reset in the <code class="docutils literal"><span class="pre">tearDown()</span></code> method.</p>
</div>
<div class="section" id="testing-actions-that-require-authentication">
<span id="testing-authentication"></span><h3>Testing Actions That Require Authentication<a class="headerlink" href="#testing-actions-that-require-authentication" title="Permalink to this headline">¶</a></h3>
<p>If you are using <code class="docutils literal"><span class="pre">AuthComponent</span></code> you will need to stub out the session data
that AuthComponent uses to validate a user&#8217;s identity. You can use helper
methods in <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> to do this. Assuming you had an
<code class="docutils literal"><span class="pre">ArticlesController</span></code> that contained an add method, and that add method
required authentication, you could write the following tests:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testAddUnauthenticatedFails</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// No session data set.</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles/add&#39;</span><span class="p">);</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRedirect</span><span class="p">([</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;login&#39;</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">testAddAuthenticated</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Set session data</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">([</span>
        <span class="s1">&#39;Auth&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;User&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;testing&#39;</span><span class="p">,</span>
                <span class="c1">// other keys.</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles/add&#39;</span><span class="p">);</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
    <span class="c1">// Other assertions.</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-stateless-authentication-and-apis">
<h3>Testing Stateless Authentication and APIs<a class="headerlink" href="#testing-stateless-authentication-and-apis" title="Permalink to this headline">¶</a></h3>
<p>To test APIs that use stateless authentication, such as Basic authentication,
you can configure the request to inject environment conditions or headers that
simulate actual authentication request headers.</p>
<p>When testing Basic or Digest Authentication, you can add the environment
variables that <a class="reference external" href="http://php.net/manual/en/features.http-auth.php">PHP creates</a>
automatically. These environment variables used in the authentication adapter
outlined in <a class="reference internal" href="../controllers/components/authentication.html#basic-authentication"><span class="std std-ref">Using Basic Authentication</span></a>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicAuthentication</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
        <span class="s1">&#39;environment&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;PHP_AUTH_USER&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PHP_AUTH_PW&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]);</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/api/posts&#39;</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you are testing other forms of authentication, such as OAuth2, you can set
the Authorization header directly:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testOauthToken</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
        <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;authorization&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bearer: oauth-token&#39;</span>
        <span class="p">]</span>
    <span class="p">]);</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/api/posts&#39;</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The headers key in <code class="docutils literal"><span class="pre">configRequest()</span></code> can be used to configure any additional
HTTP headers needed for an action.</p>
</div>
<div class="section" id="testing-actions-protected-by-csrfcomponent-or-securitycomponent">
<h3>Testing Actions Protected by CsrfComponent or SecurityComponent<a class="headerlink" href="#testing-actions-protected-by-csrfcomponent-or-securitycomponent" title="Permalink to this headline">¶</a></h3>
<p>When testing actions protected by either SecurityComponent or CsrfComponent you
can enable automatic token generation to ensure your tests won&#8217;t fail due to
token mismatches:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enableCsrfToken</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enableSecurityToken</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/posts/add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Exciting news!&#39;</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It is also important to enable debug in tests that use tokens to prevent the
SecurityComponent from thinking the debug token is being used in a non-debug
environment. When testing with other methods like <code class="docutils literal"><span class="pre">requireSecure()</span></code> you
can use <code class="docutils literal"><span class="pre">configRequest()</span></code> to set the correct environment variables:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Fake out SSL connections.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
    <span class="s1">&#39;environment&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;HTTPS&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;on&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.1.2: </span>The <code class="docutils literal"><span class="pre">enableCsrfToken()</span></code> and <code class="docutils literal"><span class="pre">enableSecurityToken()</span></code> methods were added
in 3.1.2</p>
</div>
</div>
<div class="section" id="integration-testing-psr-7-middleware">
<h3>Integration Testing PSR-7 Middleware<a class="headerlink" href="#integration-testing-psr-7-middleware" title="Permalink to this headline">¶</a></h3>
<p>Integration testing can also be used to test your entire PSR-7 application and
<a class="reference internal" href="../controllers/middleware.html"><span class="doc">Middleware</span></a>. By default <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> will
auto-detect the presence of an <code class="docutils literal"><span class="pre">App\Application</span></code> class and automatically
enable integration testing of your Application. You can toggle this behavior
with the <code class="docutils literal"><span class="pre">useHttpServer()</span></code> method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Enable PSR-7 integration testing.</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">useHttpServer</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

    <span class="c1">// Disable PSR-7 integration testing.</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">useHttpServer</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>You can customize the application class name used, and the constructor
arguments, by using the <code class="docutils literal"><span class="pre">configApplication()</span></code> method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configApplication</span><span class="p">(</span><span class="s1">&#39;App\App&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">CONFIG</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After enabling the PSR-7 mode, and possibly configuring your application class,
you can use the remaining <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> features as normal.</p>
<p>You should also take care to try and use <a class="reference internal" href="configuration.html#application-bootstrap"><span class="std std-ref">Application::bootstrap()</span></a> to load
any plugins containing events/routes. Doing so will ensure that your
events/routes are connected for each test case.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.3.0: </span>PSR-7 Middleware and the <code class="docutils literal"><span class="pre">useHttpServer()</span></code> method were added in 3.3.0.</p>
</div>
</div>
<div class="section" id="testing-with-encrypted-cookies">
<h3>Testing with Encrypted Cookies<a class="headerlink" href="#testing-with-encrypted-cookies" title="Permalink to this headline">¶</a></h3>
<p>If you use the <a class="reference internal" href="../controllers/components/cookie.html#Cake\Controller\Component\CookieComponent" title="Cake\Controller\Component\CookieComponent"><code class="xref php php-class docutils literal"><span class="pre">Cake\Controller\Component\CookieComponent</span></code></a> in your
controllers, your cookies are likely encrypted. As of 3.1.7, CakePHP provides
helper methods for interacting with encrypted cookies in your test cases:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Set a cookie using AES and the default key.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookieEncrypted</span><span class="p">(</span><span class="s1">&#39;my_cookie&#39;</span><span class="p">,</span> <span class="s1">&#39;Some secret values&#39;</span><span class="p">);</span>

<span class="c1">// Assume this action modifies the cookie.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/bookmarks/index&#39;</span><span class="p">);</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCookieEncrypted</span><span class="p">(</span><span class="s1">&#39;An updated value&#39;</span><span class="p">,</span> <span class="s1">&#39;my_cookie&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.1.7: </span><code class="docutils literal"><span class="pre">assertCookieEncrypted</span></code> and <code class="docutils literal"><span class="pre">cookieEncrypted</span></code> were added in 3.1.7.</p>
</div>
</div>
<div class="section" id="testing-flash-messages">
<h3>Testing Flash Messages<a class="headerlink" href="#testing-flash-messages" title="Permalink to this headline">¶</a></h3>
<p>If you want to assert the presence of flash messages in the session and not the
rendered HTML, you can use <code class="docutils literal"><span class="pre">enableRetainFlashMessages()</span></code> in your tests to
retain flash messages in the session so you can write assertions:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enableRetainFlashMessages</span><span class="p">();</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/bookmarks/delete/9999&#39;</span><span class="p">);</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSession</span><span class="p">(</span><span class="s1">&#39;That bookmark does not exist&#39;</span><span class="p">,</span> <span class="s1">&#39;Flash.flash.0.message&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.4.7: </span><code class="docutils literal"><span class="pre">enableRetainFlashMessages()</span></code> was added in 3.4.7</p>
</div>
</div>
<div class="section" id="testing-a-json-responding-controller">
<h3>Testing a JSON Responding Controller<a class="headerlink" href="#testing-a-json-responding-controller" title="Permalink to this headline">¶</a></h3>
<p>JSON is a friendly and common format to use when building a web service.
Testing the endpoints of your web service is very simple with CakePHP. Let us
begin with a simple example controller that responds in JSON:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MarkersController</span> <span class="k">extends</span> <span class="nx">AppController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">initialize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">initialize</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadComponent</span><span class="p">(</span><span class="s1">&#39;RequestHandler&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">view</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$marker</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Markers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span>
            <span class="s1">&#39;_serialize&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">],</span>
            <span class="s1">&#39;marker&#39;</span> <span class="o">=&gt;</span> <span class="nv">$marker</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we create the file <strong>tests/TestCase/Controller/MarkersControllerTest.php</strong>
and make sure our web service is returning the proper response:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MarkersControllerTest</span> <span class="k">extends</span> <span class="nx">IntegrationTestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
            <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Accept&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">]</span>
        <span class="p">]);</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/markers/view/1.json&#39;</span><span class="p">);</span>

        <span class="c1">// Check that the response was a 200</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>

        <span class="nv">$expected</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;lng&#39;</span> <span class="o">=&gt;</span> <span class="mi">66</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span> <span class="o">=&gt;</span> <span class="mi">45</span><span class="p">],</span>
        <span class="p">];</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nx">JSON_PRETTY_PRINT</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_response</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We use the <code class="docutils literal"><span class="pre">JSON_PRETTY_PRINT</span></code> option as CakePHP&#8217;s built in JsonView will use
that option when <code class="docutils literal"><span class="pre">debug</span></code> is enabled.</p>
</div>
<div class="section" id="disabling-error-handling-middleware-in-tests">
<h3>Disabling Error Handling Middleware in Tests<a class="headerlink" href="#disabling-error-handling-middleware-in-tests" title="Permalink to this headline">¶</a></h3>
<p>When debugging tests that are failing because your application is encountering
errors it can be helpful to temporarily disable the error handling middleware to
allow the underlying error to bubble up. You can use
<code class="docutils literal"><span class="pre">disableErrorHandlerMiddleware()</span></code> to do this:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testGetMissing</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">disableErrorHandlerMiddleware</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/markers/not-there&#39;</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseCode</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the above example, the test would fail and the underlying exception message
and stack trace would be displayed instead of the rendered error page being
checked.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.5.0.</span></p>
</div>
</div>
<div class="section" id="assertion-methods">
<h3>Assertion methods<a class="headerlink" href="#assertion-methods" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> class provides a number of assertion methods that
make testing responses much simpler. Some examples are:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Check for a 2xx response code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>

<span class="c1">// Check for a 2xx/3xx response code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseSuccess</span><span class="p">();</span>

<span class="c1">// Check for a 4xx response code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseError</span><span class="p">();</span>

<span class="c1">// Check for a 5xx response code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseFailure</span><span class="p">();</span>

<span class="c1">// Check for a specific response code, e.g. 200</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseCode</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>

<span class="c1">// Check the Location header</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRedirect</span><span class="p">([</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Articles&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>

<span class="c1">// Check that no Location header has been set</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNoRedirect</span><span class="p">();</span>

<span class="c1">// Check a part of the Location header</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRedirectContains</span><span class="p">(</span><span class="s1">&#39;/articles/edit/&#39;</span><span class="p">);</span>

<span class="c1">// Assert not empty response content</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseNotEmpty</span><span class="p">();</span>

<span class="c1">// Assert empty response content</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseEmpty</span><span class="p">();</span>

<span class="c1">// Assert response content</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseEquals</span><span class="p">(</span><span class="s1">&#39;Yeah!&#39;</span><span class="p">);</span>

<span class="c1">// Assert partial response content</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseContains</span><span class="p">(</span><span class="s1">&#39;You won!&#39;</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseNotContains</span><span class="p">(</span><span class="s1">&#39;You lost!&#39;</span><span class="p">);</span>

<span class="c1">// Assert layout</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertLayout</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="c1">// Assert which template was rendered (if any)</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTemplate</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>

<span class="c1">// Assert data in the session</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSession</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Auth.User.id&#39;</span><span class="p">);</span>

<span class="c1">// Assert response header.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">);</span>

<span class="c1">// Assert view variables</span>
<span class="nv">$user</span> <span class="o">=</span>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">viewVariable</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;jose&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">);</span>

<span class="c1">// Assert cookies in the response</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCookie</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;thingid&#39;</span><span class="p">);</span>

<span class="c1">// Check the content type</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContentType</span><span class="p">(</span><span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>In addition to the above assertion methods, you can also use all of the
assertions in <a class="reference external" href="https://api.cakephp.org/3.x/class-Cake.TestSuite.TestCase.html">TestSuite</a> and those
found in <a class="reference external" href="https://phpunit.de/manual/current/en/appendixes.assertions.html">PHPUnit</a>.</p>
</div>
<div class="section" id="comparing-test-results-to-a-file">
<h3>Comparing test results to a file<a class="headerlink" href="#comparing-test-results-to-a-file" title="Permalink to this headline">¶</a></h3>
<p>For some types of test, it may be easier to compare the result of a test to the
contents of a file - for example, when testing the rendered output of a view.
The <code class="docutils literal"><span class="pre">StringCompareTrait</span></code> adds a simple assert method for this purpose.</p>
<p>Usage involves using the trait, setting the comparison base path and calling
<code class="docutils literal"><span class="pre">assertSameAsFile</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Cake\TestSuite\StringCompareTrait</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SomeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">StringCompareTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_compareBasePath</span> <span class="o">=</span> <span class="nx">APP</span> <span class="o">.</span> <span class="s1">&#39;tests&#39;</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">&#39;comparisons&#39;</span> <span class="o">.</span> <span class="nx">DS</span><span class="p">;</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSameAsFile</span><span class="p">(</span><span class="s1">&#39;example.php&#39;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above example will compare <code class="docutils literal"><span class="pre">$result</span></code> to the contents of the file
<code class="docutils literal"><span class="pre">APP/tests/comparisons/example.php</span></code>.</p>
<p>A mechanism is provided to write/update test files, by setting the environment
variable <code class="docutils literal"><span class="pre">UPDATE_TEST_COMPARISON_FILES</span></code>, which will create and/or update test
comparison files as they are referenced:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>phpunit
...
FAILURES!
Tests: <span class="m">6</span>, Assertions: <span class="m">7</span>, Failures: <span class="m">1</span>

<span class="nv">UPDATE_TEST_COMPARISON_FILES</span><span class="o">=</span><span class="m">1</span> phpunit
...
OK <span class="o">(</span><span class="m">6</span> tests, <span class="m">7</span> assertions<span class="o">)</span>

git status
...
<span class="c1"># Changes not staged for commit:</span>
<span class="c1">#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="c1">#   (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="c1">#</span>
<span class="c1">#   modified:   tests/comparisons/example.php</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="console-integration-testing">
<span id="id2"></span><h2>Console Integration Testing<a class="headerlink" href="#console-integration-testing" title="Permalink to this headline">¶</a></h2>
<p>To make testing console applications easier, CakePHP comes with a
<code class="docutils literal"><span class="pre">ConsoleIntegrationTestCase</span></code> class that can be used to test console applications
and assert against their results.</p>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.5.0: </span>The <code class="docutils literal"><span class="pre">ConsoleIntegrationTestCase</span></code> was added.</p>
</div>
<p>To get started testing your console application, create a test case that extends
<code class="docutils literal"><span class="pre">Cake\TestSuite\ConsoleIntegrationTestCase</span></code>. This class contains a method
<code class="docutils literal"><span class="pre">exec()</span></code> that is used to execute your command. You can pass the same string
you would use in the CLI to this method.</p>
<p>Let&#8217;s start with a very simple shell, located in <strong>src/Shell/MyConsoleShell.php</strong>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Console\ConsoleOptionParser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Console\Shell</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShell</span> <span class="k">extends</span> <span class="nx">Shell</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOptionParser</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>
        <span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">setDescription</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$parser</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To write an integration test for this shell, we would create a test case in
<strong>tests/TestCase/Shell/MyConsoleShellTest.php</strong> that extends
<code class="docutils literal"><span class="pre">Cake\TestSuite\ConsoleIntegrationTestCase</span></code>. This shell doesn&#8217;t do much at the
moment, but let&#8217;s just test that our shell&#8217;s description is displayed in <code class="docutils literal"><span class="pre">stdout</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\TestSuite\ConsoleIntegrationTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShellTest</span> <span class="k">extends</span> <span class="nx">ConsoleIntegrationTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDescriptionOutput</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputContains</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Our test passes! While this is very trivial example, it shows that creating an
integration test case for console applications is quite easy. Let&#8217;s continue by
adding some subcommands and options to our shell:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Console\ConsoleOptionParser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\I18n\FrozenTime</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShell</span> <span class="k">extends</span> <span class="nx">Shell</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOptionParser</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>

        <span class="nv">$updateModifiedParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>
        <span class="nv">$updateModifiedParser</span><span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;help&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Table to update&#39;</span><span class="p">,</span>
            <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">]);</span>

        <span class="nv">$parser</span>
            <span class="o">-&gt;</span><span class="na">setDescription</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">addSubcommand</span><span class="p">(</span><span class="s1">&#39;updateModified&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;parser&#39;</span> <span class="o">=&gt;</span> <span class="nv">$updateModifiedParser</span>
            <span class="p">]);</span>

        <span class="k">return</span> <span class="nv">$parser</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateModified</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$table</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadModel</span><span class="p">(</span><span class="nv">$table</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$table</span><span class="p">}</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">update</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span>
                <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">FrozenTime</span><span class="p">()</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is a more complete shell that has a subcommand with its own parser. Let&#8217;s
test the <code class="docutils literal"><span class="pre">updateModified</span></code> subcommand. Modify your test case to the following
snippet of code:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">Cake\Test\TestCase\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Console\Shell</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\I18n\FrozenTime</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\ConsoleIntegrationTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShellTest</span> <span class="k">extends</span> <span class="nx">ConsoleIntegrationTestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">// assumes you have a UsersFixture</span>
        <span class="s1">&#39;app.users&#39;</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDescriptionOutput</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputContains</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUpdateModified</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FrozenTime</span><span class="p">(</span><span class="s1">&#39;2017-01-01 00:00:00&#39;</span><span class="p">);</span>
        <span class="nx">FrozenTime</span><span class="o">::</span><span class="na">setTestNow</span><span class="p">(</span><span class="nv">$now</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadFixtures</span><span class="p">(</span><span class="s1">&#39;Users&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console update_modified Users&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertExitCode</span><span class="p">(</span><span class="nx">Shell</span><span class="o">::</span><span class="na">CODE_SUCCESS</span><span class="p">);</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">modified</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">,</span> <span class="nv">$now</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">);</span>

        <span class="nx">FrozenTime</span><span class="o">::</span><span class="na">setTestNow</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see from the <code class="docutils literal"><span class="pre">testUpdateModified</span></code> method, we are testing that our
<code class="docutils literal"><span class="pre">update_modified</span></code> subcommand updates the table that we are passing as the first
argument. First, we assert that the shell exited with the proper status code,
<code class="docutils literal"><span class="pre">0</span></code>. Then we check that our subcommand did its work, that is, updated the
table we provided and set the <code class="docutils literal"><span class="pre">modified</span></code> column to the current time.</p>
<p>Remember, <code class="docutils literal"><span class="pre">exec()</span></code> will take the same string you type into your CLI, so you
can include options and arguments in your command string.</p>
<div class="section" id="testing-interactive-shells">
<h3>Testing Interactive Shells<a class="headerlink" href="#testing-interactive-shells" title="Permalink to this headline">¶</a></h3>
<p>Consoles are often interactive. Testing interactive shells with the
<code class="docutils literal"><span class="pre">Cake\TestSuite\ConsoleIntegrationTestCase</span></code> class only requires passing the
inputs you expect as the second parameter of <code class="docutils literal"><span class="pre">exec()</span></code>. They should be
included as an array in the order that you expect them.</p>
<p>Continuing with our example shell, let&#8217;s add an interactive subcommand. Update
the shell class to the following:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Console\ConsoleOptionParser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Console\Shell</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\I18n\FrozenTime</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShell</span> <span class="k">extends</span> <span class="nx">Shell</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOptionParser</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>

        <span class="nv">$updateModifiedParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>
        <span class="nv">$updateModifiedParser</span><span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;help&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Table to update&#39;</span><span class="p">,</span>
            <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">]);</span>

        <span class="nv">$parser</span>
            <span class="o">-&gt;</span><span class="na">setDescription</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">addSubcommand</span><span class="p">(</span><span class="s1">&#39;updateModified&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;parser&#39;</span> <span class="o">=&gt;</span> <span class="nv">$updateModifiedParser</span>
            <span class="p">])</span>
            <span class="c1">// add a new subcommand</span>
            <span class="o">-&gt;</span><span class="na">addSubcommand</span><span class="p">(</span><span class="s1">&#39;bestFramework&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$parser</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateModified</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$table</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadModel</span><span class="p">(</span><span class="nv">$table</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$table</span><span class="p">}</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">update</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span>
                <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">FrozenTime</span><span class="p">()</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// create this interactive subcommand</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bestFramework</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">out</span><span class="p">(</span><span class="s1">&#39;Hi there!&#39;</span><span class="p">);</span>

        <span class="nv">$framework</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">in</span><span class="p">(</span><span class="s1">&#39;What is the best PHP framework?&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$framework</span> <span class="o">!==</span> <span class="s1">&#39;CakePHP&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">err</span><span class="p">(</span><span class="s2">&quot;I disagree that &#39;</span><span class="si">$framework</span><span class="s2">&#39; is the best.&quot;</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_stop</span><span class="p">(</span><span class="nx">Shell</span><span class="o">::</span><span class="na">CODE_ERROR</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">out</span><span class="p">(</span><span class="s1">&#39;I agree!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now that we have an interactive subcommand, we can add a test case that tests
that we receive the proper response, and one that tests that we receive an
incorrect response. Add the following methods to
<strong>tests/TestCase/Shell/MyConsoleShellTest.php</strong>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testBestFramework</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console best_framework&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;CakePHP&#39;</span>
    <span class="p">]);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertExitCode</span><span class="p">(</span><span class="nx">Shell</span><span class="o">::</span><span class="na">CODE_SUCCESS</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputContains</span><span class="p">(</span><span class="s1">&#39;I agree!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">testBestFrameworkWrongAnswer</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console best_framework&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;my homemade framework&#39;</span>
    <span class="p">]);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertExitCode</span><span class="p">(</span><span class="nx">Shell</span><span class="o">::</span><span class="na">CODE_ERROR</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertErrorRegExp</span><span class="p">(</span><span class="s2">&quot;/I disagree that \&#39;(.+)\&#39; is the best\./&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see from the <code class="docutils literal"><span class="pre">testBestFramework</span></code>, it responds to the first input
request with &#8220;CakePHP&#8221;. Since this is the correct answer according to our
subcommand, the shell will exit successfully after outputting a response.</p>
<p>The second test case, <code class="docutils literal"><span class="pre">testBestFrameworkWrongAnswer</span></code>, provides an incorrect
answer which causes our shell to fail and exit with <code class="docutils literal"><span class="pre">1</span></code>. We also assert
that <code class="docutils literal"><span class="pre">stderr</span></code> was given our error, which includes the name of the incorrect
answer.</p>
</div>
<div class="section" id="testing-the-commandrunner">
<h3>Testing the CommandRunner<a class="headerlink" href="#testing-the-commandrunner" title="Permalink to this headline">¶</a></h3>
<p>To test shells that are dispatched using the <code class="docutils literal"><span class="pre">CommandRunner</span></code> class, enable it
in your test case with the following method:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">useCommandRunner</span><span class="p">();</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.5.0: </span>The <code class="docutils literal"><span class="pre">CommandRunner</span></code> class was added.</p>
</div>
</div>
<div class="section" id="id3">
<h3>Assertion methods<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">Cake\TestSuite\ConsoleIntegrationTestCase</span></code> class provides a number of
assertion methods that make it easy to assert against console output:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// assert that the shell exited with the expected code</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertExitCode</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>

<span class="c1">// assert that stdout contains a string</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputContains</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>

<span class="c1">// assert that stderr contains a string</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertErrorContains</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>

<span class="c1">// assert that stdout matches a regular expression</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputRegExp</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>

<span class="c1">// assert that stderr matches a regular expression</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertErrorRegExp</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="testing-views">
<h2>Testing Views<a class="headerlink" href="#testing-views" title="Permalink to this headline">¶</a></h2>
<p>Generally most applications will not directly test their HTML code. Doing so is
often results in fragile, difficult to maintain test suites that are prone to
breaking. When writing functional tests using <code class="xref php php-class docutils literal"><span class="pre">IntegrationTestCase</span></code>
you can inspect the rendered view content by setting the <code class="docutils literal"><span class="pre">return</span></code> option to
&#8216;view&#8217;. While it is possible to test view content using IntegrationTestCase,
a more robust and maintainable integration/view testing can be accomplished
using tools like <a class="reference external" href="http://seleniumhq.org">Selenium webdriver</a>.</p>
</div>
<div class="section" id="testing-components">
<h2>Testing Components<a class="headerlink" href="#testing-components" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s pretend we have a component called PagematronComponent in our application.
This component helps us set the pagination limit value across all the
controllers that use it. Here is our example component located in
<strong>src/Controller/Component/PagematronComponent.php</strong>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PagematronComponent</span> <span class="k">extends</span> <span class="nx">Component</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$controller</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setController</span><span class="p">(</span><span class="nv">$controller</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span> <span class="o">=</span> <span class="nv">$controller</span><span class="p">;</span>
        <span class="c1">// Make sure the controller is using pagination</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">startup</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setController</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getSubject</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">adjust</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="s1">&#39;short&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nv">$length</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;long&#39;</span><span class="o">:</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;medium&#39;</span><span class="o">:</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we can write tests to ensure our paginate <code class="docutils literal"><span class="pre">limit</span></code> parameter is being set
correctly by the <code class="docutils literal"><span class="pre">adjust()</span></code> method in our component. We create the file
<strong>tests/TestCase/Controller/Component/PagematronComponentTest.php</strong>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Controller\Component</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Controller\Component\PagematronComponent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Controller\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Controller\ComponentRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Event\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Http\ServerRequest</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Http\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PagematronComponentTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$component</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$controller</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="c1">// Setup our component and fake test controller</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ServerRequest</span><span class="p">();</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="s1">&#39;Cake\Controller\Controller&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">setConstructorArgs</span><span class="p">([</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">setMethods</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>
        <span class="nv">$registry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ComponentRegistry</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PagematronComponent</span><span class="p">(</span><span class="nv">$registry</span><span class="p">);</span>
        <span class="nv">$event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;Controller.startup&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="o">-&gt;</span><span class="na">startup</span><span class="p">(</span><span class="nv">$event</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdjust</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Test our adjust method with different parameter settings</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="o">-&gt;</span><span class="na">adjust</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="o">-&gt;</span><span class="na">adjust</span><span class="p">(</span><span class="s1">&#39;medium&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="o">-&gt;</span><span class="na">adjust</span><span class="p">(</span><span class="s1">&#39;long&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">tearDown</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">tearDown</span><span class="p">();</span>
        <span class="c1">// Clean up after we&#39;re done</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-helpers">
<h2>Testing Helpers<a class="headerlink" href="#testing-helpers" title="Permalink to this headline">¶</a></h2>
<p>Since a decent amount of logic resides in Helper classes, it&#8217;s
important to make sure those classes are covered by test cases.</p>
<p>First we create an example helper to test. The <code class="docutils literal"><span class="pre">CurrencyRendererHelper</span></code> will
help us display currencies in our views and for simplicity only has one method
<code class="docutils literal"><span class="pre">usd()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// src/View/Helper/CurrencyRendererHelper.php</span>
<span class="k">namespace</span> <span class="nx">App\View\Helper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\View\Helper</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CurrencyRendererHelper</span> <span class="k">extends</span> <span class="nx">Helper</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">usd</span><span class="p">(</span><span class="nv">$amount</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;USD &#39;</span> <span class="o">.</span> <span class="nb">number_format</span><span class="p">(</span><span class="nv">$amount</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here we set the decimal places to 2, decimal separator to dot, thousands
separator to comma, and prefix the formatted number with &#8216;USD&#8217; string.</p>
<p>Now we create our tests:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// tests/TestCase/View/Helper/CurrencyRendererHelperTest.php</span>

<span class="k">namespace</span> <span class="nx">App\Test\TestCase\View\Helper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\View\Helper\CurrencyRendererHelper</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\View\View</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CurrencyRendererHelperTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$helper</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="c1">// Here we instantiate our helper</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="nv">$View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CurrencyRendererHelper</span><span class="p">(</span><span class="nv">$View</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Testing the usd() function</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUsd</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;USD 5.30&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span><span class="o">-&gt;</span><span class="na">usd</span><span class="p">(</span><span class="mf">5.30</span><span class="p">));</span>

        <span class="c1">// We should always have 2 decimal digits</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;USD 1.00&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span><span class="o">-&gt;</span><span class="na">usd</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;USD 2.05&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span><span class="o">-&gt;</span><span class="na">usd</span><span class="p">(</span><span class="mf">2.05</span><span class="p">));</span>

        <span class="c1">// Testing the thousands separator</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
          <span class="s1">&#39;USD 12,000.70&#39;</span><span class="p">,</span>
          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span><span class="o">-&gt;</span><span class="na">usd</span><span class="p">(</span><span class="mf">12000.70</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here, we call <code class="docutils literal"><span class="pre">usd()</span></code> with different parameters and tell the test suite to
check if the returned values are equal to what is expected.</p>
<p>Save this and execute the test. You should see a green bar and messaging
indicating 1 pass and 4 assertions.</p>
<p>When you are testing a Helper which uses other helpers, be sure to mock the
View clases <code class="docutils literal"><span class="pre">loadHelpers</span></code> method.</p>
</div>
<div class="section" id="testing-events">
<span id="id4"></span><h2>Testing Events<a class="headerlink" href="#testing-events" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../core-libraries/events.html"><span class="doc">Events System</span></a> is a great way to decouple your application
code, but sometimes when testing, you tend to test the results of events in the
test cases that execute those events. This is an additional form of coupling
that can be removed by using <code class="docutils literal"><span class="pre">assertEventFired</span></code> and <code class="docutils literal"><span class="pre">assertEventFiredWith</span></code>
instead.</p>
<p>Expanding on the Orders example, say we have the following tables:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OrdersTable</span> <span class="k">extends</span> <span class="nx">Table</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">place</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$order</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// moved cart removal to CartsTable</span>
            <span class="nv">$event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;Model.Order.afterPlace&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="nv">$order</span>
            <span class="p">]);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$event</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">CartsTable</span> <span class="k">extends</span> <span class="nx">Table</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">implementedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;Model.Order.afterPlace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;removeFromCart&#39;</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">removeFromCart</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$order</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">cart_id</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To assert that events are fired, you must first enable
<a class="reference internal" href="../core-libraries/events.html#tracking-events"><span class="std std-ref">Tracking Events</span></a> on the event manager you wish to assert against.</p>
</div>
<p>To test the <code class="docutils literal"><span class="pre">OrdersTable</span></code> above, we enable tracking in <code class="docutils literal"><span class="pre">setUp()</span></code> then assert
that the event was fired, and assert that the <code class="docutils literal"><span class="pre">$order</span></code> entity was passed in
the event data:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Model\Table\OrdersTable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Event\EventList</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrdersTableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.orders&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Orders&#39;</span><span class="p">);</span>
        <span class="c1">// enable event tracking</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">setEventList</span><span class="p">(</span><span class="k">new</span> <span class="nx">EventList</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPlace</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$order</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Order</span><span class="p">([</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;item&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cake&#39;</span><span class="p">,</span>
            <span class="s1">&#39;quantity&#39;</span> <span class="o">=&gt;</span> <span class="mi">42</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span><span class="o">-&gt;</span><span class="na">place</span><span class="p">(</span><span class="nv">$order</span><span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEventFired</span><span class="p">(</span><span class="s1">&#39;Model.Order.afterPlace&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEventFiredWith</span><span class="p">(</span><span class="s1">&#39;Model.Order.afterPlace&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="nv">$order</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>By default, the global <code class="docutils literal"><span class="pre">EventManager</span></code> is used for assertions, so testing
global events does not require passing the event manager:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEventFired</span><span class="p">(</span><span class="s1">&#39;My.Global.Event&#39;</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEventFiredWith</span><span class="p">(</span><span class="s1">&#39;My.Global.Event&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">New in version 3.2.11: </span>Event tracking, <code class="docutils literal"><span class="pre">assertEventFired()</span></code>, and <code class="docutils literal"><span class="pre">assertEventFiredWith</span></code> were
added.</p>
</div>
</div>
<div class="section" id="creating-test-suites">
<h2>Creating Test Suites<a class="headerlink" href="#creating-test-suites" title="Permalink to this headline">¶</a></h2>
<p>If you want several of your tests to run at the same time, you can create a test
suite. A test suite is composed of several test cases.  You can either create
test suites in your application&#8217;s <strong>phpunit.xml</strong> file. A simple example
would be:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;testsuites&gt;</span>
  <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Models&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;directory&gt;</span>src/Model<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;file&gt;</span>src/Service/UserServiceTest.php<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;exclude&gt;</span>src/Model/Cloud/ImagesTest.php<span class="nt">&lt;/exclude&gt;</span>
  <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-tests-for-plugins">
<h2>Creating Tests for Plugins<a class="headerlink" href="#creating-tests-for-plugins" title="Permalink to this headline">¶</a></h2>
<p>Tests for plugins are created in their own directory inside the plugins
folder.</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="o">/</span><span class="nx">src</span>
<span class="o">/</span><span class="nx">plugins</span>
    <span class="o">/</span><span class="nx">Blog</span>
        <span class="o">/</span><span class="nx">tests</span>
            <span class="o">/</span><span class="nx">TestCase</span>
            <span class="o">/</span><span class="nx">Fixture</span>
</pre></div>
</div>
<p>They work just like normal tests but you have to remember to use the naming
conventions for plugins when importing classes. This is an example of a testcase
for the <code class="docutils literal"><span class="pre">BlogPost</span></code> model from the plugins chapter of this manual. A difference
from other tests is in the first line where &#8216;Blog.BlogPost&#8217; is imported. You
also need to prefix your plugin fixtures with <code class="docutils literal"><span class="pre">plugin.blog.blog_posts</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">Blog\Test\TestCase\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Blog\Model\Table\BlogPostsTable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BlogPostsTableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>

    <span class="c1">// Plugin fixtures located in /plugins/Blog/tests/Fixture/</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plugin.blog.blog_posts&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Test something.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you want to use plugin fixtures in the app tests you can
reference them using <code class="docutils literal"><span class="pre">plugin.pluginName.fixtureName</span></code> syntax in the
<code class="docutils literal"><span class="pre">$fixtures</span></code> array.</p>
<p>Before you can use fixtures you should double check that your <code class="docutils literal"><span class="pre">phpunit.xml</span></code>
contains the fixture listener:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="o">&lt;!--</span> <span class="nx">Setup</span> <span class="nx">a</span> <span class="nx">listener</span> <span class="k">for</span> <span class="nx">fixtures</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">listeners</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">listener</span>
    <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;\Cake</span><span class="se">\T</span><span class="s2">estSuite\Fixture\FixtureInjector&quot;</span>
    <span class="nb">file</span><span class="o">=</span><span class="s2">&quot;./vendor/cakephp/cakephp/src/TestSuite/Fixture/FixtureInjector.php&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">arguments</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">object</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;\Cake</span><span class="se">\T</span><span class="s2">estSuite\Fixture\FixtureManager&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;/</span><span class="nx">arguments</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="nx">listener</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">listeners</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>You should also ensure that your fixtures are loadable. Ensure the following is
present in your <strong>composer.json</strong> file:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="s2">&quot;autoload-dev&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;psr-4&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;MyPlugin</span><span class="se">\\</span><span class="s2">Test</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">:</span> <span class="s2">&quot;./plugins/MyPlugin/tests&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Remember to run <code class="docutils literal"><span class="pre">composer.phar</span> <span class="pre">dumpautoload</span></code> when adding new autoload
mappings.</p>
</div>
</div>
<div class="section" id="generating-tests-with-bake">
<h2>Generating Tests with Bake<a class="headerlink" href="#generating-tests-with-bake" title="Permalink to this headline">¶</a></h2>
<p>If you use <a class="reference internal" href="../bake/usage.html"><span class="doc">bake</span></a> to
generate scaffolding, it will also generate test stubs. If you need to
re-generate test case skeletons, or if you want to generate test skeletons for
code you wrote, you can use <code class="docutils literal"><span class="pre">bake</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>bin/cake bake <span class="nb">test</span> &lt;type&gt; &lt;name&gt;
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;type&gt;</span></code> should be one of:</p>
<ol class="arabic simple">
<li>Entity</li>
<li>Table</li>
<li>Controller</li>
<li>Component</li>
<li>Behavior</li>
<li>Helper</li>
<li>Shell</li>
<li>Cell</li>
</ol>
<p>While <code class="docutils literal"><span class="pre">&lt;name&gt;</span></code> should be the name of the object you want to bake a test
skeleton for.</p>
</div>
<div class="section" id="integration-with-jenkins">
<h2>Integration with Jenkins<a class="headerlink" href="#integration-with-jenkins" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="http://jenkins-ci.org">Jenkins</a> is a continuous integration server, that can
help you automate the running of your test cases. This helps ensure that all
your tests stay passing and your application is always ready.</p>
<p>Integrating a CakePHP application with Jenkins is fairly straightforward. The
following assumes you&#8217;ve already installed Jenkins on *nix system, and are able
to administer it. You also know how to create jobs, and run builds. If you are
unsure of any of these, refer to the <a class="reference external" href="http://jenkins-ci.org/">Jenkins documentation</a> .</p>
<div class="section" id="create-a-job">
<h3>Create a Job<a class="headerlink" href="#create-a-job" title="Permalink to this headline">¶</a></h3>
<p>Start off by creating a job for your application, and connect your repository
so that jenkins can access your code.</p>
</div>
<div class="section" id="add-test-database-config">
<h3>Add Test Database Config<a class="headerlink" href="#add-test-database-config" title="Permalink to this headline">¶</a></h3>
<p>Using a separate database just for Jenkins is generally a good idea, as it stops
bleed through and avoids a number of basic problems. Once you&#8217;ve created a new
database in a database server that jenkins can access (usually localhost). Add
a <em>shell script step</em> to the build that contains the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cat &gt; config/app_local.php <span class="s">&lt;&lt;&#39;CONFIG&#39;</span>
<span class="s">&lt;?php</span>
<span class="s">return [</span>
<span class="s">    &#39;Datasources&#39; =&gt; [</span>
<span class="s">        &#39;test&#39; =&gt; [</span>
<span class="s">            &#39;datasource&#39; =&gt; &#39;Database/Mysql&#39;,</span>
<span class="s">            &#39;host&#39;       =&gt; &#39;localhost&#39;,</span>
<span class="s">            &#39;database&#39;   =&gt; &#39;jenkins_test&#39;,</span>
<span class="s">            &#39;username&#39;      =&gt; &#39;jenkins&#39;,</span>
<span class="s">            &#39;password&#39;   =&gt; &#39;cakephp_jenkins&#39;,</span>
<span class="s">            &#39;encoding&#39;   =&gt; &#39;utf8&#39;</span>
<span class="s">        ]</span>
<span class="s">    ]</span>
<span class="s">];</span>
<span class="s">CONFIG</span>
</pre></div>
</div>
<p>Then uncomment the following line in your <strong>config/bootstrap.php</strong> file:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">//Configure::load(&#39;app_local&#39;, &#39;default&#39;);</span>
</pre></div>
</div>
<p>By creating an <strong>app_local.php</strong> file, you have an easy way to define
configuration specific to Jenkins. You can use this same configuration file to
override any other configuration files you need on Jenkins.</p>
<p>It&#8217;s often a good idea to drop and re-create the database before each build as
well. This insulates you from chained failures, where one broken build causes
others to fail. Add another <em>shell script step</em> to the build that contains the
following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mysql -u jenkins -pcakephp_jenkins -e <span class="s1">&#39;DROP DATABASE IF EXISTS jenkins_test; CREATE DATABASE jenkins_test&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="add-your-tests">
<h3>Add your Tests<a class="headerlink" href="#add-your-tests" title="Permalink to this headline">¶</a></h3>
<p>Add another <em>shell script step</em> to your build. In this step install your
dependencies and run the tests for your application. Creating a junit log file,
or clover coverage is often a nice bonus, as it gives you a nice graphical view
of your testing results:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Download Composer if it is missing.</span>
<span class="nb">test</span> -f <span class="s1">&#39;composer.phar&#39;</span> <span class="o">||</span> curl -sS https://getcomposer.org/installer <span class="p">|</span> php
<span class="c1"># Install dependencies</span>
php composer.phar install
vendor/bin/phpunit --log-junit junit.xml --coverage-clover clover.xml
</pre></div>
</div>
<p>If you use clover coverage, or the junit results, make sure to configure those
in Jenkins as well. Failing to configure those steps will mean you won&#8217;t see the
results.</p>
</div>
<div class="section" id="run-a-build">
<h3>Run a Build<a class="headerlink" href="#run-a-build" title="Permalink to this headline">¶</a></h3>
<p>You should be able to run a build now. Check the console output and make any
necessary changes to get a passing build.</p>
</div>
</div>
</div>


            </div>
        </div>

        
        <div class="col-md-3 col-md-pull-9 hidden-xs hidden-sm" lang="en">
            <aside class="sidebar">
                <div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<p class="caption"><span class="caption-text">Preface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">CakePHP at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/3-x-migration-guide.html">3.x Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/request-response.html">Request &amp; Response Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orm.html">Database Access &amp; ORM</a></li>
</ul>
<p class="caption"><span class="caption-text">Using CakePHP</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bake.html">Bake Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/caching.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Console Tools, Shells &amp; Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Error &amp; Exception Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/events.html">Events System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/internationalization-and-localization.html">Internationalization &amp; Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/form.html">Modelless Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/pagination.html">Pagination</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="sessions.html">Sessions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/validation.html">Validation</a></li>
</ul>
<p class="caption"><span class="caption-text">Utility Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/app.html">App Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/collections.html">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/file-folder.html">Folder &amp; File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/hash.html">Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/httpclient.html">Http Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/inflector.html">Inflector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/registry-objects.html">Registry Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/text.html">Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/time.html">Date &amp; Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/xml.html">Xml</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../chronos.html">Chronos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug-kit.html">Debug Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrations.html">Migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch.html">ElasticSearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade-tool.html">Upgrade Tool</a></li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/global-constants-and-functions.html">Constants &amp; Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

                </div>
            </aside>
            <aside class="sidebar">
                <div class="mb30 row">
                </div>
            </aside>
        </div>
    </div>
</div>

<section id="socials" class="back-3">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-5  social text-center">
                <div class="col-sm-3 col-xs-3">
                    <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                          var js, fjs = d.getElementsByTagName(s)[0];
                          if (d.getElementById(id)) return;
                          js = d.createElement(s); js.id = id;
                          js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
                          fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));
                        </script>
                        <div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-7 social-footer text-center ">
                <a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
                <a href="https://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
                <a href="https://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
                <a href="https://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
                <a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
                <a href="https://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
                <a href="https://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
                <a href="https://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
            </div>
        </div>
    </div>
</section>

<footer id="footer" class="footer-wrapper">
    <div class="container">

        <div class="row col-p30">
            <div class="col-sm-12 col-md-3">
                <div class="footer-widget t-footer">
                    <div class="col-md-12">
                        <a href="https://www.openhub.net/p/cakephp">
                            <img src="../_static/open-hub.png">
                        </a>
                        <div class="mt10">
                            <a href="https://www.rackspace.com/">
                                <img src="../_static/rackspace.png">
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-md-9">
                <div class="col-md-3 col-sm-6 business-solution">
                    <ul class="footer-menu">
                        <li class="menu-title">
    <a href="https://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
    <a href="https://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 text-center mt30">
                <p class="copyright">
                            &copy; Copyright 2017, Cake Software Foundation, Inc.
                        Last updated on Aug 30, 2017.
                        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
                </p>
            </div>
        </div>
    </div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-743287-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
  </body>
</html>
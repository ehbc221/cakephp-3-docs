

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Dispatcher Filters" lang="en" name="title" />
<meta content="Dispatcher filters are a middleware layer for CakePHP allowing to alter the request or response before it is sent" lang="en" name="description" />
<meta content="middleware, filters, dispatcher, request, response, rack, application stack, events, beforeDispatch, afterDispatch, router" lang="en" name="keywords" />

    <title>Dispatcher Filters - 3.x</title>
    <link href="../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/app.js"></script>

    <link rel="alternate" hreflang="pt_BR" href="../../pt/development/dispatch-filters.html" /><link rel="alternate" hreflang="es" href="../../es/development/dispatch-filters.html" /><link rel="alternate" hreflang="ja" href="../../ja/development/dispatch-filters.html" /><link rel="alternate" hreflang="fr" href="../../fr/development/dispatch-filters.html" /><link rel="alternate" hreflang="zh" href="../../zh/development/dispatch-filters.html" /><link rel="alternate" hreflang="tr" href="../../tr/development/dispatch-filters.html" /><link rel="alternate" hreflang="ru" href="../../ru/development/dispatch-filters.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within CakePHP Cookbook 3.5 documentation" href="../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="CakePHP Cookbook 3.5 documentation" href="../index.html" />
    <link rel="up" title="Routing" href="routing.html" />
    <link rel="next" title="Request &amp; Response Objects" href="../controllers/request-response.html" />
    <link rel="prev" title="Routing" href="routing.html" />

    <script type="text/javascript">
    window.lang = "en";
    </script>
  </head>
  <body>

<div id="container">
    
    <header class="nav-down">
        <div class="container-fluid hidden-xs hidden-sm">
            <div class="row">
                <div class="col-sm-3 col-md-3">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-9 col-md-9">
                    <nav class="navbar-right">
                        <ul class="menu">
                            <li class="first">
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
                                <ul class="submenu">
                                    
<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                                </ul>
                            </li>

                            <li><a href="https://cakephp.org/business-solutions">Business Solutions</a></li>
                            <li><a href="https://cakephp.org/writers">Get Paid To Write</a></li>
                            <li><a href="https://cakephp.org/pages/team">Team</a></li>

                            <li>
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
                                <div class="megamenu full">
                                    <div class="row">
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                                            </ul>
                                        </div>
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        
        <div class="container-fluid hidden-md hidden-lg">
            <div class="row">
                <div class="col-sm-6 col-xs-6">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-6 col-xs-6">
                    <div class="navbar-right">
                        <button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
                            <i class="fa fa-bars toggle-modal"></i>
                        </button>
                    </div>
                    <div id="wrap">
                        <form class="search" action="../search.html" method="get">
                            <input name="q" type="search" placeholder="What are you looking for?">
                            <input id="search_submit" value="Search" type="submit">
                        </form>
                    </div>
                </div>
            </div>
        </div>

        
        <section id="nav-cook" class="hidden-xs hidden-sm">
            <div class="container-fluid ">
                <div class="row ">
                    <div class="col-md-12 back-book">
                        <div class="col-md-5 text-center t-cook-nav p0 hidden-sm hidden-xs">
                            <h2>
                                <a href="../contents.html">
                                    <span class="glyph_range icon-submenu icon-submenu-cook">B</span>
                                    CakePHP 3.5 Red Velvet <strong>Cookbook</strong>
                                </a>
                            </h2>
                        </div>

                        <div class="col-md-4 hidden-sm">
                            <form class="search" action="../search.html" method="get">
                                <input type="hidden" name="check_keywords" value="yes" />
                                <input type="hidden" name="area" value="default" />

                                <div class="col-md-10 p0">
                                    <input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
                                </div>
                                <div class="col-md-2 p0 search-cook">
                                    <button type="submit">
                                        <span class="glyph_range icon-submenu icon-submenu-cook">A</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        
                        <div class="col-md-3">
                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Language:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
                                                    role="button" aria-haspopup="true" aria-expanded="false" href="#">
                                                        en
                                                        <i class="fa fa-menu-en fa-chevron-down"></i>
                                                    </a>
                                            <ul class="dropdown-menu">
                                            
                                                <li></li>
                                            
                                                <li><a href="../../pt/development/dispatch-filters.html">pt</a></li>
                                            
                                                <li><a href="../../es/development/dispatch-filters.html">es</a></li>
                                            
                                                <li><a href="../../ja/development/dispatch-filters.html">ja</a></li>
                                            
                                                <li><a href="../../fr/development/dispatch-filters.html">fr</a></li>
                                            
                                                <li><a href="../../zh/development/dispatch-filters.html">zh</a></li>
                                            
                                                <li><a href="../../tr/development/dispatch-filters.html">tr</a></li>
                                            
                                                <li><a href="../../ru/development/dispatch-filters.html">ru</a></li>
                                            
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Version:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">3.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
                                            <ul class="dropdown-menu">
                                                <li><a href="https://book.cakephp.org/3.0/en">3.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/2.0/en">2.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.3/en/">1.3 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.2/en/">1.2 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.1/en">1.1 Book</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
        </section>
    </header>

    
    <section class="nav-btn visible-sm visible-xs">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
                </div>

                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
                </div>
            </div>
        </div>
    </section>

    
    <div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title-cookbook" id="modal-header"></h4>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>

<div class="container page-container "><div id="improve-slideout">
        <i class="fa fa-pencil icon-improve"></i>
        <a href="https://github.com/cakephp/docs/edit/3.0/en/development/dispatch-filters.rst" target="_blank">
            <div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
        </a>
    </div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

    
    <div class="row">
        <div class="col-sm-12 col-md-9 col-md-push-3"><div class="page-contents col-sm-5">
                <h3>Page Contents</h3>
                <ul>
<li><a class="reference internal" href="#">Dispatcher Filters</a><ul>
<li><a class="reference internal" href="#built-in-filters">Built-in Filters</a></li>
<li><a class="reference internal" href="#using-filters">Using Filters</a><ul>
<li><a class="reference internal" href="#configuring-filter-order">Configuring Filter Order</a></li>
<li><a class="reference internal" href="#conditionally-applying-filters">Conditionally Applying Filters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-a-filter">Building a Filter</a></li>
</ul>
</li>
</ul>

            </div><div class="document-body">
            
  <div class="section" id="dispatcher-filters">
<h1>Dispatcher Filters<a class="headerlink" href="#dispatcher-filters" title="Permalink to this headline">¶</a></h1>
<div class="deprecated">
<p><span class="versionmodified">Deprecated since version 3.3.0: </span>As of 3.3.0 Dispatcher Filters are deprecated. You should use
<a class="reference internal" href="../controllers/middleware.html"><span class="doc">Middleware</span></a> instead now.</p>
</div>
<p>There are several reasons to want a piece of code to be run before any
controller code is executed or right before the response is sent to the client,
such as response caching, header tuning, special authentication or just to
provide access to a mission-critical API response in lesser time than a complete
request dispatching cycle would take.</p>
<p>CakePHP provides a clean interface for attaching filters to the dispatch
cycle. It is similar to a middleware layer, but re-uses the existing event
subsystem used in other parts of CakePHP. Since they do not work exactly
like traditional middleware, we refer to them as <em>Dispatcher Filters</em>.</p>
<div class="section" id="built-in-filters">
<h2>Built-in Filters<a class="headerlink" href="#built-in-filters" title="Permalink to this headline">¶</a></h2>
<p>CakePHP comes with several dispatcher filters built-in. They handle common
features that all applications are likely to need. The built-in filters are:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">AssetFilter</span></code> checks whether the request is referring to a theme
or plugin asset file, such as a CSS, JavaScript or image file stored in either a
plugin&#8217;s webroot folder or the corresponding one for a Theme. It will serve the
file accordingly if found, stopping the rest of the dispatching cycle:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Use options to set cacheTime for your static assets</span>
<span class="c1">// If not set, this defaults to +1 hour</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Asset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;cacheTime&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;+24 hours&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">RoutingFilter</span></code> applies application routing rules to the request URL.
Populates <code class="docutils literal"><span class="pre">$request-&gt;getParam()</span></code> with the results of routing.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">ControllerFactory</span></code> uses <code class="docutils literal"><span class="pre">$request-&gt;getParam()</span></code> to locate the controller that
will handle the current request.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">LocaleSelector</span></code> enables automatic language switching from the <code class="docutils literal"><span class="pre">Accept-Language</span></code>
header sent by the browser.</p>
</li>
</ul>
</div>
<div class="section" id="using-filters">
<h2>Using Filters<a class="headerlink" href="#using-filters" title="Permalink to this headline">¶</a></h2>
<p>Filters are usually enabled in your application&#8217;s <strong>bootstrap.php</strong> file, but
you could load them any time before the request is dispatched.  Adding
and removing filters is done through <code class="xref php php-class docutils literal"><span class="pre">Cake\Routing\DispatcherFactory</span></code>. By
default, the CakePHP application template comes with a couple filter classes
already enabled for all requests; let&#8217;s take a look at how they are added:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Routing&#39;</span><span class="p">);</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;ControllerFactory&#39;</span><span class="p">);</span>

<span class="c1">// Plugin syntax is also possible</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;PluginName.DispatcherName&#39;</span><span class="p">);</span>

<span class="c1">// Use options to set priority</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Asset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;priority&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
<p>Dispatcher filters with higher <code class="docutils literal"><span class="pre">priority</span></code> (lower numbers) - will be executed
first.  Priority defaults to <code class="docutils literal"><span class="pre">10</span></code>.</p>
<p>While using the string name is convenient, you can also pass instances into
<code class="docutils literal"><span class="pre">add()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Cake\Routing\Filter\RoutingFilter</span><span class="p">;</span>

<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">RoutingFilter</span><span class="p">());</span>
</pre></div>
</div>
<div class="section" id="configuring-filter-order">
<h3>Configuring Filter Order<a class="headerlink" href="#configuring-filter-order" title="Permalink to this headline">¶</a></h3>
<p>When adding filters, you can control the order they are invoked in using
event handler priorities. While filters can define a default priority using the
<code class="docutils literal"><span class="pre">$_priority</span></code> property, you can set a specific priority when attaching the
filter:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Asset&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;priority&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="k">new</span> <span class="nx">AssetFilter</span><span class="p">([</span><span class="s1">&#39;priority&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]));</span>
</pre></div>
</div>
<p>The higher the priority the later this filter will be invoked.</p>
</div>
<div class="section" id="conditionally-applying-filters">
<h3>Conditionally Applying Filters<a class="headerlink" href="#conditionally-applying-filters" title="Permalink to this headline">¶</a></h3>
<p>If you don&#8217;t want to run a filter on every request, you can use conditions to
only apply it some of the time. You can apply conditions using the <code class="docutils literal"><span class="pre">for</span></code> and
<code class="docutils literal"><span class="pre">when</span></code> options. The <code class="docutils literal"><span class="pre">for</span></code> option lets you match on URL substrings, while the
<code class="docutils literal"><span class="pre">when</span></code> option allows you to run a callable:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Only runs on requests starting with `/blog`</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;BlogHeader&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;for&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/blog&#39;</span><span class="p">]);</span>

<span class="c1">// Only run on GET requests.</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;Cache&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;when&#39;</span> <span class="o">=&gt;</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>The callable provided to <code class="docutils literal"><span class="pre">when</span></code> should return <code class="docutils literal"><span class="pre">true</span></code> when the filter should run.
The callable can expect to get the current request and response as arguments.</p>
</div>
</div>
<div class="section" id="building-a-filter">
<h2>Building a Filter<a class="headerlink" href="#building-a-filter" title="Permalink to this headline">¶</a></h2>
<p>To create a filter, define a class in <strong>src/Routing/Filter</strong>. In this example,
we&#8217;ll be making a filter that adds a tracking cookie for the first landing
page. First, create the file. Its contents should look like:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Routing\Filter</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Event\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Routing\DispatcherFilter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TrackingCookieFilter</span> <span class="k">extends</span> <span class="nx">DispatcherFilter</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">beforeDispatch</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">);</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">getCookie</span><span class="p">(</span><span class="s1">&#39;landing_page&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">cookie</span><span class="p">([</span>
                <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;landing_page&#39;</span><span class="p">,</span>
                <span class="s1">&#39;value&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">here</span><span class="p">(),</span>
                <span class="s1">&#39;expire&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;+ 1 year&#39;</span><span class="p">,</span>
            <span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Save this file into <strong>src/Routing/Filter/TrackingCookieFilter.php</strong>. As you can see, like other
classes in CakePHP, dispatcher filters have a few conventions:</p>
<ul class="simple">
<li>Class names end in <code class="docutils literal"><span class="pre">Filter</span></code>.</li>
<li>Classes are in the <code class="docutils literal"><span class="pre">Routing\Filter</span></code> namespace. For example,
<code class="docutils literal"><span class="pre">App\Routing\Filter</span></code>.</li>
<li>Generally filters extend <code class="docutils literal"><span class="pre">Cake\Routing\DispatcherFilter</span></code>.</li>
</ul>
<p><code class="docutils literal"><span class="pre">DispatcherFilter</span></code> exposes two methods that can be overridden in subclasses,
they are <code class="docutils literal"><span class="pre">beforeDispatch()</span></code> and <code class="docutils literal"><span class="pre">afterDispatch()</span></code>. These methods are
executed before or after any controller is executed respectively. Both methods
receive a <code class="xref php php-class docutils literal"><span class="pre">Cake\Event\Event</span></code> object containing the <code class="docutils literal"><span class="pre">ServerRequest</span></code> and
<code class="docutils literal"><span class="pre">Response</span></code> objects (<a class="reference internal" href="../controllers/request-response.html#Cake\Http\ServerRequest" title="Cake\Http\ServerRequest"><code class="xref php php-class docutils literal"><span class="pre">Cake\Http\ServerRequest</span></code></a> and
<a class="reference internal" href="../controllers/request-response.html#Cake\Http\Response" title="Cake\Http\Response"><code class="xref php php-class docutils literal"><span class="pre">Cake\Http\Response</span></code></a> instances) inside the <code class="docutils literal"><span class="pre">$data</span></code> property.</p>
<p>While our filter was pretty simple, there are a few other interesting things we
can do in filter methods. By returning an <code class="docutils literal"><span class="pre">Response</span></code> object, you can
short-circuit the dispatch process and prevent the controller from being called.
When returning a response, you should also remember to call
<code class="docutils literal"><span class="pre">$event-&gt;stopPropagation()</span></code> so other filters are not called.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When a beforeDispatch method returns a response, the controller, and
afterDispatch event will not be invoked.</p>
</div>
<p>Let&#8217;s now create another filter for altering response headers in any public
page, in our case it would be anything served from the <code class="docutils literal"><span class="pre">PagesController</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Routing\Filter</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Event\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Routing\DispatcherFilter</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HttpCacheFilter</span> <span class="k">extends</span> <span class="nx">DispatcherFilter</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">afterDispatch</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">);</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;response&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">statusCode</span><span class="p">()</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">sharable</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
            <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">expires</span><span class="p">(</span><span class="nb">strtotime</span><span class="p">(</span><span class="s1">&#39;+1 day&#39;</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="c1">// In our bootstrap.php</span>
<span class="nx">DispatcherFactory</span><span class="o">::</span><span class="na">add</span><span class="p">(</span><span class="s1">&#39;HttpCache&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;for&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/pages&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>This filter will send a expiration header to 1 day in the future for
all responses produced by the pages controller. You could of course do the same
in the controller, this is just an example of what could be done with filters.
For instance, instead of altering the response, you could cache it using
<a class="reference internal" href="../core-libraries/caching.html#Cake\Cache\Cache" title="Cake\Cache\Cache"><code class="xref php php-class docutils literal"><span class="pre">Cake\Cache\Cache</span></code></a> and serve the response from the <code class="docutils literal"><span class="pre">beforeDispatch()</span></code>
callback.</p>
<p>While powerful, dispatcher filters have the potential to make your application
more difficult to maintain. Filters are an extremely powerful tool when used
wisely and adding response handlers for each URL in your app is not a good use for
them. Keep in mind that not everything needs to be a filter; <cite>Controllers</cite> and
<cite>Components</cite> are usually a more accurate choice for adding any request handling
code to your app.</p>
</div>
</div>


            </div>
        </div>

        
        <div class="col-md-3 col-md-pull-9 hidden-xs hidden-sm" lang="en">
            <aside class="sidebar">
                <div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<p class="caption"><span class="caption-text">Preface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">CakePHP at a Glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quick Start Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/3-x-migration-guide.html">3.x Migration Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutorials &amp; Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
</ul>
<p class="caption"><span class="caption-text">Getting Started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="routing.html">Routing</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Dispatcher Filters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/request-response.html">Request &amp; Response Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orm.html">Database Access &amp; ORM</a></li>
</ul>
<p class="caption"><span class="caption-text">Using CakePHP</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/authentication.html">Authentication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bake.html">Bake Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/caching.html">Caching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Console Tools, Shells &amp; Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Error &amp; Exception Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/events.html">Events System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/internationalization-and-localization.html">Internationalization &amp; Localization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/form.html">Modelless Forms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/pagination.html">Pagination</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="sessions.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/validation.html">Validation</a></li>
</ul>
<p class="caption"><span class="caption-text">Utility Classes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/app.html">App Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/collections.html">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/file-folder.html">Folder &amp; File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/hash.html">Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/httpclient.html">Http Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/inflector.html">Inflector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/registry-objects.html">Registry Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/text.html">Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/time.html">Date &amp; Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/xml.html">Xml</a></li>
</ul>
<p class="caption"><span class="caption-text">Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../chronos.html">Chronos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug-kit.html">Debug Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrations.html">Migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch.html">ElasticSearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade-tool.html">Upgrade Tool</a></li>
</ul>
<p class="caption"><span class="caption-text">Other</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/global-constants-and-functions.html">Constants &amp; Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Appendices</a></li>
</ul>

</div>

                </div>
            </aside>
            <aside class="sidebar">
                <div class="mb30 row">
                </div>
            </aside>
        </div>
    </div>
</div>

<section id="socials" class="back-3">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-5  social text-center">
                <div class="col-sm-3 col-xs-3">
                    <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                          var js, fjs = d.getElementsByTagName(s)[0];
                          if (d.getElementById(id)) return;
                          js = d.createElement(s); js.id = id;
                          js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
                          fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));
                        </script>
                        <div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-7 social-footer text-center ">
                <a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
                <a href="https://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
                <a href="https://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
                <a href="https://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
                <a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
                <a href="https://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
                <a href="https://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
                <a href="https://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
            </div>
        </div>
    </div>
</section>

<footer id="footer" class="footer-wrapper">
    <div class="container">

        <div class="row col-p30">
            <div class="col-sm-12 col-md-3">
                <div class="footer-widget t-footer">
                    <div class="col-md-12">
                        <a href="https://www.openhub.net/p/cakephp">
                            <img src="../_static/open-hub.png">
                        </a>
                        <div class="mt10">
                            <a href="https://www.rackspace.com/">
                                <img src="../_static/rackspace.png">
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-md-9">
                <div class="col-md-3 col-sm-6 business-solution">
                    <ul class="footer-menu">
                        <li class="menu-title">
    <a href="https://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
    <a href="https://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 text-center mt30">
                <p class="copyright">
                            &copy; Copyright 2017, Cake Software Foundation, Inc.
                        Last updated on Aug 30, 2017.
                        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
                </p>
            </div>
        </div>
    </div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-743287-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
  </body>
</html>


<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta content="Test" lang="fr" name="title" />
<meta content="phpunit,test database,database configuration,database setup,database test,public test,test framework,running one,test setup,de facto standard,pear,runners,array,databases,cakephp,php,integration" lang="fr" name="keywords" />

    <title>Testing - 3.x</title>
    <link href="../_static/favicon.png" type="image/png" rel="icon" />

    
    <link rel="stylesheet" href="../_static/css/app.css" type="text/css" />
    
    <script type="text/javascript" src="../_static/app.js"></script>

    <link rel="alternate" hreflang="en" href="../../en/development/testing.html" /><link rel="alternate" hreflang="pt_BR" href="../../pt/development/testing.html" /><link rel="alternate" hreflang="es" href="../../es/development/testing.html" /><link rel="alternate" hreflang="ja" href="../../ja/development/testing.html" /><link rel="alternate" hreflang="zh" href="../../zh/development/testing.html" /><link rel="alternate" hreflang="tr" href="../../tr/development/testing.html" /><link rel="alternate" hreflang="ru" href="../../ru/development/testing.html" />

    <link rel="search" type="application/opensearchdescription+xml" title="Search within documentation CakePHP Cookbook 3.5" href="../_static/opensearchdescription-book-3-x.xml">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="top" title="documentation CakePHP Cookbook 3.5" href="../index.html" />
    <link rel="next" title="Validation" href="../core-libraries/validation.html" />
    <link rel="prev" title="Sessions" href="sessions.html" />

    <script type="text/javascript">
    window.lang = "fr";
    </script>
  </head>
  <body>

<div id="container">
    
    <header class="nav-down">
        <div class="container-fluid hidden-xs hidden-sm">
            <div class="row">
                <div class="col-sm-3 col-md-3">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-9 col-md-9">
                    <nav class="navbar-right">
                        <ul class="menu">
                            <li class="first">
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Documentation</a>
                                <ul class="submenu">
                                    
<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                                </ul>
                            </li>

                            <li><a href="https://cakephp.org/business-solutions">Business Solutions</a></li>
                            <li><a href="https://cakephp.org/writers">Get Paid To Write</a></li>
                            <li><a href="https://cakephp.org/pages/team">Team</a></li>

                            <li>
                                <a href="#"><i class="fa fa-menu fa-chevron-down"></i>Community</a>
                                <div class="megamenu full">
                                    <div class="row">
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                                            </ul>
                                        </div>
                                        <div class="col-6 pl30">
                                            <ul class="megamenu-list">
                                                
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        
        <div class="container-fluid hidden-md hidden-lg">
            <div class="row">
                <div class="col-sm-6 col-xs-6">
                    <a class="logo-cake" href="https://cakephp.org">
                        <img src="../_static/logo-cake.png" alt="CakePHP" />
                    </a>
                </div>

                <div class="col-sm-6 col-xs-6">
                    <div class="navbar-right">
                        <button id="btn-menu" class="btn-menu" data-toggle="modal" data-target="#modal">
                            <i class="fa fa-bars toggle-modal"></i>
                        </button>
                    </div>
                    <div id="wrap">
                        <form class="search" action="../search.html" method="get">
                            <input name="q" type="search" placeholder="What are you looking for?">
                            <input id="search_submit" value="Recherche" type="submit">
                        </form>
                    </div>
                </div>
            </div>
        </div>

        
        <section id="nav-cook" class="hidden-xs hidden-sm">
            <div class="container-fluid ">
                <div class="row ">
                    <div class="col-md-12 back-book">
                        <div class="col-md-5 text-center t-cook-nav p0 hidden-sm hidden-xs">
                            <h2>
                                <a href="../contents.html">
                                    <span class="glyph_range icon-submenu icon-submenu-cook">B</span>
                                    CakePHP 3.5 Red Velvet <strong>Cookbook</strong>
                                </a>
                            </h2>
                        </div>

                        <div class="col-md-4 hidden-sm">
                            <form class="search" action="../search.html" method="get">
                                <input type="hidden" name="check_keywords" value="yes" />
                                <input type="hidden" name="area" value="default" />

                                <div class="col-md-10 p0">
                                    <input class="form-control form-cook" autocomplete="off" type="search" name="q" size="18" placeholder='Cookbook Search' />
                                </div>
                                <div class="col-md-2 p0 search-cook">
                                    <button type="submit">
                                        <span class="glyph_range icon-submenu icon-submenu-cook">A</span>
                                    </button>
                                </div>
                            </form>
                        </div>

                        
                        <div class="col-md-3">
                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Language:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown"
                                                    role="button" aria-haspopup="true" aria-expanded="false" href="#">
                                                        fr
                                                        <i class="fa fa-menu-en fa-chevron-down"></i>
                                                    </a>
                                            <ul class="dropdown-menu">
                                            
                                                <li><a href="../../en/development/testing.html">en</a></li>
                                            
                                                <li><a href="../../pt/development/testing.html">pt</a></li>
                                            
                                                <li><a href="../../es/development/testing.html">es</a></li>
                                            
                                                <li><a href="../../ja/development/testing.html">ja</a></li>
                                            
                                                <li></li>
                                            
                                                <li><a href="../../zh/development/testing.html">zh</a></li>
                                            
                                                <li><a href="../../tr/development/testing.html">tr</a></li>
                                            
                                                <li><a href="../../ru/development/testing.html">ru</a></li>
                                            
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                            <div class="col-md-6 p0">
                                <div class="col-md-7 t-language p0">
                                    <h6>Version:</h6>
                                </div>
                                <div class="col-md-5 p0">
                                    <ul class="nav navbar-nav">
                                        <li class="dropdown">
                                            <a href="#" class="dropdown-toggle" data-hover="dropdown" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">3.x <i class="fa fa-menu-en fa-chevron-down"></i></a>
                                            <ul class="dropdown-menu">
                                                <li><a href="https://book.cakephp.org/3.0/fr">3.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/2.0/fr">2.x Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.3/fr/">1.3 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.2/fr/">1.2 Book</a></li>
                                                <li><a href="https://book.cakephp.org/1.1/en">1.1 Book</a></li>
                                            </ul>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
            
        </section>
    </header>

    
    <section class="nav-btn visible-sm visible-xs">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-nav" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Nav</strong></button>
                </div>

                <div class="col-sm-6 col-xs-6 text-center">
                    <button id="btn-toc" class="btn btn-b btn-nav" data-toggle="modal" data-target="#modal"><strong>Table of Contents</strong></button>
                </div>
            </div>
        </div>
    </section>

    
    <div id="modal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="modal-header">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title-cookbook" id="modal-header"></h4>
                </div>
                <div class="modal-body"></div>
            </div>
        </div>
    </div>

<div class="container page-container "><div id="improve-slideout">
        <i class="fa fa-pencil icon-improve"></i>
        <a href="https://github.com/cakephp/docs/edit/3.0/fr/development/testing.rst" target="_blank">
            <div id="improve-slideout-inner"><h6>Improve This Doc <i class="fa fa-github git-improve"></i></h6></div>
        </a>
    </div><a id="back-to-contents" href="#page-contents"><i class="fa fa-arrow-circle-up icon-improve" title="Back to Contents"></i></a>

    
    <div class="row">
        <div class="col-sm-12 col-md-9 col-md-push-3"><div class="page-contents col-sm-5">
                <h3>Page Contents</h3>
                <ul>
<li><a class="reference internal" href="#">Testing</a><ul>
<li><a class="reference internal" href="#installer-phpunit">Installer PHPUnit</a><ul>
<li><a class="reference internal" href="#installer-phpunit-avec-composer">Installer PHPUnit avec Composer</a></li>
<li><a class="reference internal" href="#utiliser-le-fichier-phar">Utiliser le fichier PHAR</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tester-la-configuration-de-la-base-de-donnees">Tester la Configuration de la Base de Données</a></li>
<li><a class="reference internal" href="#verifier-la-configuration-test">Vérifier la Configuration Test</a></li>
<li><a class="reference internal" href="#conventions-des-cas-de-test-testcase">Conventions des Cas de Test (TestCase)</a></li>
<li><a class="reference internal" href="#creer-votre-premier-cas-de-test">Créer Votre Premier Cas de Test</a></li>
<li><a class="reference internal" href="#lancer-les-tests">Lancer les Tests</a><ul>
<li><a class="reference internal" href="#filtrer-les-cas-de-test-testcase">Filtrer les Cas de Test (TestCase)</a></li>
<li><a class="reference internal" href="#generer-une-couverture-de-code-code-coverage">Générer une Couverture de Code (Code Coverage)</a></li>
<li><a class="reference internal" href="#combiner-les-suites-de-test-pour-les-plugins">Combiner les Suites de Test pour les Plugins</a></li>
</ul>
</li>
<li><a class="reference internal" href="#les-callbacks-du-cycle-de-vie-des-cas-de-test">Les Callbacks du Cycle de Vie des Cas de Test</a></li>
<li><a class="reference internal" href="#fixtures">Fixtures</a><ul>
<li><a class="reference internal" href="#connexions-de-test">Connexions de Test</a></li>
<li><a class="reference internal" href="#creer-les-fixtures">Créer les Fixtures</a></li>
<li><a class="reference internal" href="#les-donnees-dynamiques-et-les-fixtures">Les Données Dynamiques et les Fixtures</a></li>
<li><a class="reference internal" href="#importer-les-informations-de-table">Importer les Informations de Table</a></li>
<li><a class="reference internal" href="#charger-les-fixtures-dans-vos-tests-testcase">Charger les Fixtures dans vos Tests (TestCase)</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tester-les-classes-table">Tester les Classes Table</a><ul>
<li><a class="reference internal" href="#creer-une-methode-de-test">Créer une Méthode de Test</a></li>
<li><a class="reference internal" href="#methodes-de-mocking-des-models">Méthodes de Mocking des Models</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-d-integrations-des-controllers">Test d&#8217;Intégrations des Controllers</a><ul>
<li><a class="reference internal" href="#configurer-la-requete">Configurer la Requête</a></li>
<li><a class="reference internal" href="#tester-des-actions-protegees-par-authcomponent">Tester des Actions Protégées par AuthComponent</a></li>
<li><a class="reference internal" href="#testing-stateless-authentication-and-apis">Testing Stateless Authentication and APIs</a></li>
<li><a class="reference internal" href="#tester-les-actions-protegees-par-csrfcomponent-ou-securitycomponent">Tester les Actions Protégées par CsrfComponent ou SecurityComponent</a></li>
<li><a class="reference internal" href="#test-d-integration-sur-les-middlewares-psr-7">Test d&#8217;intégration sur les middlewares PSR-7</a></li>
<li><a class="reference internal" href="#tester-avec-des-cookies-chiffres">Tester avec des cookies chiffrés</a></li>
<li><a class="reference internal" href="#tester-les-messages-flash">Tester les Messages Flash</a></li>
<li><a class="reference internal" href="#tester-un-controller-retournant-du-json">Tester un controller retournant du JSON</a></li>
<li><a class="reference internal" href="#desactiver-le-middleware-de-gestion-d-erreurs-dans-les-tests">Désactiver le Middleware de Gestion d&#8217;Erreurs dans les Tests</a></li>
<li><a class="reference internal" href="#methodes-d-assertion">Méthodes d&#8217;Assertion</a></li>
<li><a class="reference internal" href="#comparer-les-resultats-du-test-avec-un-fichier">Comparer les Résultats du Test avec un Fichier</a></li>
<li><a class="reference internal" href="#id1">Tester avec des Cookies Chiffrés</a></li>
<li><a class="reference internal" href="#tester-un-controller-dont-la-reponse-est-au-format-json">Tester un Controller dont la Réponse est au format JSON</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tests-d-integration-de-la-console">Tests d&#8217;Intégration de la Console</a><ul>
<li><a class="reference internal" href="#tester-les-shells-interactifs">Tester les Shells Interactifs</a></li>
<li><a class="reference internal" href="#tester-le-commandrunner">Tester le CommandRunner</a></li>
<li><a class="reference internal" href="#methodes-d-assertions">Méthodes d&#8217;assertions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tester-les-views">Tester les Views</a></li>
<li><a class="reference internal" href="#tester-les-components">Tester les Components</a></li>
<li><a class="reference internal" href="#tester-les-helpers">Tester les Helpers</a></li>
<li><a class="reference internal" href="#tester-les-events">Tester les Events</a></li>
<li><a class="reference internal" href="#creer-des-suites-de-test-test-suites">Créer des Suites de Test (Test Suites)</a></li>
<li><a class="reference internal" href="#creer-des-tests-pour-les-plugins">Créer des Tests pour les Plugins</a></li>
<li><a class="reference internal" href="#generer-des-tests-avec-bake">Générer des Tests avec Bake</a></li>
<li><a class="reference internal" href="#integration-avec-jenkins">Intégration avec Jenkins</a><ul>
<li><a class="reference internal" href="#creer-un-job">Créer un Job</a></li>
<li><a class="reference internal" href="#ajouter-une-config-de-base-de-donnees-de-test">Ajouter une Config de Base de Données de Test</a></li>
<li><a class="reference internal" href="#ajouter-vos-tests">Ajouter vos Tests</a></li>
<li><a class="reference internal" href="#lancer-un-build">Lancer un Build</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            </div><div class="document-body">
            
  <div class="section" id="testing">
<h1>Testing<a class="headerlink" href="#testing" title="Lien permanent vers ce titre">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>The documentation is not currently supported in French language for this
page.</p>
<p>Please feel free to send us a pull request on
<a class="reference external" href="https://github.com/cakephp/docs">Github</a> or use the <strong>Improve This Doc</strong>
button to directly propose your changes.</p>
<p class="last">You can refer to the English version in the select top menu to have
information about this page&#8217;s topic.</p>
</div>
<p>CakePHP fournit un support de test intégré compréhensible. CakePHP permet
l&#8217;intégration de <a class="reference external" href="http://phpunit.de">PHPUnit</a>. En plus de toutes les
fonctionnalités offertes par PHPUnit, CakePHP offre quelques fonctionnalités
supplémentaires pour faciliter le test. Cette section va couvrir l&#8217;installation
de PHPUnit, comment commencer avec le Test Unitaire, et comment vous pouvez
utiliser les extensions que CakePHP offre.</p>
<div class="section" id="installer-phpunit">
<h2>Installer PHPUnit<a class="headerlink" href="#installer-phpunit" title="Lien permanent vers ce titre">¶</a></h2>
<p>CakePHP utilise PHPUnit comme framework de test sous-jacent. PHPUnit est le
standard de-facto pour le test unitaire dans PHP. Il offre un ensemble de
fonctionnalités profondes et puissantes pour s&#8217;assurer que votre code fait ce
que vous pensez qu&#8217;il doit faire. PHPUnit peut être installé avec le <a class="reference external" href="http://phpunit.de/#download">PHAR
package</a> ou avec
<a class="reference external" href="http://getcomposer.org">Composer</a>.</p>
<div class="section" id="installer-phpunit-avec-composer">
<h3>Installer PHPUnit avec Composer<a class="headerlink" href="#installer-phpunit-avec-composer" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour installer PHPUnit avec Composer:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ php composer.phar require --dev phpunit/phpunit:<span class="s2">&quot;^5.7|^6.0&quot;</span>

// Avant CakePHP <span class="m">3</span>.4.1
$ php composer.phar require --dev phpunit/phpunit
</pre></div>
</div>
<p>Ceci va ajouter la dépendance à la section <code class="docutils literal"><span class="pre">require-dev</span></code> de votre
<code class="docutils literal"><span class="pre">composer.json</span></code>, et ensuite installer PHPUnit avec vos autres dépendances.</p>
<p>Vous pouvez maintenant lancer PHPUnit en utilisant:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ vendor/bin/phpunit
</pre></div>
</div>
</div>
<div class="section" id="utiliser-le-fichier-phar">
<h3>Utiliser le fichier PHAR<a class="headerlink" href="#utiliser-le-fichier-phar" title="Lien permanent vers ce titre">¶</a></h3>
<p>Après avoir téléchargé le fichier <strong>phpunit.phar</strong>, vous pouvez l&#8217;utiliser pour
lancer vos tests:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>php phpunit.phar
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Astuce</p>
<p>Par souci de commodité vous pouvez rendre phpunit.phar disponible
globalement sur Unix ou Linux via les commandes suivantes:</p>
<div class="highlight-shell"><div class="highlight"><pre><span></span>chmod +x phpunit.phar
sudo mv phpunit.phar /usr/local/bin/phpunit
phpunit --version
</pre></div>
</div>
<p class="last">Référez vous à la documentation de PHPUnit pour les instructions concernant
<a class="reference external" href="http://phpunit.de/manual/current/en/installation.html#installation.phar.windows">l&#8217;installation globale du PHAR PHPUnit sur Windows</a>.</p>
</div>
</div>
</div>
<div class="section" id="tester-la-configuration-de-la-base-de-donnees">
<h2>Tester la Configuration de la Base de Données<a class="headerlink" href="#tester-la-configuration-de-la-base-de-donnees" title="Lien permanent vers ce titre">¶</a></h2>
<p>Souvenez-vous qu&#8217;il faut avoir debug activé dans votre fichier
<strong>config/app.php</strong> avant de lancer des tests. Vous devrez aussi vous assurer
d&#8217;ajouter une configuration de base de données <code class="docutils literal"><span class="pre">test</span></code> dans <strong>config/app.php</strong>.
Cette configuration est utilisée par CakePHP pour les tables de fixture et les
données:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="s1">&#39;Datasources&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;test&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;datasource&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cake\Database\Driver\Mysql&#39;</span><span class="p">,</span>
        <span class="s1">&#39;persistent&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
        <span class="s1">&#39;host&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;dbhost&#39;</span><span class="p">,</span>
        <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;dblogin&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;dbpassword&#39;</span><span class="p">,</span>
        <span class="s1">&#39;database&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test_database&#39;</span>
    <span class="p">],</span>
<span class="p">],</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">C&#8217;est une bonne idée de faire une base de données de test différente de
votre base de données actuelle. Cela évitera toute erreur embarrassante
pouvant arriver plus tard.</p>
</div>
</div>
<div class="section" id="verifier-la-configuration-test">
<h2>Vérifier la Configuration Test<a class="headerlink" href="#verifier-la-configuration-test" title="Lien permanent vers ce titre">¶</a></h2>
<p>Après avoir installé PHPUnit et configuré le <code class="docutils literal"><span class="pre">test</span></code> de la configuration de la
base de données, vous pouvez vous assurer que vous êtes prêt à écrire et lancer
vos propres tests en lançant un de ceux présents dans le cœur:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Pour phpunit.phar</span>
$ php phpunit.phar

<span class="c1"># Pour un PHPUnit installé avec Composer</span>
$ vendor/bin/phpunit
</pre></div>
</div>
<p>Ce qui est au-dessus va lancer tous les tests que vous avez, ou vous indiquer
qu&#8217;aucun test n&#8217;a été lancé. Pour lancer un test spécifique, vous pouvez fournir
le chemin au test en paramètre de PHPUnit. Par exemple, si vous aviez un cas
de test pour la classe ArticlesTable, vous pourriez le lancer avec:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ vendor/bin/phpunit tests/TestCase/Model/Table/ArticlesTableTest
</pre></div>
</div>
<p>Vous devriez voir une barre verte avec quelques informations supplémentaires sur
les tests exécutés et le nombre de tests réussis.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Si vous êtes sur un système Windows, vous ne verrez probablement pas les
couleurs.</p>
</div>
</div>
<div class="section" id="conventions-des-cas-de-test-testcase">
<h2>Conventions des Cas de Test (TestCase)<a class="headerlink" href="#conventions-des-cas-de-test-testcase" title="Lien permanent vers ce titre">¶</a></h2>
<p>Comme beaucoup de choses dans CakePHP, les cas de test ont quelques
conventions. En ce qui concerne les tests:</p>
<ol class="arabic simple">
<li>Les fichiers PHP contenant les tests doivent être dans votre répertoire
<code class="docutils literal"><span class="pre">tests/TestCase/[Type]</span></code>.</li>
<li>Les noms de ces fichiers doivent finir par <strong>Test.php</strong> plutôt que juste
<strong>.php</strong>.</li>
<li>Les classes contenant les tests doivent étendre <code class="docutils literal"><span class="pre">Cake\TestSuite\TestCase</span></code>,
<code class="docutils literal"><span class="pre">Cake\TestSuite\IntegrationTestCase</span></code> ou <code class="docutils literal"><span class="pre">\PHPUnit\Framework\TestCase</span></code>.</li>
<li>Comme les autres noms de classe, les noms de classe des cas de test doivent
correspondre au nom de fichier. <strong>RouterTest.php</strong> doit contenir
<code class="docutils literal"><span class="pre">class</span> <span class="pre">RouterTest</span> <span class="pre">extends</span> <span class="pre">TestCase</span></code>.</li>
<li>Le nom de toute méthode contenant un test (par ex: contenant une assertion)
doit commencer par <code class="docutils literal"><span class="pre">test</span></code>, comme dans <code class="docutils literal"><span class="pre">testPublished()</span></code>.
Vous pouvez aussi utiliser l&#8217;annotation <code class="docutils literal"><span class="pre">&#64;test</span></code> pour marquer les méthodes
en méthodes de test.</li>
</ol>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.4.1: </span>Le support de PHPUnit 6 a été ajouté. Si vous utilisez une version de PHPUnit
inférieure à 5.7.0, vos classes de tests devront soit <em>extends</em> les classes
de CakePHP, soit <code class="docutils literal"><span class="pre">PHPUnit_Framework_TestCase</span></code>.</p>
</div>
</div>
<div class="section" id="creer-votre-premier-cas-de-test">
<h2>Créer Votre Premier Cas de Test<a class="headerlink" href="#creer-votre-premier-cas-de-test" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans l&#8217;exemple suivant, nous allons créer un cas de test pour une méthode de
helper très simple. Le helper que nous allons tester sera le formatage d&#8217;une
barre de progression HTML. Notre helper ressemblera à cela:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\View\Helper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\View\Helper</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProgressHelper</span> <span class="k">extends</span> <span class="nx">Helper</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bar</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$width</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nv">$value</span> <span class="o">/</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span>
            <span class="s1">&#39;&lt;div class=&quot;progress-container&quot;&gt;</span>
<span class="s1">                &lt;div class=&quot;progress-bar&quot; style=&quot;width: %s%%&quot;&gt;&lt;/div&gt;</span>
<span class="s1">            &lt;/div&gt;&#39;</span><span class="p">,</span> <span class="nv">$width</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>C&#8217;est un exemple très simple, mais ce sera utile pour montrer comment vous
pouvez créer un cas de test simple. Après avoir créé et sauvegardé notre
helper, nous allons créer le fichier de cas de tests dans
<strong>tests/TestCase/View/Helper/ProgressHelperTest.php</strong>. Dans ce fichier, nous
allons commencer avec ce qui suit:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\View\Helper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\View\Helper\ProgressHelper</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\View\View</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ProgressHelperTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testBar</span><span class="p">()</span>
    <span class="p">{</span>

    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nous compléterons ce squelette dans une minute. Nous avons ajouté deux méthodes
pour commencer. Tout d&#8217;abord <code class="docutils literal"><span class="pre">setUp()</span></code>. Cette méthode est appelée avant chaque
méthode de <em>test</em> dans une classe de cas de test.
Les méthodes de configuration devraient initialiser les objets souhaités
pour le test, et faire toute configuration souhaitée. Dans notre configuration
nous ajouterons ce qui suit:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
    <span class="nv">$View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Progress</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ProgressHelper</span><span class="p">(</span><span class="nv">$View</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Appeler la méthode parente est importante dans les cas de test, puisque
<code class="docutils literal"><span class="pre">TestCase::setUp()</span></code> fait un certain nombre de choses comme fabriquer les
valeurs dans <a class="reference internal" href="configuration.html#Cake\Core\Configure" title="Cake\Core\Configure"><code class="xref php php-class docutils literal"><span class="pre">Core\Configure</span></code></a> et stocker les chemins dans
<a class="reference internal" href="../core-libraries/app.html#Cake\Core\App" title="Cake\Core\App"><code class="xref php php-class docutils literal"><span class="pre">Core\App</span></code></a>.</p>
<p>Ensuite, nous allons remplir les méthodes de test. Nous utiliserons quelques
assertions pour nous assurer que notre code crée la sortie que nous attendons:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testBar</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Progress</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">(</span><span class="mi">90</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;width: 90%&#39;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;progress-bar&#39;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>

    <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Progress</span><span class="o">-&gt;</span><span class="na">bar</span><span class="p">(</span><span class="mf">33.3333333</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContains</span><span class="p">(</span><span class="s1">&#39;width: 33%&#39;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Le test ci-dessus est simple mais montre le potentiel bénéfique de l&#8217;utilisation
des cas de test. Nous utilisons <code class="docutils literal"><span class="pre">assertContains()</span></code> pour nous assurer que notre
helper retourne une chaîne qui contient le contenu que nous attendons. Si le
résultat ne contient pas le contenu attendu le test sera un échec, et nous
savons que notre code est incorrect.</p>
<p>En utilisant les cas de test, vous pouvez décrire la relation entre un ensemble
d&#8217;entrées connues et leur sortie attendue. Cela vous aide à être plus confiant
sur le code que vous écrivez puisque vous pouvez vérifier que le code que vous
écrivez remplit les attentes et les assertions que vos tests font. De plus,
puisque les tests sont du code, ils peuvent être re-lancés dès que vous faîtes
un changement. Cela évite la création de nouveaux bugs.</p>
</div>
<div class="section" id="lancer-les-tests">
<span id="running-tests"></span><h2>Lancer les Tests<a class="headerlink" href="#lancer-les-tests" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une fois que vous avez installé PHPUnit et que quelques cas de tests sont
écrits, vous pouvez lancer les cas de test très fréquemment. C&#8217;est une
bonne idée de lancer les tests avant de committer tout changement pour aider
à s&#8217;assurer que vous n&#8217;avez rien cassé.</p>
<p>En utilisant <code class="docutils literal"><span class="pre">phpunit</span></code>, vous pouvez lancer les tests de votre application.
Pour lancer vos tests d&#8217;application, vous pouvez simplement lancer:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># avec l&#39;installation de composer</span>
$ vendor/bin/phpunit

<span class="c1"># avec le fichier phar</span>
php phpunit.phar
</pre></div>
</div>
<p>Si vous avez cloné la <a class="reference external" href="https://github.com/cakephp/cakephp">source de CakePHP à partir de GitHub</a>
et que vous souhaitez exécuter les tests unitaires de CakePHP, n&#8217;oubliez pas
d&#8217;exécuter la commande suivante de <code class="docutils literal"><span class="pre">Composer</span></code> avant de lancer <code class="docutils literal"><span class="pre">phpunit</span></code> pour
que toutes les dépendances soient installées:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ composer install --dev
</pre></div>
</div>
<p>À partir du répertoire racine de votre application. Pour lancer les tests pour
un plugin qui fait parti de la source de votre application, d&#8217;abord faîtes la
commande <code class="docutils literal"><span class="pre">cd</span></code> vers le répertoire du plugin, ensuite utilisez la commande
<code class="docutils literal"><span class="pre">phpunit</span></code> qui correspond à la façon dont vous avez installé phpunit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="nb">cd</span> plugins

<span class="c1"># En utilisant phpunit installé avec composer</span>
../vendor/bin/phpunit

<span class="c1"># En utilisant le fichier phar</span>
php ../phpunit.phar
</pre></div>
</div>
<p>Pour lancer les tests sur un plugin séparé, vous devez d&#8217;abord installer le
projet dans un répertoire séparé et installer ses dépendances:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>git clone git://github.com/cakephp/debug_kit.git
<span class="nb">cd</span> debug_kit
php ~/composer.phar install
php ~/phpunit.phar
</pre></div>
</div>
<div class="section" id="filtrer-les-cas-de-test-testcase">
<h3>Filtrer les Cas de Test (TestCase)<a class="headerlink" href="#filtrer-les-cas-de-test-testcase" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand vous avez des cas de test plus larges, vous pouvez lancer un
sous-ensemble de méthodes de test quand vous essayez de travailler sur un
cas unique d&#8217;échec. Avec l&#8217;exécuteur CLI vous pouvez utiliser une option pour
filtrer les méthodes de test:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ phpunit --filter testSave tests/TestCase/Model/Table/ArticlesTableTest
</pre></div>
</div>
<p>Le paramètre filter est utilisé comme une expression régulière sensible à la
casse pour filtrer les méthodes de test à lancer.</p>
</div>
<div class="section" id="generer-une-couverture-de-code-code-coverage">
<h3>Générer une Couverture de Code (Code Coverage)<a class="headerlink" href="#generer-une-couverture-de-code-code-coverage" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez générer un rapport de couverture de code en une ligne de
commande en utilisant les outils de couverture de code intégrés à PHPUnit.
PHPUnit va générer un ensemble de fichiers en HTML statique contenant les
résultats de la couverture. Vous pouvez générer une couverture pour un cas de
test en faisant ce qui suit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ phpunit --coverage-html webroot/coverage tests/TestCase/Model/Table/ArticlesTableTest
</pre></div>
</div>
<p>Cela mettra la couverture des résultats dans le répertoire webroot de votre
application. Vous pourrez voir les résultats en allant à
<code class="docutils literal"><span class="pre">http://localhost/votre_app/coverage</span></code>.</p>
<p>Si vous utilisez PHP 5.6.0 (ou supérieur), vous pouvez utilisez <a class="reference external" href="http://phpdbg.com/">phpdbg</a>
pour générer la couverture des résultats à la place de xdebug. <code class="docutils literal"><span class="pre">phpdbg</span></code> est
généralement plus rapide dans la génération des rapports de couverture :</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ phpdbg -qrr phpunit --coverage-html webroot/coverage tests/TestCase/Model/Table/ArticlesTableTest
</pre></div>
</div>
</div>
<div class="section" id="combiner-les-suites-de-test-pour-les-plugins">
<h3>Combiner les Suites de Test pour les Plugins<a class="headerlink" href="#combiner-les-suites-de-test-pour-les-plugins" title="Lien permanent vers ce titre">¶</a></h3>
<p>Souvent, votre application sera composé de plusieurs plugins. Dans ces
situations, il peut être assez fastidieux d&#8217;effectuer des tests pour chaque
plugin. Vous pouvez faire des tests pour chaque plugin qui compose votre
application en ajoutant une section <code class="docutils literal"><span class="pre">&lt;testsuite&gt;</span></code> supplémentaire au fichier
<code class="docutils literal"><span class="pre">phpunit.xml.dist</span></code> de votre application:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;testsuites&gt;</span>
    <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;App Test Suite&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;directory&gt;</span>./tests/TestCase<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;/testsuite&gt;</span>

    <span class="c">&lt;!-- Ajouter vos plugins --&gt;</span>
    <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Forum plugin&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;directory&gt;</span>./plugins/Forum/tests/TestCase<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre></div>
</div>
<p>Les tests supplémentaires ajoutés à l&#8217;élément <code class="docutils literal"><span class="pre">&lt;testsuites&gt;</span></code> seront exécutés
automatiquement quand quand vous utiliserez <code class="docutils literal"><span class="pre">phpunit</span></code>.</p>
<p>Si vous utilisez <code class="docutils literal"><span class="pre">&lt;testsuites&gt;</span></code> pour utiliser les fixtures à partir des
plugins que vous avez installé avec composer, le fichier <code class="docutils literal"><span class="pre">composer.json</span></code> du
plugin doit ajouter le namespace de la fixture à la section autoload. Exemple:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="s2">&quot;autoload&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;psr-4&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;PluginName</span><span class="se">\\</span><span class="s2">Test</span><span class="se">\\</span><span class="s2">Fixture</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">:</span> <span class="s2">&quot;tests</span><span class="se">\\</span><span class="s2">Fixture&quot;</span>
    <span class="p">}</span>
<span class="p">},</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="les-callbacks-du-cycle-de-vie-des-cas-de-test">
<h2>Les Callbacks du Cycle de Vie des Cas de Test<a class="headerlink" href="#les-callbacks-du-cycle-de-vie-des-cas-de-test" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les cas de Test ont un certain nombre de callbacks de cycle de vie que vous
pouvez utiliser quand vous faîtes les tests:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">setUp</span></code> est appelé avant chaque méthode de test. Doit être utilisé pour
créer les objets qui vont être testés, et initialiser toute donnée pour le
test. Toujours se rappeler d&#8217;appeler <code class="docutils literal"><span class="pre">parent::setUp()</span></code>.</li>
<li><code class="docutils literal"><span class="pre">tearDown</span></code> est appelé après chaque méthode de test. Devrait être utilisé
pour nettoyer une fois que le test est terminé. Toujours se rappeler
d&#8217;appeler <code class="docutils literal"><span class="pre">parent::tearDown()</span></code>.</li>
<li><code class="docutils literal"><span class="pre">setupBeforeClass</span></code> est appelé une fois avant que les méthodes de test
aient commencées dans un cas. Cette méthode doit être <em>statique</em>.</li>
<li><code class="docutils literal"><span class="pre">tearDownAfterClass</span></code> est appelé une fois après que les méthodes de test
ont commencé dans un cas. Cette méthode doit être <em>statique</em>.</li>
</ul>
</div>
<div class="section" id="fixtures">
<span id="test-fixtures"></span><h2>Fixtures<a class="headerlink" href="#fixtures" title="Lien permanent vers ce titre">¶</a></h2>
<p>Quand on teste du code qui dépend de models et d&#8217;une base de données, on
peut utiliser les <strong>fixtures</strong> comme une façon de générer temporairement des
tables de données chargées avec des données d&#8217;exemple qui peuvent être utilisées
par le test. Le bénéfice de l&#8217;utilisation de fixtures est que votre test n&#8217;a
aucune chance d&#8217;abîmer les données de l&#8217;application qui tourne. De plus, vous
pouvez commencer à tester votre code avant de développer réellement en live le
contenu pour une application.</p>
<p>CakePHP utilise la connexion nommée <code class="docutils literal"><span class="pre">test</span></code> dans votre fichier de configuration
<strong>config/app.php</strong>. Si la connexion n&#8217;est pas utilisable, une exception
sera levée et vous ne pourrez pas utiliser les fixtures de la base de données.</p>
<p>CakePHP effectue ce qui suit pendant le chemin d&#8217;une fixture basée sur un cas
de test:</p>
<ol class="arabic simple">
<li>Crée les tables pour chacune des fixtures nécessaires.</li>
<li>Remplit les tables avec les données, si les données sont fournies dans la fixture.</li>
<li>Lance les méthodes de test.</li>
<li>Vide les tables de fixture.</li>
<li>Retire les tables de fixture de la base de données.</li>
</ol>
<div class="section" id="connexions-de-test">
<h3>Connexions de Test<a class="headerlink" href="#connexions-de-test" title="Lien permanent vers ce titre">¶</a></h3>
<p>Par défaut, CakePHP va faire un alias pour chaque connexion de votre
application. Chaque connexion définie dans le bootstrap de votre application qui
ne commence pas par <code class="docutils literal"><span class="pre">test_</span></code>, va avoir un alias avec le prefix <code class="docutils literal"><span class="pre">test_</span></code> créé.
Les alias de connexion assurent que vous n&#8217;utiliserez pas accidentellement la
mauvaise connexion dans les cas de test. Les alias de connexion sont
transparents pour le reste de votre application. Par exemple, si vous utilisez
la connexion &#8216;default&#8217;, à la place, vous obtiendrez la connexion <code class="docutils literal"><span class="pre">test</span></code> dans
les cas de test. Si vous utilisez la connexion &#8216;replica&#8217;, la suite de tests va
tenter d&#8217;utiliser &#8216;test_replica&#8217;.</p>
</div>
<div class="section" id="creer-les-fixtures">
<h3>Créer les Fixtures<a class="headerlink" href="#creer-les-fixtures" title="Lien permanent vers ce titre">¶</a></h3>
<p>A la création d&#8217;une fixture, vous pouvez définir principalement deux choses:
comment la table est créée (quels champs font partie de la table), et quels
enregistrements seront remplis initialement dans la table. Créons notre
première fixture, qui sera utilisée pour tester notre propre model Article.
Créez un fichier nommé <strong>ArticlesFixture.php</strong> dans votre répertoire
<strong>tests/Fixture</strong> avec le contenu suivant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\Fixture</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\TestSuite\Fixture\TestFixture</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>

      <span class="c1">// Facultatif. Définissez cette variable pour charger des fixtures avec</span>
      <span class="c1">// une base de données de test différente.</span>
      <span class="k">public</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="p">;</span>

      <span class="k">public</span> <span class="nv">$fields</span> <span class="o">=</span> <span class="p">[</span>
          <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">],</span>
          <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">],</span>
          <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
          <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">],</span>
          <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
          <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
          <span class="s1">&#39;_constraints&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]]</span>
          <span class="p">]</span>
      <span class="p">];</span>
      <span class="k">public</span> <span class="nv">$records</span> <span class="o">=</span> <span class="p">[</span>
          <span class="p">[</span>
              <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article&#39;</span><span class="p">,</span>
              <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article Body&#39;</span><span class="p">,</span>
              <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:39:23&#39;</span><span class="p">,</span>
              <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:41:31&#39;</span>
          <span class="p">],</span>
          <span class="p">[</span>
              <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article&#39;</span><span class="p">,</span>
              <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article Body&#39;</span><span class="p">,</span>
              <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:41:23&#39;</span><span class="p">,</span>
              <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:43:31&#39;</span>
          <span class="p">],</span>
          <span class="p">[</span>
              <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article&#39;</span><span class="p">,</span>
              <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article Body&#39;</span><span class="p">,</span>
              <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
              <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:43:23&#39;</span><span class="p">,</span>
              <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:45:31&#39;</span>
          <span class="p">]</span>
      <span class="p">];</span>
 <span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Il est recommandé de ne pas ajouter manuellement les valeurs aux colonnes
qui s&#8217;incrémentent automatiquement car cela interfère avec la génération
de séquence dans PostgreSQL et SQLServer.</p>
</div>
<p>La propriété <code class="docutils literal"><span class="pre">$connection</span></code> définit la source de données que la fixture
va utiliser. Si votre application utilise plusieurs sources de données, vous
devriez faire correspondre les fixtures avec les sources de données du model,
mais préfixé avec <code class="docutils literal"><span class="pre">test_</span></code>.
Par exemple, si votre model utilise la source de données <code class="docutils literal"><span class="pre">mydb</span></code>, votre
fixture devra utiliser la source de données <code class="docutils literal"><span class="pre">test_mydb</span></code>. Si la connexion
<code class="docutils literal"><span class="pre">test_mydb</span></code> n&#8217;existe pas, vos models vont utiliser la source de données
<code class="docutils literal"><span class="pre">test</span></code> par défaut. Les sources de données de fixture doivent être préfixées
par <code class="docutils literal"><span class="pre">test</span></code> pour réduire la possibilité de trucher accidentellement toutes
les données de votre application quand vous lancez des tests.</p>
<p>Nous utilisons <code class="docutils literal"><span class="pre">$fields</span></code> pour spécifier les champs qui feront parti de cette
table, et comment ils sont définis. Le format utilisé pour définir ces champs
est le même qu&#8217;utilisé avec <code class="xref php php-class docutils literal"><span class="pre">CakeSchema</span></code>. Les clés disponibles pour
la définition de la table sont:</p>
<dl class="docutils">
<dt><code class="docutils literal"><span class="pre">type</span></code></dt>
<dd>Type de données interne à CakePHP. Actuellement supportés:
- <code class="docutils literal"><span class="pre">string</span></code>: redirige vers <code class="docutils literal"><span class="pre">VARCHAR</span></code>.
- <code class="docutils literal"><span class="pre">uuid</span></code>: redirige vers <code class="docutils literal"><span class="pre">UUID</span></code>
- <code class="docutils literal"><span class="pre">text</span></code>: redirige vers <code class="docutils literal"><span class="pre">TEXT</span></code>.
- <code class="docutils literal"><span class="pre">integer</span></code>: redirige vers <code class="docutils literal"><span class="pre">INT</span></code>.
- <code class="docutils literal"><span class="pre">biginteger</span></code>: redirige vers <code class="docutils literal"><span class="pre">BIGINTEGER</span></code>
- <code class="docutils literal"><span class="pre">decimal</span></code>: redirige vers <code class="docutils literal"><span class="pre">DECIMAL</span></code>
- <code class="docutils literal"><span class="pre">float</span></code>: redirige vers <code class="docutils literal"><span class="pre">FLOAT</span></code>.
- <code class="docutils literal"><span class="pre">datetime</span></code>: redirige vers <code class="docutils literal"><span class="pre">DATETIME</span></code>.
- <code class="docutils literal"><span class="pre">timestamp</span></code>: redirige vers <code class="docutils literal"><span class="pre">TIMESTAMP</span></code>.
- <code class="docutils literal"><span class="pre">time</span></code>: redirige vers <code class="docutils literal"><span class="pre">TIME</span></code>.
- <code class="docutils literal"><span class="pre">date</span></code>: redirige vers <code class="docutils literal"><span class="pre">DATE</span></code>.
- <code class="docutils literal"><span class="pre">binary</span></code>: redirige vers <code class="docutils literal"><span class="pre">BLOB</span></code>.</dd>
<dt>fixed</dt>
<dd>Utilisé avec les types <code class="docutils literal"><span class="pre">string</span></code> pour créer des colonnes de type <code class="docutils literal"><span class="pre">CHAR</span></code>
dans les plates-formes qui les supportent.</dd>
<dt>length</dt>
<dd>Défini à la longueur spécifique que le champ doit prendre.</dd>
<dt>precision</dt>
<dd>Défini le nombre de décimales utilisées sur les champs <code class="docutils literal"><span class="pre">float</span></code> et
<code class="docutils literal"><span class="pre">decimal</span></code>.</dd>
<dt>null</dt>
<dd>Défini soit à <code class="docutils literal"><span class="pre">true</span></code> (pour permettre les NULLs) soit à <code class="docutils literal"><span class="pre">false</span></code> (pour
ne pas permettre les NULLs).</dd>
<dt>default</dt>
<dd>Valeur par défaut que le champ prend.</dd>
</dl>
<p>Nos pouvons définir un ensemble d&#8217;enregistrements qui seront remplis après que
la table de fixture est créée. Le format est assez simple, <code class="docutils literal"><span class="pre">$records</span></code> est un
tableau d&#8217;enregistrements. Chaque item dans <code class="docutils literal"><span class="pre">$records</span></code> doit être
un enregistrement (une seule ligne). A l&#8217;intérieur de chaque ligne, il doit y
avoir un tableau associatif des colonnes et valeurs pour la ligne. Gardez juste
à l&#8217;esprit que chaque enregistrement dans le tableau $records doit avoir une
clé pour <strong>chaque</strong> champ spécifié dans le tableau <code class="docutils literal"><span class="pre">$fields</span></code>. Si un champ
pour un enregistrement particulier a besoin d&#8217;avoir une valeur <code class="docutils literal"><span class="pre">null</span></code>,
spécifiez juste la valeur de cette clé à <code class="docutils literal"><span class="pre">null</span></code>.</p>
</div>
<div class="section" id="les-donnees-dynamiques-et-les-fixtures">
<h3>Les Données Dynamiques et les Fixtures<a class="headerlink" href="#les-donnees-dynamiques-et-les-fixtures" title="Lien permanent vers ce titre">¶</a></h3>
<p>Depuis que les enregistrements pour une fixture sont déclarés en propriété
de classe, vous ne pouvez pas utiliser les fonctions ou autres données
dynamiques pour définir les fixtures. Pour résoudre ce problème, vous pouvez
définir <code class="docutils literal"><span class="pre">$records</span></code> dans la fonction <code class="docutils literal"><span class="pre">init()</span></code> de votre fixture. Par exemple,
si vous voulez que tous les timestamps soient créés et mis à jours pour refléter
la date d&#8217;aujourd&#8217;hui, vous pouvez faire ce qui suit:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\Fixture</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\TestSuite\Fixture\TestFixture</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$fields</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">],</span>
        <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;string&#39;</span><span class="p">,</span> <span class="s1">&#39;length&#39;</span> <span class="o">=&gt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">],</span>
        <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text&#39;</span><span class="p">,</span>
        <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;integer&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">],</span>
        <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;datetime&#39;</span><span class="p">,</span>
        <span class="s1">&#39;_constraints&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;primary&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;primary&#39;</span><span class="p">,</span> <span class="s1">&#39;columns&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]],</span>
        <span class="p">]</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">init</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">records</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span>
                <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article&#39;</span><span class="p">,</span>
                <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article Body&#39;</span><span class="p">,</span>
                <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">),</span>
                <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="nb">date</span><span class="p">(</span><span class="s1">&#39;Y-m-d H:i:s&#39;</span><span class="p">),</span>
            <span class="p">],</span>
        <span class="p">];</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">init</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Quand vous surchargez <code class="docutils literal"><span class="pre">init()</span></code>, rappelez-vous juste de toujours appeler
<code class="docutils literal"><span class="pre">parent::init()</span></code>.</p>
</div>
<div class="section" id="importer-les-informations-de-table">
<h3>Importer les Informations de Table<a class="headerlink" href="#importer-les-informations-de-table" title="Lien permanent vers ce titre">¶</a></h3>
<p>Définir le schema des fixtures peut être vraiment pratique lorsque vous créez
des plugins, des librairies ou si vous créez un application qui doit être
portable. La redéfinition du schéma dans les fixtures peut devenir difficile à
maintenir pour les applications de grandes échelles. A cause de cela, CakePHP
fournit la possibilité d&#8217;importer le schema depuis une connexion existante et
utilise une définition de la table réfléchie pour créer la définition de la
table utilisée par la suite de tests.</p>
<p>Commençons par un exemple. Imaginons que vous ayez un model nommé articles
disponible dans votre application (qui est lié avec une table nommée
articles), on changerait la fixture donnée dans la section précédente
(<strong>tests/Fixture/ArticlesFixture.php</strong>) en ce qui suit:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$import</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;articles&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si vous voulez utiliser une autre connexion, utilisez:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$import</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;articles&#39;</span><span class="p">,</span> <span class="s1">&#39;connection&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;other&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.1.7.</span></p>
</div>
<p>En général vous avez une classe Table avec votre fixture. Vous pouvez aussi
utiliser ceci pour récupérer le nom de la table:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$import</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Articles&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Puisqu&#8217;on utilise <code class="docutils literal"><span class="pre">TableRegistry::get()</span></code>, on peut aussi utiliser la syntaxe de
plugin.</p>
<p>Vous pouvez naturellement importer la définition de votre table à partir d&#8217;un
model/d&#8217;une table existante, mais vous avez vos enregistrements directement
définis dans le fixture comme il a été montré dans la section précédente.
Par exemple:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesFixture</span> <span class="k">extends</span> <span class="nx">TestFixture</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$import</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;table&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;articles&#39;</span><span class="p">];</span>
    <span class="k">public</span> <span class="nv">$records</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span>
          <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article&#39;</span><span class="p">,</span>
          <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article Body&#39;</span><span class="p">,</span>
          <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
          <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:39:23&#39;</span><span class="p">,</span>
          <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:41:31&#39;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article&#39;</span><span class="p">,</span>
          <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article Body&#39;</span><span class="p">,</span>
          <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
          <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:41:23&#39;</span><span class="p">,</span>
          <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:43:31&#39;</span>
        <span class="p">],</span>
        <span class="p">[</span>
          <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article&#39;</span><span class="p">,</span>
          <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article Body&#39;</span><span class="p">,</span>
          <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span>
          <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:43:23&#39;</span><span class="p">,</span>
          <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2007-03-18 10:45:31&#39;</span>
        <span class="p">]</span>
    <span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vous pouvez ne pas charger/créer schéma dans une fixture. Ceci est utile si
vous aviez déjà une configuration de base de données de test, avec toutes
les tables vides créées. En ne définissant ni <code class="docutils literal"><span class="pre">$fields</span></code> ni <code class="docutils literal"><span class="pre">$import</span></code>, une
fixture va seulement insérer les enregistrements et tronquer les
enregistrements sur chaque méthode de test.</p>
</div>
<div class="section" id="charger-les-fixtures-dans-vos-tests-testcase">
<h3>Charger les Fixtures dans vos Tests (TestCase)<a class="headerlink" href="#charger-les-fixtures-dans-vos-tests-testcase" title="Lien permanent vers ce titre">¶</a></h3>
<p>Après avoir créé vos fixtures, vous pouvez les utiliser dans vos cas de test.
Dans chaque cas de test vous devriez charger les fixtures dont vous aurez
besoin. Vous devriez charger une fixture pour chaque model qui aura une requête
lancée contre elle. Pour charger les fixtures, vous définissez la propriété
<code class="docutils literal"><span class="pre">$fixtures</span></code> dans votre model:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticleTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">,</span> <span class="s1">&#39;app.comments&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ce qui est au-dessus va charger les fixtures d&#8217;Article et de Comment à partir
du répertoire de fixture de l&#8217;application. Vous pouvez aussi charger les
fixtures à partir du cœur de CakePHP ou des plugins:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plugin.DebugKit.articles&#39;</span><span class="p">,</span> <span class="s1">&#39;plugin.MyVendorName/MyPlugin.messages&#39;</span><span class="p">,</span> <span class="s1">&#39;core.comments&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Utiliser le préfixe <code class="docutils literal"><span class="pre">core</span></code> va charger les fixtures à partir de CakePHP, et
utiliser un nom de plugin en préfixe chargera la fixture à partir d&#8217;un plugin
nommé.</p>
<p>Vous pouvez contrôler quand vos fixtures sont chargées en configurant
<code class="xref php php-attr docutils literal"><span class="pre">Cake\TestSuite\TestCase::$autoFixtures</span></code> à <code class="docutils literal"><span class="pre">false</span></code> et plus tard
les charger en utilisant <code class="xref php php-meth docutils literal"><span class="pre">Cake\TestSuite\TestCase::loadFixtures()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">,</span> <span class="s1">&#39;app.comments&#39;</span><span class="p">];</span>
    <span class="k">public</span> <span class="nv">$autoFixtures</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testMyFunction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadFixtures</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">,</span> <span class="s1">&#39;Comments&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vous pouvez charger les fixtures dans les sous-répertoires.
Utiliser plusieurs répertoires peut faciliter l&#8217;organisation de vos fixtures si
vous avez une application plus grande. Pour charger les fixtures dans les
sous-répertoires, incluez simplement le nom du sous-répertoire dans le nom de
la fixture:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ArticlesTableTest</span> <span class="k">extends</span> <span class="nx">CakeTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.blog/articles&#39;</span><span class="p">,</span> <span class="s1">&#39;app.blog/comments&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dans l&#8217;exemple ci-dessus, les deux fixtures seront chargées à partir de
<code class="docutils literal"><span class="pre">tests/Fixture/blog/</span></code>.</p>
</div>
</div>
<div class="section" id="tester-les-classes-table">
<h2>Tester les Classes Table<a class="headerlink" href="#tester-les-classes-table" title="Lien permanent vers ce titre">¶</a></h2>
<p>Disons que nous avons déjà notre table Articles définie dans
<strong>src/Model/Table/ArticlesTable.php</strong>, qui ressemble à ceci:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\ORM\Table</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\Query</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesTable</span> <span class="k">extends</span> <span class="nx">Table</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">findPublished</span><span class="p">(</span><span class="nx">Query</span> <span class="nv">$query</span><span class="p">,</span> <span class="k">array</span> <span class="nv">$options</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">alias</span><span class="p">()</span> <span class="o">.</span> <span class="s1">&#39;.published&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span>
        <span class="p">]);</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nous voulons maintenant configurer un test qui va utiliser la définition du
model, mais à travers les fixtures, pour tester quelques fonctionnalités dans
le model. Le test suite de CakePHP charge un petit ensemble minimum de fichiers
(pour garder les tests isolés), ainsi nous devons commencer par charger notre
model - dans ce cas le model Article que nous avons déjà défini.</p>
<p>Créons maintenant un fichier nommé <strong>ArticlesTableTest.php</strong> dans notre
répertoire <strong>tests/TestCase/Model/Table</strong>, avec le contenu suivant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Model\Table\ArticlesTable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesTableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">];</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dans notre variable de cas de test <code class="docutils literal"><span class="pre">$fixtures</span></code>, nous définissons l&#8217;ensemble
des fixtures que nous utiliserons. Vous devriez vous rappeler d&#8217;inclure tous
les fixtures sur lesquelles des requêtes vont être lancées.</p>
<div class="section" id="creer-une-methode-de-test">
<h3>Créer une Méthode de Test<a class="headerlink" href="#creer-une-methode-de-test" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ajoutons maintenant une méthode pour tester la fonction <code class="docutils literal"><span class="pre">published()</span></code> dans la
table Articles. Modifions le fichier
<strong>tests/TestCase/Model/Table/ArticlesTableTest.php</strong> afin qu&#8217;il ressemble
maintenant à ceci:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Model\Table\ArticlesTable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesTableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testFindPublished</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;published&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="s1">&#39;Cake\ORM\Query&#39;</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">hydrate</span><span class="p">(</span><span class="k">false</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">toArray</span><span class="p">();</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;First Article&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Second Article&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Third Article&#39;</span><span class="p">]</span>
        <span class="p">];</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vous pouvez voir que nous avons ajouté une méthode appelée
<code class="docutils literal"><span class="pre">testFindPublished()</span></code>. Nous commençons par créer une instance de notre model
<code class="docutils literal"><span class="pre">Article</span></code>, et lançons ensuite notre méthode <code class="docutils literal"><span class="pre">published()</span></code>. Dans
<code class="docutils literal"><span class="pre">$expected</span></code>, nous définissons ce que nous en attendons, ce qui devrait être le
résultat approprié (que nous connaissons depuis que nous avons défini les
enregistrements qui sont remplis initialement dans la table articles.). Nous
testons que les résultats correspondent à nos attentes en utilisant la méthode
<code class="docutils literal"><span class="pre">assertEquals()</span></code>. Regardez la section sur les <a class="reference internal" href="#running-tests"><span class="std std-ref">Lancer les Tests</span></a> pour plus
d&#8217;informations sur la façon de lancer les cas de test.</p>
</div>
<div class="section" id="methodes-de-mocking-des-models">
<h3>Méthodes de Mocking des Models<a class="headerlink" href="#methodes-de-mocking-des-models" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il y aura des fois où vous voudrez mocker les méthodes sur les models quand vous
les testez. Vous devrez utiliser <code class="docutils literal"><span class="pre">getMockForModel</span></code> pour créer les mocks de
test des models. Cela évite des problèmes avec les propriétés réfléchies que
les mocks normaux ont:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testSendingEmails</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$model</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockForModel</span><span class="p">(</span><span class="s1">&#39;EmailVerification&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;send&#39;</span><span class="p">]);</span>
    <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">expects</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">once</span><span class="p">())</span>
        <span class="o">-&gt;</span><span class="na">method</span><span class="p">(</span><span class="s1">&#39;send&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">will</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">returnValue</span><span class="p">(</span><span class="k">true</span><span class="p">));</span>

    <span class="nv">$model</span><span class="o">-&gt;</span><span class="na">verifyEmail</span><span class="p">(</span><span class="s1">&#39;test@example.com&#39;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dans votre méthode <code class="docutils literal"><span class="pre">tearDown()</span></code>, assurez-vous de retirer le mock avec ceci:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nx">TableRegistry</span><span class="o">::</span><span class="na">clear</span><span class="p">();</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="test-d-integrations-des-controllers">
<span id="integration-testing"></span><h2>Test d&#8217;Intégrations des Controllers<a class="headerlink" href="#test-d-integrations-des-controllers" title="Lien permanent vers ce titre">¶</a></h2>
<p>Alors que vous pouvez tester les controllers de la même manière que les Helpers,
Models et Components, CakePHP offre une classe spécialisée
<code class="docutils literal"><span class="pre">IntegrationTestCase</span></code>. L&#8217;utilisation de cette classe en tant que classe de
base pour les cas de test de votre controller vous permet de mettre en place des
tests d&#8217;intégration pour vos controllers.</p>
<p>Si vous n&#8217;êtes pas familier avec les tests d&#8217;intégrations, il s&#8217;agit d&#8217;une
approche de test qui facilite le test de plusieurs éléments en même temps. Les
fonctionnalités de test d&#8217;intégration dans CakePHP simulent une requête HTTP à
traiter par votre application. Par exemple, tester vos controllers impactera
les Models, Components et Helpers qui auraient été invoqués suite à une requête
HTTP. Cela vous permet d&#8217;écrire des tests au plus haut niveau de votre
application en ayant un impact sur chacun de ses travaux.</p>
<p>Disons que vous avez un controller typique ArticlesController, et son model
correspondant. Le code du controller ressemble à ceci:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Controller\AppController</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesController</span> <span class="k">extends</span> <span class="nx">AppController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$helpers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Form&#39;</span><span class="p">,</span> <span class="s1">&#39;Html&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">(</span><span class="nv">$short</span> <span class="o">=</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="s1">&#39;post&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$article</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">newEntity</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">());</span>
            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Articles</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$article</span><span class="p">))</span> <span class="p">{</span>
                <span class="c1">// Redirige selon le pattern PRG</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">redirect</span><span class="p">([</span><span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$short</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Article</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;fields&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]</span>
            <span class="p">]);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Article</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span>
            <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Articles&#39;</span><span class="p">,</span>
            <span class="s1">&#39;articles&#39;</span> <span class="o">=&gt;</span> <span class="nv">$result</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Créez un fichier nommé <strong>ArticlesControllerTest.php</strong> dans votre répertoire
<strong>tests/TestCase/Controller</strong> et mettez ce qui suit à l&#8217;intérieur:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\IntegrationTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ArticlesControllerTest</span> <span class="k">extends</span> <span class="nx">IntegrationTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.articles&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndex</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
        <span class="c1">// D&#39;autres asserts.</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndexQueryData</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles?page=1&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
        <span class="c1">// D&#39;autres asserts.</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndexShort</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles/index/short&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseContains</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
        <span class="c1">// D&#39;autres asserts.</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIndexPostData</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;published&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;slug&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;new-article&#39;</span><span class="p">,</span>
            <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;New Article&#39;</span><span class="p">,</span>
            <span class="s1">&#39;body&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;New Body&#39;</span>
        <span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/articles&#39;</span><span class="p">,</span> <span class="nv">$data</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseSuccess</span><span class="p">();</span>
        <span class="nv">$articles</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Articles&#39;</span><span class="p">);</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$articles</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="nv">$data</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Cet exemple montre quelques façons d&#8217;utiliser l&#8217;envoi de requête et quelques
assertions qu&#8217;intègre <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code>. Avant de pouvoir utiliser les
assertions, vous aurez besoin de simuler une requête. Vous pouvez utiliser
l&#8217;une des méthodes suivantes pour simuler une requête:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">get()</span></code> Envoie une requête GET.</li>
<li><code class="docutils literal"><span class="pre">post()</span></code> Envoie une requête POST.</li>
<li><code class="docutils literal"><span class="pre">put()</span></code> Envoie une requête PUT.</li>
<li><code class="docutils literal"><span class="pre">delete()</span></code> Envoie une requête DELETE.</li>
<li><code class="docutils literal"><span class="pre">patch()</span></code> Envoie une requête PATCH.</li>
<li><code class="docutils literal"><span class="pre">options()</span></code> Envoie une requête OPTIONS.</li>
<li><code class="docutils literal"><span class="pre">head()</span></code> Envoie une requête HEAD.</li>
</ul>
<p>Toutes les méthodes exceptées <code class="docutils literal"><span class="pre">get()</span></code> et <code class="docutils literal"><span class="pre">delete()</span></code> acceptent un second
paramètre qui vous permet de saisir le corps d&#8217;une requête. Après avoir émis
une requête, vous pouvez utiliser les différentes assertions que fournit
<code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> ou PHPUnit afin de vous assurer que votre requête
possède de correctes effets secondaires.</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.5.0: </span><code class="docutils literal"><span class="pre">options()</span></code> et <code class="docutils literal"><span class="pre">head()</span></code> ont été ajoutées dans 3.5.0.</p>
</div>
<div class="section" id="configurer-la-requete">
<h3>Configurer la Requête<a class="headerlink" href="#configurer-la-requete" title="Lien permanent vers ce titre">¶</a></h3>
<p>La classe <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> intègre de nombreux helpers pour faciliter
la configuration des requêtes que vous allez envoyer à votre controller:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Définit des cookies</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookie</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;Uncle Bob&#39;</span><span class="p">);</span>

<span class="c1">// Définit des données de session</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">([</span><span class="s1">&#39;Auth.User.id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>

<span class="c1">// Configure les en-têtes</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
    <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Accept&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<p>Les états de ces helpers définis par ces méthodes est remis à zéro dans la
méthode <code class="docutils literal"><span class="pre">tearDown()</span></code>.</p>
</div>
<div class="section" id="tester-des-actions-protegees-par-authcomponent">
<span id="testing-authentication"></span><h3>Tester des Actions Protégées par AuthComponent<a class="headerlink" href="#tester-des-actions-protegees-par-authcomponent" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous utilisez <code class="docutils literal"><span class="pre">AuthComponent</span></code>, vous aurez besoin de simuler les données
de session utilisées par AuthComponent pour valider l&#8217;identité d&#8217;un utilisateur.
Pour ce faire, vous pouvez utiliser les méthodes de helper fournies par
<code class="docutils literal"><span class="pre">IntegrationTestCase</span></code>. En admettant que vous ayez un <code class="docutils literal"><span class="pre">ArticlesController</span></code>
qui contient une méthode add, et que cette méthode nécessite une
authentification, vous pourriez écrire les tests suivants:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testAddUnauthenticatedFails</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Pas de données de session définies.</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles/add&#39;</span><span class="p">);</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRedirect</span><span class="p">([</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;login&#39;</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">testAddAuthenticated</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Définit des données de session</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">([</span>
        <span class="s1">&#39;Auth&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;User&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
                <span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
                <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;testing&#39;</span><span class="p">,</span>
                <span class="c1">// autres clés.</span>
            <span class="p">]</span>
        <span class="p">]</span>
    <span class="p">]);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/articles/add&#39;</span><span class="p">);</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
    <span class="c1">// Autres assertions.</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="testing-stateless-authentication-and-apis">
<h3>Testing Stateless Authentication and APIs<a class="headerlink" href="#testing-stateless-authentication-and-apis" title="Lien permanent vers ce titre">¶</a></h3>
<p>To test APIs that use stateless authentication, such as Basic authentication,
you can configure the request to inject environment conditions or headers that
simulate actual authentication request headers.</p>
<p>When testing Basic or Digest Authentication, you can add the environment
variables that <a class="reference external" href="http://php.net/manual/en/features.http-auth.php">PHP creates</a>
automatically. These environment variables used in the authentication adapter
outlined in <a class="reference internal" href="../controllers/components/authentication.html#basic-authentication"><span class="std std-ref">Utiliser l&#8217;Authentification Basic</span></a>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testBasicAuthentication</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
        <span class="s1">&#39;environment&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;PHP_AUTH_USER&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span>
            <span class="s1">&#39;PHP_AUTH_PW&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">]);</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/api/posts&#39;</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you are testing other forms of authentication, such as OAuth2, you can set
the Authorization header directly:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testOauthToken</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
        <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">&#39;authorization&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bearer: oauth-token&#39;</span>
        <span class="p">]</span>
    <span class="p">]);</span>

    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/api/posts&#39;</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The headers key in <code class="docutils literal"><span class="pre">configRequest()</span></code> can be used to configure any additional
HTTP headers needed for an action.</p>
</div>
<div class="section" id="tester-les-actions-protegees-par-csrfcomponent-ou-securitycomponent">
<h3>Tester les Actions Protégées par CsrfComponent ou SecurityComponent<a class="headerlink" href="#tester-les-actions-protegees-par-csrfcomponent-ou-securitycomponent" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand vous testez les actions protégées par SecurityComponent ou CsrfComponent,
vous pouvez activer la génération automatique de token pour vous assurer que vos
tests ne vont pas être en échec à cause d&#8217;un token non présent:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testAdd</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enableCsrfToken</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enableSecurityToken</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/posts/add&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;News excitante!&#39;</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il est aussi important d&#8217;activer debug dans les tests qui utilisent les tokens
pour éviter que le SecurityComponent pense que le token debug est utilisé dans
un environnement non-debug. Quand vous testez avec d&#8217;autres méthodes comme
<code class="docutils literal"><span class="pre">requireSecure()</span></code>, vous pouvez utiliser <code class="docutils literal"><span class="pre">configRequest()</span></code> pour définir les
bonnes variables d&#8217;environnement:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Fake out SSL connections.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
    <span class="s1">&#39;environment&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;HTTPS&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;on&#39;</span><span class="p">]</span>
<span class="p">]);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.1.2: </span>Les méthodes <code class="docutils literal"><span class="pre">enableCsrfToken()</span></code> et <code class="docutils literal"><span class="pre">enableSecurityToken()</span></code> ont été
ajoutées dans la version 3.1.2.</p>
</div>
</div>
<div class="section" id="test-d-integration-sur-les-middlewares-psr-7">
<h3>Test d&#8217;intégration sur les middlewares PSR-7<a class="headerlink" href="#test-d-integration-sur-les-middlewares-psr-7" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les tests d&#8217;intégration peuvent aussi être utilisés pour tester entièrement vos
applications PSR-7 et les <a class="reference internal" href="../controllers/middleware.html"><span class="doc">Middleware</span></a>. Par défaut,
<code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> détectera automatiquement la présence d&#8217;une classe
<code class="docutils literal"><span class="pre">App\Application</span></code> et activera automatiquement les tests d&#8217;intégration sur
votre Application. Vous pouvez activer / désactiver ce comportement avec la
méthode <code class="docutils literal"><span class="pre">useHttpServer()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Active les tests d&#39;intégration PSR-7</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">useHttpServer</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>

    <span class="c1">// Désactive les tests d&#39;intégration PSR-7</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">useHttpServer</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vous pouvez personnaliser le nom de la classe Application utilisé ainsi que les
arguments du contructeur en utilisant la méthode <code class="docutils literal"><span class="pre">configApplication()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configApplication</span><span class="p">(</span><span class="s1">&#39;App\App&#39;</span><span class="p">,</span> <span class="p">[</span><span class="nx">CONFIG</span><span class="p">]);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Après avoir activé le mode PSR-7 (et avoir peut-être configuré la classe
d&#8217;Application), vous pouvez utiliser le reste des fonctionnalités de
<code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> normalement.</p>
<p>Vous devriez également faire en sorte d&#8217;utiliser <a class="reference internal" href="configuration.html#application-bootstrap"><span class="std std-ref">Application::bootstrap()</span></a>
pour charger les plugins qui contiennent des événements et des routes. De cette
manière, vous vous assurez que les événements et les routes seront connectés pour
chacun de vos &#8220;test case&#8221;.</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.3.0: </span>Les Middleware PSR-7 et la méthode <code class="docutils literal"><span class="pre">useHttpServer()</span></code> ont été ajoutée avec 3.3.0.</p>
</div>
</div>
<div class="section" id="tester-avec-des-cookies-chiffres">
<h3>Tester avec des cookies chiffrés<a class="headerlink" href="#tester-avec-des-cookies-chiffres" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous utilisez le <a class="reference internal" href="../controllers/components/cookie.html#Cake\Controller\Component\CookieComponent" title="Cake\Controller\Component\CookieComponent"><code class="xref php php-class docutils literal"><span class="pre">Cake\Controller\Component\CookieComponent</span></code></a>
dans vos controllers, vos cookies sont probablement chiffrés. Depuis 3.1.7,
CakePHP met à votre disposition des méthodes pour intéragir avec les cookies
chiffrés dans vos &#8220;test cases&#8221;:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Définit un cookie en utilisant AES et la clé par défaut.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookieEncrypted</span><span class="p">(</span><span class="s1">&#39;my_cookie&#39;</span><span class="p">,</span> <span class="s1">&#39;Some secret values&#39;</span><span class="p">);</span>

<span class="c1">// Partons du principe que cette requête modifie le cookie.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/bookmarks/index&#39;</span><span class="p">);</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCookieEncrypted</span><span class="p">(</span><span class="s1">&#39;An updated value&#39;</span><span class="p">,</span> <span class="s1">&#39;my_cookie&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.1.7: </span><code class="docutils literal"><span class="pre">assertCookieEncrypted</span></code> et <code class="docutils literal"><span class="pre">cookieEncrypted</span></code> ont été ajoutées dans 3.1.7.</p>
</div>
</div>
<div class="section" id="tester-les-messages-flash">
<h3>Tester les Messages Flash<a class="headerlink" href="#tester-les-messages-flash" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous souhaitez faire une assertion sur la présence de messages Flash en
session et pas sur le rendu du HTML, vous pouvez utiliser <code class="docutils literal"><span class="pre">enableRetainFlashMessages()</span></code>
dans vos tests pour que les messages Flash soient conservés dans la session
pour que vous puissez écrire vos assertions:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">enableRetainFlashMessages</span><span class="p">();</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/bookmarks/delete/9999&#39;</span><span class="p">);</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSession</span><span class="p">(</span><span class="s1">&#39;That bookmark does not exist&#39;</span><span class="p">,</span> <span class="s1">&#39;Flash.flash.0.message&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.4.7: </span><code class="docutils literal"><span class="pre">enableRetainFlashMessages()</span></code> a été ajoutée dans 3.4.7</p>
</div>
</div>
<div class="section" id="tester-un-controller-retournant-du-json">
<h3>Tester un controller retournant du JSON<a class="headerlink" href="#tester-un-controller-retournant-du-json" title="Lien permanent vers ce titre">¶</a></h3>
<p>JSON est un format commun lors de la conception de web service. Tester les
endpoints de votre web service est très simple avec CakePHP. Commençons avec
un exemple simple de controller qui renvoie du JSON:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MarkersController</span> <span class="k">extends</span> <span class="nx">AppController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">initialize</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">initialize</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadComponent</span><span class="p">(</span><span class="s1">&#39;RequestHandler&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">view</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$marker</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Markers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span>
            <span class="s1">&#39;_serialize&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">],</span>
            <span class="s1">&#39;marker&#39;</span> <span class="o">=&gt;</span> <span class="nv">$marker</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Créons maintenant le fichier <strong>tests/TestCase/Controller/MarkersControllerTest.php</strong>
et assurons-nous que le web service répond correctement:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MarkersControllerTest</span> <span class="k">extends</span> <span class="nx">IntegrationTestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
            <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Accept&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">]</span>
        <span class="p">]);</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/markers/view/1.json&#39;</span><span class="p">);</span>

        <span class="c1">// Vérification que la réponse était bien une 200</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>

        <span class="nv">$expected</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;lng&#39;</span> <span class="o">=&gt;</span> <span class="mi">66</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span> <span class="o">=&gt;</span> <span class="mi">45</span><span class="p">],</span>
        <span class="p">];</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nx">JSON_PRETTY_PRINT</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_response</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nous utilisons l&#8217;option <code class="docutils literal"><span class="pre">JSON_PRETTY_PRINT</span></code> car la JsonView intégrée à CakePHP
utilise cette option quand le mode <code class="docutils literal"><span class="pre">debug</span></code> est activé.</p>
</div>
<div class="section" id="desactiver-le-middleware-de-gestion-d-erreurs-dans-les-tests">
<h3>Désactiver le Middleware de Gestion d&#8217;Erreurs dans les Tests<a class="headerlink" href="#desactiver-le-middleware-de-gestion-d-erreurs-dans-les-tests" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand vous debuggez des tests qui échouent car l&#8217;application a rencontré des
erreurs, il peut être utile de désactiver temporairement le middleware de gestion
des erreurs pour permettre aux erreurs de remonter. Vous pouvez utiliser la méthode
<code class="docutils literal"><span class="pre">disableErrorHandlerMiddleware()</span></code> pour permettre ce comportement:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testGetMissing</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">disableErrorHandlerMiddleware</span><span class="p">();</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/markers/not-there&#39;</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseCode</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dans l&#8217;exemple ci-dessus, le test échouera et le message d&#8217;exception et le stack-trace
seront affichés à la place de la page d&#8217;erreur de l&#8217;application.</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.5.0.</span></p>
</div>
</div>
<div class="section" id="methodes-d-assertion">
<h3>Méthodes d&#8217;Assertion<a class="headerlink" href="#methodes-d-assertion" title="Lien permanent vers ce titre">¶</a></h3>
<p>La classe <code class="docutils literal"><span class="pre">IntegrationTestCase</span></code> vous fournis de nombreuses méthodes
d&#8217;assertions afin de tester plus simplement les réponses. Quelques exemples:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Vérifie un code de réponse 2xx</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>

<span class="c1">// Vérifie un code de réponse 2xx/3xx</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseSuccess</span><span class="p">();</span>

<span class="c1">// Vérifie un code de réponse 4xx</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseError</span><span class="p">();</span>

<span class="c1">// Vérifie un code de réponse 5xx</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseFailure</span><span class="p">();</span>

<span class="c1">// Vérifie un code de réponse spécifique, par exemple 200</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseCode</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>

<span class="c1">// Vérifie l&#39;en-tête Location</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRedirect</span><span class="p">([</span><span class="s1">&#39;controller&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Articles&#39;</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;index&#39;</span><span class="p">]);</span>

<span class="c1">// Vérifie qu&#39;aucun en-tête Location n&#39;a été envoyé</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNoRedirect</span><span class="p">();</span>

<span class="c1">// Vérifie une partie de l&#39;en-tête Location</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertRedirectContains</span><span class="p">(</span><span class="s1">&#39;/articles/edit/&#39;</span><span class="p">);</span>

<span class="c1">// Vérifie que le contenu de la réponse n&#39;est pas vide</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseNotEmpty</span><span class="p">();</span>

<span class="c1">// Vérifie que le contenu de la réponse est vide</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseEmpty</span><span class="p">();</span>

<span class="c1">// Vérifie le contenu de la réponse</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseEquals</span><span class="p">(</span><span class="s1">&#39;Yeah!&#39;</span><span class="p">);</span>

<span class="c1">// Vérifie un contenu partiel de la réponse</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseContains</span><span class="p">(</span><span class="s1">&#39;You won!&#39;</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseNotContains</span><span class="p">(</span><span class="s1">&#39;You lost!&#39;</span><span class="p">);</span>

<span class="c1">// Vérifie le layout</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertLayout</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">);</span>

<span class="c1">// Vérifie quel Template a été rendu.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTemplate</span><span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">);</span>

<span class="c1">// Vérifie les données de la session</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSession</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Auth.User.id&#39;</span><span class="p">);</span>

<span class="c1">// Vérifie l&#39;entête de la réponse.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertHeader</span><span class="p">(</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">,</span> <span class="s1">&#39;application/json&#39;</span><span class="p">);</span>

<span class="c1">// Vérifie le contenu d&#39;une variable.</span>
<span class="nv">$user</span> <span class="o">=</span>  <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">viewVariable</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;jose&#39;</span><span class="p">,</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">username</span><span class="p">);</span>

<span class="c1">// Vérifie les cookies.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCookie</span><span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;thingid&#39;</span><span class="p">);</span>

<span class="c1">// Vérifie le type de contenu</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertContentType</span><span class="p">(</span><span class="s1">&#39;application/json&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>En plus des méthodes d&#8217;assertion ci-dessus, vous pouvez également utiliser
toutes les assertions de <a class="reference external" href="https://api.cakephp.org/3.x/class-Cake.TestSuite.TestCase.html">TestSuite</a> et celles
de
<a class="reference external" href="https://phpunit.de/manual/current/en/appendixes.assertions.html">PHPUnit</a>.</p>
</div>
<div class="section" id="comparer-les-resultats-du-test-avec-un-fichier">
<h3>Comparer les Résultats du Test avec un Fichier<a class="headerlink" href="#comparer-les-resultats-du-test-avec-un-fichier" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour certains types de test, il peut être plus simple de comparer les résultats
d&#8217;un test avec le contenu d&#8217;un fichier - par exemple, quand vous testez la
sortie rendue d&#8217;une view.
<code class="docutils literal"><span class="pre">StringCompareTrait</span></code> ajoute une méthode d&#8217;assertion simple pour cela.</p>
<p>Pour l&#8217;utiliser, vous devez inclure un Trait, définir le chemin de base de
comparaison et appeler <code class="docutils literal"><span class="pre">assertSameAsFile</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">use</span> <span class="nx">Cake\TestSuite\StringCompareTrait</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SomeTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">StringCompareTrait</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_compareBasePath</span> <span class="o">=</span> <span class="nx">APP</span> <span class="o">.</span> <span class="s1">&#39;tests&#39;</span> <span class="o">.</span> <span class="nx">DS</span> <span class="o">.</span> <span class="s1">&#39;comparisons&#39;</span> <span class="o">.</span> <span class="nx">DS</span><span class="p">;</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testExample</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="o">...</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSameAsFile</span><span class="p">(</span><span class="s1">&#39;example.php&#39;</span><span class="p">,</span> <span class="nv">$result</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>L&#8217;exemple ci-dessus va comparer <code class="docutils literal"><span class="pre">$result</span></code> au contenu du fichier
<code class="docutils literal"><span class="pre">APP/tests/comparisons/example.php</span></code>.</p>
<p>Un mécanisme est fourni pour écrire/mettre à jour les fichiers de test, en
définissant la variable d&#8217;environment <code class="docutils literal"><span class="pre">UPDATE_TEST_COMPARISON_FILES</span></code>, ce qui
va créer et/ou mettre à jour les fichiers de comparaison de test au fur et à
mesure où ils sont rendus:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>phpunit
...
FAILURES!
Tests: <span class="m">6</span>, Assertions: <span class="m">7</span>, Failures: <span class="m">1</span>

<span class="nv">UPDATE_TEST_COMPARISON_FILES</span><span class="o">=</span><span class="m">1</span> phpunit
...
OK <span class="o">(</span><span class="m">6</span> tests, <span class="m">7</span> assertions<span class="o">)</span>

git status
...
<span class="c1"># Changes not staged for commit:</span>
<span class="c1">#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span>
<span class="c1">#   (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span>
<span class="c1">#</span>
<span class="c1">#   modified:   tests/comparisons/example.php</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h3>Tester avec des Cookies Chiffrés<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous utilisez <a class="reference internal" href="../controllers/components/cookie.html#Cake\Controller\Component\CookieComponent" title="Cake\Controller\Component\CookieComponent"><code class="xref php php-class docutils literal"><span class="pre">Cake\Controller\Component\CookieComponent</span></code></a> dans
vos controllers, vos cookies sont probablement chiffrés. Depuis 3.1.7, CakePHP
fournit des méthodes pour intéragir avec les cookies chiffrés dans vos cas de
test:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// Définit un cookie en utilisant aes et la clé par défaut.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">cookieEncrypted</span><span class="p">(</span><span class="s1">&#39;my_cookie&#39;</span><span class="p">,</span> <span class="s1">&#39;Some secret values&#39;</span><span class="p">);</span>

<span class="c1">// En supposant que cette action modifie le cookie.</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/bookmarks/index&#39;</span><span class="p">);</span>

<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertCookieEncrypted</span><span class="p">(</span><span class="s1">&#39;Une valeur mise à jour&#39;</span><span class="p">,</span> <span class="s1">&#39;my_cookie&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="tester-un-controller-dont-la-reponse-est-au-format-json">
<h3>Tester un Controller dont la Réponse est au format JSON<a class="headerlink" href="#tester-un-controller-dont-la-reponse-est-au-format-json" title="Lien permanent vers ce titre">¶</a></h3>
<p>JSON est un format sympa et courant à utiliser quand on construit un service
web. Tester les endpoints de votre service web est très simple avec CakePHP.
Commençons par un exemple de controller simple qui répond en JSON:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MarkersController</span> <span class="k">extends</span> <span class="nx">AppController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$components</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;RequestHandler&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">view</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$marker</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Markers</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span>
            <span class="s1">&#39;_serialize&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;marker&#39;</span><span class="p">],</span>
            <span class="s1">&#39;marker&#39;</span> <span class="o">=&gt;</span> <span class="nv">$marker</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Maintenant créons un fichier
<strong>tests/TestCase/Controller/MarkersControllerTest.php</strong> et assurons-nous que
notre service web retourne une réponse appropriée:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MarkersControllerTest</span> <span class="k">extends</span> <span class="nx">IntegrationTestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testGet</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">configRequest</span><span class="p">([</span>
            <span class="s1">&#39;headers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;Accept&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">]</span>
        <span class="p">]);</span>
        <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/markers/view/1.json&#39;</span><span class="p">);</span>

        <span class="c1">// Vérifie que le code de réponse est 200</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertResponseOk</span><span class="p">();</span>

        <span class="nv">$expected</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;lng&#39;</span> <span class="o">=&gt;</span> <span class="mi">66</span><span class="p">,</span> <span class="s1">&#39;lat&#39;</span> <span class="o">=&gt;</span> <span class="mi">45</span><span class="p">],</span>
        <span class="p">];</span>
        <span class="nv">$expected</span> <span class="o">=</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nx">JSON_PRETTY_PRINT</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="nv">$expected</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_response</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Nous utilisons l&#8217;option <code class="docutils literal"><span class="pre">JSON_PRETTY_PRINT</span></code> comme le fait CakePHP à partir de
la classe JsonView. Ce dernier utilise cette option quand le mode <code class="docutils literal"><span class="pre">debug</span></code> est
activé. Vous pouvez utiliser ceci afin que votre test marche dans les deux cas:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nb">json_encode</span><span class="p">(</span><span class="nv">$data</span><span class="p">,</span> <span class="nx">Configure</span><span class="o">::</span><span class="na">read</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">JSON_PRETTY_PRINT</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tests-d-integration-de-la-console">
<span id="console-integration-testing"></span><h2>Tests d&#8217;Intégration de la Console<a class="headerlink" href="#tests-d-integration-de-la-console" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour faciliter les tests de vos applications console, CakePHP est doté d&#8217;une classe
<code class="docutils literal"><span class="pre">ConsoleIntegrationTestCase</span></code> qui peut être utilisée pour tester vos applications
consoles et faire des assertions sur leurs résultats.</p>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.5.0: </span><code class="docutils literal"><span class="pre">ConsoleIntegrationTestCase</span></code> a été ajoutée dans 3.5.0.</p>
</div>
<p>Pour commencer à tester votre application console, créez un &#8220;test case&#8221; qui <em>extends</em>
<code class="docutils literal"><span class="pre">Cake\TestSuite\ConsoleIntegrationTestCase</span></code>. Cette classe contient une méthode
<code class="docutils literal"><span class="pre">exec()</span></code> qui est utilisée pour exécuter votre commande. Vous pouvez passer la
même chaîne que vous passeriez au CLI dans cette méthode.</p>
<p>Commençons par créer un shell très simple, stocké dans <strong>src/Shell/MyConsoleShell.php</strong>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Console\ConsoleOptionParser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Console\Shell</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShell</span> <span class="k">extends</span> <span class="nx">Shell</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOptionParser</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>
        <span class="nv">$parser</span><span class="o">-&gt;</span><span class="na">setDescription</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$parser</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pour écrire un test d&#8217;intégration pour ce shell, on va créer un &#8220;test case&#8221; dans
<strong>tests/TestCase/Shell/MyConsoleShellTest.php</strong> qui <em>extends</em>
<code class="docutils literal"><span class="pre">Cake\TestSuite\ConsoleIntegrationTestCase</span></code>. Ce shell ne fait pas grand chose
pour le moment, mais testons que la description de notre shell est affichée dans
<code class="docutils literal"><span class="pre">stdout</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\TestSuite\ConsoleIntegrationTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShellTest</span> <span class="k">extends</span> <span class="nx">ConsoleIntegrationTestCase</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDescriptionOutput</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputContains</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Les tests passent ! Même si c&#8217;est un exemple très simple, cela prouve que construire
un test d&#8217;intégration pour une application console est facile. Continuons en ajoutant
des sous-commandes et des options à notre shell:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Console\ConsoleOptionParser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\I18n\FrozenTime</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShell</span> <span class="k">extends</span> <span class="nx">Shell</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOptionParser</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>

        <span class="nv">$updateModifiedParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>
        <span class="nv">$updateModifiedParser</span><span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;help&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Table to update&#39;</span><span class="p">,</span>
            <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">]);</span>

        <span class="nv">$parser</span>
            <span class="o">-&gt;</span><span class="na">setDescription</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">addSubcommand</span><span class="p">(</span><span class="s1">&#39;updateModified&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;parser&#39;</span> <span class="o">=&gt;</span> <span class="nv">$updateModifiedParser</span>
            <span class="p">]);</span>

        <span class="k">return</span> <span class="nv">$parser</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateModified</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$table</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadModel</span><span class="p">(</span><span class="nv">$table</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$table</span><span class="p">}</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">update</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span>
                <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">FrozenTime</span><span class="p">()</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>C&#8217;est maintenant un shell plus complexe avec une sous-commande et son propre parser.
Testons la sous-commande <code class="docutils literal"><span class="pre">updateModified</span></code>. Modifier votre &#8220;test case&#8221; avec le
morceau de code suivant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">Cake\Test\TestCase\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Console\Shell</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\I18n\FrozenTime</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\ConsoleIntegrationTestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShellTest</span> <span class="k">extends</span> <span class="nx">ConsoleIntegrationTestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1">// assumes you have a UsersFixture</span>
        <span class="s1">&#39;app.users&#39;</span>
    <span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testDescriptionOutput</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputContains</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUpdateModified</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$now</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FrozenTime</span><span class="p">(</span><span class="s1">&#39;2017-01-01 00:00:00&#39;</span><span class="p">);</span>
        <span class="nx">FrozenTime</span><span class="o">::</span><span class="na">setTestNow</span><span class="p">(</span><span class="nv">$now</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadFixtures</span><span class="p">(</span><span class="s1">&#39;Users&#39;</span><span class="p">);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console update_modified Users&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertExitCode</span><span class="p">(</span><span class="nx">Shell</span><span class="o">::</span><span class="na">CODE_SUCCESS</span><span class="p">);</span>

        <span class="nv">$user</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Users&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertSame</span><span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">modified</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">,</span> <span class="nv">$now</span><span class="o">-&gt;</span><span class="na">timestamp</span><span class="p">);</span>

        <span class="nx">FrozenTime</span><span class="o">::</span><span class="na">setTestNow</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Comme vous pouvez le voir via la méthode <code class="docutils literal"><span class="pre">testUpdateModified</span></code>, nous testons
que la sous-commande <code class="docutils literal"><span class="pre">update_modified</span></code> met à jour la table que nous passons
comme premier argument. Premièrement, nous faisons l&#8217;assertion que le shell
a terminé de s&#8217;exécuter avec le bon code de statut, <code class="docutils literal"><span class="pre">0</span></code>. Ensuite, nous testons
que notre sous-commande a fait son travail, c&#8217;est-à-dire qu&#8217;elle a correctement
mis à jour la colonne <code class="docutils literal"><span class="pre">modified</span></code> de la table que nous avons passée en argument.</p>
<p>Gardez bien en mémoire que la méthode <code class="docutils literal"><span class="pre">exec()</span></code> accepte la même chaîne que ce
que vous tapez dans votre CLI, donc vous pouvez ajouter des options et des arguments
pour tester un maximum de cas.</p>
<div class="section" id="tester-les-shells-interactifs">
<h3>Tester les Shells Interactifs<a class="headerlink" href="#tester-les-shells-interactifs" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les applications console sont souvent interactives. Tester les shells interactifs
avec la classe <code class="docutils literal"><span class="pre">Cake\TestSuite\ConsoleIntegrationTestCase</span></code> va seulement nécessiter
que vous passiez les données attendues comme second paramètre de la méthode <code class="docutils literal"><span class="pre">exec()</span></code>.
Ces données doivent être passées sous forme de tableau, dans l&#8217;ordre dans lequel ces
données sont attendues.</p>
<p>En continuant avec notre shell d&#8217;exemple, ajoutons une sous-commande interactive.
Mettez à jour la classe de shell avec le code suivant:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Shell</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\Console\ConsoleOptionParser</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Console\Shell</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\I18n\FrozenTime</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MyConsoleShell</span> <span class="k">extends</span> <span class="nx">Shell</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">getOptionParser</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>

        <span class="nv">$updateModifiedParser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleOptionParser</span><span class="p">();</span>
        <span class="nv">$updateModifiedParser</span><span class="o">-&gt;</span><span class="na">addArgument</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">[</span>
            <span class="s1">&#39;help&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Table to update&#39;</span><span class="p">,</span>
            <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span>
        <span class="p">]);</span>

        <span class="nv">$parser</span>
            <span class="o">-&gt;</span><span class="na">setDescription</span><span class="p">(</span><span class="s1">&#39;My cool console app&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">addSubcommand</span><span class="p">(</span><span class="s1">&#39;updateModified&#39;</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;parser&#39;</span> <span class="o">=&gt;</span> <span class="nv">$updateModifiedParser</span>
            <span class="p">])</span>
            <span class="c1">// add a new subcommand</span>
            <span class="o">-&gt;</span><span class="na">addSubcommand</span><span class="p">(</span><span class="s1">&#39;bestFramework&#39;</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$parser</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">updateModified</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$table</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">loadModel</span><span class="p">(</span><span class="nv">$table</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="p">{</span><span class="nv">$table</span><span class="p">}</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">update</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">set</span><span class="p">([</span>
                <span class="s1">&#39;modified&#39;</span> <span class="o">=&gt;</span> <span class="k">new</span> <span class="nx">FrozenTime</span><span class="p">()</span>
            <span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// create this interactive subcommand</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">bestFramework</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">out</span><span class="p">(</span><span class="s1">&#39;Hi there!&#39;</span><span class="p">);</span>

        <span class="nv">$framework</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">in</span><span class="p">(</span><span class="s1">&#39;What is the best PHP framework?&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$framework</span> <span class="o">!==</span> <span class="s1">&#39;CakePHP&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">err</span><span class="p">(</span><span class="s2">&quot;I disagree that &#39;</span><span class="si">$framework</span><span class="s2">&#39; is the best.&quot;</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">_stop</span><span class="p">(</span><span class="nx">Shell</span><span class="o">::</span><span class="na">CODE_ERROR</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">out</span><span class="p">(</span><span class="s1">&#39;I agree!&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Maintenant que nous avons une sous-commande interactive, nous pouvons ajouter
un test qui va permettre de vérifier que nous recevons la réponse attendue et
un test où nous passerons une réponse que nous savons incorrecte. Ajoutez les
méthodes suivantes dans <strong>tests/TestCase/Shell/MyConsoleShellTest.php</strong>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">public</span> <span class="k">function</span> <span class="nf">testBestFramework</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console best_framework&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;CakePHP&#39;</span>
    <span class="p">]);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertExitCode</span><span class="p">(</span><span class="nx">Shell</span><span class="o">::</span><span class="na">CODE_SUCCESS</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputContains</span><span class="p">(</span><span class="s1">&#39;I agree!&#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">function</span> <span class="nf">testBestFrameworkWrongAnswer</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">exec</span><span class="p">(</span><span class="s1">&#39;my_console best_framework&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;my homemade framework&#39;</span>
    <span class="p">]);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertExitCode</span><span class="p">(</span><span class="nx">Shell</span><span class="o">::</span><span class="na">CODE_ERROR</span><span class="p">);</span>
    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertErrorRegExp</span><span class="p">(</span><span class="s2">&quot;/I disagree that \&#39;(.+)\&#39; is the best\./&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Comme vous pouvez le voir dans <code class="docutils literal"><span class="pre">testBestFramework</span></code>, il répond à la première
valeur passée &#8220;CakePHP&#8221;. Puisque que c&#8217;est la réponse attendue par notre
sous-commande, le shell termine avec un succès après avoir retourné une réponse.</p>
<p>Le second test, <code class="docutils literal"><span class="pre">testBestFrameworkWrongAnswer</span></code>, passe une réponse invalide ce
qui fait que notre shell échoue et retourne le code <code class="docutils literal"><span class="pre">1</span></code>. Nous faisons également
l&#8217;assertion que <code class="docutils literal"><span class="pre">stderr</span></code> a bien reçu notre erreur et que le retour contient bien
la valeur incorrecte passée en paramètre.</p>
</div>
<div class="section" id="tester-le-commandrunner">
<h3>Tester le CommandRunner<a class="headerlink" href="#tester-le-commandrunner" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour tester les shells qui sont &#8220;dispatchées&#8221; via la classe <code class="docutils literal"><span class="pre">CommandRunner</span></code>,
activer le dans votre &#8220;test case&#8221; avec la méthode suivante:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">useCommandRunner</span><span class="p">();</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.5.0: </span>La classe <code class="docutils literal"><span class="pre">CommandRunner</span></code> a été ajoutée dans 3.5.0.</p>
</div>
</div>
<div class="section" id="methodes-d-assertions">
<h3>Méthodes d&#8217;assertions<a class="headerlink" href="#methodes-d-assertions" title="Lien permanent vers ce titre">¶</a></h3>
<p>La classe <code class="docutils literal"><span class="pre">Cake\TestSuite\ConsoleIntegrationTestCase</span></code> met à disposition
plusieurs méthodes qui facilitent les assertions des sorties de console:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// s&#39;assure que le shell a quitté avec le code attendu</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertExitCode</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>

<span class="c1">// s&#39;assure que stdout contient une chaîne</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputContains</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>

<span class="c1">// s&#39;assure que stderr contient une chaîne</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertErrorContains</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>

<span class="c1">// s&#39;assure que stdout &quot;match&quot; une regex</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertOutputRegExp</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>

<span class="c1">// s&#39;assure que stderr &quot;match&quot; une regex</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertErrorRegExp</span><span class="p">(</span><span class="nv">$expected</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tester-les-views">
<h2>Tester les Views<a class="headerlink" href="#tester-les-views" title="Lien permanent vers ce titre">¶</a></h2>
<p>Généralement, la plupart des applications ne va pas directement tester leur
code HTML. Faire ça donne souvent des résultats fragiles, il est difficile de
maintenir les suites de test qui sont sujet à se casser. En écrivant des
tests fonctionnels en utilisant <code class="xref php php-class docutils literal"><span class="pre">ControllerTestCase</span></code>, vous
pouvez inspecter le contenu de la vue rendue en configurant l&#8217;option
<code class="docutils literal"><span class="pre">return</span></code> à &#8216;view&#8217;. Alors qu&#8217;il est possible de tester le contenu de la vue
en utilisant ControllerTestCase, un test d&#8217;intégration/vue plus robuste
et maintenable peut être effectué en utilisant des outils comme
<a class="reference external" href="http://seleniumhq.org">Selenium webdriver</a>.</p>
</div>
<div class="section" id="tester-les-components">
<h2>Tester les Components<a class="headerlink" href="#tester-les-components" title="Lien permanent vers ce titre">¶</a></h2>
<p>Imaginons que nous avons un component appelé PagematronComponent dans notre
application. Ce component nous aide à paginer la valeur limite à travers tous
les controllers qui l&#8217;utilisent. Voici notre exemple de component localisé dans
<strong>src/Controller/Component/PagematronComponent.php</strong>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PagematronComponent</span> <span class="k">extends</span> <span class="nx">Component</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nv">$controller</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setController</span><span class="p">(</span><span class="nv">$controller</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span> <span class="o">=</span> <span class="nv">$controller</span><span class="p">;</span>
        <span class="c1">// Assurez-vous que le controller utilise la pagination.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">startup</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">setController</span><span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getSubject</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">adjust</span><span class="p">(</span><span class="nv">$length</span> <span class="o">=</span> <span class="s1">&#39;short&#39;</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nv">$length</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">&#39;long&#39;</span><span class="o">:</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">&#39;medium&#39;</span><span class="o">:</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Maintenant nous pouvons écrire des tests pour nous assurer que notre paramètre
de pagination <code class="docutils literal"><span class="pre">limit</span></code> est défini correctement par la méthode <code class="docutils literal"><span class="pre">adjust()</span></code>
dans notre component. Nous créons le fichier
<strong>tests/TestCase/Controller/Component/PagematronComponentTest.php</strong>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Controller\Component</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Controller\Component\PagematronComponent</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Controller\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Controller\ComponentRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Event\Event</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Http\ServerRequest</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Http\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PagematronComponentTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$component</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$controller</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="c1">// Configuration de notre component et de notre faux controller de test.</span>
        <span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ServerRequest</span><span class="p">();</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getMockBuilder</span><span class="p">(</span><span class="s1">&#39;Cake\Controller\Controller&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">setConstructorArgs</span><span class="p">([</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">])</span>
            <span class="o">-&gt;</span><span class="na">setMethods</span><span class="p">(</span><span class="k">null</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">getMock</span><span class="p">();</span>
        <span class="nv">$registry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ComponentRegistry</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PagematronComponent</span><span class="p">(</span><span class="nv">$registry</span><span class="p">);</span>
        <span class="nv">$event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;Controller.startup&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="o">-&gt;</span><span class="na">startup</span><span class="p">(</span><span class="nv">$event</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAdjust</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Test de notre méthode avec différents paramètres.</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="o">-&gt;</span><span class="na">adjust</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="o">-&gt;</span><span class="na">adjust</span><span class="p">(</span><span class="s1">&#39;medium&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="o">-&gt;</span><span class="na">adjust</span><span class="p">(</span><span class="s1">&#39;long&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">paginate</span><span class="p">[</span><span class="s1">&#39;limit&#39;</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">tearDown</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">tearDown</span><span class="p">();</span>
        <span class="c1">// Nettoie les variables quand les tests sont finis.</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">component</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="tester-les-helpers">
<h2>Tester les Helpers<a class="headerlink" href="#tester-les-helpers" title="Lien permanent vers ce titre">¶</a></h2>
<p>Puisqu&#8217;un bon nombre de logique se situe dans les classes Helper, il est
important de s&#8217;assurer que ces classes sont couvertes par des cas de test.</p>
<p>Tout d&#8217;abord, nous créons un helper d&#8217;exemple à tester.
<code class="docutils literal"><span class="pre">CurrencyRendererHelper</span></code> va nous aider à afficher les monnaies dans nos vues
et pour simplifier, il ne va avoir qu&#8217;une méthode <code class="docutils literal"><span class="pre">usd()</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// src/View/Helper/CurrencyRendererHelper.php</span>
<span class="k">namespace</span> <span class="nx">App\View\Helper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Cake\View\Helper</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CurrencyRendererHelper</span> <span class="k">extends</span> <span class="nx">Helper</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">usd</span><span class="p">(</span><span class="nv">$amount</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s1">&#39;USD &#39;</span> <span class="o">.</span> <span class="nb">number_format</span><span class="p">(</span><span class="nv">$amount</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ici nous définissons la décimale à 2 après la virgule, le séparateur de
décimal, le séparateur des centaines avec une virgule, et le nombre formaté
avec la chaîne &#8216;USD&#8217; en préfixe.</p>
<p>Maintenant nous créons nos tests:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">// tests/TestCase/View/Helper/CurrencyRendererHelperTest.php</span>

<span class="k">namespace</span> <span class="nx">App\Test\TestCase\View\Helper</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\View\Helper\CurrencyRendererHelper</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\View\View</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CurrencyRendererHelperTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$helper</span> <span class="o">=</span> <span class="k">null</span><span class="p">;</span>

    <span class="c1">// Nous instancions notre helper</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="nv">$View</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">View</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CurrencyRendererHelper</span><span class="p">(</span><span class="nv">$View</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Test de la fonction usd()</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testUsd</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;USD 5.30&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span><span class="o">-&gt;</span><span class="na">usd</span><span class="p">(</span><span class="mf">5.30</span><span class="p">));</span>

        <span class="c1">// Nous devrions toujours avoir 2 chiffres après la virgule</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;USD 1.00&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span><span class="o">-&gt;</span><span class="na">usd</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span><span class="s1">&#39;USD 2.05&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span><span class="o">-&gt;</span><span class="na">usd</span><span class="p">(</span><span class="mf">2.05</span><span class="p">));</span>

        <span class="c1">// Test du séparateur de milliers</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEquals</span><span class="p">(</span>
          <span class="s1">&#39;USD 12,000.70&#39;</span><span class="p">,</span>
          <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">helper</span><span class="o">-&gt;</span><span class="na">usd</span><span class="p">(</span><span class="mf">12000.70</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ici nous appelons <code class="docutils literal"><span class="pre">usd()</span></code> avec des paramètres différents et disons à test
suite de vérifier si les valeurs retournées sont égales à ce que nous en
attendons.</p>
<p>Sauvegardons cela et exécutons le test. Vous devriez voir une barre verte et
un message indiquant 1 passé et 4 assertions.</p>
<p>Lorsque vous testez un Helper qui utilise d&#8217;autres Helpers, assurez-vous de
créer un mock de la méthode <code class="docutils literal"><span class="pre">loadHelpers</span></code> de la classe View.</p>
</div>
<div class="section" id="tester-les-events">
<span id="testing-events"></span><h2>Tester les Events<a class="headerlink" href="#tester-les-events" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les <a class="reference internal" href="../core-libraries/events.html"><span class="doc">Événements système</span></a> sont un bon moyen pour découpler le code de
votre application, mais parfois quand nous les testons, nous avons tendance à
tester les événements dans les cas de test qui éxecutent ces événements. C&#8217;est
une forme supplémentaire de couplage qui peut être évitée en utilisant
à la place <code class="docutils literal"><span class="pre">assertEventFired</span></code> et <code class="docutils literal"><span class="pre">assertEventFiredWith</span></code>.</p>
<p>En poursuivant l&#8217;exemple sur les Orders, disons que nous avons les tables
suivantes:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">OrdersTable</span> <span class="k">extends</span> <span class="nx">Table</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">place</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$order</span><span class="p">))</span> <span class="p">{</span>
            <span class="c1">// moved cart removal to CartsTable</span>
            <span class="nv">$event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="s1">&#39;Model.Order.afterPlace&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="p">,</span> <span class="p">[</span>
                <span class="s1">&#39;order&#39;</span> <span class="o">=&gt;</span> <span class="nv">$order</span>
            <span class="p">]);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$event</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">CartsTable</span> <span class="k">extends</span> <span class="nx">Table</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">implementedEvents</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="s1">&#39;Model.Order.afterPlace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;removeFromCart&#39;</span>
        <span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">removeFromCart</span><span class="p">(</span><span class="nx">Event</span> <span class="nv">$event</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$order</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">getData</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">(</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">cart_id</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Pour faire des assertions sur le fait que des événements sont déclenchés,
vous devez d&#8217;abord activer <a class="reference internal" href="../core-libraries/events.html#tracking-events"><span class="std std-ref">Suivre la Trace des Événements</span></a> sur le gestionnaire
d&#8217;événements pour lequel vous souhaitez faire des asserts.</p>
</div>
<p>Pour tester le <code class="docutils literal"><span class="pre">OrdersTable</span></code> du dessus, vous devez activer le tracking dans la
méthode <code class="docutils literal"><span class="pre">setUp()</span></code> puis vérifier par exemple que l&#8217;événement a été déclenché,
puis que l&#8217;entity <code class="docutils literal"><span class="pre">$order</span></code> a été passée dans les données de l&#8217;événement:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">App\Test\TestCase\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Model\Table\OrdersTable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\Event\EventList</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\ORM\TableRegistry</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrdersTableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>

    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;app.orders&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">parent</span><span class="o">::</span><span class="na">setUp</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span> <span class="o">=</span> <span class="nx">TableRegistry</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;Orders&#39;</span><span class="p">);</span>
        <span class="c1">// enable event tracking</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">setEventList</span><span class="p">(</span><span class="k">new</span> <span class="nx">EventList</span><span class="p">());</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testPlace</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$order</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Order</span><span class="p">([</span>
            <span class="s1">&#39;user_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;item&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Cake&#39;</span><span class="p">,</span>
            <span class="s1">&#39;quantity&#39;</span> <span class="o">=&gt;</span> <span class="mi">42</span><span class="p">,</span>
        <span class="p">]);</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span><span class="o">-&gt;</span><span class="na">place</span><span class="p">(</span><span class="nv">$order</span><span class="p">));</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEventFired</span><span class="p">(</span><span class="s1">&#39;Model.Order.afterPlace&#39;</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="p">());</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEventFiredWith</span><span class="p">(</span><span class="s1">&#39;Model.Order.afterPlace&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">,</span> <span class="nv">$order</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Orders</span><span class="o">-&gt;</span><span class="na">eventManager</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Par défaut, l&#8217;<code class="docutils literal"><span class="pre">EventManager</span></code> global est utilisé pour les assertions, donc
tester les événements globaux ne nécessitent pas de passer le gestionnaire
d&#8217;événements:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEventFired</span><span class="p">(</span><span class="s1">&#39;My.Global.Event&#39;</span><span class="p">);</span>
<span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertEventFiredWith</span><span class="p">(</span><span class="s1">&#39;My.Global.Event&#39;</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<div class="versionadded">
<p><span class="versionmodified">Nouveau dans la version 3.2.11: </span>Le tracking d&#8217;événement, <code class="docutils literal"><span class="pre">assertEventFired()</span></code>, et <code class="docutils literal"><span class="pre">assertEventFiredWith</span></code>
ont été ajoutés.</p>
</div>
</div>
<div class="section" id="creer-des-suites-de-test-test-suites">
<h2>Créer des Suites de Test (Test Suites)<a class="headerlink" href="#creer-des-suites-de-test-test-suites" title="Lien permanent vers ce titre">¶</a></h2>
<p>Si vous voulez que plusieurs de vos tests s&#8217;exécutent en même temps, vous pouvez
créer une suite de tests. Une suite de test est composée de plusieurs cas de
test. Vous pouvez créer des suites de tests dans le fichier <code class="docutils literal"><span class="pre">phpunit.xml</span></code> de
votre application. Un exemple simple serait:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;testsuites&gt;</span>
  <span class="nt">&lt;testsuite</span> <span class="na">name=</span><span class="s">&quot;Models&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;directory&gt;</span>src/Model<span class="nt">&lt;/directory&gt;</span>
    <span class="nt">&lt;file&gt;</span>src/Service/UserServiceTest.php<span class="nt">&lt;/file&gt;</span>
    <span class="nt">&lt;exclude&gt;</span>src/Model/Cloud/ImagesTest.php<span class="nt">&lt;/exclude&gt;</span>
  <span class="nt">&lt;/testsuite&gt;</span>
<span class="nt">&lt;/testsuites&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="creer-des-tests-pour-les-plugins">
<h2>Créer des Tests pour les Plugins<a class="headerlink" href="#creer-des-tests-pour-les-plugins" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les Tests pour les plugins sont créés dans leur propre répertoire à
l&#8217;intérieur du dossier des plugins:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="o">/</span><span class="nx">src</span>
<span class="o">/</span><span class="nx">plugins</span>
    <span class="o">/</span><span class="nx">Blog</span>
        <span class="o">/</span><span class="nx">tests</span>
            <span class="o">/</span><span class="nx">TestCase</span>
            <span class="o">/</span><span class="nx">Fixture</span>
</pre></div>
</div>
<p>Ils fonctionnent comme des tests normaux mais vous devrez vous souvenir
d&#8217;utiliser les conventions de nommage pour les plugins quand vous importez des
classes. Ceci est un exemple d&#8217;un cas de test pour le model <code class="docutils literal"><span class="pre">BlogPost</span></code> à
partir du chapitre des plugins de ce manuel. Une différence par rapport aux
autres test est dans la première ligne où &#8216;Blog.BlogPost&#8217; est importé. Vous
devrez aussi préfixer les fixtures de votre plugin avec
<code class="docutils literal"><span class="pre">plugin.blog.blog_posts</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="k">namespace</span> <span class="nx">Blog\Test\TestCase\Model\Table</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Blog\Model\Table\BlogPostsTable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Cake\TestSuite\TestCase</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BlogPostsTableTest</span> <span class="k">extends</span> <span class="nx">TestCase</span>
<span class="p">{</span>

    <span class="c1">// Fixtures de plugin se trouvant dans /plugins/Blog/tests/Fixture/</span>
    <span class="k">public</span> <span class="nv">$fixtures</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plugin.blog.blog_posts&#39;</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testSomething</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// Teste quelque chose.</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Si vous voulez utiliser les fixtures de plugin dans les app tests, vous pouvez
y faire référence en utilisant la syntaxe <code class="docutils literal"><span class="pre">plugin.pluginName.fixtureName</span></code>
dans le tableau <code class="docutils literal"><span class="pre">$fixtures</span></code>.</p>
<p>Avant d&#8217;utiliser des fixtures assurez-vous que votre <code class="docutils literal"><span class="pre">phpunit.xml</span></code>
contienne un listener (écouteur) pour les fixtures:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="o">&lt;!--</span> <span class="nx">Configure</span> <span class="nx">un</span> <span class="nx">listener</span> <span class="nx">pour</span> <span class="nx">les</span> <span class="nx">fixtures</span> <span class="o">--&gt;</span>
<span class="o">&lt;</span><span class="nx">listeners</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">listener</span>
    <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;\Cake</span><span class="se">\T</span><span class="s2">estSuite\Fixture\FixtureInjector&quot;</span>
    <span class="nb">file</span><span class="o">=</span><span class="s2">&quot;./vendor/cakephp/cakephp/src/TestSuite/Fixture/FixtureInjector.php&quot;</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="nx">arguments</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="nx">object</span> <span class="nx">class</span><span class="o">=</span><span class="s2">&quot;\Cake</span><span class="se">\T</span><span class="s2">estSuite\Fixture\FixtureManager&quot;</span> <span class="o">/&gt;</span>
        <span class="o">&lt;/</span><span class="nx">arguments</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="nx">listener</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="nx">listeners</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Vous devez également vous assurer que vos fixtures sont chargeables.
Vérifiez que le code suivant est présent dans votre fichier <code class="docutils literal"><span class="pre">composer.json</span></code>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="s2">&quot;autoload-dev&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;psr-4&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;MyPlugin</span><span class="se">\\</span><span class="s2">Test</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">:</span> <span class="s2">&quot;./plugins/MyPlugin/tests&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">N&#8217;oubliez pas de lancer <code class="docutils literal"><span class="pre">composer.phar</span> <span class="pre">dumpautoload</span></code> lorsque vous modifiez
le mapping de l&#8217;autoloader.</p>
</div>
</div>
<div class="section" id="generer-des-tests-avec-bake">
<h2>Générer des Tests avec Bake<a class="headerlink" href="#generer-des-tests-avec-bake" title="Lien permanent vers ce titre">¶</a></h2>
<p>Si vous utilisez <a class="reference internal" href="../bake/usage.html"><span class="doc">bake</span></a> pour générer votre code, il va
également générer le squelette de vos fichiers de tests. Si vous avez besoin
de re-générer le squelette de vos fichiers de tests, ou si vous souhaitez
générer le squelette de test pour le code que vous avez écrit, vous pouvez
utiliser <code class="docutils literal"><span class="pre">bake</span></code>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>bin/cake bake <span class="nb">test</span> &lt;type&gt; &lt;name&gt;
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">&lt;type&gt;</span></code> doit être une de ces options:</p>
<ol class="arabic simple">
<li>Entity</li>
<li>Table</li>
<li>Controller</li>
<li>Component</li>
<li>Behavior</li>
<li>Helper</li>
<li>Shell</li>
<li>Cell</li>
</ol>
<p><code class="docutils literal"><span class="pre">&lt;name&gt;</span></code> doit être le nom de l&#8217;objet dont vous voulez générer le squelette de
tests.</p>
</div>
<div class="section" id="integration-avec-jenkins">
<h2>Intégration avec Jenkins<a class="headerlink" href="#integration-avec-jenkins" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="http://jenkins-ci.org">Jenkins</a> est un serveur d&#8217;intégration continu, qui
peut vous aider à automatiser l&#8217;exécution de vos cas de test. Cela aide à
s&#8217;assurer que tous les tests passent et que votre application est déjà
prête.</p>
<p>Intégrer une application CakePHP avec Jenkins est assez simple. Ce qui suit
suppose que vous avez déjà installé Jenkins sur un système *nix, et que vous
êtes capable de l&#8217;administrer. Vous savez aussi comment créer des jobs, et
lancer des builds. Si vous n&#8217;êtes pas sur de tout cela, référez vous à la
<a class="reference external" href="http://jenkins-ci.org/">documentation de Jenkins</a>.</p>
<div class="section" id="creer-un-job">
<h3>Créer un Job<a class="headerlink" href="#creer-un-job" title="Lien permanent vers ce titre">¶</a></h3>
<p>Commençons par créer un job pour votre application, et connectons votre
répertoire afin que jenkins puisse accéder à votre code.</p>
</div>
<div class="section" id="ajouter-une-config-de-base-de-donnees-de-test">
<h3>Ajouter une Config de Base de Données de Test<a class="headerlink" href="#ajouter-une-config-de-base-de-donnees-de-test" title="Lien permanent vers ce titre">¶</a></h3>
<p>Utiliser une base de données séparée juste pour Jenkins est généralement une
bonne idée, puisque cela évite au sang de couler et évite un certain nombre
de problèmes basiques. Une fois que vous avez créé une nouvelle base de données
dans un serveur de base de données auquel jenkins peut accéder (habituellement
localhost). Ajoutez une <em>étape de script shell</em> au build qui contient ce qui
suit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>cat &gt; config/app_local.php <span class="s">&lt;&lt;&#39;CONFIG&#39;</span>
<span class="s">&lt;?php</span>
<span class="s">return [</span>
<span class="s">    &#39;Datasources&#39; =&gt; [</span>
<span class="s">        &#39;test&#39; =&gt; [</span>
<span class="s">            &#39;datasource&#39; =&gt; &#39;Database/Mysql&#39;,</span>
<span class="s">            &#39;host&#39;       =&gt; &#39;localhost&#39;,</span>
<span class="s">            &#39;database&#39;   =&gt; &#39;jenkins_test&#39;,</span>
<span class="s">            &#39;username&#39;   =&gt; &#39;jenkins&#39;,</span>
<span class="s">            &#39;password&#39;   =&gt; &#39;cakephp_jenkins&#39;,</span>
<span class="s">            &#39;encoding&#39;   =&gt; &#39;utf8&#39;</span>
<span class="s">        ]</span>
<span class="s">    ]</span>
<span class="s">];</span>
<span class="s">CONFIG</span>
</pre></div>
</div>
<p>Ensuite, décommentez la ligne suivante dans votre fichier
<strong>config/bootstrap.php</strong>:</p>
<div class="highlight-phpinline"><div class="highlight"><pre><span></span><span class="c1">//Configure::load(&#39;app_local&#39;, &#39;default&#39;);</span>
</pre></div>
</div>
<p>En créant un fichier <strong>app_local.php</strong>, vous avez un moyen facile de définir une
configuration spécifique pour Jenkins. Vous pouvez utiliser ce même fichier de
configuration pour remplacer tous les autres fichiers de configuration dont vous
avez besoin sur Jenkins.</p>
<p>Il est souvent une bonne idée de supprimer et re-créer la base de données avant
chaque build aussi. Cela vous évite des echecs de chaînes, où un build cassé
entraîne l&#8217;echec des autres. Ajoutez une autre <em>étape de script shell</em> au build
qui contient ce qui suit:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mysql -u jenkins -pcakephp_jenkins -e <span class="s1">&#39;DROP DATABASE IF EXISTS jenkins_test; CREATE DATABASE jenkins_test&#39;</span><span class="p">;</span>
</pre></div>
</div>
</div>
<div class="section" id="ajouter-vos-tests">
<h3>Ajouter vos Tests<a class="headerlink" href="#ajouter-vos-tests" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ajoutez une autre <em>étape de script shell</em> à votre build. Dans cette étape,
lancez les tests pour votre application. Créer un fichier de log junit, ou
clover coverage est souvent un bonus sympa, puisqu&#8217;il vous donne une vue
graphique sympa des résultats de votre test:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="c1"># Télécharger Composer s&#39;il est manquant.</span>
<span class="nb">test</span> -f <span class="s1">&#39;composer.phar&#39;</span> <span class="o">||</span> curl -sS https://getcomposer.org/installer <span class="p">|</span> php
<span class="c1"># Installer les dépendances.</span>
php composer.phar install
vendor/bin/phpunit --log-junit junit.xml --coverage-clover clover.xml
</pre></div>
</div>
<p>Si vous utilisez le clover coverage, ou les résultats junit, assurez-vous de
les configurer aussi dans Jenkins. Ne pas configurer ces étapes signifiera
que vous ne verrez pas les résultats.</p>
</div>
<div class="section" id="lancer-un-build">
<h3>Lancer un Build<a class="headerlink" href="#lancer-un-build" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous devriez être capable de lancer un build maintenant. Vérifiez la sortie de
la console et faites tous les changements nécessaires pour obtenir le build
précédent.</p>
</div>
</div>
</div>


            </div>
        </div>

        
        <div class="col-md-3 col-md-pull-9 hidden-xs hidden-sm" lang="fr">
            <aside class="sidebar">
                <div class="mb30 row">
<div id="sidebar-navigation" class="hidden-xs">
	<p class="caption"><span class="caption-text">Préface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">CakePHP en un Coup d&#8217;Oeil</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Guide de Démarrage Rapide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices/3-x-migration-guide.html">3.x Guide de Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials-and-examples.html">Tutoriels et exemples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribuer</a></li>
</ul>
<p class="caption"><span class="caption-text">Pour Commencer</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="routing.html">Routing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/request-response.html">Les Objets Request &amp; Response</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/middleware.html">Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers.html">Controllers (Contrôleurs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../views.html">Views (Vues)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../orm.html">Accès Base de Données &amp; ORM</a></li>
</ul>
<p class="caption"><span class="caption-text">Généralités</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/authentication.html">Authentification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bake.html">Console Bake</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/caching.html">La mise en cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../console-and-shells.html">Outils de Console, Shells, &amp; Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Debugger</a></li>
<li class="toctree-l1"><a class="reference internal" href="../deployment.html">Déploiement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/email.html">Email</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">Gestion des Erreurs &amp; Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/events.html">Événements système</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/internationalization-and-localization.html">Internationalisation &amp; Localisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/logging.html">Journalisation (logging)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/form.html">Formulaires Sans Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="../controllers/components/pagination.html">Pagination</a></li>
<li class="toctree-l1"><a class="reference internal" href="../plugins.html">Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="rest.html">REST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">Sécurité</a></li>
<li class="toctree-l1"><a class="reference internal" href="sessions.html">Sessions</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/validation.html">Validation</a></li>
</ul>
<p class="caption"><span class="caption-text">Utilitaires</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/app.html">Classe App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/collections.html">Collections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/file-folder.html">Folder &amp; File</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/hash.html">Hash</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/httpclient.html">Client Http</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/inflector.html">Inflector</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/number.html">Number</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/registry-objects.html">Objets Registry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/text.html">Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/time.html">Date &amp; Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/xml.html">Xml</a></li>
</ul>
<p class="caption"><span class="caption-text">Divers</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../core-libraries/global-constants-and-functions.html">Globales &amp; Fonctions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../chronos.html">Chronos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../debug-kit.html">Debug Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migrations.html">Migrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elasticsearch.html">ElasticSearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade-tool.html">Outil d&#8217;Upgrade</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendices.html">Annexes</a></li>
</ul>

</div>

                </div>
            </aside>
            <aside class="sidebar">
                <div class="mb30 row">
                </div>
            </aside>
        </div>
    </div>
</div>

<section id="socials" class="back-3">
    <div class="container-fluid">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-5  social text-center">
                <div class="col-sm-3 col-xs-3">
                    <div id="fb-root"></div>
                        <script>(function(d, s, id) {
                          var js, fjs = d.getElementsByTagName(s)[0];
                          if (d.getElementById(id)) return;
                          js = d.createElement(s); js.id = id;
                          js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5";
                          fjs.parentNode.insertBefore(js, fjs);
                        }(document, 'script', 'facebook-jssdk'));
                        </script>
                        <div id="fb-root-face" class="fb-like" data-href="https://www.facebook.com/CakePHP/" data-layout="button_count" data-action="like" data-show-faces="true" data-share="false"></div>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=star&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <iframe src="https://ghbtns.com/github-btn.html?user=cakephp&amp;repo=cakephp&amp;type=fork&amp;count=true&amp;size=small" frameborder="0" scrolling="0" width="120px" height="30px"></iframe>
                </div>

                <div class="col-sm-3 col-xs-3">
                    <a href="https://twitter.com/CakePHP" class="twitter-follow-button" data-show-count="false" data-show-screen-name="false">Follow @CakePHP</a>
                    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
                </div>
            </div>

            <div class="col-xs-12 col-sm-12 col-md-7 social-footer text-center ">
                <a href="https://twitter.com/cakephp" data-toggle="tooltip" title="Twitter"><i class="fa icon-social fa-twitter"></i>
                <a href="https://www.facebook.com/groups/cake.community" data-toggle="tooltip" title="Facebook"><i class="fa icon-social fa-facebook"></i></a>
                <a href="https://goo.gl/mSC0s" data-toggle="tooltip" title="Google Plus"><i class="fa icon-social  fa-google-plus"></i></a>
                <a href="https://www.youtube.com/user/CakePHP" data-toggle="tooltip" title="Youtube"><i class="fa icon-social fa-youtube-play"></i></a>
                <a href="https://github.com/cakephp" data-toggle="tooltip" title="Github"><i class="fa icon-social fa-git"></i></a>
                <a href="https://cakesf.herokuapp.com/" target="_blank" title="Slack" data-toggle="tooltip"><i class="fa fa-slack icon-social"></i></a>
                <a href="https://stackoverflow.com/tags/cakephp" data-toggle="tooltip" title="Stack Overflow"><i class="fa icon-social fa-stack-overflow"></i></a>
                <a href="https://webchat.freenode.net/?channels=cakephp" data-toggle="tooltip" title="IRC" class="icon-irc">#IRC</a>
            </div>
        </div>
    </div>
</section>

<footer id="footer" class="footer-wrapper">
    <div class="container">

        <div class="row col-p30">
            <div class="col-sm-12 col-md-3">
                <div class="footer-widget t-footer">
                    <div class="col-md-12">
                        <a href="https://www.openhub.net/p/cakephp">
                            <img src="../_static/open-hub.png">
                        </a>
                        <div class="mt10">
                            <a href="https://www.rackspace.com/">
                                <img src="../_static/rackspace.png">
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-md-9">
                <div class="col-md-3 col-sm-6 business-solution">
                    <ul class="footer-menu">
                        <li class="menu-title">
    <a href="https://cakephp.org/business-solutions"><i class="fa fa-menu-title fa-briefcase"></i>Business Solutions</a>
</li>
<li class="menu-title mt30">
    <a href="https://cakephp.org/showcase"><i class="fa fa-menu-title fa-desktop"></i>Showcase</a>
</li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title">
	<i class="fa fa-menu-title fa-book"></i>Documentation
</li>

<li><a href="https://book.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Book</a></li>
<li><a href="https://api.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>API</a></li>

<li><a href="https://cakephp.org/documentation/videos"><i class="fa fa-menu fa-chevron-right"></i>Videos</a></li>
<li><a href="https://cakephp.org/privacy"><i class="fa fa-menu fa-chevron-right"></i>Privacy Policy</a></li>
<li><a href="https://cakephp.org/pages/trademark"><i class="fa fa-menu fa-chevron-right"></i>Logos &amp; Trademarks</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-users"></i>Community</li>

<li><a href="https://cakephp.org/team"><i class="fa fa-menu fa-chevron-right"></i>Team</a></li>
<li><a href="https://github.com/cakephp/cakephp/issues"><i class="fa fa-menu fa-chevron-right"></i>Issues (Github)</a></li>
<li><a href="https://www.youtube.com/user/CakePHP"><i class="fa fa-menu fa-chevron-right"></i>YouTube Channel</a></li>
<li><a href="https://cakephp.org/get-involved"><i class="fa fa-menu fa-chevron-right"></i>Get Involved</a></li>

<li><a href="https://bakery.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Bakery</a></li>
<li><a href="https://github.com/FriendsOfCake/awesome-cakephp"><i class="fa fa-menu fa-chevron-right"></i>Featured Resources</a></li>
<li><a href="https://cakephp.org/newsletter/signup"><i class="fa fa-menu fa-chevron-right"></i>Newsletter</a></li>
<li><a href="http://certification.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Certification</a></li>
<li><a href="http://my.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>My CakePHP</a></li>
<li><a href="http://cakefest.org"><i class="fa fa-menu fa-chevron-right"></i>CakeFest</a></li>
<li><a href="https://www.facebook.com/groups/cake.community"><i class="fa fa-menu fa-chevron-right"></i>Facebook</a></li>
<li><a href="https://twitter.com/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Twitter</a></li>
                    </ul>
                </div>

                <div class="col-md-3 col-sm-6">
                    <ul class="footer-menu">
                        
<li class="menu-title"><i class="fa fa-menu-title fa-comments-o"></i>Help &amp; Support</li>

<li><a href="http://discourse.cakephp.org"><i class="fa fa-menu fa-chevron-right"></i>Forum</a></li>
<li><a href="https://stackoverflow.com/tags/cakephp"><i class="fa fa-menu fa-chevron-right"></i>Stack Overflow</a></li>
<li><a href="https://webchat.freenode.net/?channels=cakephp"><i class="fa fa-menu fa-chevron-right"></i>IRC</a></li>
<li><a href="https://cakesf.herokuapp.com/"><i class="fa fa-menu fa-chevron-right"></i>Slack</a></li>
<li><a href="https://www.cakedc.com/"><i class="fa fa-menu fa-chevron-right"></i>Paid Support</a></li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 text-center mt30">
                <p class="copyright">
                            &copy; Copyright 2017, Cake Software Foundation, Inc.
                        Mis à jour le août 30, 2017.
                        Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.4.5.
                </p>
            </div>
        </div>
    </div>
</footer>

<div id="inline-search-results"></div>


</div>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-743287-3']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>
  </body>
</html>